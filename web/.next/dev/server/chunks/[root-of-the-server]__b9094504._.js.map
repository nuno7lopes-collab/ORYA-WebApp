{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/env.ts"],"sourcesContent":["// Central helper for server-side environment variables (server-only).\n// ⚠️ Não importar este módulo em componentes com \"use client\".\nconst required = [\n  \"SUPABASE_URL\",\n  \"SUPABASE_ANON_KEY\",\n  \"SUPABASE_SERVICE_ROLE\",\n  \"DATABASE_URL\",\n  \"STRIPE_SECRET_KEY\",\n  \"STRIPE_WEBHOOK_SECRET\",\n  \"QR_SECRET_KEY\",\n  \"RESEND_API_KEY\",\n] as const;\n\ntype EnvKey = (typeof required)[number];\n\nfunction getEnv(key: EnvKey): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing env var: ${key}`);\n  }\n  return value;\n}\n\nfunction getOptionalUrlEnv(...keys: string[]) {\n  for (const key of keys) {\n    const value = process.env[key];\n    if (typeof value === \"string\" && value.trim().length > 0) {\n      return value.trim().replace(/\\/+$/, \"\"); // remove trailing slash para URLs previsíveis\n    }\n  }\n  return \"\";\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseList(raw: unknown) {\n  if (typeof raw !== \"string\") return [];\n  return raw\n    .split(/[,\\s]+/g)\n    .map((item) => item.trim())\n    .filter(Boolean);\n}\n\nexport const env = {\n  supabaseUrl: getEnv(\"SUPABASE_URL\"),\n  supabaseAnonKey: getEnv(\"SUPABASE_ANON_KEY\"),\n  serviceRoleKey: getEnv(\"SUPABASE_SERVICE_ROLE\"),\n  dbUrl: getEnv(\"DATABASE_URL\"),\n  stripeSecretKey: getEnv(\"STRIPE_SECRET_KEY\"),\n  stripeWebhookSecret: getEnv(\"STRIPE_WEBHOOK_SECRET\"),\n  qrSecretKey: getEnv(\"QR_SECRET_KEY\"),\n  resendApiKey: getEnv(\"RESEND_API_KEY\"),\n  resendFrom:\n    process.env.RESEND_FROM ??\n    process.env.RESEND_FROM_EMAIL ??\n    \"no-reply@orya.pt\",\n  appBaseUrl: getOptionalUrlEnv(\"APP_BASE_URL\", \"NEXT_PUBLIC_BASE_URL\", \"NEXT_PUBLIC_SITE_URL\", \"VERCEL_URL\"),\n  uploadsBucket:\n    process.env.SUPABASE_STORAGE_BUCKET_UPLOADS ??\n    process.env.SUPABASE_STORAGE_BUCKET ??\n    \"uploads\",\n  avatarsBucket: process.env.SUPABASE_STORAGE_BUCKET_AVATARS ?? \"\",\n  eventCoversBucket: process.env.SUPABASE_STORAGE_BUCKET_EVENT_COVERS ?? \"\",\n  storageSignedUrls: parseBoolean(process.env.SUPABASE_STORAGE_SIGNED_URLS, false),\n  storageSignedTtlSeconds: parseNumber(process.env.SUPABASE_STORAGE_SIGNED_TTL_SECONDS, 60 * 60 * 24 * 30), // 30 dias\n  stripePremiumPriceIds: parseList(process.env.STRIPE_PREMIUM_PRICE_IDS),\n  stripePremiumProductIds: parseList(process.env.STRIPE_PREMIUM_PRODUCT_IDS),\n};\n"],"names":[],"mappings":"AAAA,sEAAsE;AACtE,+DAA+D;;;;;AAC/D,MAAM,WAAW;IACf;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAID,SAAS,OAAO,GAAW;IACzB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK;IAC3C;IACA,OAAO;AACT;AAEA,SAAS,kBAAkB,GAAG,IAAc;IAC1C,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;QAC9B,IAAI,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;YACxD,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,8CAA8C;QACzF;IACF;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAY,EAAE,QAAiB;IACnD,IAAI,OAAO,QAAQ,WAAW,OAAO;IACrC,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,aAAa,IAAI,IAAI,GAAG,WAAW;QACzC,IAAI;YAAC;YAAK;YAAQ;YAAO;SAAK,CAAC,QAAQ,CAAC,aAAa,OAAO;QAC5D,IAAI;YAAC;YAAK;YAAS;YAAM;SAAM,CAAC,QAAQ,CAAC,aAAa,OAAO;IAC/D;IACA,OAAO;AACT;AAEA,SAAS,YAAY,GAAY,EAAE,QAAgB;IACjD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO,EAAE;IACtC,OAAO,IACJ,KAAK,CAAC,WACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC;AACZ;AAEO,MAAM,MAAM;IACjB,aAAa,OAAO;IACpB,iBAAiB,OAAO;IACxB,gBAAgB,OAAO;IACvB,OAAO,OAAO;IACd,iBAAiB,OAAO;IACxB,qBAAqB,OAAO;IAC5B,aAAa,OAAO;IACpB,cAAc,OAAO;IACrB,YACE,QAAQ,GAAG,CAAC,WAAW,IACvB,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IACF,YAAY,kBAAkB,gBAAgB,wBAAwB,wBAAwB;IAC9F,eACE,QAAQ,GAAG,CAAC,+BAA+B,IAC3C,QAAQ,GAAG,CAAC,uBAAuB,IACnC;IACF,eAAe,QAAQ,GAAG,CAAC,+BAA+B,IAAI;IAC9D,mBAAmB,QAAQ,GAAG,CAAC,oCAAoC,IAAI;IACvE,mBAAmB,aAAa,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC1E,yBAAyB,YAAY,QAAQ,GAAG,CAAC,mCAAmC,EAAE,KAAK,KAAK,KAAK;IACrG,uBAAuB,UAAU,QAAQ,GAAG,CAAC,wBAAwB;IACrE,yBAAyB,UAAU,QAAQ,GAAG,CAAC,0BAA0B;AAC3E"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { Prisma, PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport { env } from \"@/lib/env\";\n\n// Toggle de logs verbose (queries) via env: PRISMA_LOG_QUERIES=true\nconst enableQueryLog = process.env.PRISMA_LOG_QUERIES === \"true\";\nconst logLevels: (Prisma.LogLevel | Prisma.LogDefinition)[] =\n  process.env.NODE_ENV === \"development\"\n    ? enableQueryLog\n      ? [\"query\", \"error\", \"warn\"]\n      : [\"error\", \"warn\"]\n    : [\"error\"];\n\n// Evitar múltiplas instâncias em dev (hot reload)\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\n// Pool e adapter para usar o client engine (\"library\") com Postgres\nconst pool = new Pool({\n  connectionString: env.dbUrl,\n  ssl:\n    process.env.NODE_ENV === \"production\"\n      ? undefined\n      : { rejectUnauthorized: false },\n});\n\nconst adapter = new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: logLevels,\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;AACA;AACA;;;;;;;;;;AAEA,oEAAoE;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK;AAC1D,MAAM,YACJ,uCACI,iBACE;IAAC;IAAS;IAAS;CAAO,GAC1B;IAAC;IAAS;CAAO,GACnB;AAEN,kDAAkD;AAClD,MAAM,kBAAkB;AAIxB,oEAAoE;AACpE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,mHAAG,CAAC,KAAK;IAC3B,KACE,sCACI,0BACA;QAAE,oBAAoB;IAAM;AACpC;AAEA,MAAM,UAAU,IAAI,8JAAQ,CAAC;AAEtB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK;AACP;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/supabaseServer.ts"],"sourcesContent":["import \"server-only\";\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { env } from \"@/lib/env\";\n\nfunction decodeBase64Cookie(raw: string) {\n  const BASE64_PREFIX = \"base64-\";\n  if (!raw.startsWith(BASE64_PREFIX)) return raw;\n\n  const base = raw.slice(BASE64_PREFIX.length);\n  const encodings: BufferEncoding[] = [\"base64url\", \"base64\"];\n\n  for (const enc of encodings) {\n    try {\n      return Buffer.from(base, enc).toString(\"utf-8\");\n    } catch {\n      /* try next */\n    }\n  }\n\n  // Se não conseguirmos decodificar, tratamos como cookie ausente para evitar JSON.parse de strings inválidas\n  return undefined;\n}\n\n/**\n * Server-side Supabase client (SSR + Route Handlers)\n * - Safe cookie reading\n * - Safe cookie writing\n * - Prevents JSON parse errors\n * - No profile fetching here\n */\nexport async function createSupabaseServer() {\n  const cookieStore = (await cookies());\n\n  const supabase = createServerClient(\n    env.supabaseUrl,\n    env.supabaseAnonKey,\n    {\n      cookies: {\n        get(name: string) {\n          try {\n            // Só devolvemos cookies do Supabase (sb-*) e ignoramos o resto\n            if (!name.startsWith(\"sb-\")) return undefined;\n            const raw = cookieStore.get(name)?.value;\n            if (!raw) return undefined;\n\n            // Se for um chunk (sb-*.0, sb-*.1, ...), deixamos intacto para o combinador do Supabase tratar\n            const isChunk = /\\.\\d+$/.test(name);\n            return isChunk ? raw : decodeBase64Cookie(raw);\n          } catch {\n            return undefined;\n          }\n        },\n        set(name: string, value: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value, ...options });\n          } catch {\n            /* ignore errors for RSC */\n          }\n        },\n        remove(name: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value: \"\", ...options, maxAge: 0 });\n          } catch {\n            /* ignore */\n          }\n        },\n      },\n    }\n  );\n\n  return supabase;\n}\n\n\nexport async function getCurrentUser() {\n  const supabase = await createSupabaseServer();\n\n  try {\n    const { data, error } = await supabase.auth.getUser();\n\n    if (error || !data?.user) {\n      return { user: null, error };\n    }\n\n    return { user: data.user, error: null };\n  } catch (err) {\n    return { user: null, error: err };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,SAAS,mBAAmB,GAAW;IACrC,MAAM,gBAAgB;IACtB,IAAI,CAAC,IAAI,UAAU,CAAC,gBAAgB,OAAO;IAE3C,MAAM,OAAO,IAAI,KAAK,CAAC,cAAc,MAAM;IAC3C,MAAM,YAA8B;QAAC;QAAa;KAAS;IAE3D,KAAK,MAAM,OAAO,UAAW;QAC3B,IAAI;YACF,OAAO,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;QACzC,EAAE,OAAM;QACN,YAAY,GACd;IACF;IAEA,4GAA4G;IAC5G,OAAO;AACT;AASO,eAAe;IACpB,MAAM,cAAe,MAAM,IAAA,4IAAO;IAElC,MAAM,WAAW,IAAA,iMAAkB,EACjC,mHAAG,CAAC,WAAW,EACf,mHAAG,CAAC,eAAe,EACnB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,IAAI;oBACF,+DAA+D;oBAC/D,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,OAAO;oBACpC,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBACnC,IAAI,CAAC,KAAK,OAAO;oBAEjB,+FAA+F;oBAC/F,MAAM,UAAU,SAAS,IAAI,CAAC;oBAC9B,OAAO,UAAU,MAAM,mBAAmB;gBAC5C,EAAE,OAAM;oBACN,OAAO;gBACT;YACF;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAgC;gBAC/D,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAM;gBACN,yBAAyB,GAC3B;YACF;YACA,QAAO,IAAY,EAAE,OAAgC;gBACnD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBAC3D,EAAE,OAAM;gBACN,UAAU,GACZ;YACF;QACF;IACF;IAGF,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEnD,IAAI,SAAS,CAAC,MAAM,MAAM;YACxB,OAAO;gBAAE,MAAM;gBAAM;YAAM;QAC7B;QAEA,OAAO;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO;QAAK;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,MAAM;YAAM,OAAO;QAAI;IAClC;AACF"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerRoles.ts"],"sourcesContent":["import { OrganizerMemberRole, Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype TxLike = Prisma.TransactionClient | PrismaClient;\n\n/**\n * Garante unicidade de OWNER numa organização:\n * - promove/cria o utilizador como OWNER\n * - despromove todos os outros OWNER para CO_OWNER\n */\nexport async function setSoleOwner(\n  client: TxLike,\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  await client.organizerMember.upsert({\n    where: { organizerId_userId: { organizerId, userId } },\n    update: { role: OrganizerMemberRole.OWNER },\n    create: {\n      organizerId,\n      userId,\n      role: OrganizerMemberRole.OWNER,\n      invitedByUserId: invitedByUserId ?? undefined,\n    },\n  });\n\n  await client.organizerMember.updateMany({\n    where: { organizerId, role: OrganizerMemberRole.OWNER, userId: { not: userId } },\n    data: { role: OrganizerMemberRole.CO_OWNER },\n  });\n}\n\n/**\n * Marca o perfil como \"organizer\" no array de roles (idempotente).\n */\nexport async function ensureUserIsOrganizer(client: TxLike, userId: string) {\n  const targetProfile = await client.profile.findUnique({\n    where: { id: userId },\n    select: { roles: true },\n  });\n  if (!targetProfile) return;\n\n  const roles = Array.isArray(targetProfile.roles) ? targetProfile.roles : [];\n  if (!roles.includes(\"organizer\")) {\n    await client.profile.update({\n      where: { id: userId },\n      data: { roles: [...roles, \"organizer\"] },\n    });\n  }\n}\n\n/**\n * Wrapper que permite usar helper fora de transação quando necessário.\n */\nexport async function setSoleOwnerSafe(\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  return setSoleOwner(prisma, organizerId, userId, invitedByUserId);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AASO,eAAe,aACpB,MAAc,EACd,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,MAAM,OAAO,eAAe,CAAC,MAAM,CAAC;QAClC,OAAO;YAAE,oBAAoB;gBAAE;gBAAa;YAAO;QAAE;QACrD,QAAQ;YAAE,MAAM,oJAAmB,CAAC,KAAK;QAAC;QAC1C,QAAQ;YACN;YACA;YACA,MAAM,oJAAmB,CAAC,KAAK;YAC/B,iBAAiB,mBAAmB;QACtC;IACF;IAEA,MAAM,OAAO,eAAe,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE;YAAa,MAAM,oJAAmB,CAAC,KAAK;YAAE,QAAQ;gBAAE,KAAK;YAAO;QAAE;QAC/E,MAAM;YAAE,MAAM,oJAAmB,CAAC,QAAQ;QAAC;IAC7C;AACF;AAKO,eAAe,sBAAsB,MAAc,EAAE,MAAc;IACxE,MAAM,gBAAgB,MAAM,OAAO,OAAO,CAAC,UAAU,CAAC;QACpD,OAAO;YAAE,IAAI;QAAO;QACpB,QAAQ;YAAE,OAAO;QAAK;IACxB;IACA,IAAI,CAAC,eAAe;IAEpB,MAAM,QAAQ,MAAM,OAAO,CAAC,cAAc,KAAK,IAAI,cAAc,KAAK,GAAG,EAAE;IAC3E,IAAI,CAAC,MAAM,QAAQ,CAAC,cAAc;QAChC,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC;YAC1B,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,OAAO;uBAAI;oBAAO;iBAAY;YAAC;QACzC;IACF;AACF;AAKO,eAAe,iBACpB,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,OAAO,aAAa,yHAAM,EAAE,aAAa,QAAQ;AACnD"}},
    {"offset": {"line": 387, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerId.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport type { NextRequest } from \"next/server\";\n\nexport const ORGANIZER_COOKIE_NAME = \"orya_org\";\n\nexport function parseOrganizerId(value: unknown): number | null {\n  if (typeof value === \"number\") {\n    return Number.isFinite(value) && value > 0 ? value : null;\n  }\n  if (typeof value !== \"string\") return null;\n  const trimmed = value.trim();\n  if (!trimmed) return null;\n  const parsed = Number(trimmed);\n  return Number.isFinite(parsed) && parsed > 0 ? parsed : null;\n}\n\nexport async function resolveOrganizerIdFromCookies(): Promise<number | null> {\n  try {\n    const cookieStore = await cookies();\n    return parseOrganizerId(cookieStore.get(ORGANIZER_COOKIE_NAME)?.value);\n  } catch {\n    return null;\n  }\n}\n\nexport function resolveOrganizerIdFromRequest(req: NextRequest): number | null {\n  const params = req.nextUrl.searchParams;\n  const paramValue = params.get(\"organizerId\") ?? params.get(\"org\");\n  return parseOrganizerId(paramValue) ?? parseOrganizerId(req.cookies.get(ORGANIZER_COOKIE_NAME)?.value);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,wBAAwB;AAE9B,SAAS,iBAAiB,KAAc;IAC7C,IAAI,OAAO,UAAU,UAAU;QAC7B,OAAO,OAAO,QAAQ,CAAC,UAAU,QAAQ,IAAI,QAAQ;IACvD;IACA,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,UAAU,MAAM,IAAI;IAC1B,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,SAAS,OAAO;IACtB,OAAO,OAAO,QAAQ,CAAC,WAAW,SAAS,IAAI,SAAS;AAC1D;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,OAAO,iBAAiB,YAAY,GAAG,CAAC,wBAAwB;IAClE,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,8BAA8B,GAAgB;IAC5D,MAAM,SAAS,IAAI,OAAO,CAAC,YAAY;IACvC,MAAM,aAAa,OAAO,GAAG,CAAC,kBAAkB,OAAO,GAAG,CAAC;IAC3D,OAAO,iBAAiB,eAAe,iBAAiB,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB;AAClG"}},
    {"offset": {"line": 429, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerContext.ts"],"sourcesContent":["import { OrganizerMemberRole } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\nimport { ensureUserIsOrganizer } from \"@/lib/organizerRoles\";\nimport { resolveOrganizerIdFromCookies } from \"@/lib/organizerId\";\n\ntype Options = {\n  organizerId?: number | null;\n  roles?: OrganizerMemberRole[];\n  // Se quisermos forçar leitura de cookie, basta passar organizerId externamente\n};\n\nexport async function ensureLegacyOrganizerMemberships(userId: string, organizerId?: number | null) {\n  if (!userId) return 0;\n\n  const legacyOrganizers = await prisma.organizer.findMany({\n    where: {\n      userId,\n      ...(Number.isFinite(organizerId) ? { id: organizerId! } : {}),\n    },\n    select: { id: true },\n  });\n\n  if (legacyOrganizers.length === 0) return 0;\n\n  try {\n    await prisma.$transaction(async (tx) => {\n      for (const organizer of legacyOrganizers) {\n        await tx.organizerMember.upsert({\n          where: {\n            organizerId_userId: {\n              organizerId: organizer.id,\n              userId,\n            },\n          },\n          update: { role: OrganizerMemberRole.OWNER },\n          create: {\n            organizerId: organizer.id,\n            userId,\n            role: OrganizerMemberRole.OWNER,\n          },\n        });\n      }\n\n      await ensureUserIsOrganizer(tx, userId);\n    });\n  } catch (err: unknown) {\n    const msg =\n      typeof err === \"object\" && err && \"message\" in err ? String((err as { message?: unknown }).message) : \"\";\n    if (msg.includes(\"does not exist\") || msg.includes(\"organizer_members\")) {\n      return 0;\n    }\n    throw err;\n  }\n\n  return legacyOrganizers.length;\n}\n\nexport async function getActiveOrganizerForUser(userId: string, opts: Options = {}) {\n  const { roles } = opts;\n  const directOrganizerId =\n    typeof opts.organizerId === \"number\" && Number.isFinite(opts.organizerId)\n      ? opts.organizerId\n      : null;\n  const cookieOrganizerId = directOrganizerId ? null : await resolveOrganizerIdFromCookies();\n  const organizerId = directOrganizerId ?? cookieOrganizerId;\n\n  // 1) Se organizerId foi especificado, tenta buscar diretamente essa membership primeiro\n  if (organizerId) {\n    const direct = await prisma.organizerMember.findFirst({\n      where: {\n        userId,\n        organizerId,\n        ...(roles ? { role: { in: roles } } : {}),\n        organizer: { status: \"ACTIVE\" },\n      },\n      include: { organizer: true },\n    });\n    if (direct?.organizer) {\n      return { organizer: direct.organizer, membership: direct };\n    }\n\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId, organizerId);\n    if (legacyFixed > 0) {\n      const retry = await prisma.organizerMember.findFirst({\n        where: {\n          userId,\n          organizerId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n      });\n      if (retry?.organizer) {\n        return { organizer: retry.organizer, membership: retry };\n      }\n    }\n    // Se o organizerId foi pedido explicitamente e não existe membership, não faz fallback.\n    return { organizer: null, membership: null };\n  }\n\n  let memberships = await prisma.organizerMember.findMany({\n    where: {\n      userId,\n      ...(roles ? { role: { in: roles } } : {}),\n      organizer: { status: \"ACTIVE\" },\n    },\n    include: { organizer: true },\n    orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n  });\n\n  if (memberships.length === 0) {\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId);\n    if (legacyFixed > 0) {\n      memberships = await prisma.organizerMember.findMany({\n        where: {\n          userId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n        orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n      });\n    }\n  }\n\n  if (memberships && memberships.length > 0) {\n    if (memberships.length > 1) {\n      return { organizer: null, membership: null };\n    }\n    const selected = memberships[0];\n    if (selected?.organizer) {\n      return { organizer: selected.organizer, membership: selected };\n    }\n  }\n\n  return { organizer: null, membership: null };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 633, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerPermissions.ts"],"sourcesContent":["import { OrganizerMemberRole } from \"@prisma/client\";\n\nconst ROLE_WEIGHT: Record<OrganizerMemberRole, number> = {\n  [OrganizerMemberRole.VIEWER]: 0,\n  [OrganizerMemberRole.STAFF]: 1,\n  [OrganizerMemberRole.ADMIN]: 2,\n  [OrganizerMemberRole.CO_OWNER]: 3,\n  [OrganizerMemberRole.OWNER]: 4,\n};\n\nconst ADMIN_MANAGEABLE = new Set<OrganizerMemberRole>([\n  OrganizerMemberRole.STAFF,\n  OrganizerMemberRole.VIEWER,\n]);\n\nconst CO_OWNER_MANAGEABLE = new Set<OrganizerMemberRole>([\n  OrganizerMemberRole.ADMIN,\n  OrganizerMemberRole.STAFF,\n  OrganizerMemberRole.VIEWER,\n]);\n\nexport function isOrgOwner(role: OrganizerMemberRole | null | undefined) {\n  return role === OrganizerMemberRole.OWNER;\n}\n\nexport function isOrgCoOwnerOrAbove(role: OrganizerMemberRole | null | undefined) {\n  return role ? ROLE_WEIGHT[role] >= ROLE_WEIGHT[OrganizerMemberRole.CO_OWNER] : false;\n}\n\nexport function isOrgAdminOrAbove(role: OrganizerMemberRole | null | undefined) {\n  return role ? ROLE_WEIGHT[role] >= ROLE_WEIGHT[OrganizerMemberRole.ADMIN] : false;\n}\n\nexport function canManageEvents(role: OrganizerMemberRole | null | undefined) {\n  return isOrgAdminOrAbove(role);\n}\n\nexport function canManageBilling(role: OrganizerMemberRole | null | undefined) {\n  return role === OrganizerMemberRole.OWNER;\n}\n\nexport function canManageMembers(\n  actorRole: OrganizerMemberRole | null | undefined,\n  targetCurrentRole: OrganizerMemberRole | null | undefined,\n  desiredRole: OrganizerMemberRole | null | undefined,\n) {\n  if (!actorRole) return false;\n  if (actorRole === OrganizerMemberRole.OWNER) return true;\n\n  if (actorRole === OrganizerMemberRole.CO_OWNER) {\n    if (\n      targetCurrentRole === OrganizerMemberRole.OWNER ||\n      targetCurrentRole === OrganizerMemberRole.CO_OWNER ||\n      desiredRole === OrganizerMemberRole.OWNER ||\n      desiredRole === OrganizerMemberRole.CO_OWNER\n    ) {\n      return false;\n    }\n    const target = targetCurrentRole ?? desiredRole;\n    return target ? CO_OWNER_MANAGEABLE.has(target) : true;\n  }\n\n  if (actorRole === OrganizerMemberRole.ADMIN) {\n    const target = targetCurrentRole ?? desiredRole;\n    if (target && !ADMIN_MANAGEABLE.has(target)) return false;\n    return desiredRole ? ADMIN_MANAGEABLE.has(desiredRole) : true;\n  }\n\n  return false;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAEA,MAAM,cAAmD;IACvD,CAAC,oJAAmB,CAAC,MAAM,CAAC,EAAE;IAC9B,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;IAC7B,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;IAC7B,CAAC,oJAAmB,CAAC,QAAQ,CAAC,EAAE;IAChC,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;AAC/B;AAEA,MAAM,mBAAmB,IAAI,IAAyB;IACpD,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,MAAM;CAC3B;AAED,MAAM,sBAAsB,IAAI,IAAyB;IACvD,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,MAAM;CAC3B;AAEM,SAAS,WAAW,IAA4C;IACrE,OAAO,SAAS,oJAAmB,CAAC,KAAK;AAC3C;AAEO,SAAS,oBAAoB,IAA4C;IAC9E,OAAO,OAAO,WAAW,CAAC,KAAK,IAAI,WAAW,CAAC,oJAAmB,CAAC,QAAQ,CAAC,GAAG;AACjF;AAEO,SAAS,kBAAkB,IAA4C;IAC5E,OAAO,OAAO,WAAW,CAAC,KAAK,IAAI,WAAW,CAAC,oJAAmB,CAAC,KAAK,CAAC,GAAG;AAC9E;AAEO,SAAS,gBAAgB,IAA4C;IAC1E,OAAO,kBAAkB;AAC3B;AAEO,SAAS,iBAAiB,IAA4C;IAC3E,OAAO,SAAS,oJAAmB,CAAC,KAAK;AAC3C;AAEO,SAAS,iBACd,SAAiD,EACjD,iBAAyD,EACzD,WAAmD;IAEnD,IAAI,CAAC,WAAW,OAAO;IACvB,IAAI,cAAc,oJAAmB,CAAC,KAAK,EAAE,OAAO;IAEpD,IAAI,cAAc,oJAAmB,CAAC,QAAQ,EAAE;QAC9C,IACE,sBAAsB,oJAAmB,CAAC,KAAK,IAC/C,sBAAsB,oJAAmB,CAAC,QAAQ,IAClD,gBAAgB,oJAAmB,CAAC,KAAK,IACzC,gBAAgB,oJAAmB,CAAC,QAAQ,EAC5C;YACA,OAAO;QACT;QACA,MAAM,SAAS,qBAAqB;QACpC,OAAO,SAAS,oBAAoB,GAAG,CAAC,UAAU;IACpD;IAEA,IAAI,cAAc,oJAAmB,CAAC,KAAK,EAAE;QAC3C,MAAM,SAAS,qBAAqB;QACpC,IAAI,UAAU,CAAC,iBAAiB,GAAG,CAAC,SAAS,OAAO;QACpD,OAAO,cAAc,iBAAiB,GAAG,CAAC,eAAe;IAC3D;IAEA,OAAO;AACT"}},
    {"offset": {"line": 703, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/api/organizador/promo/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { createSupabaseServer } from \"@/lib/supabaseServer\";\nimport { getActiveOrganizerForUser } from \"@/lib/organizerContext\";\nimport { isOrgAdminOrAbove } from \"@/lib/organizerPermissions\";\n\nconst resolveOrganizerId = (req: NextRequest) => {\n  const orgParam = req.nextUrl.searchParams.get(\"org\");\n  const cookieOrgId = req.cookies.get(\"orya_org\")?.value;\n  const raw = orgParam ?? cookieOrgId ?? \"\";\n  const parsed = Number(raw);\n  return Number.isFinite(parsed) ? parsed : null;\n};\n\nasync function requireOrganizer(req: NextRequest) {\n  const supabase = await createSupabaseServer();\n  const {\n    data: { user },\n    error,\n  } = await supabase.auth.getUser();\n\n  if (error || !user) {\n    return { error: \"UNAUTHENTICATED\" as const };\n  }\n\n  const profile = await prisma.profile.findUnique({ where: { id: user.id } });\n  if (!profile) return { error: \"PROFILE_NOT_FOUND\" as const };\n\n  const organizerId = resolveOrganizerId(req);\n  const { organizer, membership } = await getActiveOrganizerForUser(user.id, {\n    organizerId: organizerId ?? undefined,\n    roles: [\"OWNER\", \"CO_OWNER\", \"ADMIN\"],\n  });\n\n  if (!membership || !organizer || !isOrgAdminOrAbove(membership.role)) {\n    return { error: \"ORGANIZER_NOT_FOUND\" as const };\n  }\n\n  return { organizer, profile, membership };\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const ctx = await requireOrganizer(req);\n    if (\"error\" in ctx) {\n      const status =\n        ctx.error === \"UNAUTHENTICATED\" ? 401 : ctx.error === \"PROFILE_NOT_FOUND\" ? 404 : 403;\n      return NextResponse.json({ ok: false, error: ctx.error }, { status });\n    }\n\n    const promoRepo = (prisma as unknown as {\n      promoCode?: {\n        findMany: typeof prisma.promoCode.findMany;\n      };\n    }).promoCode;\n    if (!promoRepo) {\n      return NextResponse.json(\n        { ok: false, error: \"Promo codes indisponíveis nesta instância do Prisma.\" },\n        { status: 500 },\n      );\n    }\n\n    const organizerEvents = await prisma.event.findMany({\n      where: { organizerId: ctx.organizer.id },\n      select: { id: true, title: true, slug: true },\n    });\n    const eventIds = organizerEvents.map((e) => e.id);\n\n    const promoCodes = await prisma.promoCode.findMany({\n      where: {\n        OR: [{ organizerId: ctx.organizer.id }, { eventId: { in: eventIds } }],\n      },\n      orderBy: { createdAt: \"desc\" },\n      include: {\n        redemptions: true,\n      },\n    });\n\n    const promoIds = promoCodes.map((p) => p.id);\n    const promoCodesList = promoCodes.map((p) => p.code);\n\n    const validRedemptionSummaryIds = new Set<number>();\n    promoCodes.forEach((p) => {\n      p.redemptions.forEach((r) => {\n        if (r.saleSummaryId) validRedemptionSummaryIds.add(r.saleSummaryId);\n      });\n    });\n\n    const lines = await prisma.saleLine.findMany({\n      where: {\n        eventId: { in: eventIds },\n        OR: [\n          { promoCodeId: { in: promoIds } },\n          { promoCodeSnapshot: { in: promoCodesList } },\n        ],\n        ...(validRedemptionSummaryIds.size > 0\n          ? { saleSummaryId: { in: Array.from(validRedemptionSummaryIds) } }\n          : {}),\n      },\n      select: {\n        promoCodeId: true,\n        promoCodeSnapshot: true,\n        quantity: true,\n        grossCents: true,\n        netCents: true,\n        discountPerUnitCents: true,\n        platformFeeCents: true,\n      },\n    });\n\n    type PromoAgg = {\n      tickets: number;\n      grossCents: number;\n      discountCents: number;\n      platformFeeCents: number;\n      netCents: number;\n    };\n\n    const statsMap = new Map<\n      string | number,\n      PromoAgg & { users: Set<string>; redemptions: number }\n    >();\n    const ensureAgg = (key: string | number) => {\n      const existing = statsMap.get(key);\n      if (existing) return existing;\n      const base: PromoAgg & { users: Set<string>; redemptions: number } = {\n        tickets: 0,\n        grossCents: 0,\n        discountCents: 0,\n        platformFeeCents: 0,\n        netCents: 0,\n        users: new Set(),\n        redemptions: 0,\n      };\n      statsMap.set(key, base);\n      return base;\n    };\n\n    for (const l of lines) {\n      const key = l.promoCodeId ?? l.promoCodeSnapshot ?? \"unknown\";\n      const agg = ensureAgg(key);\n      const qty = l.quantity ?? 0;\n      const discountLine = (l.discountPerUnitCents ?? 0) * qty;\n      agg.tickets += qty;\n      agg.grossCents += l.grossCents ?? 0;\n      agg.discountCents += discountLine;\n      agg.platformFeeCents += l.platformFeeCents ?? 0;\n      agg.netCents += l.netCents ?? 0;\n    }\n\n    // Contar redemptions (uses) e users únicos\n    promoCodes.forEach((p) => {\n      const agg = ensureAgg(p.id);\n      agg.redemptions += p.redemptions.length;\n      p.redemptions.forEach((r) => {\n        if (r.userId) agg.users.add(r.userId);\n        else if (r.guestEmail) agg.users.add(r.guestEmail.toLowerCase());\n      });\n    });\n\n    return NextResponse.json({\n      ok: true,\n      promoCodes: promoCodes.map((p) => ({\n        ...p,\n        status:\n          !p.active\n            ? \"INACTIVE\"\n            : p.validUntil && new Date(p.validUntil) < new Date()\n              ? \"EXPIRED\"\n              : \"ACTIVE\",\n        redemptionsCount: statsMap.get(p.id)?.tickets ?? p.redemptions.length,\n      })),\n      events: organizerEvents,\n      promoStats: promoCodes.map((p) => {\n        const agg =\n          statsMap.get(p.id) ??\n          statsMap.get(p.code) ?? {\n            tickets: 0,\n            grossCents: 0,\n            discountCents: 0,\n            platformFeeCents: 0,\n            netCents: 0,\n            users: new Set<string>(),\n            redemptions: 0,\n          };\n        return {\n          promoCodeId: p.id,\n          tickets: agg.tickets,\n          grossCents: agg.grossCents,\n          discountCents: agg.discountCents,\n          platformFeeCents: agg.platformFeeCents,\n          netCents: agg.netCents,\n          usesTotal: agg.redemptions,\n          usersUnique: agg.users.size,\n          totalSavedCents: agg.discountCents,\n        };\n      }),\n    });\n  } catch (err) {\n    console.error(\"[organizador/promo][GET]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const ctx = await requireOrganizer(req);\n    if (\"error\" in ctx) {\n      const status =\n        ctx.error === \"UNAUTHENTICATED\" ? 401 : ctx.error === \"PROFILE_NOT_FOUND\" ? 404 : 403;\n      return NextResponse.json({ ok: false, error: ctx.error }, { status });\n    }\n\n    const body = await req.json().catch(() => null);\n    if (!body) {\n      return NextResponse.json({ ok: false, error: \"BAD_REQUEST\" }, { status: 400 });\n    }\n    const promoRepo = (prisma as unknown as {\n      promoCode?: {\n        findFirst: typeof prisma.promoCode.findFirst;\n        create: typeof prisma.promoCode.create;\n      };\n    }).promoCode;\n    if (!promoRepo) {\n      return NextResponse.json(\n        { ok: false, error: \"Promo codes indisponíveis nesta instância do Prisma.\" },\n        { status: 500 },\n      );\n    }\n\n    const {\n      code,\n      type,\n      value,\n      maxUses,\n      perUserLimit,\n      validFrom,\n      validUntil,\n      eventId,\n      active,\n      autoApply,\n      minQuantity,\n      minTotalCents,\n      name,\n      description,\n      minCartValueCents,\n    } = body as {\n      code?: string;\n      type?: \"PERCENTAGE\" | \"FIXED\";\n      value?: number;\n      maxUses?: number | null;\n      perUserLimit?: number | null;\n      validFrom?: string | null;\n      validUntil?: string | null;\n      eventId?: number | null;\n      active?: boolean;\n      autoApply?: boolean;\n      minQuantity?: number | null;\n      minTotalCents?: number | null;\n      name?: string | null;\n      description?: string | null;\n      minCartValueCents?: number | null;\n    };\n\n    const cleanCode = (code || \"\").trim();\n    const auto = Boolean(autoApply);\n    // Se autoApply e sem código, gerar um placeholder interno\n    const finalCode =\n      auto && !cleanCode\n        ? `AUTO-${Math.random().toString(36).slice(2, 8).toUpperCase()}`\n        : cleanCode;\n    if (!finalCode) {\n      return NextResponse.json({ ok: false, error: \"Código em falta.\" }, { status: 400 });\n    }\n    if (type !== \"PERCENTAGE\" && type !== \"FIXED\") {\n      return NextResponse.json({ ok: false, error: \"Tipo inválido.\" }, { status: 400 });\n    }\n    const cleanValue = Number(value);\n    if (!Number.isFinite(cleanValue) || cleanValue <= 0) {\n      return NextResponse.json({ ok: false, error: \"Valor inválido.\" }, { status: 400 });\n    }\n\n    let targetEventId: number | null = null;\n    if (eventId !== null && eventId !== undefined) {\n      const exists = await prisma.event.findFirst({\n        where: { id: Number(eventId), organizerId: ctx.organizer.id },\n        select: { id: true },\n      });\n      if (!exists) {\n        return NextResponse.json(\n          { ok: false, error: \"Evento inválido ou não pertence ao organizador.\" },\n          { status: 400 },\n        );\n      }\n      targetEventId = Number(eventId);\n    }\n\n    const parseDate = (d?: string | null) => {\n      if (!d) return null;\n      const dt = new Date(d);\n      return Number.isNaN(dt.getTime()) ? null : dt;\n    };\n\n    const created = await prisma.promoCode.create({\n      data: {\n        code: finalCode,\n        type,\n        value: Math.floor(cleanValue),\n        organizerId: ctx.organizer.id,\n        maxUses: maxUses ?? null,\n        perUserLimit: perUserLimit ?? null,\n        validFrom: parseDate(validFrom),\n        validUntil: parseDate(validUntil),\n        eventId: targetEventId,\n        active: active ?? true,\n        autoApply: auto,\n        minQuantity: minQuantity ?? null,\n        minTotalCents: minTotalCents ?? null,\n      },\n    });\n\n    return NextResponse.json({ ok: true, promoCode: created }, { status: 200 });\n  } catch (err) {\n    console.error(\"[organizador/promo][POST]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\nexport async function PATCH(req: NextRequest) {\n  try {\n    const ctx = await requireOrganizer(req);\n    if (\"error\" in ctx) {\n      const status =\n        ctx.error === \"UNAUTHENTICATED\" ? 401 : ctx.error === \"PROFILE_NOT_FOUND\" ? 404 : 403;\n      return NextResponse.json({ ok: false, error: ctx.error }, { status });\n    }\n\n    const body = await req.json().catch(() => null);\n    if (!body || typeof body.id !== \"number\") {\n      return NextResponse.json({ ok: false, error: \"BAD_REQUEST\" }, { status: 400 });\n    }\n\n    const promoRepo = (prisma as unknown as {\n      promoCode?: {\n        findUnique: typeof prisma.promoCode.findUnique;\n        update: typeof prisma.promoCode.update;\n      };\n    }).promoCode;\n    if (!promoRepo) {\n      return NextResponse.json(\n        { ok: false, error: \"Promo codes indisponíveis nesta instância do Prisma.\" },\n        { status: 500 },\n      );\n    }\n\n    const promo = await promoRepo.findUnique({ where: { id: body.id } });\n    if (!promo) {\n      return NextResponse.json({ ok: false, error: \"NOT_FOUND\" }, { status: 404 });\n    }\n\n    // garantir que pertence ao organizer (ou global)\n    if (promo.organizerId && promo.organizerId !== ctx.organizer.id) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n    if (!promo.organizerId && promo.eventId) {\n      const evt = await prisma.event.findFirst({\n        where: { id: promo.eventId, organizerId: ctx.organizer.id },\n        select: { id: true },\n      });\n      if (!evt) {\n        return NextResponse.json(\n          { ok: false, error: \"FORBIDDEN\" },\n          { status: 403 },\n        );\n      }\n    } else if (!promo.organizerId && !promo.eventId) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n\n    const {\n      active,\n      autoApply,\n      code,\n      type,\n      value,\n      maxUses,\n      perUserLimit,\n      validFrom,\n      validUntil,\n      eventId,\n      minQuantity,\n      minTotalCents,\n      minCartValueCents,\n      name,\n      description,\n    } = body as {\n      active?: boolean;\n      autoApply?: boolean;\n      code?: string;\n      type?: \"PERCENTAGE\" | \"FIXED\";\n      value?: number;\n      maxUses?: number | null;\n      perUserLimit?: number | null;\n      validFrom?: string | null;\n      validUntil?: string | null;\n      eventId?: number | null;\n      minQuantity?: number | null;\n      minTotalCents?: number | null;\n      minCartValueCents?: number | null;\n      name?: string | null;\n      description?: string | null;\n    };\n\n    let targetEventId: number | null | undefined = undefined;\n    if (eventId !== undefined && eventId !== null) {\n      const exists = await prisma.event.findFirst({\n        where: { id: Number(eventId), organizerId: ctx.organizer.id },\n        select: { id: true },\n      });\n      if (!exists) {\n        return NextResponse.json(\n          { ok: false, error: \"Evento inválido ou não pertence ao organizador.\" },\n          { status: 400 },\n        );\n      }\n      targetEventId = Number(eventId);\n    } else if (eventId === null) {\n      targetEventId = null;\n    }\n\n    const parseDate = (d?: string | null) => {\n      if (!d) return null;\n      const dt = new Date(d);\n      return Number.isNaN(dt.getTime()) ? null : dt;\n    };\n\n    const dataUpdate: Record<string, unknown> = {};\n    if (typeof active === \"boolean\") dataUpdate.active = active;\n    if (typeof autoApply === \"boolean\") dataUpdate.autoApply = autoApply;\n    if (typeof code === \"string\" && code.trim()) dataUpdate.code = code.trim();\n    if (type === \"PERCENTAGE\" || type === \"FIXED\") dataUpdate.type = type;\n    if (typeof value === \"number\" && Number.isFinite(value) && value > 0) {\n      dataUpdate.value = Math.floor(value);\n    }\n    if (maxUses !== undefined) dataUpdate.maxUses = maxUses;\n    if (perUserLimit !== undefined) dataUpdate.perUserLimit = perUserLimit;\n    if (validFrom !== undefined) dataUpdate.validFrom = parseDate(validFrom);\n    if (validUntil !== undefined) dataUpdate.validUntil = parseDate(validUntil);\n    if (targetEventId !== undefined) {\n      dataUpdate.event = targetEventId === null ? { disconnect: true } : { connect: { id: targetEventId } };\n    }\n    if (minQuantity !== undefined) dataUpdate.minQuantity = minQuantity;\n    if (minTotalCents !== undefined) dataUpdate.minTotalCents = minTotalCents;\n    if (minCartValueCents !== undefined) dataUpdate.minCartValueCents = minCartValueCents;\n    if (typeof name === \"string\") dataUpdate.name = name.trim() || null;\n    if (typeof description === \"string\") dataUpdate.description = description.trim() || null;\n\n    const updated = await prisma.promoCode.update({\n      where: { id: promo.id },\n      data: dataUpdate,\n    });\n\n    return NextResponse.json({ ok: true, promoCode: updated }, { status: 200 });\n  } catch (err) {\n    console.error(\"[organizador/promo][PATCH]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const ctx = await requireOrganizer(req);\n    if (\"error\" in ctx) {\n      const status =\n        ctx.error === \"UNAUTHENTICATED\" ? 401 : ctx.error === \"PROFILE_NOT_FOUND\" ? 404 : 403;\n      return NextResponse.json({ ok: false, error: ctx.error }, { status });\n    }\n    const body = await req.json().catch(() => null);\n    if (!body || typeof body.id !== \"number\") {\n      return NextResponse.json({ ok: false, error: \"BAD_REQUEST\" }, { status: 400 });\n    }\n\n    const promo = await prisma.promoCode.findUnique({ where: { id: body.id } });\n    if (!promo) {\n      return NextResponse.json({ ok: false, error: \"NOT_FOUND\" }, { status: 404 });\n    }\n    if (promo.organizerId && promo.organizerId !== ctx.organizer.id) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n    if (!promo.organizerId && promo.eventId) {\n      const evt = await prisma.event.findFirst({\n        where: { id: promo.eventId, organizerId: ctx.organizer.id },\n        select: { id: true },\n      });\n      if (!evt) {\n        return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n      }\n    } else if (!promo.organizerId && !promo.eventId) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n\n    await prisma.promoCode.delete({\n      where: { id: promo.id },\n    });\n    return NextResponse.json({ ok: true }, { status: 200 });\n  } catch (err) {\n    console.error(\"[organizador/promo][DELETE]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,qBAAqB,CAAC;IAC1B,MAAM,WAAW,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAC9C,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IACjD,MAAM,MAAM,YAAY,eAAe;IACvC,MAAM,SAAS,OAAO;IACtB,OAAO,OAAO,QAAQ,CAAC,UAAU,SAAS;AAC5C;AAEA,eAAe,iBAAiB,GAAgB;IAC9C,MAAM,WAAW,MAAM,IAAA,+IAAoB;IAC3C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,SAAS,CAAC,MAAM;QAClB,OAAO;YAAE,OAAO;QAA2B;IAC7C;IAEA,MAAM,UAAU,MAAM,yHAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI,KAAK,EAAE;QAAC;IAAE;IACzE,IAAI,CAAC,SAAS,OAAO;QAAE,OAAO;IAA6B;IAE3D,MAAM,cAAc,mBAAmB;IACvC,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,MAAM,IAAA,sJAAyB,EAAC,KAAK,EAAE,EAAE;QACzE,aAAa,eAAe;QAC5B,OAAO;YAAC;YAAS;YAAY;SAAQ;IACvC;IAEA,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,IAAA,kJAAiB,EAAC,WAAW,IAAI,GAAG;QACpE,OAAO;YAAE,OAAO;QAA+B;IACjD;IAEA,OAAO;QAAE;QAAW;QAAS;IAAW;AAC1C;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,MAAM,MAAM,iBAAiB;QACnC,IAAI,WAAW,KAAK;YAClB,MAAM,SACJ,IAAI,KAAK,KAAK,oBAAoB,MAAM,IAAI,KAAK,KAAK,sBAAsB,MAAM;YACpF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO,IAAI,KAAK;YAAC,GAAG;gBAAE;YAAO;QACrE;QAEA,MAAM,YAAY,AAAC,yHAAM,CAItB,SAAS;QACZ,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAAuD,GAC3E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,kBAAkB,MAAM,yHAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YAClD,OAAO;gBAAE,aAAa,IAAI,SAAS,CAAC,EAAE;YAAC;YACvC,QAAQ;gBAAE,IAAI;gBAAM,OAAO;gBAAM,MAAM;YAAK;QAC9C;QACA,MAAM,WAAW,gBAAgB,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;QAEhD,MAAM,aAAa,MAAM,yHAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;YACjD,OAAO;gBACL,IAAI;oBAAC;wBAAE,aAAa,IAAI,SAAS,CAAC,EAAE;oBAAC;oBAAG;wBAAE,SAAS;4BAAE,IAAI;wBAAS;oBAAE;iBAAE;YACxE;YACA,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBACP,aAAa;YACf;QACF;QAEA,MAAM,WAAW,WAAW,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE;QAC3C,MAAM,iBAAiB,WAAW,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;QAEnD,MAAM,4BAA4B,IAAI;QACtC,WAAW,OAAO,CAAC,CAAC;YAClB,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;gBACrB,IAAI,EAAE,aAAa,EAAE,0BAA0B,GAAG,CAAC,EAAE,aAAa;YACpE;QACF;QAEA,MAAM,QAAQ,MAAM,yHAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC3C,OAAO;gBACL,SAAS;oBAAE,IAAI;gBAAS;gBACxB,IAAI;oBACF;wBAAE,aAAa;4BAAE,IAAI;wBAAS;oBAAE;oBAChC;wBAAE,mBAAmB;4BAAE,IAAI;wBAAe;oBAAE;iBAC7C;gBACD,GAAI,0BAA0B,IAAI,GAAG,IACjC;oBAAE,eAAe;wBAAE,IAAI,MAAM,IAAI,CAAC;oBAA2B;gBAAE,IAC/D,CAAC,CAAC;YACR;YACA,QAAQ;gBACN,aAAa;gBACb,mBAAmB;gBACnB,UAAU;gBACV,YAAY;gBACZ,UAAU;gBACV,sBAAsB;gBACtB,kBAAkB;YACpB;QACF;QAUA,MAAM,WAAW,IAAI;QAIrB,MAAM,YAAY,CAAC;YACjB,MAAM,WAAW,SAAS,GAAG,CAAC;YAC9B,IAAI,UAAU,OAAO;YACrB,MAAM,OAA+D;gBACnE,SAAS;gBACT,YAAY;gBACZ,eAAe;gBACf,kBAAkB;gBAClB,UAAU;gBACV,OAAO,IAAI;gBACX,aAAa;YACf;YACA,SAAS,GAAG,CAAC,KAAK;YAClB,OAAO;QACT;QAEA,KAAK,MAAM,KAAK,MAAO;YACrB,MAAM,MAAM,EAAE,WAAW,IAAI,EAAE,iBAAiB,IAAI;YACpD,MAAM,MAAM,UAAU;YACtB,MAAM,MAAM,EAAE,QAAQ,IAAI;YAC1B,MAAM,eAAe,CAAC,EAAE,oBAAoB,IAAI,CAAC,IAAI;YACrD,IAAI,OAAO,IAAI;YACf,IAAI,UAAU,IAAI,EAAE,UAAU,IAAI;YAClC,IAAI,aAAa,IAAI;YACrB,IAAI,gBAAgB,IAAI,EAAE,gBAAgB,IAAI;YAC9C,IAAI,QAAQ,IAAI,EAAE,QAAQ,IAAI;QAChC;QAEA,2CAA2C;QAC3C,WAAW,OAAO,CAAC,CAAC;YAClB,MAAM,MAAM,UAAU,EAAE,EAAE;YAC1B,IAAI,WAAW,IAAI,EAAE,WAAW,CAAC,MAAM;YACvC,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;gBACrB,IAAI,EAAE,MAAM,EAAE,IAAI,KAAK,CAAC,GAAG,CAAC,EAAE,MAAM;qBAC/B,IAAI,EAAE,UAAU,EAAE,IAAI,KAAK,CAAC,GAAG,CAAC,EAAE,UAAU,CAAC,WAAW;YAC/D;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,YAAY,WAAW,GAAG,CAAC,CAAC,IAAM,CAAC;oBACjC,GAAG,CAAC;oBACJ,QACE,CAAC,EAAE,MAAM,GACL,aACA,EAAE,UAAU,IAAI,IAAI,KAAK,EAAE,UAAU,IAAI,IAAI,SAC3C,YACA;oBACR,kBAAkB,SAAS,GAAG,CAAC,EAAE,EAAE,GAAG,WAAW,EAAE,WAAW,CAAC,MAAM;gBACvE,CAAC;YACD,QAAQ;YACR,YAAY,WAAW,GAAG,CAAC,CAAC;gBAC1B,MAAM,MACJ,SAAS,GAAG,CAAC,EAAE,EAAE,KACjB,SAAS,GAAG,CAAC,EAAE,IAAI,KAAK;oBACtB,SAAS;oBACT,YAAY;oBACZ,eAAe;oBACf,kBAAkB;oBAClB,UAAU;oBACV,OAAO,IAAI;oBACX,aAAa;gBACf;gBACF,OAAO;oBACL,aAAa,EAAE,EAAE;oBACjB,SAAS,IAAI,OAAO;oBACpB,YAAY,IAAI,UAAU;oBAC1B,eAAe,IAAI,aAAa;oBAChC,kBAAkB,IAAI,gBAAgB;oBACtC,UAAU,IAAI,QAAQ;oBACtB,WAAW,IAAI,WAAW;oBAC1B,aAAa,IAAI,KAAK,CAAC,IAAI;oBAC3B,iBAAiB,IAAI,aAAa;gBACpC;YACF;QACF;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,MAAM,MAAM,iBAAiB;QACnC,IAAI,WAAW,KAAK;YAClB,MAAM,SACJ,IAAI,KAAK,KAAK,oBAAoB,MAAM,IAAI,KAAK,KAAK,sBAAsB,MAAM;YACpF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO,IAAI,KAAK;YAAC,GAAG;gBAAE;YAAO;QACrE;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;QAC1C,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QACA,MAAM,YAAY,AAAC,yHAAM,CAKtB,SAAS;QACZ,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAAuD,GAC3E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EACJ,IAAI,EACJ,IAAI,EACJ,KAAK,EACL,OAAO,EACP,YAAY,EACZ,SAAS,EACT,UAAU,EACV,OAAO,EACP,MAAM,EACN,SAAS,EACT,WAAW,EACX,aAAa,EACb,IAAI,EACJ,WAAW,EACX,iBAAiB,EAClB,GAAG;QAkBJ,MAAM,YAAY,CAAC,QAAQ,EAAE,EAAE,IAAI;QACnC,MAAM,OAAO,QAAQ;QACrB,0DAA0D;QAC1D,MAAM,YACJ,QAAQ,CAAC,YACL,CAAC,KAAK,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,GAAG,WAAW,IAAI,GAC9D;QACN,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACnF;QACA,IAAI,SAAS,gBAAgB,SAAS,SAAS;YAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACjF;QACA,MAAM,aAAa,OAAO;QAC1B,IAAI,CAAC,OAAO,QAAQ,CAAC,eAAe,cAAc,GAAG;YACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,IAAI,gBAA+B;QACnC,IAAI,YAAY,QAAQ,YAAY,WAAW;YAC7C,MAAM,SAAS,MAAM,yHAAM,CAAC,KAAK,CAAC,SAAS,CAAC;gBAC1C,OAAO;oBAAE,IAAI,OAAO;oBAAU,aAAa,IAAI,SAAS,CAAC,EAAE;gBAAC;gBAC5D,QAAQ;oBAAE,IAAI;gBAAK;YACrB;YACA,IAAI,CAAC,QAAQ;gBACX,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,IAAI;oBAAO,OAAO;gBAAkD,GACtE;oBAAE,QAAQ;gBAAI;YAElB;YACA,gBAAgB,OAAO;QACzB;QAEA,MAAM,YAAY,CAAC;YACjB,IAAI,CAAC,GAAG,OAAO;YACf,MAAM,KAAK,IAAI,KAAK;YACpB,OAAO,OAAO,KAAK,CAAC,GAAG,OAAO,MAAM,OAAO;QAC7C;QAEA,MAAM,UAAU,MAAM,yHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;YAC5C,MAAM;gBACJ,MAAM;gBACN;gBACA,OAAO,KAAK,KAAK,CAAC;gBAClB,aAAa,IAAI,SAAS,CAAC,EAAE;gBAC7B,SAAS,WAAW;gBACpB,cAAc,gBAAgB;gBAC9B,WAAW,UAAU;gBACrB,YAAY,UAAU;gBACtB,SAAS;gBACT,QAAQ,UAAU;gBAClB,WAAW;gBACX,aAAa,eAAe;gBAC5B,eAAe,iBAAiB;YAClC;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,WAAW;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC3E,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF;AAEO,eAAe,MAAM,GAAgB;IAC1C,IAAI;QACF,MAAM,MAAM,MAAM,iBAAiB;QACnC,IAAI,WAAW,KAAK;YAClB,MAAM,SACJ,IAAI,KAAK,KAAK,oBAAoB,MAAM,IAAI,KAAK,KAAK,sBAAsB,MAAM;YACpF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO,IAAI,KAAK;YAAC,GAAG;gBAAE;YAAO;QACrE;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;QAC1C,IAAI,CAAC,QAAQ,OAAO,KAAK,EAAE,KAAK,UAAU;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,YAAY,AAAC,yHAAM,CAKtB,SAAS;QACZ,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAAuD,GAC3E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,MAAM,UAAU,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;QAAE;QAClE,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,iDAAiD;QACjD,IAAI,MAAM,WAAW,IAAI,MAAM,WAAW,KAAK,IAAI,SAAS,CAAC,EAAE,EAAE;YAC/D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QACA,IAAI,CAAC,MAAM,WAAW,IAAI,MAAM,OAAO,EAAE;YACvC,MAAM,MAAM,MAAM,yHAAM,CAAC,KAAK,CAAC,SAAS,CAAC;gBACvC,OAAO;oBAAE,IAAI,MAAM,OAAO;oBAAE,aAAa,IAAI,SAAS,CAAC,EAAE;gBAAC;gBAC1D,QAAQ;oBAAE,IAAI;gBAAK;YACrB;YACA,IAAI,CAAC,KAAK;gBACR,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,IAAI;oBAAO,OAAO;gBAAY,GAChC;oBAAE,QAAQ;gBAAI;YAElB;QACF,OAAO,IAAI,CAAC,MAAM,WAAW,IAAI,CAAC,MAAM,OAAO,EAAE;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,EACJ,MAAM,EACN,SAAS,EACT,IAAI,EACJ,IAAI,EACJ,KAAK,EACL,OAAO,EACP,YAAY,EACZ,SAAS,EACT,UAAU,EACV,OAAO,EACP,WAAW,EACX,aAAa,EACb,iBAAiB,EACjB,IAAI,EACJ,WAAW,EACZ,GAAG;QAkBJ,IAAI,gBAA2C;QAC/C,IAAI,YAAY,aAAa,YAAY,MAAM;YAC7C,MAAM,SAAS,MAAM,yHAAM,CAAC,KAAK,CAAC,SAAS,CAAC;gBAC1C,OAAO;oBAAE,IAAI,OAAO;oBAAU,aAAa,IAAI,SAAS,CAAC,EAAE;gBAAC;gBAC5D,QAAQ;oBAAE,IAAI;gBAAK;YACrB;YACA,IAAI,CAAC,QAAQ;gBACX,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,IAAI;oBAAO,OAAO;gBAAkD,GACtE;oBAAE,QAAQ;gBAAI;YAElB;YACA,gBAAgB,OAAO;QACzB,OAAO,IAAI,YAAY,MAAM;YAC3B,gBAAgB;QAClB;QAEA,MAAM,YAAY,CAAC;YACjB,IAAI,CAAC,GAAG,OAAO;YACf,MAAM,KAAK,IAAI,KAAK;YACpB,OAAO,OAAO,KAAK,CAAC,GAAG,OAAO,MAAM,OAAO;QAC7C;QAEA,MAAM,aAAsC,CAAC;QAC7C,IAAI,OAAO,WAAW,WAAW,WAAW,MAAM,GAAG;QACrD,IAAI,OAAO,cAAc,WAAW,WAAW,SAAS,GAAG;QAC3D,IAAI,OAAO,SAAS,YAAY,KAAK,IAAI,IAAI,WAAW,IAAI,GAAG,KAAK,IAAI;QACxE,IAAI,SAAS,gBAAgB,SAAS,SAAS,WAAW,IAAI,GAAG;QACjE,IAAI,OAAO,UAAU,YAAY,OAAO,QAAQ,CAAC,UAAU,QAAQ,GAAG;YACpE,WAAW,KAAK,GAAG,KAAK,KAAK,CAAC;QAChC;QACA,IAAI,YAAY,WAAW,WAAW,OAAO,GAAG;QAChD,IAAI,iBAAiB,WAAW,WAAW,YAAY,GAAG;QAC1D,IAAI,cAAc,WAAW,WAAW,SAAS,GAAG,UAAU;QAC9D,IAAI,eAAe,WAAW,WAAW,UAAU,GAAG,UAAU;QAChE,IAAI,kBAAkB,WAAW;YAC/B,WAAW,KAAK,GAAG,kBAAkB,OAAO;gBAAE,YAAY;YAAK,IAAI;gBAAE,SAAS;oBAAE,IAAI;gBAAc;YAAE;QACtG;QACA,IAAI,gBAAgB,WAAW,WAAW,WAAW,GAAG;QACxD,IAAI,kBAAkB,WAAW,WAAW,aAAa,GAAG;QAC5D,IAAI,sBAAsB,WAAW,WAAW,iBAAiB,GAAG;QACpE,IAAI,OAAO,SAAS,UAAU,WAAW,IAAI,GAAG,KAAK,IAAI,MAAM;QAC/D,IAAI,OAAO,gBAAgB,UAAU,WAAW,WAAW,GAAG,YAAY,IAAI,MAAM;QAEpF,MAAM,UAAU,MAAM,yHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;YAC5C,OAAO;gBAAE,IAAI,MAAM,EAAE;YAAC;YACtB,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,WAAW;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC3E,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF;AAEO,eAAe,OAAO,GAAgB;IAC3C,IAAI;QACF,MAAM,MAAM,MAAM,iBAAiB;QACnC,IAAI,WAAW,KAAK;YAClB,MAAM,SACJ,IAAI,KAAK,KAAK,oBAAoB,MAAM,IAAI,KAAK,KAAK,sBAAsB,MAAM;YACpF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO,IAAI,KAAK;YAAC,GAAG;gBAAE;YAAO;QACrE;QACA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;QAC1C,IAAI,CAAC,QAAQ,OAAO,KAAK,EAAE,KAAK,UAAU;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,MAAM,QAAQ,MAAM,yHAAM,CAAC,SAAS,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;QAAE;QACzE,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QACA,IAAI,MAAM,WAAW,IAAI,MAAM,WAAW,KAAK,IAAI,SAAS,CAAC,EAAE,EAAE;YAC/D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QACA,IAAI,CAAC,MAAM,WAAW,IAAI,MAAM,OAAO,EAAE;YACvC,MAAM,MAAM,MAAM,yHAAM,CAAC,KAAK,CAAC,SAAS,CAAC;gBACvC,OAAO;oBAAE,IAAI,MAAM,OAAO;oBAAE,aAAa,IAAI,SAAS,CAAC,EAAE;gBAAC;gBAC1D,QAAQ;oBAAE,IAAI;gBAAK;YACrB;YACA,IAAI,CAAC,KAAK;gBACR,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,IAAI;oBAAO,OAAO;gBAAY,GAAG;oBAAE,QAAQ;gBAAI;YAC5E;QACF,OAAO,IAAI,CAAC,MAAM,WAAW,IAAI,CAAC,MAAM,OAAO,EAAE;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,yHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;YAC5B,OAAO;gBAAE,IAAI,MAAM,EAAE;YAAC;QACxB;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK,GAAG;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}