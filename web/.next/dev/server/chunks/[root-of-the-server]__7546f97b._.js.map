{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/env.ts"],"sourcesContent":["// Central helper for server-side environment variables (server-only).\n// ⚠️ Não importar este módulo em componentes com \"use client\".\nconst required = [\n  \"SUPABASE_URL\",\n  \"SUPABASE_ANON_KEY\",\n  \"SUPABASE_SERVICE_ROLE\",\n  \"DATABASE_URL\",\n  \"STRIPE_SECRET_KEY\",\n  \"STRIPE_WEBHOOK_SECRET\",\n  \"QR_SECRET_KEY\",\n  \"RESEND_API_KEY\",\n] as const;\n\ntype EnvKey = (typeof required)[number];\n\nfunction getEnv(key: EnvKey): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing env var: ${key}`);\n  }\n  return value;\n}\n\nfunction getOptionalUrlEnv(...keys: string[]) {\n  for (const key of keys) {\n    const value = process.env[key];\n    if (typeof value === \"string\" && value.trim().length > 0) {\n      return value.trim().replace(/\\/+$/, \"\"); // remove trailing slash para URLs previsíveis\n    }\n  }\n  return \"\";\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseList(raw: unknown) {\n  if (typeof raw !== \"string\") return [];\n  return raw\n    .split(/[,\\s]+/g)\n    .map((item) => item.trim())\n    .filter(Boolean);\n}\n\nexport const env = {\n  supabaseUrl: getEnv(\"SUPABASE_URL\"),\n  supabaseAnonKey: getEnv(\"SUPABASE_ANON_KEY\"),\n  serviceRoleKey: getEnv(\"SUPABASE_SERVICE_ROLE\"),\n  dbUrl: getEnv(\"DATABASE_URL\"),\n  stripeSecretKey: getEnv(\"STRIPE_SECRET_KEY\"),\n  stripeWebhookSecret: getEnv(\"STRIPE_WEBHOOK_SECRET\"),\n  qrSecretKey: getEnv(\"QR_SECRET_KEY\"),\n  resendApiKey: getEnv(\"RESEND_API_KEY\"),\n  resendFrom:\n    process.env.RESEND_FROM ??\n    process.env.RESEND_FROM_EMAIL ??\n    \"no-reply@orya.pt\",\n  appBaseUrl: getOptionalUrlEnv(\"APP_BASE_URL\", \"NEXT_PUBLIC_BASE_URL\", \"NEXT_PUBLIC_SITE_URL\", \"VERCEL_URL\"),\n  uploadsBucket:\n    process.env.SUPABASE_STORAGE_BUCKET_UPLOADS ??\n    process.env.SUPABASE_STORAGE_BUCKET ??\n    \"uploads\",\n  avatarsBucket: process.env.SUPABASE_STORAGE_BUCKET_AVATARS ?? \"\",\n  eventCoversBucket: process.env.SUPABASE_STORAGE_BUCKET_EVENT_COVERS ?? \"\",\n  storageSignedUrls: parseBoolean(process.env.SUPABASE_STORAGE_SIGNED_URLS, false),\n  storageSignedTtlSeconds: parseNumber(process.env.SUPABASE_STORAGE_SIGNED_TTL_SECONDS, 60 * 60 * 24 * 30), // 30 dias\n  stripePremiumPriceIds: parseList(process.env.STRIPE_PREMIUM_PRICE_IDS),\n  stripePremiumProductIds: parseList(process.env.STRIPE_PREMIUM_PRODUCT_IDS),\n};\n"],"names":[],"mappings":"AAAA,sEAAsE;AACtE,+DAA+D;;;;;AAC/D,MAAM,WAAW;IACf;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAID,SAAS,OAAO,GAAW;IACzB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK;IAC3C;IACA,OAAO;AACT;AAEA,SAAS,kBAAkB,GAAG,IAAc;IAC1C,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;QAC9B,IAAI,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;YACxD,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,8CAA8C;QACzF;IACF;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAY,EAAE,QAAiB;IACnD,IAAI,OAAO,QAAQ,WAAW,OAAO;IACrC,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,aAAa,IAAI,IAAI,GAAG,WAAW;QACzC,IAAI;YAAC;YAAK;YAAQ;YAAO;SAAK,CAAC,QAAQ,CAAC,aAAa,OAAO;QAC5D,IAAI;YAAC;YAAK;YAAS;YAAM;SAAM,CAAC,QAAQ,CAAC,aAAa,OAAO;IAC/D;IACA,OAAO;AACT;AAEA,SAAS,YAAY,GAAY,EAAE,QAAgB;IACjD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO,EAAE;IACtC,OAAO,IACJ,KAAK,CAAC,WACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC;AACZ;AAEO,MAAM,MAAM;IACjB,aAAa,OAAO;IACpB,iBAAiB,OAAO;IACxB,gBAAgB,OAAO;IACvB,OAAO,OAAO;IACd,iBAAiB,OAAO;IACxB,qBAAqB,OAAO;IAC5B,aAAa,OAAO;IACpB,cAAc,OAAO;IACrB,YACE,QAAQ,GAAG,CAAC,WAAW,IACvB,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IACF,YAAY,kBAAkB,gBAAgB,wBAAwB,wBAAwB;IAC9F,eACE,QAAQ,GAAG,CAAC,+BAA+B,IAC3C,QAAQ,GAAG,CAAC,uBAAuB,IACnC;IACF,eAAe,QAAQ,GAAG,CAAC,+BAA+B,IAAI;IAC9D,mBAAmB,QAAQ,GAAG,CAAC,oCAAoC,IAAI;IACvE,mBAAmB,aAAa,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC1E,yBAAyB,YAAY,QAAQ,GAAG,CAAC,mCAAmC,EAAE,KAAK,KAAK,KAAK;IACrG,uBAAuB,UAAU,QAAQ,GAAG,CAAC,wBAAwB;IACrE,yBAAyB,UAAU,QAAQ,GAAG,CAAC,0BAA0B;AAC3E"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/supabaseServer.ts"],"sourcesContent":["import \"server-only\";\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { env } from \"@/lib/env\";\n\nfunction decodeBase64Cookie(raw: string) {\n  const BASE64_PREFIX = \"base64-\";\n  if (!raw.startsWith(BASE64_PREFIX)) return raw;\n\n  const base = raw.slice(BASE64_PREFIX.length);\n  const encodings: BufferEncoding[] = [\"base64url\", \"base64\"];\n\n  for (const enc of encodings) {\n    try {\n      return Buffer.from(base, enc).toString(\"utf-8\");\n    } catch {\n      /* try next */\n    }\n  }\n\n  // Se não conseguirmos decodificar, tratamos como cookie ausente para evitar JSON.parse de strings inválidas\n  return undefined;\n}\n\n/**\n * Server-side Supabase client (SSR + Route Handlers)\n * - Safe cookie reading\n * - Safe cookie writing\n * - Prevents JSON parse errors\n * - No profile fetching here\n */\nexport async function createSupabaseServer() {\n  const cookieStore = (await cookies());\n\n  const supabase = createServerClient(\n    env.supabaseUrl,\n    env.supabaseAnonKey,\n    {\n      cookies: {\n        get(name: string) {\n          try {\n            // Só devolvemos cookies do Supabase (sb-*) e ignoramos o resto\n            if (!name.startsWith(\"sb-\")) return undefined;\n            const raw = cookieStore.get(name)?.value;\n            if (!raw) return undefined;\n\n            // Se for um chunk (sb-*.0, sb-*.1, ...), deixamos intacto para o combinador do Supabase tratar\n            const isChunk = /\\.\\d+$/.test(name);\n            return isChunk ? raw : decodeBase64Cookie(raw);\n          } catch {\n            return undefined;\n          }\n        },\n        set(name: string, value: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value, ...options });\n          } catch {\n            /* ignore errors for RSC */\n          }\n        },\n        remove(name: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value: \"\", ...options, maxAge: 0 });\n          } catch {\n            /* ignore */\n          }\n        },\n      },\n    }\n  );\n\n  return supabase;\n}\n\n\nexport async function getCurrentUser() {\n  const supabase = await createSupabaseServer();\n\n  try {\n    const { data, error } = await supabase.auth.getUser();\n\n    if (error || !data?.user) {\n      return { user: null, error };\n    }\n\n    return { user: data.user, error: null };\n  } catch (err) {\n    return { user: null, error: err };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,SAAS,mBAAmB,GAAW;IACrC,MAAM,gBAAgB;IACtB,IAAI,CAAC,IAAI,UAAU,CAAC,gBAAgB,OAAO;IAE3C,MAAM,OAAO,IAAI,KAAK,CAAC,cAAc,MAAM;IAC3C,MAAM,YAA8B;QAAC;QAAa;KAAS;IAE3D,KAAK,MAAM,OAAO,UAAW;QAC3B,IAAI;YACF,OAAO,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;QACzC,EAAE,OAAM;QACN,YAAY,GACd;IACF;IAEA,4GAA4G;IAC5G,OAAO;AACT;AASO,eAAe;IACpB,MAAM,cAAe,MAAM,IAAA,4IAAO;IAElC,MAAM,WAAW,IAAA,iMAAkB,EACjC,mHAAG,CAAC,WAAW,EACf,mHAAG,CAAC,eAAe,EACnB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,IAAI;oBACF,+DAA+D;oBAC/D,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,OAAO;oBACpC,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBACnC,IAAI,CAAC,KAAK,OAAO;oBAEjB,+FAA+F;oBAC/F,MAAM,UAAU,SAAS,IAAI,CAAC;oBAC9B,OAAO,UAAU,MAAM,mBAAmB;gBAC5C,EAAE,OAAM;oBACN,OAAO;gBACT;YACF;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAgC;gBAC/D,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAM;gBACN,yBAAyB,GAC3B;YACF;YACA,QAAO,IAAY,EAAE,OAAgC;gBACnD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBAC3D,EAAE,OAAM;gBACN,UAAU,GACZ;YACF;QACF;IACF;IAGF,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEnD,IAAI,SAAS,CAAC,MAAM,MAAM;YACxB,OAAO;gBAAE,MAAM;gBAAM;YAAM;QAC7B;QAEA,OAAO;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO;QAAK;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,MAAM;YAAM,OAAO;QAAI;IAClC;AACF"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { Prisma, PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport { env } from \"@/lib/env\";\n\n// Toggle de logs verbose (queries) via env: PRISMA_LOG_QUERIES=true\nconst enableQueryLog = process.env.PRISMA_LOG_QUERIES === \"true\";\nconst logLevels: (Prisma.LogLevel | Prisma.LogDefinition)[] =\n  process.env.NODE_ENV === \"development\"\n    ? enableQueryLog\n      ? [\"query\", \"error\", \"warn\"]\n      : [\"error\", \"warn\"]\n    : [\"error\"];\n\n// Evitar múltiplas instâncias em dev (hot reload)\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\n// Pool e adapter para usar o client engine (\"library\") com Postgres\nconst pool = new Pool({\n  connectionString: env.dbUrl,\n  ssl:\n    process.env.NODE_ENV === \"production\"\n      ? undefined\n      : { rejectUnauthorized: false },\n});\n\nconst adapter = new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: logLevels,\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;AACA;AACA;;;;;;;;;;AAEA,oEAAoE;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK;AAC1D,MAAM,YACJ,uCACI,iBACE;IAAC;IAAS;IAAS;CAAO,GAC1B;IAAC;IAAS;CAAO,GACnB;AAEN,kDAAkD;AAClD,MAAM,kBAAkB;AAIxB,oEAAoE;AACpE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,mHAAG,CAAC,KAAK;IAC3B,KACE,sCACI,0BACA;QAAE,oBAAoB;IAAM;AACpC;AAEA,MAAM,UAAU,IAAI,8JAAQ,CAAC;AAEtB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK;AACP;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerPermissions.ts"],"sourcesContent":["import { OrganizerMemberRole } from \"@prisma/client\";\n\nconst ROLE_WEIGHT: Record<OrganizerMemberRole, number> = {\n  [OrganizerMemberRole.VIEWER]: 0,\n  [OrganizerMemberRole.STAFF]: 1,\n  [OrganizerMemberRole.ADMIN]: 2,\n  [OrganizerMemberRole.CO_OWNER]: 3,\n  [OrganizerMemberRole.OWNER]: 4,\n};\n\nconst ADMIN_MANAGEABLE = new Set<OrganizerMemberRole>([\n  OrganizerMemberRole.STAFF,\n  OrganizerMemberRole.VIEWER,\n]);\n\nconst CO_OWNER_MANAGEABLE = new Set<OrganizerMemberRole>([\n  OrganizerMemberRole.ADMIN,\n  OrganizerMemberRole.STAFF,\n  OrganizerMemberRole.VIEWER,\n]);\n\nexport function isOrgOwner(role: OrganizerMemberRole | null | undefined) {\n  return role === OrganizerMemberRole.OWNER;\n}\n\nexport function isOrgCoOwnerOrAbove(role: OrganizerMemberRole | null | undefined) {\n  return role ? ROLE_WEIGHT[role] >= ROLE_WEIGHT[OrganizerMemberRole.CO_OWNER] : false;\n}\n\nexport function isOrgAdminOrAbove(role: OrganizerMemberRole | null | undefined) {\n  return role ? ROLE_WEIGHT[role] >= ROLE_WEIGHT[OrganizerMemberRole.ADMIN] : false;\n}\n\nexport function canManageEvents(role: OrganizerMemberRole | null | undefined) {\n  return isOrgAdminOrAbove(role);\n}\n\nexport function canManageBilling(role: OrganizerMemberRole | null | undefined) {\n  return role === OrganizerMemberRole.OWNER;\n}\n\nexport function canManageMembers(\n  actorRole: OrganizerMemberRole | null | undefined,\n  targetCurrentRole: OrganizerMemberRole | null | undefined,\n  desiredRole: OrganizerMemberRole | null | undefined,\n) {\n  if (!actorRole) return false;\n  if (actorRole === OrganizerMemberRole.OWNER) return true;\n\n  if (actorRole === OrganizerMemberRole.CO_OWNER) {\n    if (\n      targetCurrentRole === OrganizerMemberRole.OWNER ||\n      targetCurrentRole === OrganizerMemberRole.CO_OWNER ||\n      desiredRole === OrganizerMemberRole.OWNER ||\n      desiredRole === OrganizerMemberRole.CO_OWNER\n    ) {\n      return false;\n    }\n    const target = targetCurrentRole ?? desiredRole;\n    return target ? CO_OWNER_MANAGEABLE.has(target) : true;\n  }\n\n  if (actorRole === OrganizerMemberRole.ADMIN) {\n    const target = targetCurrentRole ?? desiredRole;\n    if (target && !ADMIN_MANAGEABLE.has(target)) return false;\n    return desiredRole ? ADMIN_MANAGEABLE.has(desiredRole) : true;\n  }\n\n  return false;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAEA,MAAM,cAAmD;IACvD,CAAC,oJAAmB,CAAC,MAAM,CAAC,EAAE;IAC9B,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;IAC7B,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;IAC7B,CAAC,oJAAmB,CAAC,QAAQ,CAAC,EAAE;IAChC,CAAC,oJAAmB,CAAC,KAAK,CAAC,EAAE;AAC/B;AAEA,MAAM,mBAAmB,IAAI,IAAyB;IACpD,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,MAAM;CAC3B;AAED,MAAM,sBAAsB,IAAI,IAAyB;IACvD,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,KAAK;IACzB,oJAAmB,CAAC,MAAM;CAC3B;AAEM,SAAS,WAAW,IAA4C;IACrE,OAAO,SAAS,oJAAmB,CAAC,KAAK;AAC3C;AAEO,SAAS,oBAAoB,IAA4C;IAC9E,OAAO,OAAO,WAAW,CAAC,KAAK,IAAI,WAAW,CAAC,oJAAmB,CAAC,QAAQ,CAAC,GAAG;AACjF;AAEO,SAAS,kBAAkB,IAA4C;IAC5E,OAAO,OAAO,WAAW,CAAC,KAAK,IAAI,WAAW,CAAC,oJAAmB,CAAC,KAAK,CAAC,GAAG;AAC9E;AAEO,SAAS,gBAAgB,IAA4C;IAC1E,OAAO,kBAAkB;AAC3B;AAEO,SAAS,iBAAiB,IAA4C;IAC3E,OAAO,SAAS,oJAAmB,CAAC,KAAK;AAC3C;AAEO,SAAS,iBACd,SAAiD,EACjD,iBAAyD,EACzD,WAAmD;IAEnD,IAAI,CAAC,WAAW,OAAO;IACvB,IAAI,cAAc,oJAAmB,CAAC,KAAK,EAAE,OAAO;IAEpD,IAAI,cAAc,oJAAmB,CAAC,QAAQ,EAAE;QAC9C,IACE,sBAAsB,oJAAmB,CAAC,KAAK,IAC/C,sBAAsB,oJAAmB,CAAC,QAAQ,IAClD,gBAAgB,oJAAmB,CAAC,KAAK,IACzC,gBAAgB,oJAAmB,CAAC,QAAQ,EAC5C;YACA,OAAO;QACT;QACA,MAAM,SAAS,qBAAqB;QACpC,OAAO,SAAS,oBAAoB,GAAG,CAAC,UAAU;IACpD;IAEA,IAAI,cAAc,oJAAmB,CAAC,KAAK,EAAE;QAC3C,MAAM,SAAS,qBAAqB;QACpC,IAAI,UAAU,CAAC,iBAAiB,GAAG,CAAC,SAAS,OAAO;QACpD,OAAO,cAAc,iBAAiB,GAAG,CAAC,eAAe;IAC3D;IAEA,OAAO;AACT"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerRoles.ts"],"sourcesContent":["import { OrganizerMemberRole, Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype TxLike = Prisma.TransactionClient | PrismaClient;\n\n/**\n * Garante unicidade de OWNER numa organização:\n * - promove/cria o utilizador como OWNER\n * - despromove todos os outros OWNER para CO_OWNER\n */\nexport async function setSoleOwner(\n  client: TxLike,\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  await client.organizerMember.upsert({\n    where: { organizerId_userId: { organizerId, userId } },\n    update: { role: OrganizerMemberRole.OWNER },\n    create: {\n      organizerId,\n      userId,\n      role: OrganizerMemberRole.OWNER,\n      invitedByUserId: invitedByUserId ?? undefined,\n    },\n  });\n\n  await client.organizerMember.updateMany({\n    where: { organizerId, role: OrganizerMemberRole.OWNER, userId: { not: userId } },\n    data: { role: OrganizerMemberRole.CO_OWNER },\n  });\n}\n\n/**\n * Marca o perfil como \"organizer\" no array de roles (idempotente).\n */\nexport async function ensureUserIsOrganizer(client: TxLike, userId: string) {\n  const targetProfile = await client.profile.findUnique({\n    where: { id: userId },\n    select: { roles: true },\n  });\n  if (!targetProfile) return;\n\n  const roles = Array.isArray(targetProfile.roles) ? targetProfile.roles : [];\n  if (!roles.includes(\"organizer\")) {\n    await client.profile.update({\n      where: { id: userId },\n      data: { roles: [...roles, \"organizer\"] },\n    });\n  }\n}\n\n/**\n * Wrapper que permite usar helper fora de transação quando necessário.\n */\nexport async function setSoleOwnerSafe(\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  return setSoleOwner(prisma, organizerId, userId, invitedByUserId);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AASO,eAAe,aACpB,MAAc,EACd,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,MAAM,OAAO,eAAe,CAAC,MAAM,CAAC;QAClC,OAAO;YAAE,oBAAoB;gBAAE;gBAAa;YAAO;QAAE;QACrD,QAAQ;YAAE,MAAM,oJAAmB,CAAC,KAAK;QAAC;QAC1C,QAAQ;YACN;YACA;YACA,MAAM,oJAAmB,CAAC,KAAK;YAC/B,iBAAiB,mBAAmB;QACtC;IACF;IAEA,MAAM,OAAO,eAAe,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE;YAAa,MAAM,oJAAmB,CAAC,KAAK;YAAE,QAAQ;gBAAE,KAAK;YAAO;QAAE;QAC/E,MAAM;YAAE,MAAM,oJAAmB,CAAC,QAAQ;QAAC;IAC7C;AACF;AAKO,eAAe,sBAAsB,MAAc,EAAE,MAAc;IACxE,MAAM,gBAAgB,MAAM,OAAO,OAAO,CAAC,UAAU,CAAC;QACpD,OAAO;YAAE,IAAI;QAAO;QACpB,QAAQ;YAAE,OAAO;QAAK;IACxB;IACA,IAAI,CAAC,eAAe;IAEpB,MAAM,QAAQ,MAAM,OAAO,CAAC,cAAc,KAAK,IAAI,cAAc,KAAK,GAAG,EAAE;IAC3E,IAAI,CAAC,MAAM,QAAQ,CAAC,cAAc;QAChC,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC;YAC1B,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,OAAO;uBAAI;oBAAO;iBAAY;YAAC;QACzC;IACF;AACF;AAKO,eAAe,iBACpB,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,OAAO,aAAa,yHAAM,EAAE,aAAa,QAAQ;AACnD"}},
    {"offset": {"line": 457, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizationAudit.ts"],"sourcesContent":["import { Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype TxLike = Prisma.TransactionClient | PrismaClient;\n\nexport type OrganizationAuditInput = {\n  organizerId: number;\n  actorUserId?: string | null;\n  action: string;\n  fromUserId?: string | null;\n  toUserId?: string | null;\n  metadata?: Record<string, unknown> | Prisma.JsonValue;\n  ip?: string | null;\n  userAgent?: string | null;\n};\n\n/**\n * Regista ações sensíveis para audit trail da organização.\n * Usa TransactionClient quando já estivermos em transação.\n */\nexport async function recordOrganizationAudit(\n  client: TxLike,\n  input: OrganizationAuditInput,\n) {\n  // Alguns schemas podem não ter a tabela de audit; nesse caso, faz no-op.\n  const auditModel = (client as any).organizationAuditLog;\n  if (!auditModel?.create) return null;\n  return auditModel.create({\n    data: {\n      organizerId: input.organizerId,\n      actorUserId: input.actorUserId ?? null,\n      action: input.action,\n      fromUserId: input.fromUserId ?? null,\n      toUserId: input.toUserId ?? null,\n      metadata: (input.metadata ?? {}) as Prisma.InputJsonValue,\n      ip: input.ip ?? null,\n      userAgent: input.userAgent ?? null,\n    },\n  });\n}\n\nexport async function recordOrganizationAuditSafe(input: OrganizationAuditInput) {\n  return recordOrganizationAudit(prisma, input);\n}\n"],"names":[],"mappings":";;;;;;AACA;;;;;;AAmBO,eAAe,wBACpB,MAAc,EACd,KAA6B;IAE7B,yEAAyE;IACzE,MAAM,aAAa,AAAC,OAAe,oBAAoB;IACvD,IAAI,CAAC,YAAY,QAAQ,OAAO;IAChC,OAAO,WAAW,MAAM,CAAC;QACvB,MAAM;YACJ,aAAa,MAAM,WAAW;YAC9B,aAAa,MAAM,WAAW,IAAI;YAClC,QAAQ,MAAM,MAAM;YACpB,YAAY,MAAM,UAAU,IAAI;YAChC,UAAU,MAAM,QAAQ,IAAI;YAC5B,UAAW,MAAM,QAAQ,IAAI,CAAC;YAC9B,IAAI,MAAM,EAAE,IAAI;YAChB,WAAW,MAAM,SAAS,IAAI;QAChC;IACF;AACF;AAEO,eAAe,4BAA4B,KAA6B;IAC7E,OAAO,wBAAwB,yHAAM,EAAE;AACzC"}},
    {"offset": {"line": 496, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/api/organizador/organizations/members/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createSupabaseServer } from \"@/lib/supabaseServer\";\nimport { prisma } from \"@/lib/prisma\";\nimport { OrganizerMemberRole } from \"@prisma/client\";\nimport { canManageMembers, isOrgOwner } from \"@/lib/organizerPermissions\";\nimport { setSoleOwner } from \"@/lib/organizerRoles\";\nimport { recordOrganizationAuditSafe } from \"@/lib/organizationAudit\";\n\nexport async function GET(req: NextRequest) {\n  try {\n    const supabase = await createSupabaseServer();\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser();\n\n    if (error || !user) {\n      return NextResponse.json({ ok: false, error: \"UNAUTHENTICATED\" }, { status: 401 });\n    }\n\n    const url = new URL(req.url);\n    const organizerIdRaw = url.searchParams.get(\"organizerId\");\n    const eventIdRaw = url.searchParams.get(\"eventId\");\n    let organizerId = organizerIdRaw ? Number(organizerIdRaw) : null;\n\n    if (!organizerId && eventIdRaw) {\n      const eventId = Number(eventIdRaw);\n      if (eventId && !Number.isNaN(eventId)) {\n        const ev = await prisma.event.findUnique({\n          where: { id: eventId },\n          select: { organizerId: true },\n        });\n        organizerId = ev?.organizerId ?? null;\n      }\n    }\n\n    if (!organizerId || Number.isNaN(organizerId)) {\n      return NextResponse.json({ ok: false, error: \"INVALID_ORGANIZER_ID\" }, { status: 400 });\n    }\n\n    const limit = Math.min(Number(url.searchParams.get(\"limit\") ?? 200), 500);\n\n    // Qualquer membro pode consultar; ações ficam restritas por role\n    const callerMembership = await prisma.organizerMember.findUnique({\n      where: { organizerId_userId: { organizerId, userId: user.id } },\n    });\n    if (!callerMembership) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n\n    const members = await prisma.organizerMember.findMany({\n      where: { organizerId, user: { isDeleted: false } },\n      include: {\n        user: {\n          select: {\n            id: true,\n            fullName: true,\n            username: true,\n            avatarUrl: true,\n            visibility: true,\n          },\n        },\n      },\n      orderBy: { createdAt: \"asc\" },\n      take: limit,\n    });\n\n    const items = members.map((m) => {\n      const visibility = (m.user as { visibility?: string | null })?.visibility ?? \"PUBLIC\";\n      const isSelf = m.userId === user.id;\n      const isPrivate = visibility === \"PRIVATE\" && !isSelf;\n\n      return {\n        userId: m.userId,\n        role: m.role,\n        invitedByUserId: m.invitedByUserId,\n        createdAt: m.createdAt,\n        fullName: isPrivate\n          ? null\n          : (m.user && \"fullName\" in m.user ? (m.user as { fullName?: string | null }).fullName ?? null : null),\n        username: m.user && \"username\" in m.user ? (m.user as { username?: string | null }).username ?? null : null,\n        avatarUrl: m.user && \"avatarUrl\" in m.user ? (m.user as { avatarUrl?: string | null }).avatarUrl ?? null : null,\n        email: isPrivate ? null : null,\n        visibility,\n      };\n    });\n\n    return NextResponse.json(\n      { ok: true, items, viewerRole: callerMembership.role, organizerId },\n      { status: 200 },\n    );\n  } catch (err) {\n    console.error(\"[organizador/members][GET]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\nexport async function PATCH(req: NextRequest) {\n  try {\n    const supabase = await createSupabaseServer();\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser();\n\n    if (error || !user) {\n      return NextResponse.json({ ok: false, error: \"UNAUTHENTICATED\" }, { status: 401 });\n    }\n\n    const body = await req.json().catch(() => null);\n    const organizerId = Number(body?.organizerId);\n    const targetUserId = typeof body?.userId === \"string\" ? body.userId : null;\n    const role = typeof body?.role === \"string\" ? body.role.toUpperCase() : null;\n\n    if (!organizerId || Number.isNaN(organizerId) || !targetUserId || !role) {\n      return NextResponse.json({ ok: false, error: \"INVALID_PAYLOAD\" }, { status: 400 });\n    }\n    if (!Object.values(OrganizerMemberRole).includes(role as OrganizerMemberRole)) {\n      return NextResponse.json({ ok: false, error: \"INVALID_ROLE\" }, { status: 400 });\n    }\n\n    const callerMembership = await prisma.organizerMember.findUnique({\n      where: { organizerId_userId: { organizerId, userId: user.id } },\n    });\n    if (!callerMembership) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n    const callerRole = callerMembership.role as OrganizerMemberRole | null;\n\n    const targetMembership = await prisma.organizerMember.findUnique({\n      where: { organizerId_userId: { organizerId, userId: targetUserId } },\n    });\n    if (!targetMembership) {\n      return NextResponse.json({ ok: false, error: \"NOT_MEMBER\" }, { status: 404 });\n    }\n\n    if (!canManageMembers(callerRole, targetMembership.role, role as OrganizerMemberRole)) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n\n    if (role === \"OWNER\" && !isOrgOwner(callerRole)) {\n      return NextResponse.json({ ok: false, error: \"ONLY_OWNER_CAN_SET_OWNER\" }, { status: 403 });\n    }\n\n    if (targetMembership.role === \"OWNER\" && role !== \"OWNER\") {\n      const otherOwners = await prisma.organizerMember.count({\n        where: {\n          organizerId,\n          role: \"OWNER\",\n          userId: { not: targetUserId },\n        },\n      });\n      if (otherOwners === 0) {\n        return NextResponse.json(\n          { ok: false, error: \"Não podes remover o último Owner.\" },\n          { status: 400 },\n        );\n      }\n    }\n\n    // Se promover para OWNER, garantir que fica único (demovendo outros para CO_OWNER)\n    if (role === \"OWNER\") {\n      await prisma.$transaction(async (tx) => setSoleOwner(tx, organizerId, targetUserId));\n      await recordOrganizationAuditSafe({\n        organizerId,\n        actorUserId: user.id,\n        action: \"OWNER_PROMOTED\",\n        toUserId: targetUserId,\n        metadata: { via: \"members.patch\" },\n      });\n      return NextResponse.json({ ok: true }, { status: 200 });\n    }\n\n    // Bloqueia que o único owner se despromova a si próprio\n    if (targetMembership.role === \"OWNER\" && targetUserId === user.id && role !== \"OWNER\") {\n      const otherOwners = await prisma.organizerMember.count({\n        where: { organizerId, role: \"OWNER\", userId: { not: user.id } },\n      });\n      if (otherOwners === 0) {\n        return NextResponse.json(\n          { ok: false, error: \"Garante outro Owner antes de descer o teu papel.\" },\n          { status: 400 },\n        );\n      }\n    }\n\n    await prisma.organizerMember.update({\n      where: { organizerId_userId: { organizerId, userId: targetUserId } },\n      data: { role: role as OrganizerMemberRole },\n    });\n\n    if (targetMembership.role === \"OWNER\" && role !== \"OWNER\") {\n      await recordOrganizationAuditSafe({\n        organizerId,\n        actorUserId: user.id,\n        action: \"OWNER_DEMOTED\",\n        fromUserId: targetUserId,\n        metadata: { newRole: role },\n      });\n    }\n\n    return NextResponse.json({ ok: true }, { status: 200 });\n  } catch (err) {\n    console.error(\"[organizador/members][PATCH]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const supabase = await createSupabaseServer();\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser();\n\n    if (error || !user) {\n      return NextResponse.json({ ok: false, error: \"UNAUTHENTICATED\" }, { status: 401 });\n    }\n\n    const url = new URL(req.url);\n    const organizerId = Number(url.searchParams.get(\"organizerId\"));\n    const targetUserId = url.searchParams.get(\"userId\");\n\n    if (!organizerId || Number.isNaN(organizerId) || !targetUserId) {\n      return NextResponse.json({ ok: false, error: \"INVALID_PARAMS\" }, { status: 400 });\n    }\n\n    const callerMembership = await prisma.organizerMember.findUnique({\n      where: { organizerId_userId: { organizerId, userId: user.id } },\n    });\n    if (!callerMembership) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n    const callerRole = callerMembership.role as OrganizerMemberRole | null;\n\n    const targetMembership = await prisma.organizerMember.findUnique({\n      where: { organizerId_userId: { organizerId, userId: targetUserId } },\n    });\n    if (!targetMembership) {\n      return NextResponse.json({ ok: false, error: \"NOT_MEMBER\" }, { status: 404 });\n    }\n\n    if (!canManageMembers(callerRole, targetMembership.role, targetMembership.role)) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n    }\n\n    if (targetMembership.role === \"OWNER\") {\n      if (!isOrgOwner(callerRole)) {\n        return NextResponse.json({ ok: false, error: \"ONLY_OWNER_CAN_REMOVE_OWNER\" }, { status: 403 });\n      }\n\n      const otherOwners = await prisma.organizerMember.count({\n        where: {\n          organizerId,\n          role: \"OWNER\",\n          userId: { not: targetUserId },\n        },\n      });\n      if (otherOwners === 0) {\n        return NextResponse.json(\n          { ok: false, error: \"Não podes remover o último Owner.\" },\n          { status: 400 },\n        );\n      }\n    }\n\n    await prisma.organizerMember.delete({\n      where: { organizerId_userId: { organizerId, userId: targetUserId } },\n    });\n\n    if (targetMembership.role === \"OWNER\") {\n      await recordOrganizationAuditSafe({\n        organizerId,\n        actorUserId: user.id,\n        action: \"OWNER_REMOVED\",\n        fromUserId: targetUserId,\n        metadata: { via: \"members.delete\" },\n      });\n    }\n\n    return NextResponse.json({ ok: true }, { status: 200 });\n  } catch (err) {\n    console.error(\"[organizador/members][DELETE]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}