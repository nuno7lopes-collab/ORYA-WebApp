{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/env.ts"],"sourcesContent":["// Central helper for server-side environment variables (server-only).\n// ⚠️ Não importar este módulo em componentes com \"use client\".\nconst required = [\n  \"SUPABASE_URL\",\n  \"SUPABASE_ANON_KEY\",\n  \"SUPABASE_SERVICE_ROLE\",\n  \"DATABASE_URL\",\n  \"STRIPE_SECRET_KEY\",\n  \"STRIPE_WEBHOOK_SECRET\",\n  \"QR_SECRET_KEY\",\n  \"RESEND_API_KEY\",\n] as const;\n\ntype EnvKey = (typeof required)[number];\n\nfunction getEnv(key: EnvKey): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing env var: ${key}`);\n  }\n  return value;\n}\n\nfunction getOptionalUrlEnv(...keys: string[]) {\n  for (const key of keys) {\n    const value = process.env[key];\n    if (typeof value === \"string\" && value.trim().length > 0) {\n      return value.trim().replace(/\\/+$/, \"\"); // remove trailing slash para URLs previsíveis\n    }\n  }\n  return \"\";\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseList(raw: unknown) {\n  if (typeof raw !== \"string\") return [];\n  return raw\n    .split(/[,\\s]+/g)\n    .map((item) => item.trim())\n    .filter(Boolean);\n}\n\nexport const env = {\n  supabaseUrl: getEnv(\"SUPABASE_URL\"),\n  supabaseAnonKey: getEnv(\"SUPABASE_ANON_KEY\"),\n  serviceRoleKey: getEnv(\"SUPABASE_SERVICE_ROLE\"),\n  dbUrl: getEnv(\"DATABASE_URL\"),\n  stripeSecretKey: getEnv(\"STRIPE_SECRET_KEY\"),\n  stripeWebhookSecret: getEnv(\"STRIPE_WEBHOOK_SECRET\"),\n  qrSecretKey: getEnv(\"QR_SECRET_KEY\"),\n  resendApiKey: getEnv(\"RESEND_API_KEY\"),\n  resendFrom:\n    process.env.RESEND_FROM ??\n    process.env.RESEND_FROM_EMAIL ??\n    \"no-reply@orya.pt\",\n  appBaseUrl: getOptionalUrlEnv(\"APP_BASE_URL\", \"NEXT_PUBLIC_BASE_URL\", \"NEXT_PUBLIC_SITE_URL\", \"VERCEL_URL\"),\n  uploadsBucket:\n    process.env.SUPABASE_STORAGE_BUCKET_UPLOADS ??\n    process.env.SUPABASE_STORAGE_BUCKET ??\n    \"uploads\",\n  avatarsBucket: process.env.SUPABASE_STORAGE_BUCKET_AVATARS ?? \"\",\n  eventCoversBucket: process.env.SUPABASE_STORAGE_BUCKET_EVENT_COVERS ?? \"\",\n  storageSignedUrls: parseBoolean(process.env.SUPABASE_STORAGE_SIGNED_URLS, false),\n  storageSignedTtlSeconds: parseNumber(process.env.SUPABASE_STORAGE_SIGNED_TTL_SECONDS, 60 * 60 * 24 * 30), // 30 dias\n  stripePremiumPriceIds: parseList(process.env.STRIPE_PREMIUM_PRICE_IDS),\n  stripePremiumProductIds: parseList(process.env.STRIPE_PREMIUM_PRODUCT_IDS),\n};\n"],"names":[],"mappings":"AAAA,sEAAsE;AACtE,+DAA+D;;;;;AAC/D,MAAM,WAAW;IACf;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAID,SAAS,OAAO,GAAW;IACzB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK;IAC3C;IACA,OAAO;AACT;AAEA,SAAS,kBAAkB,GAAG,IAAc;IAC1C,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;QAC9B,IAAI,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;YACxD,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,8CAA8C;QACzF;IACF;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAY,EAAE,QAAiB;IACnD,IAAI,OAAO,QAAQ,WAAW,OAAO;IACrC,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,aAAa,IAAI,IAAI,GAAG,WAAW;QACzC,IAAI;YAAC;YAAK;YAAQ;YAAO;SAAK,CAAC,QAAQ,CAAC,aAAa,OAAO;QAC5D,IAAI;YAAC;YAAK;YAAS;YAAM;SAAM,CAAC,QAAQ,CAAC,aAAa,OAAO;IAC/D;IACA,OAAO;AACT;AAEA,SAAS,YAAY,GAAY,EAAE,QAAgB;IACjD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO,EAAE;IACtC,OAAO,IACJ,KAAK,CAAC,WACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC;AACZ;AAEO,MAAM,MAAM;IACjB,aAAa,OAAO;IACpB,iBAAiB,OAAO;IACxB,gBAAgB,OAAO;IACvB,OAAO,OAAO;IACd,iBAAiB,OAAO;IACxB,qBAAqB,OAAO;IAC5B,aAAa,OAAO;IACpB,cAAc,OAAO;IACrB,YACE,QAAQ,GAAG,CAAC,WAAW,IACvB,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IACF,YAAY,kBAAkB,gBAAgB,wBAAwB,wBAAwB;IAC9F,eACE,QAAQ,GAAG,CAAC,+BAA+B,IAC3C,QAAQ,GAAG,CAAC,uBAAuB,IACnC;IACF,eAAe,QAAQ,GAAG,CAAC,+BAA+B,IAAI;IAC9D,mBAAmB,QAAQ,GAAG,CAAC,oCAAoC,IAAI;IACvE,mBAAmB,aAAa,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC1E,yBAAyB,YAAY,QAAQ,GAAG,CAAC,mCAAmC,EAAE,KAAK,KAAK,KAAK;IACrG,uBAAuB,UAAU,QAAQ,GAAG,CAAC,wBAAwB;IACrE,yBAAyB,UAAU,QAAQ,GAAG,CAAC,0BAA0B;AAC3E"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/supabaseServer.ts"],"sourcesContent":["import \"server-only\";\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { env } from \"@/lib/env\";\n\nfunction decodeBase64Cookie(raw: string) {\n  const BASE64_PREFIX = \"base64-\";\n  if (!raw.startsWith(BASE64_PREFIX)) return raw;\n\n  const base = raw.slice(BASE64_PREFIX.length);\n  const encodings: BufferEncoding[] = [\"base64url\", \"base64\"];\n\n  for (const enc of encodings) {\n    try {\n      return Buffer.from(base, enc).toString(\"utf-8\");\n    } catch {\n      /* try next */\n    }\n  }\n\n  // Se não conseguirmos decodificar, tratamos como cookie ausente para evitar JSON.parse de strings inválidas\n  return undefined;\n}\n\n/**\n * Server-side Supabase client (SSR + Route Handlers)\n * - Safe cookie reading\n * - Safe cookie writing\n * - Prevents JSON parse errors\n * - No profile fetching here\n */\nexport async function createSupabaseServer() {\n  const cookieStore = (await cookies());\n\n  const supabase = createServerClient(\n    env.supabaseUrl,\n    env.supabaseAnonKey,\n    {\n      cookies: {\n        get(name: string) {\n          try {\n            // Só devolvemos cookies do Supabase (sb-*) e ignoramos o resto\n            if (!name.startsWith(\"sb-\")) return undefined;\n            const raw = cookieStore.get(name)?.value;\n            if (!raw) return undefined;\n\n            // Se for um chunk (sb-*.0, sb-*.1, ...), deixamos intacto para o combinador do Supabase tratar\n            const isChunk = /\\.\\d+$/.test(name);\n            return isChunk ? raw : decodeBase64Cookie(raw);\n          } catch {\n            return undefined;\n          }\n        },\n        set(name: string, value: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value, ...options });\n          } catch {\n            /* ignore errors for RSC */\n          }\n        },\n        remove(name: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value: \"\", ...options, maxAge: 0 });\n          } catch {\n            /* ignore */\n          }\n        },\n      },\n    }\n  );\n\n  return supabase;\n}\n\n\nexport async function getCurrentUser() {\n  const supabase = await createSupabaseServer();\n\n  try {\n    const { data, error } = await supabase.auth.getUser();\n\n    if (error || !data?.user) {\n      return { user: null, error };\n    }\n\n    return { user: data.user, error: null };\n  } catch (err) {\n    return { user: null, error: err };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,SAAS,mBAAmB,GAAW;IACrC,MAAM,gBAAgB;IACtB,IAAI,CAAC,IAAI,UAAU,CAAC,gBAAgB,OAAO;IAE3C,MAAM,OAAO,IAAI,KAAK,CAAC,cAAc,MAAM;IAC3C,MAAM,YAA8B;QAAC;QAAa;KAAS;IAE3D,KAAK,MAAM,OAAO,UAAW;QAC3B,IAAI;YACF,OAAO,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;QACzC,EAAE,OAAM;QACN,YAAY,GACd;IACF;IAEA,4GAA4G;IAC5G,OAAO;AACT;AASO,eAAe;IACpB,MAAM,cAAe,MAAM,IAAA,4IAAO;IAElC,MAAM,WAAW,IAAA,iMAAkB,EACjC,mHAAG,CAAC,WAAW,EACf,mHAAG,CAAC,eAAe,EACnB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,IAAI;oBACF,+DAA+D;oBAC/D,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,OAAO;oBACpC,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBACnC,IAAI,CAAC,KAAK,OAAO;oBAEjB,+FAA+F;oBAC/F,MAAM,UAAU,SAAS,IAAI,CAAC;oBAC9B,OAAO,UAAU,MAAM,mBAAmB;gBAC5C,EAAE,OAAM;oBACN,OAAO;gBACT;YACF;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAgC;gBAC/D,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAM;gBACN,yBAAyB,GAC3B;YACF;YACA,QAAO,IAAY,EAAE,OAAgC;gBACnD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBAC3D,EAAE,OAAM;gBACN,UAAU,GACZ;YACF;QACF;IACF;IAGF,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEnD,IAAI,SAAS,CAAC,MAAM,MAAM;YACxB,OAAO;gBAAE,MAAM;gBAAM;YAAM;QAC7B;QAEA,OAAO;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO;QAAK;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,MAAM;YAAM,OAAO;QAAI;IAClC;AACF"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { Prisma, PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport { env } from \"@/lib/env\";\n\n// Toggle de logs verbose (queries) via env: PRISMA_LOG_QUERIES=true\nconst enableQueryLog = process.env.PRISMA_LOG_QUERIES === \"true\";\nconst logLevels: (Prisma.LogLevel | Prisma.LogDefinition)[] =\n  process.env.NODE_ENV === \"development\"\n    ? enableQueryLog\n      ? [\"query\", \"error\", \"warn\"]\n      : [\"error\", \"warn\"]\n    : [\"error\"];\n\n// Evitar múltiplas instâncias em dev (hot reload)\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\n// Pool e adapter para usar o client engine (\"library\") com Postgres\nconst pool = new Pool({\n  connectionString: env.dbUrl,\n  ssl:\n    process.env.NODE_ENV === \"production\"\n      ? undefined\n      : { rejectUnauthorized: false },\n});\n\nconst adapter = new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: logLevels,\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;AACA;AACA;;;;;;;;;;AAEA,oEAAoE;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK;AAC1D,MAAM,YACJ,uCACI,iBACE;IAAC;IAAS;IAAS;CAAO,GAC1B;IAAC;IAAS;CAAO,GACnB;AAEN,kDAAkD;AAClD,MAAM,kBAAkB;AAIxB,oEAAoE;AACpE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,mHAAG,CAAC,KAAK;IAC3B,KACE,sCACI,0BACA;QAAE,oBAAoB;IAAM;AACpC;AAEA,MAAM,UAAU,IAAI,8JAAQ,CAAC;AAEtB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK;AACP;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/notifications.ts"],"sourcesContent":["import { prisma } from \"./prisma\";\nimport type { NotificationPriority, NotificationType } from \"@prisma/client\";\n\nexport type CreateNotificationInput = {\n  userId: string;\n  type: NotificationType;\n  title?: string | null;\n  body?: string | null;\n  payload?: Record<string, unknown> | null;\n  ctaUrl?: string | null;\n  ctaLabel?: string | null;\n  priority?: NotificationPriority;\n  senderVisibility?: \"PUBLIC\" | \"PRIVATE\";\n  fromUserId?: string | null;\n  organizerId?: number | null;\n  eventId?: number | null;\n  ticketId?: string | null;\n  inviteId?: string | null;\n};\n\nexport async function shouldNotify(userId: string, type: NotificationType) {\n  const prefs = await getNotificationPrefs(userId);\n  switch (type) {\n    case \"EVENT_SALE\":\n      return prefs.allowSalesAlerts;\n    case \"FRIEND_REQUEST\":\n    case \"FRIEND_ACCEPT\":\n      return prefs.allowFriendRequests;\n    case \"FOLLOWED_YOU\":\n      return prefs.allowFriendRequests;\n    case \"SYSTEM_ANNOUNCE\":\n    case \"STRIPE_STATUS\":\n      return prefs.allowSystemAnnouncements;\n    case \"EVENT_REMINDER\":\n    case \"NEW_EVENT_FROM_FOLLOWED_ORGANIZER\":\n      return prefs.allowEventReminders;\n    default:\n      return true;\n  }\n}\n\nfunction sanitizeActor(\n  actor: any,\n  options: { isPrivate?: boolean; viewerId?: string | null },\n) {\n  if (!actor || typeof actor !== \"object\") return actor;\n  const isSelf = options.viewerId && actor.id === options.viewerId;\n  if (!options.isPrivate || isSelf) return actor;\n  return {\n    id: actor.id ?? null,\n    username: actor.username ?? null,\n    avatarUrl: actor.avatarUrl ?? null,\n    fullName: null,\n    email: null,\n  };\n}\n\nfunction sanitizePayload(payload: any, opts: { senderVisibility?: \"PUBLIC\" | \"PRIVATE\"; viewerId?: string | null }) {\n  if (!payload || typeof payload !== \"object\") return payload;\n  const clone: Record<string, unknown> = { ...payload };\n  if (clone.actor) {\n    clone.actor = sanitizeActor(clone.actor, { isPrivate: opts.senderVisibility === \"PRIVATE\", viewerId: opts.viewerId });\n  }\n  return clone;\n}\n\nexport async function createNotification(input: CreateNotificationInput) {\n  const {\n    userId,\n    type,\n    title,\n    body,\n    payload,\n    ctaUrl = null,\n    ctaLabel = null,\n    priority = \"NORMAL\",\n    senderVisibility = \"PUBLIC\",\n    fromUserId = null,\n    organizerId = null,\n    eventId = null,\n    ticketId = null,\n    inviteId = null,\n  } = input;\n\n  const data = {\n    userId,\n    type,\n    title: title ?? null,\n    body: body ?? null,\n    payload: payload ? sanitizePayload(payload, { senderVisibility, viewerId: userId }) : undefined,\n    ctaUrl: ctaUrl || undefined,\n    ctaLabel: ctaLabel || undefined,\n    priority,\n    fromUserId: fromUserId || undefined,\n    organizerId: organizerId ?? undefined,\n    eventId: eventId ?? undefined,\n    ticketId: ticketId ?? undefined,\n    inviteId: inviteId ?? undefined,\n  };\n\n  return prisma.notification.create({ data });\n}\n\nexport async function getNotificationPrefs(userId: string) {\n  const existing = await prisma.notificationPreference.findUnique({ where: { userId } });\n  if (existing) return existing;\n\n  const profile = await prisma.profile.findUnique({\n    where: { id: userId },\n    select: {\n      allowEmailNotifications: true,\n      allowEventReminders: true,\n      allowFriendRequests: true,\n    },\n  });\n\n  const defaults = {\n    userId,\n    allowEmailNotifications: profile?.allowEmailNotifications ?? true,\n    allowEventReminders: profile?.allowEventReminders ?? true,\n    allowFriendRequests: profile?.allowFriendRequests ?? true,\n    allowSalesAlerts: true,\n    allowSystemAnnouncements: true,\n  };\n\n  return prisma.notificationPreference.upsert({\n    where: { userId },\n    update: defaults,\n    create: defaults,\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAoBO,eAAe,aAAa,MAAc,EAAE,IAAsB;IACvE,MAAM,QAAQ,MAAM,qBAAqB;IACzC,OAAQ;QACN,KAAK;YACH,OAAO,MAAM,gBAAgB;QAC/B,KAAK;QACL,KAAK;YACH,OAAO,MAAM,mBAAmB;QAClC,KAAK;YACH,OAAO,MAAM,mBAAmB;QAClC,KAAK;QACL,KAAK;YACH,OAAO,MAAM,wBAAwB;QACvC,KAAK;QACL,KAAK;YACH,OAAO,MAAM,mBAAmB;QAClC;YACE,OAAO;IACX;AACF;AAEA,SAAS,cACP,KAAU,EACV,OAA0D;IAE1D,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU,OAAO;IAChD,MAAM,SAAS,QAAQ,QAAQ,IAAI,MAAM,EAAE,KAAK,QAAQ,QAAQ;IAChE,IAAI,CAAC,QAAQ,SAAS,IAAI,QAAQ,OAAO;IACzC,OAAO;QACL,IAAI,MAAM,EAAE,IAAI;QAChB,UAAU,MAAM,QAAQ,IAAI;QAC5B,WAAW,MAAM,SAAS,IAAI;QAC9B,UAAU;QACV,OAAO;IACT;AACF;AAEA,SAAS,gBAAgB,OAAY,EAAE,IAA2E;IAChH,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU,OAAO;IACpD,MAAM,QAAiC;QAAE,GAAG,OAAO;IAAC;IACpD,IAAI,MAAM,KAAK,EAAE;QACf,MAAM,KAAK,GAAG,cAAc,MAAM,KAAK,EAAE;YAAE,WAAW,KAAK,gBAAgB,KAAK;YAAW,UAAU,KAAK,QAAQ;QAAC;IACrH;IACA,OAAO;AACT;AAEO,eAAe,mBAAmB,KAA8B;IACrE,MAAM,EACJ,MAAM,EACN,IAAI,EACJ,KAAK,EACL,IAAI,EACJ,OAAO,EACP,SAAS,IAAI,EACb,WAAW,IAAI,EACf,WAAW,QAAQ,EACnB,mBAAmB,QAAQ,EAC3B,aAAa,IAAI,EACjB,cAAc,IAAI,EAClB,UAAU,IAAI,EACd,WAAW,IAAI,EACf,WAAW,IAAI,EAChB,GAAG;IAEJ,MAAM,OAAO;QACX;QACA;QACA,OAAO,SAAS;QAChB,MAAM,QAAQ;QACd,SAAS,UAAU,gBAAgB,SAAS;YAAE;YAAkB,UAAU;QAAO,KAAK;QACtF,QAAQ,UAAU;QAClB,UAAU,YAAY;QACtB;QACA,YAAY,cAAc;QAC1B,aAAa,eAAe;QAC5B,SAAS,WAAW;QACpB,UAAU,YAAY;QACtB,UAAU,YAAY;IACxB;IAEA,OAAO,yHAAM,CAAC,YAAY,CAAC,MAAM,CAAC;QAAE;IAAK;AAC3C;AAEO,eAAe,qBAAqB,MAAc;IACvD,MAAM,WAAW,MAAM,yHAAM,CAAC,sBAAsB,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE;QAAO;IAAE;IACpF,IAAI,UAAU,OAAO;IAErB,MAAM,UAAU,MAAM,yHAAM,CAAC,OAAO,CAAC,UAAU,CAAC;QAC9C,OAAO;YAAE,IAAI;QAAO;QACpB,QAAQ;YACN,yBAAyB;YACzB,qBAAqB;YACrB,qBAAqB;QACvB;IACF;IAEA,MAAM,WAAW;QACf;QACA,yBAAyB,SAAS,2BAA2B;QAC7D,qBAAqB,SAAS,uBAAuB;QACrD,qBAAqB,SAAS,uBAAuB;QACrD,kBAAkB;QAClB,0BAA0B;IAC5B;IAEA,OAAO,yHAAM,CAAC,sBAAsB,CAAC,MAAM,CAAC;QAC1C,OAAO;YAAE;QAAO;QAChB,QAAQ;QACR,QAAQ;IACV;AACF"}},
    {"offset": {"line": 428, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/username.ts"],"sourcesContent":["const USERNAME_REGEX = /^[a-z0-9](?:[a-z0-9._]*[a-z0-9])?$/;\n\nexport type UsernameValidation =\n  | { valid: true; normalized: string }\n  | { valid: false; error: string };\n\n/**\n * Remove acentos, espaços e caracteres inválidos, deixando apenas letras, números, _ e . (lowercase).\n * Limita a 30 chars e evita que termine/comece em '.'.\n */\nexport function sanitizeUsername(input: string): string {\n  const base = (input ?? \"\")\n    .normalize(\"NFKD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\"); // remove diacríticos\n  const cleaned = base.replace(/[^A-Za-z0-9._]/g, \"\");\n  const trimmed = cleaned.replace(/^\\.+/, \"\").replace(/\\.+$/, \"\");\n  const collapsedDots = trimmed.replace(/\\.{2,}/g, \".\");\n  return collapsedDots.toLowerCase().slice(0, 30);\n}\n\nexport function validateUsername(raw: string): UsernameValidation {\n  const normalized = sanitizeUsername(raw);\n  if (!normalized || normalized.length < 3 || normalized.length > 30) {\n    return {\n      valid: false,\n      error: \"Escolhe um username entre 3 e 30 caracteres (letras, números, _ ou .).\",\n    };\n  }\n  if (!USERNAME_REGEX.test(normalized)) {\n    return {\n      valid: false,\n      error: \"O username só pode ter letras, números, _ e . (sem espaços ou acentos).\",\n    };\n  }\n  if (normalized.includes(\"..\")) {\n    return {\n      valid: false,\n      error: \"O username não pode ter '..' seguido.\",\n    };\n  }\n  return { valid: true, normalized };\n}\n\nexport const USERNAME_RULES_HINT =\n  \"3-30 caracteres, letras ou números, opcionalmente _ ou ., sem espaços ou acentos.\";\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,iBAAiB;AAUhB,SAAS,iBAAiB,KAAa;IAC5C,MAAM,OAAO,CAAC,SAAS,EAAE,EACtB,SAAS,CAAC,QACV,OAAO,CAAC,oBAAoB,KAAK,qBAAqB;IACzD,MAAM,UAAU,KAAK,OAAO,CAAC,mBAAmB;IAChD,MAAM,UAAU,QAAQ,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ;IAC5D,MAAM,gBAAgB,QAAQ,OAAO,CAAC,WAAW;IACjD,OAAO,cAAc,WAAW,GAAG,KAAK,CAAC,GAAG;AAC9C;AAEO,SAAS,iBAAiB,GAAW;IAC1C,MAAM,aAAa,iBAAiB;IACpC,IAAI,CAAC,cAAc,WAAW,MAAM,GAAG,KAAK,WAAW,MAAM,GAAG,IAAI;QAClE,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,IAAI,CAAC,eAAe,IAAI,CAAC,aAAa;QACpC,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,IAAI,WAAW,QAAQ,CAAC,OAAO;QAC7B,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,OAAO;QAAE,OAAO;QAAM;IAAW;AACnC;AAEO,MAAM,sBACX"}},
    {"offset": {"line": 476, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/globalUsernames.ts"],"sourcesContent":["import { Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\nimport { validateUsername } from \"@/lib/username\";\n\ntype Tx = Prisma.TransactionClient | PrismaClient;\nexport type UsernameOwnerType = \"user\" | \"organizer\";\n\nexport class UsernameTakenError extends Error {\n  code = \"USERNAME_TAKEN\";\n  constructor(username: string) {\n    super(`Username ${username} já está a ser usado`);\n  }\n}\n\nexport function normalizeAndValidateUsername(raw: string) {\n  const result = validateUsername(raw);\n  if (!result.valid) {\n    return { ok: false as const, error: result.error };\n  }\n  return { ok: true as const, username: result.normalized };\n}\n\nexport async function checkUsernameAvailability(username: string, tx: Tx = prisma) {\n  const normalizedResult = normalizeAndValidateUsername(username);\n  if (!normalizedResult.ok) return normalizedResult;\n\n  const normalized = normalizedResult.username;\n\n  const checkLocalAvailability = async (client: Tx) => {\n    const [profile, organizer] = await Promise.all([\n      client.profile.findFirst({\n        where: { username: { equals: normalized, mode: \"insensitive\" } },\n        select: { id: true },\n      }),\n      client.organizer.findFirst({\n        where: { username: { equals: normalized, mode: \"insensitive\" } },\n        select: { id: true },\n      }),\n    ]);\n    return !profile && !organizer;\n  };\n\n  try {\n    const existing = await tx.globalUsername.findUnique({\n      where: { username: normalized },\n      select: { ownerType: true, ownerId: true },\n    });\n    if (existing) {\n      return { ok: true as const, available: false, username: normalized };\n    }\n    const available = await checkLocalAvailability(tx);\n    return { ok: true as const, available, username: normalized };\n  } catch (err) {\n    const code = (err as { code?: string })?.code;\n    const msg = err instanceof Error ? err.message : \"\";\n    const missingTable = code === \"P2021\" || code === \"P2022\" || msg.toLowerCase().includes(\"does not exist\");\n    if (missingTable) {\n      console.warn(\"[globalUsernames] table/column missing while checking availability\");\n      const available = await checkLocalAvailability(tx);\n      return { ok: true as const, available, username: normalized };\n    }\n    throw err;\n  }\n}\n\nexport async function setUsernameForOwner(options: {\n  username: string;\n  ownerType: UsernameOwnerType;\n  ownerId: string | number;\n  tx?: Tx;\n}) {\n  const { username: rawUsername, ownerType, ownerId } = options;\n  const providedTx = options.tx;\n\n  const validated = normalizeAndValidateUsername(rawUsername);\n  if (!validated.ok) {\n    return { ok: false as const, error: validated.error };\n  }\n\n  const username = validated.username;\n  const ownerIdStr = String(ownerId);\n  const ownerIdNumber = ownerType === \"organizer\" ? Number(ownerId) : null;\n\n  const run = async (trx: Tx) => {\n    const [profile, organizer] = await Promise.all([\n      trx.profile.findFirst({\n        where: {\n          username: { equals: username, mode: \"insensitive\" },\n          ...(ownerType === \"user\" ? { NOT: { id: ownerIdStr } } : {}),\n        },\n        select: { id: true },\n      }),\n      trx.organizer.findFirst({\n        where: {\n          username: { equals: username, mode: \"insensitive\" },\n          ...(ownerType === \"organizer\" && ownerIdNumber && Number.isFinite(ownerIdNumber)\n            ? { NOT: { id: ownerIdNumber } }\n            : {}),\n        },\n        select: { id: true },\n      }),\n    ]);\n    if (profile || organizer) {\n      throw new UsernameTakenError(username);\n    }\n\n    const existing = await trx.globalUsername.findUnique({\n      where: { username },\n      select: { ownerType: true, ownerId: true },\n    });\n\n    if (existing && (existing.ownerType !== ownerType || existing.ownerId !== ownerIdStr)) {\n      throw new UsernameTakenError(username);\n    }\n\n    await trx.globalUsername.deleteMany({\n      where: {\n        ownerType,\n        ownerId: ownerIdStr,\n        username: { not: username },\n      },\n    });\n\n    await trx.globalUsername.upsert({\n      where: { username },\n      update: { ownerType, ownerId: ownerIdStr, updatedAt: new Date() },\n      create: {\n        username,\n        ownerType,\n        ownerId: ownerIdStr,\n      },\n    });\n\n    return { ok: true as const, username };\n  };\n\n  if (providedTx) {\n    try {\n      return await run(providedTx);\n    } catch (err) {\n      const code = (err as { code?: string })?.code;\n      const msg = err instanceof Error ? err.message : \"\";\n      const missingTable = code === \"P2021\" || code === \"P2022\" || msg.toLowerCase().includes(\"relation\") || msg.toLowerCase().includes(\"does not exist\");\n      if (missingTable) {\n        console.warn(\"[globalUsernames] table/column missing, skipping username reservation\");\n        return { ok: false as const, error: \"USERNAME_TABLE_MISSING\" as const };\n      }\n      throw err;\n    }\n  }\n\n  try {\n    return await prisma.$transaction(run);\n  } catch (err) {\n    const code = (err as { code?: string })?.code;\n    const msg = err instanceof Error ? err.message : \"\";\n    const missingTable = code === \"P2021\" || code === \"P2022\" || msg.toLowerCase().includes(\"relation\") || msg.toLowerCase().includes(\"does not exist\");\n    if (missingTable) {\n      console.warn(\"[globalUsernames] table/column missing, skipping username reservation\");\n      return { ok: false as const, error: \"USERNAME_TABLE_MISSING\" as const };\n    }\n    throw err;\n  }\n}\n\n/**\n * Remove usernames associados a um owner específico (user ou organizer).\n * Útil em deletes/cleanup de conta/org.\n */\nexport async function clearUsernameForOwner(options: {\n  ownerType: UsernameOwnerType;\n  ownerId: string | number;\n  tx?: Tx;\n}) {\n  const { ownerType, ownerId } = options;\n  const client = options.tx ?? prisma;\n  await client.globalUsername.deleteMany({\n    where: { ownerType, ownerId: String(ownerId) },\n  });\n  return { ok: true as const };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 730, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/api/auth/me/route.ts"],"sourcesContent":["// app/api/auth/me/route.ts\nimport { NextResponse } from \"next/server\";\nimport { createSupabaseServer } from \"@/lib/supabaseServer\";\nimport { getNotificationPrefs } from \"@/lib/notifications\";\nimport { prisma } from \"@/lib/prisma\";\nimport type { User } from \"@supabase/supabase-js\";\nimport { setUsernameForOwner, UsernameTakenError } from \"@/lib/globalUsernames\";\n\ntype SupabaseUserMetadata = {\n  full_name?: string;\n  name?: string;\n  avatar_url?: string;\n  pending_username?: string;\n};\n\ntype ApiAuthMeResponse = {\n  user: {\n    id: string;\n    email: string | null;\n    emailConfirmed: boolean;\n  } | null;\n  profile: {\n    id: string;\n    username: string | null;\n    fullName: string | null;\n    avatarUrl: string | null;\n    coverUrl: string | null;\n    bio: string | null;\n    city: string | null;\n    contactPhone: string | null;\n    favouriteCategories: string[];\n    onboardingDone: boolean;\n    roles: string[];\n    visibility: string;\n    allowEmailNotifications: boolean;\n    allowEventReminders: boolean;\n    allowFriendRequests: boolean;\n    allowSalesAlerts?: boolean;\n    allowSystemAnnouncements?: boolean;\n    profileVisibility: \"PUBLIC\" | \"PRIVATE\";\n  } | null;\n  needsEmailConfirmation?: boolean;\n};\n\nexport async function GET() {\n  try {\n     const supabase = await createSupabaseServer();\n\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser();\n\n    if (error || !user) {\n      // Sessão ausente ou inválida → 401 limpo (evita spam de logs)\n      return NextResponse.json<ApiAuthMeResponse>(\n        { user: null, profile: null },\n        { status: 401 },\n      );\n    }\n\n    const supaUser = user as User;\n    const emailConfirmed =\n      Boolean(supaUser.email_confirmed_at) ||\n      Boolean((supaUser as { confirmed_at?: string | null })?.confirmed_at) ||\n      false;\n\n    const userMetadata = (user.user_metadata ?? {}) as SupabaseUserMetadata;\n\n    const userId = user.id;\n\n    // Garantir Profile 1-1 com auth.users e prefs\n    const [profileFromDb, notificationPrefs] = await Promise.all([\n      prisma.profile.findUnique({\n        where: { id: userId },\n      }),\n      getNotificationPrefs(userId).catch(() => null),\n    ]);\n    let profile =\n      profileFromDb ??\n      (await prisma.profile.create({\n        data: {\n          id: userId,\n          username: null,\n          fullName: userMetadata.full_name ?? userMetadata.name ?? null,\n          avatarUrl: userMetadata.avatar_url ?? null,\n          roles: [\"user\"],\n          visibility: \"PUBLIC\",\n          allowEmailNotifications: true,\n          allowEventReminders: true,\n          allowFriendRequests: true,\n        },\n      }));\n\n    const pendingUsername = typeof userMetadata.pending_username === \"string\" ? userMetadata.pending_username : null;\n\n    // Atribuir username pendente se ainda não existir\n    if (!profile.username && pendingUsername) {\n      try {\n        await prisma.$transaction(async (tx) => {\n          await setUsernameForOwner({\n            username: pendingUsername,\n            ownerType: \"user\",\n            ownerId: userId,\n            tx,\n          });\n          await tx.profile.update({\n            where: { id: userId },\n            data: { username: pendingUsername },\n          });\n        });\n        profile = await prisma.profile.findUnique({ where: { id: userId } });\n      } catch (err) {\n        if (err instanceof UsernameTakenError) {\n          // outro utilizador já registou o @ entretanto; deixa username nulo\n          console.warn(\"[auth/me] pending_username já ocupado\");\n        } else {\n          console.error(\"[auth/me] erro ao aplicar pending_username:\", err);\n        }\n      }\n    }\n\n    if (!profile) {\n      throw new Error(\"PROFILE_MISSING\");\n    }\n\n    const profileVisibility: \"PUBLIC\" | \"PRIVATE\" =\n      profile.visibility === \"PRIVATE\" ? \"PRIVATE\" : \"PUBLIC\";\n\n    const safeProfile: ApiAuthMeResponse[\"profile\"] = {\n      id: profile.id,\n      username: profile.username,\n      fullName: profile.fullName,\n      avatarUrl: profile.avatarUrl,\n      coverUrl: profile.coverUrl,\n      bio: profile.bio,\n      city: profile.city,\n      contactPhone: profile.contactPhone,\n      favouriteCategories: profile.favouriteCategories,\n      onboardingDone: profile.onboardingDone,\n      roles: profile.roles,\n      visibility: profile.visibility,\n      allowEmailNotifications: profile.allowEmailNotifications,\n      allowEventReminders: profile.allowEventReminders,\n      allowFriendRequests: profile.allowFriendRequests,\n      allowSalesAlerts: notificationPrefs?.allowSalesAlerts ?? true,\n      allowSystemAnnouncements: notificationPrefs?.allowSystemAnnouncements ?? true,\n      profileVisibility,\n    };\n\n    // Se email não está confirmado, força o frontend a continuar em modo \"verify\"\n    if (!emailConfirmed) {\n      return NextResponse.json<ApiAuthMeResponse>(\n        {\n          user: {\n            id: user.id,\n            email: user.email ?? null,\n            emailConfirmed,\n          },\n          profile: null,\n          needsEmailConfirmation: true,\n        },\n        { status: 401 },\n      );\n    }\n\n    return NextResponse.json<ApiAuthMeResponse>(\n      {\n        user: {\n          id: user.id,\n          email: user.email ?? null,\n          emailConfirmed,\n        },\n        profile: safeProfile,\n      },\n      { status: 200 },\n    );\n  } catch (err) {\n    console.error(\"GET /api/auth/me error:\", err);\n    return NextResponse.json<ApiAuthMeResponse>(\n      { user: null, profile: null },\n      { status: 200 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}