{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/env.ts"],"sourcesContent":["// Central helper for server-side environment variables (server-only).\n// ⚠️ Não importar este módulo em componentes com \"use client\".\nconst required = [\n  \"SUPABASE_URL\",\n  \"SUPABASE_ANON_KEY\",\n  \"SUPABASE_SERVICE_ROLE\",\n  \"DATABASE_URL\",\n  \"STRIPE_SECRET_KEY\",\n  \"STRIPE_WEBHOOK_SECRET\",\n  \"QR_SECRET_KEY\",\n  \"RESEND_API_KEY\",\n] as const;\n\ntype EnvKey = (typeof required)[number];\n\nfunction getEnv(key: EnvKey): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing env var: ${key}`);\n  }\n  return value;\n}\n\nfunction getOptionalUrlEnv(...keys: string[]) {\n  for (const key of keys) {\n    const value = process.env[key];\n    if (typeof value === \"string\" && value.trim().length > 0) {\n      return value.trim().replace(/\\/+$/, \"\"); // remove trailing slash para URLs previsíveis\n    }\n  }\n  return \"\";\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseList(raw: unknown) {\n  if (typeof raw !== \"string\") return [];\n  return raw\n    .split(/[,\\s]+/g)\n    .map((item) => item.trim())\n    .filter(Boolean);\n}\n\nexport const env = {\n  supabaseUrl: getEnv(\"SUPABASE_URL\"),\n  supabaseAnonKey: getEnv(\"SUPABASE_ANON_KEY\"),\n  serviceRoleKey: getEnv(\"SUPABASE_SERVICE_ROLE\"),\n  dbUrl: getEnv(\"DATABASE_URL\"),\n  stripeSecretKey: getEnv(\"STRIPE_SECRET_KEY\"),\n  stripeWebhookSecret: getEnv(\"STRIPE_WEBHOOK_SECRET\"),\n  qrSecretKey: getEnv(\"QR_SECRET_KEY\"),\n  resendApiKey: getEnv(\"RESEND_API_KEY\"),\n  resendFrom:\n    process.env.RESEND_FROM ??\n    process.env.RESEND_FROM_EMAIL ??\n    \"no-reply@orya.pt\",\n  appBaseUrl: getOptionalUrlEnv(\"APP_BASE_URL\", \"NEXT_PUBLIC_BASE_URL\", \"NEXT_PUBLIC_SITE_URL\", \"VERCEL_URL\"),\n  uploadsBucket:\n    process.env.SUPABASE_STORAGE_BUCKET_UPLOADS ??\n    process.env.SUPABASE_STORAGE_BUCKET ??\n    \"uploads\",\n  avatarsBucket: process.env.SUPABASE_STORAGE_BUCKET_AVATARS ?? \"\",\n  eventCoversBucket: process.env.SUPABASE_STORAGE_BUCKET_EVENT_COVERS ?? \"\",\n  storageSignedUrls: parseBoolean(process.env.SUPABASE_STORAGE_SIGNED_URLS, false),\n  storageSignedTtlSeconds: parseNumber(process.env.SUPABASE_STORAGE_SIGNED_TTL_SECONDS, 60 * 60 * 24 * 30), // 30 dias\n  stripePremiumPriceIds: parseList(process.env.STRIPE_PREMIUM_PRICE_IDS),\n  stripePremiumProductIds: parseList(process.env.STRIPE_PREMIUM_PRODUCT_IDS),\n};\n"],"names":[],"mappings":"AAAA,sEAAsE;AACtE,+DAA+D;;;;;AAC/D,MAAM,WAAW;IACf;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAID,SAAS,OAAO,GAAW;IACzB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK;IAC3C;IACA,OAAO;AACT;AAEA,SAAS,kBAAkB,GAAG,IAAc;IAC1C,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;QAC9B,IAAI,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;YACxD,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,8CAA8C;QACzF;IACF;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAY,EAAE,QAAiB;IACnD,IAAI,OAAO,QAAQ,WAAW,OAAO;IACrC,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,aAAa,IAAI,IAAI,GAAG,WAAW;QACzC,IAAI;YAAC;YAAK;YAAQ;YAAO;SAAK,CAAC,QAAQ,CAAC,aAAa,OAAO;QAC5D,IAAI;YAAC;YAAK;YAAS;YAAM;SAAM,CAAC,QAAQ,CAAC,aAAa,OAAO;IAC/D;IACA,OAAO;AACT;AAEA,SAAS,YAAY,GAAY,EAAE,QAAgB;IACjD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO,EAAE;IACtC,OAAO,IACJ,KAAK,CAAC,WACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC;AACZ;AAEO,MAAM,MAAM;IACjB,aAAa,OAAO;IACpB,iBAAiB,OAAO;IACxB,gBAAgB,OAAO;IACvB,OAAO,OAAO;IACd,iBAAiB,OAAO;IACxB,qBAAqB,OAAO;IAC5B,aAAa,OAAO;IACpB,cAAc,OAAO;IACrB,YACE,QAAQ,GAAG,CAAC,WAAW,IACvB,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IACF,YAAY,kBAAkB,gBAAgB,wBAAwB,wBAAwB;IAC9F,eACE,QAAQ,GAAG,CAAC,+BAA+B,IAC3C,QAAQ,GAAG,CAAC,uBAAuB,IACnC;IACF,eAAe,QAAQ,GAAG,CAAC,+BAA+B,IAAI;IAC9D,mBAAmB,QAAQ,GAAG,CAAC,oCAAoC,IAAI;IACvE,mBAAmB,aAAa,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC1E,yBAAyB,YAAY,QAAQ,GAAG,CAAC,mCAAmC,EAAE,KAAK,KAAK,KAAK;IACrG,uBAAuB,UAAU,QAAQ,GAAG,CAAC,wBAAwB;IACrE,yBAAyB,UAAU,QAAQ,GAAG,CAAC,0BAA0B;AAC3E"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/supabaseServer.ts"],"sourcesContent":["import \"server-only\";\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { env } from \"@/lib/env\";\n\nfunction decodeBase64Cookie(raw: string) {\n  const BASE64_PREFIX = \"base64-\";\n  if (!raw.startsWith(BASE64_PREFIX)) return raw;\n\n  const base = raw.slice(BASE64_PREFIX.length);\n  const encodings: BufferEncoding[] = [\"base64url\", \"base64\"];\n\n  for (const enc of encodings) {\n    try {\n      return Buffer.from(base, enc).toString(\"utf-8\");\n    } catch {\n      /* try next */\n    }\n  }\n\n  // Se não conseguirmos decodificar, tratamos como cookie ausente para evitar JSON.parse de strings inválidas\n  return undefined;\n}\n\n/**\n * Server-side Supabase client (SSR + Route Handlers)\n * - Safe cookie reading\n * - Safe cookie writing\n * - Prevents JSON parse errors\n * - No profile fetching here\n */\nexport async function createSupabaseServer() {\n  const cookieStore = (await cookies());\n\n  const supabase = createServerClient(\n    env.supabaseUrl,\n    env.supabaseAnonKey,\n    {\n      cookies: {\n        get(name: string) {\n          try {\n            // Só devolvemos cookies do Supabase (sb-*) e ignoramos o resto\n            if (!name.startsWith(\"sb-\")) return undefined;\n            const raw = cookieStore.get(name)?.value;\n            if (!raw) return undefined;\n\n            // Se for um chunk (sb-*.0, sb-*.1, ...), deixamos intacto para o combinador do Supabase tratar\n            const isChunk = /\\.\\d+$/.test(name);\n            return isChunk ? raw : decodeBase64Cookie(raw);\n          } catch {\n            return undefined;\n          }\n        },\n        set(name: string, value: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value, ...options });\n          } catch {\n            /* ignore errors for RSC */\n          }\n        },\n        remove(name: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value: \"\", ...options, maxAge: 0 });\n          } catch {\n            /* ignore */\n          }\n        },\n      },\n    }\n  );\n\n  return supabase;\n}\n\n\nexport async function getCurrentUser() {\n  const supabase = await createSupabaseServer();\n\n  try {\n    const { data, error } = await supabase.auth.getUser();\n\n    if (error || !data?.user) {\n      return { user: null, error };\n    }\n\n    return { user: data.user, error: null };\n  } catch (err) {\n    return { user: null, error: err };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,SAAS,mBAAmB,GAAW;IACrC,MAAM,gBAAgB;IACtB,IAAI,CAAC,IAAI,UAAU,CAAC,gBAAgB,OAAO;IAE3C,MAAM,OAAO,IAAI,KAAK,CAAC,cAAc,MAAM;IAC3C,MAAM,YAA8B;QAAC;QAAa;KAAS;IAE3D,KAAK,MAAM,OAAO,UAAW;QAC3B,IAAI;YACF,OAAO,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;QACzC,EAAE,OAAM;QACN,YAAY,GACd;IACF;IAEA,4GAA4G;IAC5G,OAAO;AACT;AASO,eAAe;IACpB,MAAM,cAAe,MAAM,IAAA,4IAAO;IAElC,MAAM,WAAW,IAAA,iMAAkB,EACjC,mHAAG,CAAC,WAAW,EACf,mHAAG,CAAC,eAAe,EACnB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,IAAI;oBACF,+DAA+D;oBAC/D,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,OAAO;oBACpC,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBACnC,IAAI,CAAC,KAAK,OAAO;oBAEjB,+FAA+F;oBAC/F,MAAM,UAAU,SAAS,IAAI,CAAC;oBAC9B,OAAO,UAAU,MAAM,mBAAmB;gBAC5C,EAAE,OAAM;oBACN,OAAO;gBACT;YACF;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAgC;gBAC/D,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAM;gBACN,yBAAyB,GAC3B;YACF;YACA,QAAO,IAAY,EAAE,OAAgC;gBACnD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBAC3D,EAAE,OAAM;gBACN,UAAU,GACZ;YACF;QACF;IACF;IAGF,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEnD,IAAI,SAAS,CAAC,MAAM,MAAM;YACxB,OAAO;gBAAE,MAAM;gBAAM;YAAM;QAC7B;QAEA,OAAO;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO;QAAK;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,MAAM;YAAM,OAAO;QAAI;IAClC;AACF"}},
    {"offset": {"line": 261, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { Prisma, PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport { env } from \"@/lib/env\";\n\n// Toggle de logs verbose (queries) via env: PRISMA_LOG_QUERIES=true\nconst enableQueryLog = process.env.PRISMA_LOG_QUERIES === \"true\";\nconst logLevels: (Prisma.LogLevel | Prisma.LogDefinition)[] =\n  process.env.NODE_ENV === \"development\"\n    ? enableQueryLog\n      ? [\"query\", \"error\", \"warn\"]\n      : [\"error\", \"warn\"]\n    : [\"error\"];\n\n// Evitar múltiplas instâncias em dev (hot reload)\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\n// Pool e adapter para usar o client engine (\"library\") com Postgres\nconst pool = new Pool({\n  connectionString: env.dbUrl,\n  ssl:\n    process.env.NODE_ENV === \"production\"\n      ? undefined\n      : { rejectUnauthorized: false },\n});\n\nconst adapter = new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: logLevels,\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;AACA;AACA;;;;;;;;;;AAEA,oEAAoE;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK;AAC1D,MAAM,YACJ,uCACI,iBACE;IAAC;IAAS;IAAS;CAAO,GAC1B;IAAC;IAAS;CAAO,GACnB;AAEN,kDAAkD;AAClD,MAAM,kBAAkB;AAIxB,oEAAoE;AACpE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,mHAAG,CAAC,KAAK;IAC3B,KACE,sCACI,0BACA;QAAE,oBAAoB;IAAM;AACpC;AAEA,MAAM,UAAU,IAAI,8JAAQ,CAAC;AAEtB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK;AACP;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 313, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/padel/eventSnapshot.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\ntype CourtLite = { name: string; clubName: string | null; indoor?: boolean | null };\ntype PartnerClubLite = { id: number; name: string | null; city: string | null };\n\nexport type PadelEventSnapshot = {\n  eventId: number;\n  title: string;\n  status: string;\n  startsAt: string | null;\n  endsAt: string | null;\n  clubName: string | null;\n  clubCity: string | null;\n  partnerClubs: PartnerClubLite[];\n  courts: CourtLite[];\n  timeline: Array<{ key: string; label: string; state: \"done\" | \"active\" | \"pending\"; cancelled?: boolean; date: string | null }>;\n};\n\nfunction buildTimeline(params: { status: string; startsAt: Date | null; endsAt: Date | null }) {\n  const { status, startsAt, endsAt } = params;\n  const now = new Date();\n  const started = startsAt ? startsAt.getTime() <= now.getTime() : false;\n  const finished = status === \"FINISHED\" || (endsAt ? endsAt.getTime() < now.getTime() : false);\n  const cancelled = status === \"CANCELLED\";\n\n  return [\n    {\n      key: \"signup\",\n      label: \"Inscrições\",\n      state: status === \"PUBLISHED\" && !started ? \"active\" : status === \"DRAFT\" ? \"pending\" : \"done\",\n      date: startsAt ? startsAt.toISOString() : null,\n    },\n    {\n      key: \"games\",\n      label: \"Jogos\",\n      state: cancelled ? \"pending\" : started ? (finished ? \"done\" : \"active\") : \"pending\",\n      date: startsAt ? startsAt.toISOString() : null,\n    },\n    {\n      key: \"finish\",\n      label: cancelled ? \"Cancelado\" : \"Terminado\",\n      state: finished || cancelled ? \"done\" : \"pending\",\n      cancelled,\n      date: endsAt ? endsAt.toISOString() : null,\n    },\n  ];\n}\n\nexport async function buildPadelEventSnapshot(eventId: number): Promise<PadelEventSnapshot | null> {\n  if (!Number.isFinite(eventId)) return null;\n\n  const event = await prisma.event.findUnique({\n    where: { id: eventId, isDeleted: false },\n    select: {\n      id: true,\n      title: true,\n      status: true,\n      startsAt: true,\n      endsAt: true,\n      templateType: true,\n      locationCity: true,\n      locationName: true,\n      padelTournamentConfig: {\n        select: {\n          numberOfCourts: true,\n          partnerClubIds: true,\n          advancedSettings: true,\n          club: { select: { id: true, name: true, city: true, address: true } },\n        },\n      },\n    },\n  });\n\n  if (!event || event.templateType !== \"PADEL\") return null;\n\n  const config = event.padelTournamentConfig;\n  const advanced = (config?.advancedSettings || {}) as {\n    courtsFromClubs?: Array<{ name?: string | null; clubName?: string | null; indoor?: boolean | null }>;\n  };\n\n  const partnerIds = config?.partnerClubIds ?? [];\n  const partnerClubs: PartnerClubLite[] =\n    partnerIds.length > 0\n      ? await prisma.padelClub.findMany({\n          where: { id: { in: partnerIds } },\n          select: { id: true, name: true, city: true },\n        })\n      : [];\n\n  const courtsFromClubs = Array.isArray(advanced?.courtsFromClubs)\n    ? (advanced.courtsFromClubs || []).map((c, idx) => ({\n        name: c.name || `Court ${idx + 1}`,\n        clubName: c.clubName || config?.club?.name || null,\n        indoor: c.indoor ?? null,\n      }))\n    : [];\n\n  const courts: CourtLite[] =\n    courtsFromClubs.length > 0\n      ? courtsFromClubs\n      : Array.from({ length: Math.max(1, config?.numberOfCourts || 1) }).map((_, idx) => ({\n          name: `Court ${idx + 1}`,\n          clubName: config?.club?.name || event.locationName || null,\n          indoor: null,\n        }));\n\n  return {\n    eventId: event.id,\n    title: event.title,\n    status: event.status,\n    startsAt: event.startsAt?.toISOString() ?? null,\n    endsAt: event.endsAt?.toISOString() ?? null,\n    clubName: config?.club?.name || event.locationName || null,\n    clubCity: config?.club?.city || event.locationCity || null,\n    partnerClubs,\n    courts,\n    timeline: buildTimeline({ status: event.status, startsAt: event.startsAt, endsAt: event.endsAt ?? event.startsAt }),\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/domain/padelEligibility.ts"],"sourcesContent":["import { Gender, PadelEligibilityType } from \"@prisma/client\";\n\nexport type EligibilityResult =\n  | { ok: true }\n  | { ok: false; code: \"GENDER_REQUIRED_FOR_TOURNAMENT\" | \"INELIGIBLE_FOR_TOURNAMENT\" };\n\nexport function validateEligibility(\n  eligibilityType: PadelEligibilityType,\n  player1Gender: Gender | null | undefined,\n  player2Gender?: Gender | null,\n): EligibilityResult {\n  if (eligibilityType === \"OPEN\") return { ok: true };\n\n  const p1 = player1Gender ?? null;\n  const p2 = player2Gender ?? null;\n\n  if (!p1) return { ok: false, code: \"GENDER_REQUIRED_FOR_TOURNAMENT\" };\n  if (eligibilityType === \"MALE_ONLY\") {\n    return p1 === \"MALE\" && (!p2 || p2 === \"MALE\")\n      ? { ok: true }\n      : { ok: false, code: \"INELIGIBLE_FOR_TOURNAMENT\" };\n  }\n  if (eligibilityType === \"FEMALE_ONLY\") {\n    return p1 === \"FEMALE\" && (!p2 || p2 === \"FEMALE\")\n      ? { ok: true }\n      : { ok: false, code: \"INELIGIBLE_FOR_TOURNAMENT\" };\n  }\n\n  // MIXED\n  if (!p2) return { ok: true }; // pode criar/entrar “à procura”; valida no fecho\n  const comboOk =\n    (p1 === \"MALE\" && p2 === \"FEMALE\") || (p1 === \"FEMALE\" && p2 === \"MALE\");\n  return comboOk ? { ok: true } : { ok: false, code: \"INELIGIBLE_FOR_TOURNAMENT\" };\n}\n"],"names":[],"mappings":";;;;AAMO,SAAS,oBACd,eAAqC,EACrC,aAAwC,EACxC,aAA6B;IAE7B,IAAI,oBAAoB,QAAQ,OAAO;QAAE,IAAI;IAAK;IAElD,MAAM,KAAK,iBAAiB;IAC5B,MAAM,KAAK,iBAAiB;IAE5B,IAAI,CAAC,IAAI,OAAO;QAAE,IAAI;QAAO,MAAM;IAAiC;IACpE,IAAI,oBAAoB,aAAa;QACnC,OAAO,OAAO,UAAU,CAAC,CAAC,MAAM,OAAO,MAAM,IACzC;YAAE,IAAI;QAAK,IACX;YAAE,IAAI;YAAO,MAAM;QAA4B;IACrD;IACA,IAAI,oBAAoB,eAAe;QACrC,OAAO,OAAO,YAAY,CAAC,CAAC,MAAM,OAAO,QAAQ,IAC7C;YAAE,IAAI;QAAK,IACX;YAAE,IAAI;YAAO,MAAM;QAA4B;IACrD;IAEA,QAAQ;IACR,IAAI,CAAC,IAAI,OAAO;QAAE,IAAI;IAAK,GAAG,iDAAiD;IAC/E,MAAM,UACJ,AAAC,OAAO,UAAU,OAAO,YAAc,OAAO,YAAY,OAAO;IACnE,OAAO,UAAU;QAAE,IAAI;IAAK,IAAI;QAAE,IAAI;QAAO,MAAM;IAA4B;AACjF"}},
    {"offset": {"line": 480, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/domain/padelPairingHold.ts"],"sourcesContent":["import { Prisma, PadelPairingHoldStatus } from \"@prisma/client\";\n\ntype TxClient = Prisma.TransactionClient;\n\nconst DEFAULT_HOLD_MINUTES = 30;\n\nexport async function upsertActiveHold(\n  tx: TxClient,\n  params: { pairingId: number; eventId: number; ttlMinutes?: number },\n) {\n  const { pairingId, eventId, ttlMinutes } = params;\n  const minutes = ttlMinutes && ttlMinutes > 0 ? ttlMinutes : DEFAULT_HOLD_MINUTES;\n  const expiresAt = new Date(Date.now() + minutes * 60 * 1000);\n\n  // Alguns ambientes perderam o unique constraint, por isso evitamos upsert/ON CONFLICT.\n  const updated = await tx.padelPairingHold.updateMany({\n    where: { pairingId, status: PadelPairingHoldStatus.ACTIVE },\n    data: { expiresAt },\n  });\n\n  if (updated.count === 0) {\n    await tx.padelPairingHold.create({\n      data: {\n        pairingId,\n        eventId,\n        holds: 2,\n        status: PadelPairingHoldStatus.ACTIVE,\n        expiresAt,\n      },\n    });\n  }\n\n  return { expiresAt };\n}\n\nexport async function cancelActiveHold(tx: TxClient, pairingId: number) {\n  await tx.padelPairingHold.updateMany({\n    where: { pairingId, status: PadelPairingHoldStatus.ACTIVE },\n    data: { status: PadelPairingHoldStatus.CANCELLED },\n  });\n}\n\nexport async function expireHolds(tx: TxClient, now: Date) {\n  await tx.padelPairingHold.updateMany({\n    where: { status: PadelPairingHoldStatus.ACTIVE, expiresAt: { lt: now } },\n    data: { status: PadelPairingHoldStatus.EXPIRED },\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAIA,MAAM,uBAAuB;AAEtB,eAAe,iBACpB,EAAY,EACZ,MAAmE;IAEnE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG;IAC3C,MAAM,UAAU,cAAc,aAAa,IAAI,aAAa;IAC5D,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,UAAU,KAAK;IAEvD,uFAAuF;IACvF,MAAM,UAAU,MAAM,GAAG,gBAAgB,CAAC,UAAU,CAAC;QACnD,OAAO;YAAE;YAAW,QAAQ,uJAAsB,CAAC,MAAM;QAAC;QAC1D,MAAM;YAAE;QAAU;IACpB;IAEA,IAAI,QAAQ,KAAK,KAAK,GAAG;QACvB,MAAM,GAAG,gBAAgB,CAAC,MAAM,CAAC;YAC/B,MAAM;gBACJ;gBACA;gBACA,OAAO;gBACP,QAAQ,uJAAsB,CAAC,MAAM;gBACrC;YACF;QACF;IACF;IAEA,OAAO;QAAE;IAAU;AACrB;AAEO,eAAe,iBAAiB,EAAY,EAAE,SAAiB;IACpE,MAAM,GAAG,gBAAgB,CAAC,UAAU,CAAC;QACnC,OAAO;YAAE;YAAW,QAAQ,uJAAsB,CAAC,MAAM;QAAC;QAC1D,MAAM;YAAE,QAAQ,uJAAsB,CAAC,SAAS;QAAC;IACnD;AACF;AAEO,eAAe,YAAY,EAAY,EAAE,GAAS;IACvD,MAAM,GAAG,gBAAgB,CAAC,UAAU,CAAC;QACnC,OAAO;YAAE,QAAQ,uJAAsB,CAAC,MAAM;YAAE,WAAW;gBAAE,IAAI;YAAI;QAAE;QACvE,MAAM;YAAE,QAAQ,uJAAsB,CAAC,OAAO;QAAC;IACjD;AACF"}},
    {"offset": {"line": 548, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/domain/padelDeadlines.ts"],"sourcesContent":["const MIN_DEADLINE_HOURS = 48;\nconst MAX_DEADLINE_HOURS = 168;\nconst MIN_LINK_MINUTES = 15;\nconst MAX_LINK_MINUTES = 30;\nconst DEFAULT_LINK_MINUTES = 30;\nconst GRACE_HOURS = 24;\n\nexport function clampDeadlineHours(raw?: number | null): number {\n  const base = typeof raw === \"number\" && !Number.isNaN(raw) ? raw : MIN_DEADLINE_HOURS;\n  return Math.min(Math.max(base, MIN_DEADLINE_HOURS), MAX_DEADLINE_HOURS);\n}\n\nexport function computeDeadlineAt(now: Date, splitDeadlineHours?: number | null): Date {\n  const hours = clampDeadlineHours(splitDeadlineHours);\n  return new Date(now.getTime() + hours * 60 * 60 * 1000);\n}\n\nexport function clampLinkMinutes(raw?: number | null): number {\n  const base = typeof raw === \"number\" && !Number.isNaN(raw) ? raw : DEFAULT_LINK_MINUTES;\n  return Math.min(Math.max(base, MIN_LINK_MINUTES), MAX_LINK_MINUTES);\n}\n\nexport function computePartnerLinkExpiresAt(now: Date, minutes?: number | null): Date {\n  const mins = clampLinkMinutes(minutes);\n  return new Date(now.getTime() + mins * 60 * 1000);\n}\n\nexport function computeGraceUntil(now: Date): Date {\n  return new Date(now.getTime() + GRACE_HOURS * 60 * 60 * 1000);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAM,qBAAqB;AAC3B,MAAM,qBAAqB;AAC3B,MAAM,mBAAmB;AACzB,MAAM,mBAAmB;AACzB,MAAM,uBAAuB;AAC7B,MAAM,cAAc;AAEb,SAAS,mBAAmB,GAAmB;IACpD,MAAM,OAAO,OAAO,QAAQ,YAAY,CAAC,OAAO,KAAK,CAAC,OAAO,MAAM;IACnE,OAAO,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,MAAM,qBAAqB;AACtD;AAEO,SAAS,kBAAkB,GAAS,EAAE,kBAAkC;IAC7E,MAAM,QAAQ,mBAAmB;IACjC,OAAO,IAAI,KAAK,IAAI,OAAO,KAAK,QAAQ,KAAK,KAAK;AACpD;AAEO,SAAS,iBAAiB,GAAmB;IAClD,MAAM,OAAO,OAAO,QAAQ,YAAY,CAAC,OAAO,KAAK,CAAC,OAAO,MAAM;IACnE,OAAO,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,MAAM,mBAAmB;AACpD;AAEO,SAAS,4BAA4B,GAAS,EAAE,OAAuB;IAC5E,MAAM,OAAO,iBAAiB;IAC9B,OAAO,IAAI,KAAK,IAAI,OAAO,KAAK,OAAO,KAAK;AAC9C;AAEO,SAAS,kBAAkB,GAAS;IACzC,OAAO,IAAI,KAAK,IAAI,OAAO,KAAK,cAAc,KAAK,KAAK;AAC1D"}},
    {"offset": {"line": 591, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerRoles.ts"],"sourcesContent":["import { OrganizerMemberRole, Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype TxLike = Prisma.TransactionClient | PrismaClient;\n\n/**\n * Garante unicidade de OWNER numa organização:\n * - promove/cria o utilizador como OWNER\n * - despromove todos os outros OWNER para CO_OWNER\n */\nexport async function setSoleOwner(\n  client: TxLike,\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  await client.organizerMember.upsert({\n    where: { organizerId_userId: { organizerId, userId } },\n    update: { role: OrganizerMemberRole.OWNER },\n    create: {\n      organizerId,\n      userId,\n      role: OrganizerMemberRole.OWNER,\n      invitedByUserId: invitedByUserId ?? undefined,\n    },\n  });\n\n  await client.organizerMember.updateMany({\n    where: { organizerId, role: OrganizerMemberRole.OWNER, userId: { not: userId } },\n    data: { role: OrganizerMemberRole.CO_OWNER },\n  });\n}\n\n/**\n * Marca o perfil como \"organizer\" no array de roles (idempotente).\n */\nexport async function ensureUserIsOrganizer(client: TxLike, userId: string) {\n  const targetProfile = await client.profile.findUnique({\n    where: { id: userId },\n    select: { roles: true },\n  });\n  if (!targetProfile) return;\n\n  const roles = Array.isArray(targetProfile.roles) ? targetProfile.roles : [];\n  if (!roles.includes(\"organizer\")) {\n    await client.profile.update({\n      where: { id: userId },\n      data: { roles: [...roles, \"organizer\"] },\n    });\n  }\n}\n\n/**\n * Wrapper que permite usar helper fora de transação quando necessário.\n */\nexport async function setSoleOwnerSafe(\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  return setSoleOwner(prisma, organizerId, userId, invitedByUserId);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AASO,eAAe,aACpB,MAAc,EACd,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,MAAM,OAAO,eAAe,CAAC,MAAM,CAAC;QAClC,OAAO;YAAE,oBAAoB;gBAAE;gBAAa;YAAO;QAAE;QACrD,QAAQ;YAAE,MAAM,oJAAmB,CAAC,KAAK;QAAC;QAC1C,QAAQ;YACN;YACA;YACA,MAAM,oJAAmB,CAAC,KAAK;YAC/B,iBAAiB,mBAAmB;QACtC;IACF;IAEA,MAAM,OAAO,eAAe,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE;YAAa,MAAM,oJAAmB,CAAC,KAAK;YAAE,QAAQ;gBAAE,KAAK;YAAO;QAAE;QAC/E,MAAM;YAAE,MAAM,oJAAmB,CAAC,QAAQ;QAAC;IAC7C;AACF;AAKO,eAAe,sBAAsB,MAAc,EAAE,MAAc;IACxE,MAAM,gBAAgB,MAAM,OAAO,OAAO,CAAC,UAAU,CAAC;QACpD,OAAO;YAAE,IAAI;QAAO;QACpB,QAAQ;YAAE,OAAO;QAAK;IACxB;IACA,IAAI,CAAC,eAAe;IAEpB,MAAM,QAAQ,MAAM,OAAO,CAAC,cAAc,KAAK,IAAI,cAAc,KAAK,GAAG,EAAE;IAC3E,IAAI,CAAC,MAAM,QAAQ,CAAC,cAAc;QAChC,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC;YAC1B,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,OAAO;uBAAI;oBAAO;iBAAY;YAAC;QACzC;IACF;AACF;AAKO,eAAe,iBACpB,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,OAAO,aAAa,yHAAM,EAAE,aAAa,QAAQ;AACnD"}},
    {"offset": {"line": 671, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerId.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport type { NextRequest } from \"next/server\";\n\nexport const ORGANIZER_COOKIE_NAME = \"orya_org\";\n\nexport function parseOrganizerId(value: unknown): number | null {\n  if (typeof value === \"number\") {\n    return Number.isFinite(value) && value > 0 ? value : null;\n  }\n  if (typeof value !== \"string\") return null;\n  const trimmed = value.trim();\n  if (!trimmed) return null;\n  const parsed = Number(trimmed);\n  return Number.isFinite(parsed) && parsed > 0 ? parsed : null;\n}\n\nexport async function resolveOrganizerIdFromCookies(): Promise<number | null> {\n  try {\n    const cookieStore = await cookies();\n    return parseOrganizerId(cookieStore.get(ORGANIZER_COOKIE_NAME)?.value);\n  } catch {\n    return null;\n  }\n}\n\nexport function resolveOrganizerIdFromRequest(req: NextRequest): number | null {\n  const params = req.nextUrl.searchParams;\n  const paramValue = params.get(\"organizerId\") ?? params.get(\"org\");\n  return parseOrganizerId(paramValue) ?? parseOrganizerId(req.cookies.get(ORGANIZER_COOKIE_NAME)?.value);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,wBAAwB;AAE9B,SAAS,iBAAiB,KAAc;IAC7C,IAAI,OAAO,UAAU,UAAU;QAC7B,OAAO,OAAO,QAAQ,CAAC,UAAU,QAAQ,IAAI,QAAQ;IACvD;IACA,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,UAAU,MAAM,IAAI;IAC1B,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,SAAS,OAAO;IACtB,OAAO,OAAO,QAAQ,CAAC,WAAW,SAAS,IAAI,SAAS;AAC1D;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,OAAO,iBAAiB,YAAY,GAAG,CAAC,wBAAwB;IAClE,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,8BAA8B,GAAgB;IAC5D,MAAM,SAAS,IAAI,OAAO,CAAC,YAAY;IACvC,MAAM,aAAa,OAAO,GAAG,CAAC,kBAAkB,OAAO,GAAG,CAAC;IAC3D,OAAO,iBAAiB,eAAe,iBAAiB,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB;AAClG"}},
    {"offset": {"line": 713, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerContext.ts"],"sourcesContent":["import { OrganizerMemberRole } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\nimport { ensureUserIsOrganizer } from \"@/lib/organizerRoles\";\nimport { resolveOrganizerIdFromCookies } from \"@/lib/organizerId\";\n\ntype Options = {\n  organizerId?: number | null;\n  roles?: OrganizerMemberRole[];\n  // Se quisermos forçar leitura de cookie, basta passar organizerId externamente\n};\n\nexport async function ensureLegacyOrganizerMemberships(userId: string, organizerId?: number | null) {\n  if (!userId) return 0;\n\n  const legacyOrganizers = await prisma.organizer.findMany({\n    where: {\n      userId,\n      ...(Number.isFinite(organizerId) ? { id: organizerId! } : {}),\n    },\n    select: { id: true },\n  });\n\n  if (legacyOrganizers.length === 0) return 0;\n\n  try {\n    await prisma.$transaction(async (tx) => {\n      for (const organizer of legacyOrganizers) {\n        await tx.organizerMember.upsert({\n          where: {\n            organizerId_userId: {\n              organizerId: organizer.id,\n              userId,\n            },\n          },\n          update: { role: OrganizerMemberRole.OWNER },\n          create: {\n            organizerId: organizer.id,\n            userId,\n            role: OrganizerMemberRole.OWNER,\n          },\n        });\n      }\n\n      await ensureUserIsOrganizer(tx, userId);\n    });\n  } catch (err: unknown) {\n    const msg =\n      typeof err === \"object\" && err && \"message\" in err ? String((err as { message?: unknown }).message) : \"\";\n    if (msg.includes(\"does not exist\") || msg.includes(\"organizer_members\")) {\n      return 0;\n    }\n    throw err;\n  }\n\n  return legacyOrganizers.length;\n}\n\nexport async function getActiveOrganizerForUser(userId: string, opts: Options = {}) {\n  const { roles } = opts;\n  const directOrganizerId =\n    typeof opts.organizerId === \"number\" && Number.isFinite(opts.organizerId)\n      ? opts.organizerId\n      : null;\n  const cookieOrganizerId = directOrganizerId ? null : await resolveOrganizerIdFromCookies();\n  const organizerId = directOrganizerId ?? cookieOrganizerId;\n\n  // 1) Se organizerId foi especificado, tenta buscar diretamente essa membership primeiro\n  if (organizerId) {\n    const direct = await prisma.organizerMember.findFirst({\n      where: {\n        userId,\n        organizerId,\n        ...(roles ? { role: { in: roles } } : {}),\n        organizer: { status: \"ACTIVE\" },\n      },\n      include: { organizer: true },\n    });\n    if (direct?.organizer) {\n      return { organizer: direct.organizer, membership: direct };\n    }\n\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId, organizerId);\n    if (legacyFixed > 0) {\n      const retry = await prisma.organizerMember.findFirst({\n        where: {\n          userId,\n          organizerId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n      });\n      if (retry?.organizer) {\n        return { organizer: retry.organizer, membership: retry };\n      }\n    }\n    // Se o organizerId foi pedido explicitamente e não existe membership, não faz fallback.\n    return { organizer: null, membership: null };\n  }\n\n  let memberships = await prisma.organizerMember.findMany({\n    where: {\n      userId,\n      ...(roles ? { role: { in: roles } } : {}),\n      organizer: { status: \"ACTIVE\" },\n    },\n    include: { organizer: true },\n    orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n  });\n\n  if (memberships.length === 0) {\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId);\n    if (legacyFixed > 0) {\n      memberships = await prisma.organizerMember.findMany({\n        where: {\n          userId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n        orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n      });\n    }\n  }\n\n  if (memberships && memberships.length > 0) {\n    if (memberships.length > 1) {\n      return { organizer: null, membership: null };\n    }\n    const selected = memberships[0];\n    if (selected?.organizer) {\n      return { organizer: selected.organizer, membership: selected };\n    }\n  }\n\n  return { organizer: null, membership: null };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 919, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/padel/staff.ts"],"sourcesContent":["\"use server\";\n\nimport { StaffRole, StaffScope, StaffStatus } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\n/**\n * Verifica se o utilizador tem permissão de staff (GLOBAL ou EVENT) para gerir padel no organizer.\n */\nexport async function isPadelStaff(userId: string, organizerId: number, eventId?: number | null) {\n  if (!userId || !organizerId) return false;\n  const scopeFilter =\n    typeof eventId === \"number\"\n      ? { OR: [{ scope: StaffScope.GLOBAL }, { scope: StaffScope.EVENT, eventId }] }\n      : { scope: StaffScope.GLOBAL };\n  const assignment = await prisma.staffAssignment.findFirst({\n    where: {\n      userId,\n      organizerId,\n      status: StaffStatus.ACCEPTED,\n      revokedAt: null,\n      role: { in: [StaffRole.OWNER, StaffRole.ADMIN, StaffRole.STAFF, StaffRole.CHECKIN] },\n      ...scopeFilter,\n    },\n    select: { id: true },\n  });\n  return Boolean(assignment);\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;;;;AAKO,eAAe,aAAa,MAAc,EAAE,WAAmB,EAAE,OAAuB;IAC7F,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IACpC,MAAM,cACJ,OAAO,YAAY,WACf;QAAE,IAAI;YAAC;gBAAE,OAAO,2IAAU,CAAC,MAAM;YAAC;YAAG;gBAAE,OAAO,2IAAU,CAAC,KAAK;gBAAE;YAAQ;SAAE;IAAC,IAC3E;QAAE,OAAO,2IAAU,CAAC,MAAM;IAAC;IACjC,MAAM,aAAa,MAAM,yHAAM,CAAC,eAAe,CAAC,SAAS,CAAC;QACxD,OAAO;YACL;YACA;YACA,QAAQ,4IAAW,CAAC,QAAQ;YAC5B,WAAW;YACX,MAAM;gBAAE,IAAI;oBAAC,0IAAS,CAAC,KAAK;oBAAE,0IAAS,CAAC,KAAK;oBAAE,0IAAS,CAAC,KAAK;oBAAE,0IAAS,CAAC,OAAO;iBAAC;YAAC;YACnF,GAAG,WAAW;QAChB;QACA,QAAQ;YAAE,IAAI;QAAK;IACrB;IACA,OAAO,QAAQ;AACjB;;;IAlBsB;;AAAA,iPAAA"}},
    {"offset": {"line": 981, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/domain/padelCategoryLimit.ts"],"sourcesContent":["import { Prisma } from \"@prisma/client\";\n\ntype LimitResult = { ok: true } | { ok: false; code: \"ALREADY_IN_CATEGORY\" | \"MAX_CATEGORIES\" };\n\ntype LimitParams = {\n  tx: Prisma.TransactionClient;\n  eventId: number;\n  userId: string;\n  categoryId: number | null;\n  excludePairingId?: number | null;\n};\n\nexport async function checkPadelCategoryLimit(params: LimitParams): Promise<LimitResult> {\n  const { tx, eventId, userId, categoryId, excludePairingId } = params;\n\n  if (!categoryId) return { ok: true };\n\n  const slots = await tx.padelPairingSlot.findMany({\n    where: {\n      profileId: userId,\n      slotStatus: \"FILLED\",\n      paymentStatus: \"PAID\",\n      pairing: {\n        eventId,\n        pairingStatus: { not: \"CANCELLED\" },\n        lifecycleStatus: { not: \"CANCELLED_INCOMPLETE\" },\n        ...(excludePairingId ? { id: { not: excludePairingId } } : {}),\n      },\n    },\n    select: {\n      pairing: { select: { categoryId: true } },\n    },\n  });\n\n  const categories = new Set<number>();\n  for (const slot of slots) {\n    const slotCategory = slot.pairing?.categoryId ?? null;\n    if (slotCategory) categories.add(slotCategory);\n  }\n\n  if (categories.has(categoryId)) {\n    return { ok: false, code: \"ALREADY_IN_CATEGORY\" };\n  }\n\n  if (categories.size >= 2) {\n    return { ok: false, code: \"MAX_CATEGORIES\" };\n  }\n\n  return { ok: true };\n}\n"],"names":[],"mappings":";;;;AAYO,eAAe,wBAAwB,MAAmB;IAC/D,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,gBAAgB,EAAE,GAAG;IAE9D,IAAI,CAAC,YAAY,OAAO;QAAE,IAAI;IAAK;IAEnC,MAAM,QAAQ,MAAM,GAAG,gBAAgB,CAAC,QAAQ,CAAC;QAC/C,OAAO;YACL,WAAW;YACX,YAAY;YACZ,eAAe;YACf,SAAS;gBACP;gBACA,eAAe;oBAAE,KAAK;gBAAY;gBAClC,iBAAiB;oBAAE,KAAK;gBAAuB;gBAC/C,GAAI,mBAAmB;oBAAE,IAAI;wBAAE,KAAK;oBAAiB;gBAAE,IAAI,CAAC,CAAC;YAC/D;QACF;QACA,QAAQ;YACN,SAAS;gBAAE,QAAQ;oBAAE,YAAY;gBAAK;YAAE;QAC1C;IACF;IAEA,MAAM,aAAa,IAAI;IACvB,KAAK,MAAM,QAAQ,MAAO;QACxB,MAAM,eAAe,KAAK,OAAO,EAAE,cAAc;QACjD,IAAI,cAAc,WAAW,GAAG,CAAC;IACnC;IAEA,IAAI,WAAW,GAAG,CAAC,aAAa;QAC9B,OAAO;YAAE,IAAI;YAAO,MAAM;QAAsB;IAClD;IAEA,IAAI,WAAW,IAAI,IAAI,GAAG;QACxB,OAAO;YAAE,IAAI;YAAO,MAAM;QAAiB;IAC7C;IAEA,OAAO;QAAE,IAAI;IAAK;AACpB"}},
    {"offset": {"line": 1045, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/api/padel/pairings/route.ts"],"sourcesContent":["export const runtime = \"nodejs\";\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport {\n  Gender,\n  PadelEligibilityType,\n  PadelPairingLifecycleStatus,\n  PadelPairingPaymentStatus,\n  PadelPairingSlotRole,\n  PadelPairingSlotStatus,\n  PadelPaymentMode,\n  PadelPairingJoinMode,\n  OrganizerMemberRole,\n} from \"@prisma/client\";\nimport { randomUUID } from \"crypto\";\nimport { createSupabaseServer } from \"@/lib/supabaseServer\";\nimport { prisma } from \"@/lib/prisma\";\nimport { buildPadelEventSnapshot } from \"@/lib/padel/eventSnapshot\";\nimport { validateEligibility } from \"@/domain/padelEligibility\";\nimport { upsertActiveHold } from \"@/domain/padelPairingHold\";\nimport {\n  clampDeadlineHours,\n  computeDeadlineAt,\n  computePartnerLinkExpiresAt,\n} from \"@/domain/padelDeadlines\";\nimport { getActiveOrganizerForUser } from \"@/lib/organizerContext\";\nimport { isPadelStaff } from \"@/lib/padel/staff\";\nimport { checkPadelCategoryLimit } from \"@/domain/padelCategoryLimit\";\n\nconst allowedRoles: OrganizerMemberRole[] = [\"OWNER\", \"CO_OWNER\", \"ADMIN\"];\n\nasync function syncPlayersFromSlots({\n  organizerId,\n  slots,\n}: {\n  organizerId: number;\n  slots: Array<{\n    profileId: string | null;\n    invitedContact: string | null;\n  }>;\n}) {\n  const profileIds = Array.from(\n    new Set(slots.map((s) => s.profileId).filter(Boolean) as string[]),\n  );\n\n  // 1) Jogadores ligados a perfis existentes\n  if (profileIds.length > 0) {\n    const profiles = await prisma.profile.findMany({\n      where: { id: { in: profileIds } },\n      select: { id: true, fullName: true, contactPhone: true },\n    });\n    for (const profile of profiles) {\n      const exists = await prisma.padelPlayerProfile.findFirst({\n        where: { organizerId, userId: profile.id },\n        select: { id: true },\n      });\n      if (exists) continue;\n      const fullName = profile.fullName?.trim() || \"Jogador ORYA\";\n      await prisma.padelPlayerProfile.create({\n        data: {\n          organizerId,\n          userId: profile.id,\n          fullName,\n          displayName: fullName,\n          phone: profile.contactPhone || undefined,\n          isActive: true,\n        },\n      });\n    }\n  }\n\n  // 2) Convites por contacto (email ou telefone)\n  const invitedContacts = Array.from(\n    new Set(\n      slots\n        .map((s) => s.invitedContact?.trim())\n        .filter(Boolean) as string[],\n    ),\n  );\n  for (const contact of invitedContacts) {\n    const isEmail = contact.includes(\"@\");\n    const email = isEmail ? contact.toLowerCase() : null;\n    const phone = !isEmail ? contact : null;\n    if (email) {\n      const exists = await prisma.padelPlayerProfile.findFirst({\n        where: { organizerId, email },\n        select: { id: true },\n      });\n      if (exists) continue;\n    }\n    await prisma.padelPlayerProfile.create({\n      data: {\n        organizerId,\n        fullName: contact,\n        displayName: contact,\n        email: email || undefined,\n        phone: phone || undefined,\n        isActive: true,\n      },\n    });\n  }\n}\n\n// Cria pairing Padel v2 após checkout ou setup inicial.\nexport async function POST(req: NextRequest) {\n  const supabase = await createSupabaseServer();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) return NextResponse.json({ ok: false, error: \"UNAUTHENTICATED\" }, { status: 401 });\n\n  const body = (await req.json().catch(() => null)) as Record<string, unknown> | null;\n  const eventId = body && typeof body.eventId === \"number\" ? body.eventId : Number(body?.eventId);\n  const organizerIdRaw = body && typeof body.organizerId === \"number\" ? body.organizerId : Number(body?.organizerId);\n  const categoryId = body && typeof body.categoryId === \"number\" ? body.categoryId : body?.categoryId === null ? null : Number(body?.categoryId);\n  const paymentMode = typeof body?.paymentMode === \"string\" ? (body?.paymentMode as PadelPaymentMode) : null;\n  const pairingJoinModeRaw = typeof body?.pairingJoinMode === \"string\" ? (body?.pairingJoinMode as PadelPairingJoinMode) : \"INVITE_PARTNER\";\n  const createdByTicketId = typeof body?.createdByTicketId === \"string\" ? body?.createdByTicketId : null;\n  const inviteToken = typeof body?.inviteToken === \"string\" ? body?.inviteToken : null;\n  const inviteExpiresAt = body?.inviteExpiresAt ? new Date(String(body.inviteExpiresAt)) : null;\n  const lockedUntil = body?.lockedUntil ? new Date(String(body.lockedUntil)) : null;\n  const isPublicOpen = Boolean(body?.isPublicOpen);\n  const invitedContactNormalized =\n    typeof body?.invitedContact === \"string\" && body.invitedContact.trim().length > 0\n      ? body.invitedContact.trim()\n      : null;\n\n  if (!eventId || !paymentMode || ![\"FULL\", \"SPLIT\"].includes(paymentMode)) {\n    return NextResponse.json({ ok: false, error: \"INVALID_INPUT\" }, { status: 400 });\n  }\n\n  // Resolver organizer + flag padel v2\n  const event = await prisma.event.findUnique({\n    where: { id: eventId },\n    select: {\n      organizerId: true,\n      padelTournamentConfig: { select: { padelV2Enabled: true } },\n    },\n  });\n  if (!event || !event.padelTournamentConfig?.padelV2Enabled) {\n    return NextResponse.json({ ok: false, error: \"EVENT_NOT_PADDEL_V2\" }, { status: 400 });\n  }\n  const organizerId = Number.isFinite(organizerIdRaw) && organizerIdRaw ? organizerIdRaw : event.organizerId;\n  if (!organizerId) {\n    return NextResponse.json({ ok: false, error: \"ORGANIZER_MISSING\" }, { status: 400 });\n  }\n\n  // Basic guard: only proceed if padel_v2_enabled is active on the tournament config.\n  const config = await prisma.padelTournamentConfig.findUnique({\n    where: { eventId },\n    select: {\n      padelV2Enabled: true,\n      organizerId: true,\n      eligibilityType: true,\n      splitDeadlineHours: true,\n      defaultCategoryId: true,\n    },\n  });\n  if (!config?.padelV2Enabled || config.organizerId !== organizerId) {\n    return NextResponse.json({ ok: false, error: \"PADEL_V2_DISABLED\" }, { status: 400 });\n  }\n\n  const profile = await prisma.profile.findUnique({\n    where: { id: user.id },\n    select: { gender: true },\n  });\n\n  const eligibility = validateEligibility(\n    (config.eligibilityType as PadelEligibilityType) ?? PadelEligibilityType.OPEN,\n    profile?.gender as Gender | null,\n    null,\n  );\n  if (!eligibility.ok) {\n    return NextResponse.json(\n      { ok: false, error: eligibility.code },\n      { status: eligibility.code === \"GENDER_REQUIRED_FOR_TOURNAMENT\" ? 403 : 409 },\n    );\n  }\n\n  const categoryLinks = await prisma.padelEventCategoryLink.findMany({\n    where: { eventId, isEnabled: true },\n    select: { id: true, padelCategoryId: true },\n    orderBy: { id: \"asc\" },\n  });\n\n  let effectiveCategoryId: number | null = null;\n  if (Number.isFinite(categoryId as number)) {\n    const match = categoryLinks.find((l) => l.padelCategoryId === (categoryId as number));\n    if (!match) {\n      return NextResponse.json({ ok: false, error: \"CATEGORY_NOT_AVAILABLE\" }, { status: 400 });\n    }\n    effectiveCategoryId = match.padelCategoryId;\n  } else if (categoryLinks.length > 1) {\n    return NextResponse.json({ ok: false, error: \"CATEGORY_REQUIRED\" }, { status: 400 });\n  } else if (categoryLinks.length > 0) {\n    effectiveCategoryId = categoryLinks[0].padelCategoryId;\n  } else if (config.defaultCategoryId) {\n    effectiveCategoryId = config.defaultCategoryId;\n  }\n\n  if (!effectiveCategoryId) {\n    return NextResponse.json({ ok: false, error: \"CATEGORY_REQUIRED\" }, { status: 400 });\n  }\n\n  // Invariante: 1 pairing ativo por evento+categoria+user\n  const existingActive = await prisma.padelPairing.findFirst({\n    where: {\n      eventId,\n      lifecycleStatus: { not: \"CANCELLED_INCOMPLETE\" },\n      categoryId: effectiveCategoryId,\n      OR: [{ player1UserId: user.id }, { player2UserId: user.id }],\n    },\n    include: { slots: true },\n  });\n  if (existingActive) {\n    const updates: Record<string, unknown> = {};\n    const slotUpdates: Record<string, unknown> = {};\n    const partnerSlot = existingActive.slots.find((s) => s.slot_role === \"PARTNER\");\n    const canUpdatePartner = partnerSlot && !partnerSlot.profileId;\n\n    if (paymentMode && existingActive.payment_mode !== paymentMode) {\n      updates.payment_mode = paymentMode;\n    }\n\n    if (canUpdatePartner) {\n      const joinModeChanged = existingActive.pairingJoinMode !== pairingJoinModeRaw;\n      if (joinModeChanged) {\n        updates.pairingJoinMode = pairingJoinModeRaw;\n      }\n\n      if (pairingJoinModeRaw === \"LOOKING_FOR_PARTNER\") {\n        updates.partnerInviteToken = null;\n        updates.partnerLinkToken = null;\n        updates.partnerLinkExpiresAt = null;\n        updates.partnerInvitedAt = null;\n        if (partnerSlot?.invitedContact) {\n          slotUpdates.invitedContact = null;\n        }\n      } else {\n        const now = new Date();\n        const inviteExpired =\n          existingActive.partnerLinkExpiresAt &&\n          existingActive.partnerLinkExpiresAt.getTime() < now.getTime();\n        const shouldResetInvite =\n          !existingActive.partnerInviteToken ||\n          existingActive.pairingJoinMode !== \"INVITE_PARTNER\" ||\n          inviteExpired;\n        const inviteTokenToUse = shouldResetInvite\n          ? randomUUID()\n          : existingActive.partnerInviteToken!;\n        if (shouldResetInvite) {\n          updates.partnerInviteToken = inviteTokenToUse;\n          updates.partnerLinkToken = inviteTokenToUse;\n          updates.partnerLinkExpiresAt = computePartnerLinkExpiresAt(now, undefined);\n          updates.partnerInvitedAt = now;\n        } else if (!existingActive.partnerLinkExpiresAt) {\n          updates.partnerLinkExpiresAt = computePartnerLinkExpiresAt(now, undefined);\n        }\n        if (invitedContactNormalized && partnerSlot?.invitedContact !== invitedContactNormalized) {\n          slotUpdates.invitedContact = invitedContactNormalized;\n        }\n      }\n    }\n\n    const shouldUpdate =\n      Object.keys(updates).length > 0 || Object.keys(slotUpdates).length > 0;\n    const pairingReturn = shouldUpdate\n      ? await prisma.padelPairing.update({\n          where: { id: existingActive.id },\n          data: {\n            ...updates,\n            ...(Object.keys(slotUpdates).length > 0 && partnerSlot\n              ? {\n                  slots: {\n                    update: {\n                      where: { id: partnerSlot.id },\n                      data: slotUpdates,\n                    },\n                  },\n                }\n              : {}),\n          },\n          include: { slots: true },\n        })\n      : existingActive;\n\n    await upsertActiveHold(prisma, { pairingId: pairingReturn.id, eventId, ttlMinutes: 30 });\n    return NextResponse.json({ ok: true, pairing: pairingReturn }, { status: 200 });\n  }\n\n  let validatedTicketId: string | null = null;\n  if (createdByTicketId) {\n    const ticket = await prisma.ticket.findUnique({\n      where: { id: createdByTicketId },\n      select: {\n        id: true,\n        eventId: true,\n        status: true,\n        userId: true,\n        ownerUserId: true,\n        pairingId: true,\n        ticketType: {\n          select: {\n            padelEventCategoryLinkId: true,\n            padelEventCategoryLink: { select: { padelCategoryId: true } },\n          },\n        },\n      },\n    });\n    if (!ticket || ticket.eventId !== eventId || ticket.status !== \"ACTIVE\") {\n      return NextResponse.json({ ok: false, error: \"INVALID_TICKET\" }, { status: 400 });\n    }\n    if (ticket.userId !== user.id && ticket.ownerUserId !== user.id) {\n      return NextResponse.json({ ok: false, error: \"FORBIDDEN_TICKET\" }, { status: 403 });\n    }\n    if (ticket.pairingId) {\n      return NextResponse.json({ ok: false, error: \"TICKET_ALREADY_USED\" }, { status: 409 });\n    }\n    const slotUsingTicket = await prisma.padelPairingSlot.findUnique({\n      where: { ticketId: createdByTicketId },\n      select: { id: true },\n    });\n    if (slotUsingTicket) {\n      return NextResponse.json({ ok: false, error: \"TICKET_ALREADY_USED\" }, { status: 409 });\n    }\n    const ticketCategoryId = ticket.ticketType?.padelEventCategoryLink?.padelCategoryId ?? null;\n    if (ticketCategoryId && ticketCategoryId !== effectiveCategoryId) {\n      return NextResponse.json({ ok: false, error: \"TICKET_CATEGORY_MISMATCH\" }, { status: 409 });\n    }\n    validatedTicketId = ticket.id;\n  }\n\n  // Build slots: se não vierem slots no payload, cria duas entradas (capitão + parceiro pendente)\n  type IncomingSlot = {\n    ticketId?: unknown;\n    profileId?: unknown;\n    invitedContact?: unknown;\n    isPublicOpen?: unknown;\n    slotRole?: unknown;\n    slotStatus?: unknown;\n    paymentStatus?: unknown;\n  };\n\n  const normalizeSlot = (slot: IncomingSlot | unknown) => {\n    if (typeof slot !== \"object\" || slot === null) return null;\n    const s = slot as IncomingSlot;\n    const roleRaw =\n      typeof s.slotRole === \"string\"\n        ? s.slotRole\n        : typeof (s as any).slot_role === \"string\"\n          ? (s as any).slot_role\n          : \"PARTNER\";\n    const statusRaw = typeof s.slotStatus === \"string\" ? s.slotStatus : \"PENDING\";\n    const payRaw = typeof s.paymentStatus === \"string\" ? s.paymentStatus : \"UNPAID\";\n\n    return {\n      ticketId: typeof s.ticketId === \"string\" ? s.ticketId : null,\n      profileId: typeof s.profileId === \"string\" ? s.profileId : null,\n      invitedContact: typeof s.invitedContact === \"string\" ? s.invitedContact : null,\n      isPublicOpen: Boolean(s.isPublicOpen),\n      slot_role: roleRaw === \"CAPTAIN\" ? PadelPairingSlotRole.CAPTAIN : PadelPairingSlotRole.PARTNER,\n      slotStatus:\n        statusRaw === \"FILLED\"\n          ? PadelPairingSlotStatus.FILLED\n          : statusRaw === \"CANCELLED\"\n            ? PadelPairingSlotStatus.CANCELLED\n            : PadelPairingSlotStatus.PENDING,\n      paymentStatus: payRaw === \"PAID\" ? PadelPairingPaymentStatus.PAID : PadelPairingPaymentStatus.UNPAID,\n    };\n  };\n\n  const incomingSlots = Array.isArray(body?.slots) ? (body!.slots as unknown[]) : [];\n  const captainPaid = Boolean(validatedTicketId);\n  if (captainPaid) {\n    const limitCheck = await prisma.$transaction((tx) =>\n      checkPadelCategoryLimit({\n        tx,\n        eventId,\n        userId: user.id,\n        categoryId: effectiveCategoryId,\n      }),\n    );\n    if (!limitCheck.ok) {\n      return NextResponse.json(\n        {\n          ok: false,\n          error: limitCheck.code === \"ALREADY_IN_CATEGORY\" ? \"ALREADY_IN_CATEGORY\" : \"MAX_CATEGORIES\",\n        },\n        { status: 409 },\n      );\n    }\n  }\n  const slotsToCreate =\n    incomingSlots.length > 0\n      ? (incomingSlots\n          .map((slot) => normalizeSlot(slot))\n          .filter(Boolean) as Array<{\n          ticketId: string | null;\n          profileId: string | null;\n          invitedContact: string | null;\n          isPublicOpen: boolean;\n          slot_role: PadelPairingSlotRole;\n          slotStatus: PadelPairingSlotStatus;\n          paymentStatus: PadelPairingPaymentStatus;\n        }>)\n      : [\n          {\n            ticketId: validatedTicketId,\n            profileId: user.id,\n            invitedContact: null,\n            isPublicOpen,\n            slot_role: PadelPairingSlotRole.CAPTAIN,\n            slotStatus: captainPaid ? PadelPairingSlotStatus.FILLED : PadelPairingSlotStatus.PENDING,\n            paymentStatus: captainPaid ? PadelPairingPaymentStatus.PAID : PadelPairingPaymentStatus.UNPAID,\n          },\n          {\n            ticketId: null,\n            profileId: null,\n            invitedContact:\n              pairingJoinModeRaw === \"INVITE_PARTNER\" && invitedContactNormalized\n                ? invitedContactNormalized\n                : null,\n            isPublicOpen,\n            slot_role: PadelPairingSlotRole.PARTNER,\n            slotStatus: PadelPairingSlotStatus.PENDING,\n            paymentStatus:\n              paymentMode === \"FULL\" && captainPaid\n                ? PadelPairingPaymentStatus.PAID\n                : PadelPairingPaymentStatus.UNPAID,\n          },\n        ];\n\n  try {\n    const now = new Date();\n    const clampedDeadlineHours = clampDeadlineHours(config.splitDeadlineHours ?? undefined);\n    const deadlineAt = computeDeadlineAt(now, clampedDeadlineHours);\n    const partnerLinkExpiresAtNormalized =\n      inviteExpiresAt && !Number.isNaN(inviteExpiresAt.getTime())\n        ? inviteExpiresAt\n        : computePartnerLinkExpiresAt(now, undefined);\n    const partnerInviteToken =\n      pairingJoinModeRaw === \"INVITE_PARTNER\"\n        ? inviteToken || randomUUID()\n        : null;\n\n    const initialLifecycleStatus = captainPaid\n      ? paymentMode === \"FULL\"\n        ? PadelPairingLifecycleStatus.CONFIRMED_CAPTAIN_FULL\n        : PadelPairingLifecycleStatus.PENDING_PARTNER_PAYMENT\n      : PadelPairingLifecycleStatus.PENDING_ONE_PAID;\n\n    const pairing = await prisma.$transaction(async (tx) => {\n      const created = await tx.padelPairing.create({\n        data: {\n          eventId,\n          organizerId,\n          categoryId: effectiveCategoryId,\n          payment_mode: paymentMode,\n          createdByUserId: user.id,\n          player1UserId: user.id,\n          createdByTicketId: validatedTicketId,\n          partnerInviteToken,\n          partnerLinkToken: partnerInviteToken,\n          partnerLinkExpiresAt: partnerInviteToken ? partnerLinkExpiresAtNormalized : null,\n          partnerInvitedAt: partnerInviteToken ? now : null,\n          partnerSwapAllowedUntilAt: deadlineAt,\n          deadlineAt,\n          guaranteeStatus: paymentMode === \"SPLIT\" ? \"ARMED\" : \"NONE\",\n          lockedUntil,\n          isPublicOpen,\n          pairingJoinMode: pairingJoinModeRaw ?? PadelPairingJoinMode.INVITE_PARTNER,\n          lifecycleStatus: initialLifecycleStatus,\n          slots: {\n            create: slotsToCreate,\n          },\n        },\n        include: { slots: true },\n      });\n\n      await upsertActiveHold(tx, { pairingId: created.id, eventId, ttlMinutes: 30 });\n      return created;\n    });\n\n    // Auto-criar perfis de jogador para o organizador (roster)\n    await syncPlayersFromSlots({\n      organizerId,\n      slots: pairing.slots.map((s) => ({\n        profileId: (s as { profileId?: string | null }).profileId ?? null,\n        invitedContact: (s as { invitedContact?: string | null }).invitedContact ?? null,\n      })),\n    });\n\n    return NextResponse.json({ ok: true, pairing }, { status: 200 });\n  } catch (err) {\n    console.error(\"[padel/pairings][POST]\", err);\n    return NextResponse.json({ ok: false, error: \"INTERNAL_ERROR\" }, { status: 500 });\n  }\n}\n\n// GET simples para fornecer pairing + ticketTypes (para checkout/claim UI)\nexport async function GET(req: NextRequest) {\n  const supabase = await createSupabaseServer();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) return NextResponse.json({ ok: false, error: \"UNAUTHENTICATED\" }, { status: 401 });\n\n  const pairingId = Number(req.nextUrl.searchParams.get(\"id\"));\n  const eventId = Number(req.nextUrl.searchParams.get(\"eventId\"));\n\n  if (Number.isFinite(pairingId)) {\n    const pairing = await prisma.padelPairing.findUnique({\n      where: { id: pairingId },\n      include: {\n        slots: { include: { playerProfile: true } },\n        event: { select: { organizerId: true } },\n      },\n    });\n    if (!pairing) return NextResponse.json({ ok: false, error: \"NOT_FOUND\" }, { status: 404 });\n\n    const isParticipant =\n      pairing.player1UserId === user.id ||\n      pairing.player2UserId === user.id ||\n      pairing.slots.some((s) => s.profileId === user.id);\n    if (!isParticipant) {\n      const { organizer } = await getActiveOrganizerForUser(user.id, {\n        organizerId: pairing.organizerId,\n        roles: allowedRoles,\n      });\n      const isStaff = await isPadelStaff(user.id, pairing.organizerId, pairing.eventId);\n      if (!organizer && !isStaff) {\n        return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n      }\n    }\n\n    const ticketTypes = await prisma.ticketType.findMany({\n      where: {\n        eventId: pairing.eventId,\n        status: \"ON_SALE\",\n        ...(pairing.categoryId\n          ? { padelEventCategoryLink: { padelCategoryId: pairing.categoryId } }\n          : {}),\n      },\n      select: { id: true, name: true, price: true, currency: true },\n      orderBy: { price: \"asc\" },\n    });\n\n    const padelEvent = await buildPadelEventSnapshot(pairing.eventId);\n\n    return NextResponse.json({ ok: true, pairing, ticketTypes, padelEvent }, { status: 200 });\n  }\n\n  if (!Number.isFinite(eventId)) {\n    return NextResponse.json({ ok: false, error: \"INVALID_ID\" }, { status: 400 });\n  }\n\n  const event = await prisma.event.findUnique({\n    where: { id: eventId },\n    select: { organizerId: true },\n  });\n  if (!event?.organizerId) {\n    return NextResponse.json({ ok: false, error: \"EVENT_NOT_FOUND\" }, { status: 404 });\n  }\n  const { organizer } = await getActiveOrganizerForUser(user.id, {\n    organizerId: event.organizerId,\n    roles: allowedRoles,\n  });\n  const isStaff = await isPadelStaff(user.id, event.organizerId, eventId);\n  if (!organizer && !isStaff) {\n    return NextResponse.json({ ok: false, error: \"FORBIDDEN\" }, { status: 403 });\n  }\n\n  const pairings = await prisma.padelPairing.findMany({\n    where: { eventId },\n    include: {\n      slots: { include: { playerProfile: true } },\n    },\n    orderBy: [{ createdAt: \"asc\" }],\n  });\n\n  const mapped = pairings.map(({ payment_mode, partnerInviteToken, slots, ...rest }) => ({\n    ...rest,\n    paymentMode: payment_mode,\n    inviteToken: partnerInviteToken,\n    slots: slots.map(({ slot_role, ...slotRest }) => ({\n      ...slotRest,\n      slotRole: slot_role,\n    })),\n  }));\n\n  return NextResponse.json({ ok: true, pairings: mapped }, { status: 200 });\n}\n"],"names":[],"mappings":"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"}}]
}