{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkout/contextoCheckout.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useMemo, useState, useCallback } from \"react\";\n\nexport type DadosCheckout = {\n  slug: string;\n  ticketId: string;\n  quantity: number;\n  price: number | null;\n  ticketName: string | null;\n  eventId: string | null;\n  userId: string | null;\n  pairingId?: number | null;\n  pairingSlotId?: number | null;\n  ticketTypeId?: number | null;\n  waves?: unknown[];\n  additional?: Record<string, unknown>;\n  paymentScenario?: string | null;\n};\n\nexport type CheckoutBreakdown = {\n  lines: {\n    ticketTypeId: number;\n    name: string;\n    quantity: number;\n    unitPriceCents: number;\n    currency: string;\n    lineTotalCents: number;\n  }[];\n  subtotalCents: number;\n  feeMode: string | null;\n  platformFeeCents: number;\n  platformFeeCombinedCents?: number;\n  platformFeeOryaCents?: number;\n  stripeFeeEstimateCents?: number;\n  totalCents: number;\n  currency: string;\n  discountCents?: number;\n  feeBpsApplied?: number;\n  feeFixedApplied?: number;\n} | null;\n\ntype CheckoutContextType = {\n  isOpen: boolean;\n  passo: 1 | 2 | 3;\n  dados: DadosCheckout | null;\n  breakdown: CheckoutBreakdown;\n  abrirCheckout: (params: {\n    slug: string;\n    ticketId: string;\n    quantity?: number;\n    price?: number | null;\n    ticketName?: string | null;\n    eventId?: string | null;\n    userId?: string | null;\n    waves?: unknown[];\n    additional?: Record<string, unknown>;\n    pairingId?: number | null;\n    pairingSlotId?: number | null;\n    ticketTypeId?: number | null;\n  }) => void;\n  fecharCheckout: () => void;\n  irParaPasso: (passo: 1 | 2 | 3) => void;\n  atualizarDados: (patch: Partial<DadosCheckout>) => void;\n  setBreakdown: (b: CheckoutContextType[\"breakdown\"]) => void;\n};\n\nconst CheckoutContext = createContext<CheckoutContextType | undefined>(\n  undefined,\n);\n\nexport function CheckoutProvider({ children }: { children: React.ReactNode }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [passo, setPasso] = useState<1 | 2 | 3>(1);\n  const [dados, setDados] = useState<DadosCheckout | null>(null);\n  const [breakdown, setBreakdown] = useState<CheckoutBreakdown>(null);\n\n  const abrirCheckout = useCallback(\n    ({\n      slug,\n      ticketId,\n      quantity = 1,\n      price = null,\n      ticketName = null,\n      eventId = null,\n      userId = null,\n      waves,\n      additional,\n      pairingId = null,\n      pairingSlotId = null,\n      ticketTypeId = null,\n    }: {\n      slug: string;\n      ticketId: string;\n      quantity?: number;\n      price?: number | null;\n      ticketName?: string | null;\n      eventId?: string | null;\n      userId?: string | null;\n      waves?: unknown[];\n      additional?: Record<string, unknown>;\n      pairingId?: number | null;\n      pairingSlotId?: number | null;\n      ticketTypeId?: number | null;\n    }) => {\n      setDados((prev) => {\n        const safeWaves =\n          Array.isArray(waves)\n            ? waves\n            : prev?.waves && Array.isArray(prev.waves)\n            ? prev.waves\n            : [];\n        const safeAdditional =\n          additional && typeof additional === \"object\"\n            ? additional\n            : prev?.additional ?? {};\n\n        return {\n          slug,\n          ticketId,\n          quantity,\n          price,\n          ticketName,\n          eventId,\n          userId,\n          waves: safeWaves,\n          pairingId,\n          pairingSlotId,\n          ticketTypeId,\n          additional: safeAdditional,\n        };\n      });\n\n      setPasso(1);\n      setIsOpen(true);\n    },\n    [],\n  );\n\n  const fecharCheckout = useCallback(() => {\n    setIsOpen(false);\n    setPasso(1);\n    setDados(null);\n    setBreakdown(null);\n  }, []);\n\n  const irParaPasso = useCallback((novoPasso: 1 | 2 | 3) => {\n    setPasso(novoPasso);\n  }, []);\n\n  const atualizarDados = useCallback((patch: Partial<DadosCheckout>) => {\n    setDados((prev) => (prev ? { ...prev, ...patch } : prev));\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      isOpen,\n      passo,\n      dados,\n      breakdown,\n      setBreakdown,\n      abrirCheckout,\n      fecharCheckout,\n      irParaPasso,\n      atualizarDados,\n    }),\n    [isOpen, passo, dados, breakdown, abrirCheckout, fecharCheckout, irParaPasso, atualizarDados],\n  );\n\n  return (\n    <CheckoutContext.Provider value={value}>\n      {children}\n    </CheckoutContext.Provider>\n  );\n}\n\nexport function useCheckout() {\n  const ctx = useContext(CheckoutContext);\n  if (!ctx) {\n    throw new Error(\"useCheckout deve ser usado dentro de um CheckoutProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAFA;;;AAmEA,MAAM,gCAAkB,IAAA,sNAAa,EACnC;AAGK,SAAS,iBAAiB,EAAE,QAAQ,EAAiC;IAC1E,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAY;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAuB;IACzD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAoB;IAE9D,MAAM,gBAAgB,IAAA,oNAAW,EAC/B,CAAC,EACC,IAAI,EACJ,QAAQ,EACR,WAAW,CAAC,EACZ,QAAQ,IAAI,EACZ,aAAa,IAAI,EACjB,UAAU,IAAI,EACd,SAAS,IAAI,EACb,KAAK,EACL,UAAU,EACV,YAAY,IAAI,EAChB,gBAAgB,IAAI,EACpB,eAAe,IAAI,EAcpB;QACC,SAAS,CAAC;YACR,MAAM,YACJ,MAAM,OAAO,CAAC,SACV,QACA,MAAM,SAAS,MAAM,OAAO,CAAC,KAAK,KAAK,IACvC,KAAK,KAAK,GACV,EAAE;YACR,MAAM,iBACJ,cAAc,OAAO,eAAe,WAChC,aACA,MAAM,cAAc,CAAC;YAE3B,OAAO;gBACL;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA,OAAO;gBACP;gBACA;gBACA;gBACA,YAAY;YACd;QACF;QAEA,SAAS;QACT,UAAU;IACZ,GACA,EAAE;IAGJ,MAAM,iBAAiB,IAAA,oNAAW,EAAC;QACjC,UAAU;QACV,SAAS;QACT,SAAS;QACT,aAAa;IACf,GAAG,EAAE;IAEL,MAAM,cAAc,IAAA,oNAAW,EAAC,CAAC;QAC/B,SAAS;IACX,GAAG,EAAE;IAEL,MAAM,iBAAiB,IAAA,oNAAW,EAAC,CAAC;QAClC,SAAS,CAAC,OAAU,OAAO;gBAAE,GAAG,IAAI;gBAAE,GAAG,KAAK;YAAC,IAAI;IACrD,GAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,gNAAO,EACnB,IAAM,CAAC;YACL;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACF,CAAC,GACD;QAAC;QAAQ;QAAO;QAAO;QAAW;QAAe;QAAgB;QAAa;KAAe;IAG/F,qBACE,8OAAC,gBAAgB,QAAQ;QAAC,OAAO;kBAC9B;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,mNAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/eventos/%5Bslug%5D/WavesSectionClient.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useCheckout } from \"@/app/components/checkout/contextoCheckout\";\n\nexport type WaveStatus = \"on_sale\" | \"upcoming\" | \"closed\" | \"sold_out\";\n\nexport type WaveTicket = {\n  id: string;\n  name: string;\n  price: number;\n  currency: string;\n  remaining: number | null; // null = stock ilimitado\n  status: WaveStatus;\n  startsAt: string | null;\n  endsAt: string | null;\n  available: boolean;\n  isVisible: boolean;\n  // info extra de stock (opcional, vindo da API)\n  totalQuantity?: number | null;\n  soldQuantity?: number;\n  padelCategoryId?: number | null;\n  padelCategoryLabel?: string | null;\n  padelCategoryLinkId?: number | null;\n};\n\ntype WavesSectionClientProps = {\n  slug: string;\n  tickets: WaveTicket[];\n  // para sabermos se devemos ir para checkout ou fazer ‚Äújoin‚Äù direto\n  isFreeEvent?: boolean;\n  checkoutUiVariant?: \"DEFAULT\" | \"PADEL\";\n  padelMeta?: {\n    eventId: number;\n    organizerId: number | null;\n    categoryId?: number | null;\n    categoryLinkId?: number | null;\n  };\n  inviteEmail?: string | null;\n};\n\ntype FeedbackType = \"success\" | \"error\";\n\ntype FeedbackState = {\n  [ticketId: string]: {\n    type: FeedbackType;\n    message: string;\n  };\n};\n\nfunction formatDateTime(value: string | null) {\n  if (!value) return null;\n  const d = new Date(value);\n  if (Number.isNaN(d.getTime())) return null;\n\n  return d.toLocaleString(\"pt-PT\", {\n    day: \"2-digit\",\n    month: \"short\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n}\n\nfunction computeRemainingAndStatus(\n  prev: WaveTicket,\n  updated: { totalQuantity?: number | null; soldQuantity?: number },\n): { remaining: number | null; status: WaveStatus } {\n  const total =\n    updated.totalQuantity !== undefined\n      ? updated.totalQuantity\n      : prev.totalQuantity ?? null;\n\n  const sold =\n    updated.soldQuantity !== undefined\n      ? updated.soldQuantity\n      : prev.soldQuantity ?? 0;\n\n  let remaining: number | null = null;\n\n  if (total === null || total === undefined) {\n    remaining = null; // ilimitado\n  } else {\n    const diff = total - sold;\n    remaining = diff < 0 ? 0 : diff;\n  }\n\n  let status: WaveStatus = prev.status;\n\n  if (total !== null && total !== undefined && sold >= total) {\n    status = \"sold_out\";\n  } else if (status === \"sold_out\") {\n    status = \"sold_out\";\n  }\n\n  // Se estiver marcada como indispon√≠vel/oculta, tratamos como encerrada visualmente\n  if (!prev.available || !prev.isVisible) {\n    status = \"closed\";\n  }\n\n  return { remaining, status };\n}\n\nexport default function WavesSectionClient({\n  slug,\n  tickets: initialTickets,\n  isFreeEvent,\n  checkoutUiVariant = \"DEFAULT\",\n  padelMeta,\n  inviteEmail,\n}: WavesSectionClientProps) {\n  const { abrirCheckout, atualizarDados } = useCheckout();\n  const [tickets, setTickets] = useState<WaveTicket[]>(initialTickets);\n  const [loadingId, setLoadingId] = useState<string | null>(null);\n  const [feedback, setFeedback] = useState<FeedbackState>({});\n  const inviteAdditional =\n    inviteEmail && inviteEmail.trim()\n      ? { guestEmail: inviteEmail.trim(), guestEmailConfirm: inviteEmail.trim() }\n      : {};\n\n  async function handlePurchase(ticketId: string) {\n    const selectedTicket = tickets.find((t) => t.id === ticketId);\n    if (!selectedTicket) return;\n\n    // limpar feedback antigo\n    setFeedback((prev) => {\n      const clone = { ...prev };\n      delete clone[ticketId];\n      return clone;\n    });\n\n    setLoadingId(ticketId);\n\n    try {\n      // Todo o checkout (pago ou gr√°tis) passa pelo modal/core √∫nico.\n      abrirCheckout({\n        slug,\n        ticketId,\n        price: selectedTicket.price,\n        ticketName: selectedTicket.name,\n        eventId: padelMeta?.eventId ? String(padelMeta.eventId) : undefined,\n        additional: {\n          checkoutUiVariant,\n          padelMeta,\n          ...inviteAdditional,\n        },\n        waves: tickets,\n      });\n    } catch (err) {\n      console.error(err);\n      setFeedback((prev) => ({\n        ...prev,\n        [ticketId]: {\n          type: \"error\",\n          message: \"Erro inesperado ao processar a a√ß√£o. Tenta outra vez.\",\n        },\n      }));\n    } finally {\n      setLoadingId(null);\n    }\n  }\n\n  const visibleTickets = tickets.filter((t) => t.isVisible);\n  const purchasableTickets = visibleTickets.filter(\n    (t) => t.status === \"on_sale\" || t.status === \"upcoming\",\n  );\n\n  // üî• Calcular pre√ßo m√≠nimo (defensivo para o caso de n√£o haver bilhetes vis√≠veis)\n  const minPrice =\n    purchasableTickets.length > 0\n      ? Math.min(...purchasableTickets.map((t) => t.price))\n      : null;\n  const isFreeLabel = Boolean(isFreeEvent);\n\n  return (\n    <div className=\"mt-6 w-full\">\n      <div className=\"rounded-2xl border border-white/15 bg-[linear-gradient(140deg,rgba(255,255,255,0.14),rgba(4,8,20,0.85))] px-5 py-4 backdrop-blur-xl flex flex-col gap-3 shadow-[0_0_35px_rgba(0,0,0,0.55)]\">\n        <p className=\"text-white/85 text-sm\">\n          {isFreeLabel ? (\n            <span className=\"text-white font-semibold\">Entrada gratuita</span>\n          ) : minPrice !== null ? (\n            <>\n              A partir de{\" \"}\n              <span className=\"text-white font-semibold\">\n                {minPrice.toFixed(2)}‚Ç¨\n              </span>\n            </>\n          ) : (\n            <span className=\"text-white/60\">Sem bilhetes dispon√≠veis</span>\n          )}\n        </p>\n\n        <button\n          type=\"button\"\n          disabled={purchasableTickets.length === 0}\n          onClick={() => {\n            if (purchasableTickets.length === 0) return;\n\n            atualizarDados({\n              slug,\n              waves: visibleTickets,\n              additional: {\n                checkoutUiVariant,\n                padelMeta,\n                ...inviteAdditional,\n              },\n            });\n\n            const defaultTicket = purchasableTickets[0];\n\n            abrirCheckout({\n              slug,\n              ticketId: defaultTicket.id,\n              price: defaultTicket.price,\n              ticketName: defaultTicket.name,\n              eventId: padelMeta?.eventId ? String(padelMeta.eventId) : undefined,\n              additional: {\n                checkoutUiVariant,\n                padelMeta,\n                ...inviteAdditional,\n              },\n              waves: visibleTickets,\n            });\n\n            setTimeout(() => {\n              try {\n                const evt = new Event(\"orya-force-step1\");\n                window.dispatchEvent(evt);\n              } catch {}\n            }, 10);\n          }}\n          className=\"w-full rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] text-black font-semibold py-3 shadow-[0_0_20px_rgba(107,255,255,0.45)] hover:scale-[1.02] active:scale-95 transition-transform text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {purchasableTickets.length === 0\n            ? \"Esgotado\"\n            : isFreeLabel\n              ? \"Garantir lugar\"\n              : \"Comprar agora\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkout/Step1Bilhete.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useCheckout } from \"./contextoCheckout\";\n\ntype Wave = {\n  id: string;\n  name: string;\n  price: number;\n  description?: string | null;\n  quantity?: number | null;\n  status?: string;\n  remaining?: number | null;\n  padelCategoryId?: number | null;\n  padelCategoryLabel?: string | null;\n  padelCategoryLinkId?: number | null;\n};\n\ntype CheckoutData = {\n  waves?: Wave[];\n  additional?: Record<string, unknown>;\n  paymentScenario?: string | null;\n};\n\nexport default function Step1Bilhete() {\n  const { dados, irParaPasso, fecharCheckout, atualizarDados } = useCheckout();\n\n  const safeDados: CheckoutData =\n    dados && typeof dados === \"object\"\n      ? (dados as CheckoutData)\n      : { waves: [], additional: {} };\n\n  const normalizeStatus = (status?: string) =>\n    (status || \"on_sale\").toLowerCase();\n\n  const stableWaves: Wave[] = Array.isArray(safeDados.waves)\n    ? [...safeDados.waves].map((w) => ({\n        ...w,\n        status: normalizeStatus(w.status),\n      }))\n    : [];\n  const cheapestAvailable = [...stableWaves]\n    .filter((w) => {\n      const st = normalizeStatus(w.status);\n      return st !== \"sold_out\" && st !== \"closed\";\n    })\n    .sort((a, b) => (a.price ?? 0) - (b.price ?? 0))[0];\n  const hasWaves = stableWaves.length > 0;\n\n  // üßÆ Quantidades iniciais por wave (memoizado para n√£o recriar em cada render)\n  const initialQuantidades: Record<string, number> = {};\n  for (const w of stableWaves) {\n    const rawQty =\n      typeof w.quantity === \"number\" && w.quantity > 0 ? w.quantity : 0;\n    const remaining =\n      typeof w.remaining === \"number\" && w.remaining >= 0\n        ? w.remaining\n        : null;\n    const maxForWave =\n      remaining === null ? Number.MAX_SAFE_INTEGER : Math.max(0, remaining);\n    initialQuantidades[w.id] = Math.min(rawQty, maxForWave);\n  }\n  const variant = (\n    typeof safeDados.additional?.checkoutUiVariant === \"string\"\n      ? safeDados.additional.checkoutUiVariant\n      : \"DEFAULT\"\n  ).toUpperCase();\n  const isPadelVariant = variant === \"PADEL\";\n  const padelMeta = (safeDados.additional?.padelMeta as\n    | { eventId: number; organizerId: number | null; categoryId?: number | null; categoryLinkId?: number | null }\n    | undefined) ?? null;\n\n  const [quantidades, setQuantidades] = useState<Record<string, number>>(\n    initialQuantidades,\n  );\n  const padelCategoryOptions = useMemo(() => {\n    if (!isPadelVariant) return [];\n    const map = new Map<\n      string,\n      {\n        key: string;\n        linkId: number | null;\n        categoryId: number | null;\n        label: string;\n      }\n    >();\n    for (const wave of stableWaves) {\n      const linkId = typeof wave.padelCategoryLinkId === \"number\" ? wave.padelCategoryLinkId : null;\n      const categoryId = typeof wave.padelCategoryId === \"number\" ? wave.padelCategoryId : null;\n      if (!linkId && !categoryId) continue;\n      const key = linkId ? `link:${linkId}` : `cat:${categoryId}`;\n      if (map.has(key)) continue;\n      const label =\n        wave.padelCategoryLabel?.trim() ||\n        (categoryId ? `Categoria ${categoryId}` : linkId ? `Categoria ${linkId}` : \"Categoria\");\n      map.set(key, { key, linkId, categoryId, label });\n    }\n    return Array.from(map.values());\n  }, [isPadelVariant, stableWaves]);\n  const [selectedPadelCategoryKey, setSelectedPadelCategoryKey] = useState<string | null>(() => {\n    if (!isPadelVariant) return null;\n    if (padelMeta?.categoryLinkId) return `link:${padelMeta.categoryLinkId}`;\n    if (padelMeta?.categoryId) return `cat:${padelMeta.categoryId}`;\n    return padelCategoryOptions[0]?.key ?? null;\n  });\n  const [padelSelection, setPadelSelection] = useState<\n    \"INDIVIDUAL\" | \"DUO_SPLIT\" | \"DUO_FULL\"\n  >(\"INDIVIDUAL\");\n  const [padelJoinMode, setPadelJoinMode] = useState<\"INVITE_PARTNER\" | \"LOOKING_FOR_PARTNER\">(\"LOOKING_FOR_PARTNER\");\n  const [partnerContact, setPartnerContact] = useState(\"\");\n  const [partnerError, setPartnerError] = useState<string | null>(null);\n  const [padelStockError, setPadelStockError] = useState<string | null>(null);\n  const [partnerResults, setPartnerResults] = useState<\n    { id: string; username: string | null; fullName: string | null; avatarUrl: string | null }[]\n  >([]);\n  const [partnerLoading, setPartnerLoading] = useState(false);\n  const [partnerSelected, setPartnerSelected] = useState<{\n    id: string;\n    username: string | null;\n    fullName: string | null;\n    avatarUrl: string | null;\n    label: string;\n  } | null>(null);\n  const partnerSelectedLabel = partnerSelected?.label ?? \"\";\n  const searchAbortRef = useRef<AbortController | null>(null);\n  const partnerRequired = padelJoinMode === \"INVITE_PARTNER\";\n  const hasPartnerContact = partnerContact.trim().length > 0;\n  const canContinuePadel = !partnerRequired || hasPartnerContact;\n\n  // Qual wave est√° expandida (tipo acorde√£o)\n  const [aberto, setAberto] = useState<string | null>(\n    cheapestAvailable?.id ?? stableWaves[0]?.id ?? null,\n  );\n\n  // üí∞ Totais para mostrar apenas (backend recalcula sempre)\n  const { total, selectedQty } = stableWaves.reduce(\n    (acc: { total: number; selectedQty: number }, w: Wave) => {\n      const q = quantidades[w.id] ?? 0;\n      const price = typeof w.price === \"number\" ? w.price : 0;\n      return { total: acc.total + q * price, selectedQty: acc.selectedQty + q };\n    },\n    { total: 0, selectedQty: 0 },\n  );\n\n  function toggleWave(id: string) {\n    setAberto((prev) => (prev === id ? null : id));\n  }\n\n  useEffect(() => {\n    if (!isPadelVariant) return;\n    if (padelCategoryOptions.length === 0) {\n      if (selectedPadelCategoryKey !== null) {\n        setSelectedPadelCategoryKey(null);\n      }\n      return;\n    }\n    const desiredKey =\n      padelMeta?.categoryLinkId ? `link:${padelMeta.categoryLinkId}` : padelMeta?.categoryId ? `cat:${padelMeta.categoryId}` : null;\n    const hasCurrent = selectedPadelCategoryKey\n      ? padelCategoryOptions.some((opt) => opt.key === selectedPadelCategoryKey)\n      : false;\n    if (hasCurrent) return;\n    if (desiredKey && padelCategoryOptions.some((opt) => opt.key === desiredKey)) {\n      setSelectedPadelCategoryKey(desiredKey);\n    } else {\n      setSelectedPadelCategoryKey(padelCategoryOptions[0].key);\n    }\n  }, [isPadelVariant, padelCategoryOptions, padelMeta?.categoryId, padelMeta?.categoryLinkId, selectedPadelCategoryKey]);\n\n  const selectedPadelCategory =\n    padelCategoryOptions.find((opt) => opt.key === selectedPadelCategoryKey) ?? null;\n  const resolvedPadelMeta = padelMeta\n    ? {\n        ...padelMeta,\n        categoryId: selectedPadelCategory?.categoryId ?? padelMeta.categoryId ?? null,\n        categoryLinkId: selectedPadelCategory?.linkId ?? padelMeta.categoryLinkId ?? null,\n      }\n    : null;\n  const padelCategoryRequired = isPadelVariant && padelCategoryOptions.length > 1;\n  const padelCategorySelected = !padelCategoryRequired || Boolean(selectedPadelCategory);\n\n  const padelFilteredWaves = isPadelVariant && selectedPadelCategory\n    ? stableWaves.filter((w) => {\n        if (selectedPadelCategory.linkId) return w.padelCategoryLinkId === selectedPadelCategory.linkId;\n        if (selectedPadelCategory.categoryId) return w.padelCategoryId === selectedPadelCategory.categoryId;\n        return true;\n      })\n    : stableWaves;\n  const padelCandidateWave =\n    padelFilteredWaves.find((w) => {\n      const st = normalizeStatus(w.status);\n      return st !== \"sold_out\" && st !== \"closed\";\n    }) ?? padelFilteredWaves[0] ?? null;\n  const padelRemainingSlots =\n    typeof padelCandidateWave?.remaining === \"number\" ? padelCandidateWave.remaining : null;\n  const padelHasPairSlots =\n    padelCandidateWave ? (padelRemainingSlots === null ? true : padelRemainingSlots >= 2) : false;\n\n  // Sugest√µes de parceiro (procura por @username/nome)\n  useEffect(() => {\n    if (padelJoinMode !== \"INVITE_PARTNER\") {\n      setPartnerResults([]);\n      return;\n    }\n    const term = partnerContact.trim();\n    if (partnerSelected && term === partnerSelected.label) {\n      setPartnerResults([]);\n      return;\n    }\n    if (term.length < 2) {\n      setPartnerResults([]);\n      return;\n    }\n\n    if (searchAbortRef.current) {\n      searchAbortRef.current.abort();\n    }\n    const controller = new AbortController();\n    searchAbortRef.current = controller;\n\n    const timeout = setTimeout(async () => {\n      try {\n        setPartnerLoading(true);\n        const res = await fetch(`/api/users/search?q=${encodeURIComponent(term)}`, {\n          signal: controller.signal,\n        });\n        const json = await res.json().catch(() => null);\n        if (!res.ok || !json?.ok) {\n          setPartnerResults([]);\n        } else {\n          setPartnerResults(Array.isArray(json.results) ? json.results : []);\n        }\n      } catch (err) {\n        if ((err as Error).name !== \"AbortError\") {\n          setPartnerResults([]);\n        }\n      } finally {\n        setPartnerLoading(false);\n      }\n    }, 300);\n\n    return () => {\n      clearTimeout(timeout);\n      controller.abort();\n    };\n  }, [partnerContact, padelJoinMode, partnerSelectedLabel]);\n\n  function getMaxForWave(waveId: string) {\n    const wave = stableWaves.find((w) => w.id === waveId);\n    if (!wave) return Number.MAX_SAFE_INTEGER;\n    const remaining =\n      typeof wave.remaining === \"number\" && wave.remaining >= 0\n        ? wave.remaining\n        : null;\n    return remaining === null ? Number.MAX_SAFE_INTEGER : Math.max(0, remaining);\n  }\n\n  function handleIncrement(id: string) {\n    const maxAllowed = getMaxForWave(id);\n    setQuantidades((prev) => {\n      const current = prev[id] ?? 0;\n      if (current >= maxAllowed) return prev;\n      return {\n        ...prev,\n        [id]: current + 1,\n      };\n    });\n  }\n\n  function handleDecrement(id: string) {\n    setQuantidades((prev) => ({\n      ...prev,\n      [id]: Math.max(0, (prev[id] ?? 0) - 1),\n    }));\n  }\n\n  function handleContinuar() {\n    if (variant === \"PADEL\") {\n      if (padelCategoryRequired && !selectedPadelCategory) {\n        setPadelStockError(\"Seleciona primeiro uma categoria.\");\n        return;\n      }\n      const target = padelCandidateWave;\n      if (!target || !padelHasPairSlots) {\n        setPadelStockError(\"Sem vagas suficientes para criar uma dupla.\");\n        return;\n      }\n\n      // Em modos com convite (INVITE_PARTNER), obrigar a indicar contacto do parceiro\n      if (partnerRequired && !hasPartnerContact) {\n        setPartnerError(\"Indica o contacto do parceiro para enviarmos o convite.\");\n        return;\n      }\n\n      if (padelStockError) setPadelStockError(null);\n      setPartnerError(null);\n\n      const scenario =\n        padelSelection === \"DUO_FULL\"\n          ? \"GROUP_FULL\"\n          : \"GROUP_SPLIT\";\n\n      // Criar (ou reusar) pairing antes de avan√ßar\n      const paymentMode = scenario === \"GROUP_FULL\" ? \"FULL\" : \"SPLIT\";\n\n      const createPairing = async () => {\n        if (!resolvedPadelMeta?.eventId) return null;\n        try {\n          const res = await fetch(\"/api/padel/pairings\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              eventId: resolvedPadelMeta.eventId,\n              organizerId: resolvedPadelMeta.organizerId ?? undefined,\n              categoryId: resolvedPadelMeta.categoryId ?? undefined,\n              paymentMode,\n              pairingJoinMode: padelJoinMode,\n              invitedContact:\n                padelJoinMode === \"INVITE_PARTNER\" && partnerContact.trim() ? partnerContact.trim() : undefined,\n            }),\n          });\n          const json = await res.json().catch(() => null);\n          if (!res.ok || !json?.ok || !json?.pairing?.id) {\n            throw new Error(json?.error || \"Falha ao preparar inscri√ß√£o Padel.\");\n          }\n          const pairing = json.pairing as { id: number; slots?: Array<{ id: number; slot_role?: string; slotRole?: string }> };\n          const slot =\n            pairing.slots?.find((s) => (s.slot_role ?? s.slotRole) === \"CAPTAIN\") ??\n            pairing.slots?.[0] ??\n            null;\n          return { pairingId: pairing.id, slotId: slot?.id ?? null };\n        } catch (err) {\n          console.error(\"[Step1Bilhete] pairing padel\", err);\n          alert(err instanceof Error ? err.message : \"Erro ao preparar inscri√ß√£o Padel.\");\n          return null;\n        }\n      };\n\n      void createPairing().then((pairingResult) => {\n        if (!pairingResult?.pairingId) return;\n        if ((scenario === \"GROUP_FULL\" || scenario === \"GROUP_SPLIT\") && !pairingResult.slotId) {\n          alert(\"N√£o foi poss√≠vel identificar o teu slot na dupla. Atualiza a p√°gina e tenta novamente.\");\n          return;\n        }\n\n        const nextQuantidades: Record<string, number> = { [target.id]: scenario === \"GROUP_FULL\" ? 2 : 1 };\n        const totalCalc = (target.price ?? 0) * (scenario === \"GROUP_FULL\" ? 2 : 1);\n\n        atualizarDados({\n          paymentScenario: scenario,\n          additional: {\n            ...(safeDados.additional && typeof safeDados.additional === \"object\" ? safeDados.additional : {}),\n            quantidades: nextQuantidades,\n            total: totalCalc,\n            padelJoinMode,\n            checkoutUiVariant: variant,\n            padelMeta: resolvedPadelMeta ?? padelMeta,\n            pairingId: pairingResult.pairingId,\n            pairingSlotId: pairingResult.slotId ?? undefined,\n            ticketTypeId: Number(target.id),\n          },\n        });\n        irParaPasso(2);\n      });\n\n      return;\n    }\n\n    // Permitir avan√ßar mesmo que aparente 0‚Ç¨ ‚Äî backend decide se √© FREE/PAID.\n    if (selectedQty <= 0) return;\n\n    // Guardar info deste step no contexto (quantidades + total)\n    atualizarDados({\n      paymentScenario: \"SINGLE\",\n      additional: {\n        ...(safeDados.additional && typeof safeDados.additional === \"object\" ? safeDados.additional : {}),\n        quantidades,\n        total,\n        checkoutUiVariant: variant,\n      },\n    });\n\n    irParaPasso(2);\n  }\n\n  if (!hasWaves) {\n    return (\n      <div className=\"p-6 text-sm text-white/70\">\n        A carregar bilhetes... Se isto persistir, volta atr√°s e tenta novamente.\n      </div>\n    );\n  }\n\n    if (variant === \"PADEL\") {\n      const baseWave = padelCandidateWave;\n      const basePrice = baseWave?.price ?? 0;\n      const hasPairSlotsAvailable = padelHasPairSlots;\n    return (\n      <div className=\"flex flex-col gap-6 text-white\">\n        <header className=\"flex items-start justify-between gap-3\">\n          <div className=\"space-y-1\">\n            <p className=\"text-[11px] uppercase tracking-[0.18em] text-white/55\">\n              Passo 1 de 3\n            </p>\n            <h2 className=\"text-2xl font-semibold leading-tight\">Escolhe como queres jogar</h2>\n            <p className=\"text-[11px] text-white/60 max-w-sm\">\n              Padel: inscri√ß√£o individual ou como dupla. Pagas j√° a tua parte ou a dupla completa.\n            </p>\n          </div>\n          <button\n            type=\"button\"\n            onClick={fecharCheckout}\n            className=\"text-[11px] rounded-full border border-white/15 bg-white/5 px-3 py-1 text-white/75 hover:text-white hover:border-white/40 transition-colors\"\n          >\n            Fechar\n          </button>\n        </header>\n\n        <div className=\"h-1 w-full rounded-full bg-white/10 overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.35)]\">\n          <div className=\"h-full w-1/3 rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] animate-pulse\" />\n        </div>\n\n        {padelCategoryOptions.length > 1 && (\n          <div className=\"rounded-2xl border border-white/12 bg-white/[0.05] p-4 shadow-[0_14px_40px_rgba(0,0,0,0.55)]\">\n            <p className=\"text-[11px] uppercase tracking-[0.18em] text-white/60\">Categoria</p>\n            <div className=\"mt-3 flex flex-wrap gap-2\">\n              {padelCategoryOptions.map((opt) => {\n                const isSelected = opt.key === selectedPadelCategoryKey;\n                return (\n                  <button\n                    key={opt.key}\n                    type=\"button\"\n                    onClick={() => {\n                      setSelectedPadelCategoryKey(opt.key);\n                      if (padelStockError) setPadelStockError(null);\n                    }}\n                    className={`rounded-full border px-3 py-1.5 text-[12px] transition ${\n                      isSelected\n                        ? \"border-[#6BFFFF]/70 bg-white/12 text-white shadow-[0_10px_30px_rgba(107,255,255,0.25)]\"\n                        : \"border-white/15 bg-white/[0.04] text-white/70 hover:border-white/30\"\n                    }`}\n                  >\n                    {opt.label}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        <div className=\"grid gap-3 md:grid-cols-3\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              setPadelSelection(\"INDIVIDUAL\");\n              setPadelJoinMode(\"LOOKING_FOR_PARTNER\");\n              if (padelStockError) setPadelStockError(null);\n            }}\n            disabled={!hasPairSlotsAvailable}\n            className={`rounded-2xl border px-4 py-4 text-left transition shadow-lg ${\n              padelSelection === \"INDIVIDUAL\"\n                ? \"border-[#6BFFFF]/70 bg-white/12 shadow-[0_10px_40px_rgba(107,255,255,0.25)]\"\n                : \"border-white/10 bg-white/[0.04] hover:border-white/25\"\n            } ${!hasPairSlotsAvailable ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n          >\n            <p className=\"text-sm font-semibold\">Inscri√ß√£o individual</p>\n            <p className=\"text-[11px] text-white/65 mt-1\">1 lugar. Entrar em matchmaking.</p>\n            <p className=\"mt-3 text-lg font-semibold\">{basePrice.toFixed(2)} ‚Ç¨</p>\n            <p className=\"mt-3 text-[11px] text-white/70\">\n              Pagas s√≥ a tua parte e ficas em procura de parceiro.\n            </p>\n          </button>\n\n          <button\n            type=\"button\"\n            onClick={() => {\n              setPadelSelection(\"DUO_SPLIT\");\n              setPadelJoinMode(\"INVITE_PARTNER\");\n              if (padelStockError) setPadelStockError(null);\n            }}\n            disabled={!hasPairSlotsAvailable}\n            className={`rounded-2xl border px-4 py-4 text-left transition shadow-lg ${\n              padelSelection === \"DUO_SPLIT\"\n                ? \"border-[#6BFFFF]/70 bg-white/12 shadow-[0_10px_40px_rgba(107,255,255,0.25)]\"\n                : \"border-white/10 bg-white/[0.04] hover:border-white/25\"\n            } ${!hasPairSlotsAvailable ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n          >\n            <p className=\"text-sm font-semibold\">Dupla ¬∑ j√° tenho parceiro</p>\n            <p className=\"text-[11px] text-white/65 mt-1\">1 lugar pago. O parceiro paga o dele.</p>\n            <p className=\"mt-3 text-lg font-semibold\">{basePrice.toFixed(2)} ‚Ç¨</p>\n          </button>\n\n          <button\n            type=\"button\"\n            onClick={() => {\n              setPadelSelection(\"DUO_FULL\");\n              setPadelJoinMode(\"INVITE_PARTNER\");\n              if (padelStockError) setPadelStockError(null);\n            }}\n            disabled={!hasPairSlotsAvailable}\n            className={`rounded-2xl border px-4 py-4 text-left transition shadow-lg ${\n              padelSelection === \"DUO_FULL\"\n                ? \"border-[#6BFFFF]/70 bg-white/12 shadow-[0_10px_40px_rgba(107,255,255,0.25)]\"\n                : \"border-white/10 bg-white/[0.04] hover:border-white/25\"\n            } ${!hasPairSlotsAvailable ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n          >\n            <p className=\"text-sm font-semibold\">Dupla ¬∑ pagar os dois lugares</p>\n            <p className=\"text-[11px] text-white/65 mt-1\">2 lugares pagos j√° garantidos.</p>\n            <p className=\"mt-3 text-lg font-semibold\">{(basePrice * 2).toFixed(2)} ‚Ç¨</p>\n          </button>\n        </div>\n\n        {padelJoinMode === \"INVITE_PARTNER\" && (\n          <div className=\"rounded-2xl border border-white/12 bg-white/[0.05] p-4 shadow-[0_14px_40px_rgba(0,0,0,0.55)]\">\n            <p className=\"text-[12px] font-semibold text-white\">Dados do parceiro (obrigat√≥rio)</p>\n            <p className=\"text-[11px] text-white/60 mt-1\">\n              Adiciona o email, telefone ou @username para enviar o convite e prender o lugar dele.\n            </p>\n            <div className=\"mt-3\">\n              {partnerSelected ? (\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/10 px-2 py-1 text-sm text-white\">\n                  <div className=\"h-7 w-7 rounded-full bg-white/10 overflow-hidden border border-white/10\">\n                    {partnerSelected.avatarUrl ? (\n                      <img\n                        src={partnerSelected.avatarUrl}\n                        alt={partnerSelected.username ?? partnerSelected.fullName ?? \"user\"}\n                        className=\"h-full w-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"h-full w-full flex items-center justify-center text-[11px] text-white/70\">\n                        {(partnerSelected.username ?? partnerSelected.fullName ?? \"?\").slice(0, 2).toUpperCase()}\n                      </div>\n                    )}\n                  </div>\n                  <span className=\"font-medium\">\n                    {partnerSelected.username ? `@${partnerSelected.username}` : partnerSelected.fullName ?? \"Utilizador\"}\n                  </span>\n                  {partnerSelected.fullName && partnerSelected.username && (\n                    <span className=\"text-[11px] text-white/70\">¬∑ {partnerSelected.fullName}</span>\n                  )}\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setPartnerSelected(null);\n                      setPartnerContact(\"\");\n                    }}\n                    className=\"ml-1 inline-flex h-6 w-6 items-center justify-center rounded-full border border-white/20 bg-white/10 text-[11px] text-white/80 hover:bg-white/20\"\n                  >\n                    √ó\n                  </button>\n                </div>\n              ) : (\n                <input\n                  type=\"text\"\n                  value={partnerContact}\n                  onChange={(e) => {\n                    setPartnerContact(e.target.value);\n                    setPartnerSelected(null);\n                    if (partnerError) setPartnerError(null);\n                  }}\n                  placeholder=\"Email / telefone / @username\"\n                  className={`w-full rounded-xl border bg-white/5 backdrop-blur-sm px-3 py-2 text-sm text-white placeholder:text-white/35 focus:outline-none ${\n                    partnerError\n                      ? \"border-red-400/70 focus:border-red-300/90\"\n                      : \"border-white/15 focus:border-white/40\"\n                  }`}\n                />\n              )}\n              {partnerError && (\n                <p className=\"mt-2 text-[11px] text-red-300\">{partnerError}</p>\n              )}\n              {!partnerError && partnerLoading && (\n                <p className=\"mt-2 text-[11px] text-white/60\">A procurar utilizadores‚Ä¶</p>\n              )}\n              {!partnerSelected && !partnerError && !partnerLoading && partnerResults.length > 0 && (\n                <div className=\"mt-2 max-h-48 overflow-y-auto rounded-xl border border-white/12 bg-black/70 shadow-[0_12px_30px_rgba(0,0,0,0.5)]\">\n                  {partnerResults.map((user) => (\n                    <button\n                      key={user.id}\n                      type=\"button\"\n                    onClick={() => {\n                      const username = user.username ? `@${user.username}` : user.fullName ?? \"\";\n                        setPartnerContact(username);\n                        setPartnerSelected({\n                          ...user,\n                          label: username,\n                        });\n                        setPartnerResults([]);\n                        setPartnerError(null);\n                      }}\n                      className=\"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-white/5 transition-colors\"\n                    >\n                      <div className=\"h-8 w-8 rounded-full bg-white/10 overflow-hidden border border-white/10\">\n                        {user.avatarUrl ? (\n                          <img src={user.avatarUrl} alt={user.username ?? user.fullName ?? \"user\"} className=\"h-full w-full object-cover\" />\n                        ) : (\n                          <div className=\"h-full w-full flex items-center justify-center text-[11px] text-white/70\">\n                            {(user.username ?? user.fullName ?? \"?\").slice(0, 2).toUpperCase()}\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex flex-col\">\n                        <span className=\"text-sm text-white\">{user.username ? `@${user.username}` : user.fullName ?? \"Utilizador\"}</span>\n                        {user.fullName && (\n                          <span className=\"text-[11px] text-white/60\">{user.fullName}</span>\n                        )}\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex items-center justify-between gap-3 border-t border-white/10 pt-3\">\n          <div className=\"text-[11px] text-white/70\">\n            Seleciona uma op√ß√£o para avan√ßar.\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleContinuar}\n            disabled={!canContinuePadel || !hasPairSlotsAvailable || !padelCategorySelected}\n            className=\"rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] px-5 py-2.5 text-xs font-semibold text-black shadow-[0_0_26px_rgba(107,255,255,0.55)] hover:scale-[1.02] active:scale-95 transition-transform disabled:cursor-not-allowed disabled:opacity-50\"\n          >\n            Continuar\n          </button>\n        </div>\n        {padelStockError && (\n          <p className=\"text-[11px] text-amber-200\">{padelStockError}</p>\n        )}\n        {!padelStockError && !padelCategorySelected && padelCategoryRequired && (\n          <p className=\"text-[11px] text-amber-200\">Seleciona uma categoria para continuar.</p>\n        )}\n        {!padelStockError && !hasPairSlotsAvailable && (\n          <p className=\"text-[11px] text-amber-200\">Sem vagas suficientes para criar uma dupla.</p>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-6 text-white\">\n      {/* Header */}\n      <header className=\"flex items-start justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.18em] text-white/55\">\n            Passo 1 de 3\n          </p>\n          <h2 className=\"text-2xl font-semibold leading-tight\">\n            Escolhe o teu bilhete\n          </h2>\n          <p className=\"text-[11px] text-white/60 max-w-xs\">\n            Seleciona a wave, ajusta quantidades e rev√™ antes de pagar.\n          </p>\n        </div>\n        <button\n          type=\"button\"\n          onClick={fecharCheckout}\n          className=\"text-[11px] rounded-full border border-white/15 bg-white/5 px-3 py-1 text-white/75 hover:text-white hover:border-white/40 transition-colors\"\n        >\n          Fechar\n        </button>\n      </header>\n\n      {/* Barra de progresso */}\n      <div className=\"h-1 w-full rounded-full bg-white/10 overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.35)]\">\n        <div className=\"h-full w-1/3 rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] animate-pulse\" />\n      </div>\n\n      {/* Lista de waves com scroll interno */}\n      <div className=\"space-y-3\">\n        {stableWaves.map((wave: Wave) => {\n          const q = quantidades[wave.id] ?? 0;\n          const isOpen = aberto === wave.id;\n          const status = normalizeStatus(wave.status);\n          const isSoldOut = status === \"sold_out\" || status === \"closed\";\n          const maxForWave = getMaxForWave(wave.id);\n          const badge =\n            status === \"upcoming\"\n              ? \"Em breve\"\n              : isSoldOut\n                ? \"Venda terminada\"\n                : \"Dispon√≠vel\";\n          const badgeClass = isSoldOut\n            ? \"border-red-400/50 bg-red-500/20 text-red-50\"\n            : status === \"upcoming\"\n              ? \"border-amber-300/50 bg-amber-400/20 text-amber-50\"\n              : \"border-emerald-300/50 bg-emerald-500/18 text-emerald-50\";\n\n          return (\n            <div\n              key={wave.id}\n              className=\"rounded-2xl border border-white/12 bg-white/[0.05] shadow-[0_10px_30px_rgba(0,0,0,0.55)] backdrop-blur-xl\"\n            >\n              {/* Header Wave */}\n              <button\n                type=\"button\"\n                onClick={() => toggleWave(wave.id)}\n                className=\"w-full flex items-center justify-between px-4 py-3\"\n                disabled={isSoldOut}\n              >\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-semibold\">{wave.name}</p>\n                  <p className=\"text-[11px] text-white/50\">\n                    {typeof wave.price === \"number\"\n                      ? `${wave.price.toFixed(2)} ‚Ç¨`\n                      : \"Pre√ßo indispon√≠vel\"}\n                  </p>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  <span\n                    className={`rounded-full border px-2 py-0.5 text-[10px] text-white/80 ${\n                      isSoldOut\n                        ? \"border-red-400/40 bg-red-500/10\"\n                        : \"border-emerald-300/30 bg-emerald-400/10\"\n                    }`}\n                  >\n                    {isSoldOut ? \"Esgotado\" : \"Dispon√≠vel\"}\n                  </span>\n                  <span\n                    className={`flex h-7 w-7 items-center justify-center rounded-full border ${\n                      q > 0\n                        ? \"border-emerald-400/50 bg-emerald-400/15 text-emerald-100\"\n                        : \"border-white/20 bg-white/10 text-white/80\"\n                    }`}\n                  >\n                    {q > 0 ? q : isOpen ? \"‚àí\" : \"+\"}\n                  </span>\n                </div>\n              </button>\n\n              {/* Conte√∫do Wave */}\n              {isOpen && (\n                <div className=\"px-4 pb-4 flex flex-col gap-3\">\n                  <p className=\"text-[11px] text-white/60\">\n                    {wave.description ?? \"Sem descri√ß√£o dispon√≠vel.\"}\n                  </p>\n\n                  {isSoldOut && (\n                    <div className=\"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 text-[11px] text-white/70\">\n                      Venda terminada. Escolhe outra wave ou volta mais tarde.\n                    </div>\n                  )}\n\n                  <div className=\"inline-flex items-center gap-2 rounded-full bg-black/60 border border-white/15 px-2 py-1.5 shadow-md\">\n                    <button\n                      type=\"button\"\n                      onClick={() => handleDecrement(wave.id)}\n                      className=\"flex h-7 w-7 items-center justify-center rounded-full bg-white/10 hover:bg-white/20 disabled:opacity-50\"\n                      disabled={isSoldOut}\n                    >\n                      ‚Äì\n                    </button>\n\n                    <span className=\"w-9 text-center text-sm font-semibold\">\n                      {q}\n                    </span>\n\n                    <button\n                      type=\"button\"\n                      onClick={() => handleIncrement(wave.id)}\n                      className=\"flex h-7 w-7 items-center justify-center rounded-full bg-white text-black hover:bg-zinc-100 disabled:opacity-50\"\n                      disabled={\n                        isSoldOut || (quantidades[wave.id] ?? 0) >= maxForWave\n                      }\n                    >\n                      +\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Total + CTA */}\n      <div className=\"border-t border-white/10 pt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <p className=\"text-[12px] text-white/70\">\n          Total:{\" \"}\n          <span className=\"font-semibold text-white text-base\">\n            {total.toFixed(2)} ‚Ç¨\n          </span>\n        </p>\n        <button\n          type=\"button\"\n          disabled={total === 0}\n          onClick={handleContinuar}\n          className=\"mt-3 sm:mt-0 rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] px-5 py-2.5 text-xs font-semibold text-black shadow-[0_0_26px_rgba(107,255,255,0.55)] disabled:opacity-50 hover:scale-[1.02] active:scale-95 transition-transform\"\n        >\n          Continuar para pagamento\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAwBe,SAAS;IACtB,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,cAAc,EAAE,cAAc,EAAE,GAAG,IAAA,iKAAW;IAE1E,MAAM,YACJ,SAAS,OAAO,UAAU,WACrB,QACD;QAAE,OAAO,EAAE;QAAE,YAAY,CAAC;IAAE;IAElC,MAAM,kBAAkB,CAAC,SACvB,CAAC,UAAU,SAAS,EAAE,WAAW;IAEnC,MAAM,cAAsB,MAAM,OAAO,CAAC,UAAU,KAAK,IACrD;WAAI,UAAU,KAAK;KAAC,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;YAC/B,GAAG,CAAC;YACJ,QAAQ,gBAAgB,EAAE,MAAM;QAClC,CAAC,KACD,EAAE;IACN,MAAM,oBAAoB;WAAI;KAAY,CACvC,MAAM,CAAC,CAAC;QACP,MAAM,KAAK,gBAAgB,EAAE,MAAM;QACnC,OAAO,OAAO,cAAc,OAAO;IACrC,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,KAAK,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,EAAE;IACrD,MAAM,WAAW,YAAY,MAAM,GAAG;IAEtC,+EAA+E;IAC/E,MAAM,qBAA6C,CAAC;IACpD,KAAK,MAAM,KAAK,YAAa;QAC3B,MAAM,SACJ,OAAO,EAAE,QAAQ,KAAK,YAAY,EAAE,QAAQ,GAAG,IAAI,EAAE,QAAQ,GAAG;QAClE,MAAM,YACJ,OAAO,EAAE,SAAS,KAAK,YAAY,EAAE,SAAS,IAAI,IAC9C,EAAE,SAAS,GACX;QACN,MAAM,aACJ,cAAc,OAAO,OAAO,gBAAgB,GAAG,KAAK,GAAG,CAAC,GAAG;QAC7D,kBAAkB,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,GAAG,CAAC,QAAQ;IAC9C;IACA,MAAM,UAAU,CACd,OAAO,UAAU,UAAU,EAAE,sBAAsB,WAC/C,UAAU,UAAU,CAAC,iBAAiB,GACtC,SACN,EAAE,WAAW;IACb,MAAM,iBAAiB,YAAY;IACnC,MAAM,YAAY,AAAC,UAAU,UAAU,EAAE,aAEvB;IAElB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAC5C;IAEF,MAAM,uBAAuB,IAAA,gNAAO,EAAC;QACnC,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAC9B,MAAM,MAAM,IAAI;QAShB,KAAK,MAAM,QAAQ,YAAa;YAC9B,MAAM,SAAS,OAAO,KAAK,mBAAmB,KAAK,WAAW,KAAK,mBAAmB,GAAG;YACzF,MAAM,aAAa,OAAO,KAAK,eAAe,KAAK,WAAW,KAAK,eAAe,GAAG;YACrF,IAAI,CAAC,UAAU,CAAC,YAAY;YAC5B,MAAM,MAAM,SAAS,CAAC,KAAK,EAAE,QAAQ,GAAG,CAAC,IAAI,EAAE,YAAY;YAC3D,IAAI,IAAI,GAAG,CAAC,MAAM;YAClB,MAAM,QACJ,KAAK,kBAAkB,EAAE,UACzB,CAAC,aAAa,CAAC,UAAU,EAAE,YAAY,GAAG,SAAS,CAAC,UAAU,EAAE,QAAQ,GAAG,WAAW;YACxF,IAAI,GAAG,CAAC,KAAK;gBAAE;gBAAK;gBAAQ;gBAAY;YAAM;QAChD;QACA,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM;IAC9B,GAAG;QAAC;QAAgB;KAAY;IAChC,MAAM,CAAC,0BAA0B,4BAA4B,GAAG,IAAA,iNAAQ,EAAgB;QACtF,IAAI,CAAC,gBAAgB,OAAO;QAC5B,IAAI,WAAW,gBAAgB,OAAO,CAAC,KAAK,EAAE,UAAU,cAAc,EAAE;QACxE,IAAI,WAAW,YAAY,OAAO,CAAC,IAAI,EAAE,UAAU,UAAU,EAAE;QAC/D,OAAO,oBAAoB,CAAC,EAAE,EAAE,OAAO;IACzC;IACA,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAElD;IACF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAA2C;IAC7F,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IACrD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB;IAChE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAgB;IACtE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAElD,EAAE;IACJ,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IACrD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAM5C;IACV,MAAM,uBAAuB,iBAAiB,SAAS;IACvD,MAAM,iBAAiB,IAAA,+MAAM,EAAyB;IACtD,MAAM,kBAAkB,kBAAkB;IAC1C,MAAM,oBAAoB,eAAe,IAAI,GAAG,MAAM,GAAG;IACzD,MAAM,mBAAmB,CAAC,mBAAmB;IAE7C,2CAA2C;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAClC,mBAAmB,MAAM,WAAW,CAAC,EAAE,EAAE,MAAM;IAGjD,2DAA2D;IAC3D,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,YAAY,MAAM,CAC/C,CAAC,KAA6C;QAC5C,MAAM,IAAI,WAAW,CAAC,EAAE,EAAE,CAAC,IAAI;QAC/B,MAAM,QAAQ,OAAO,EAAE,KAAK,KAAK,WAAW,EAAE,KAAK,GAAG;QACtD,OAAO;YAAE,OAAO,IAAI,KAAK,GAAG,IAAI;YAAO,aAAa,IAAI,WAAW,GAAG;QAAE;IAC1E,GACA;QAAE,OAAO;QAAG,aAAa;IAAE;IAG7B,SAAS,WAAW,EAAU;QAC5B,UAAU,CAAC,OAAU,SAAS,KAAK,OAAO;IAC5C;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,gBAAgB;QACrB,IAAI,qBAAqB,MAAM,KAAK,GAAG;YACrC,IAAI,6BAA6B,MAAM;gBACrC,4BAA4B;YAC9B;YACA;QACF;QACA,MAAM,aACJ,WAAW,iBAAiB,CAAC,KAAK,EAAE,UAAU,cAAc,EAAE,GAAG,WAAW,aAAa,CAAC,IAAI,EAAE,UAAU,UAAU,EAAE,GAAG;QAC3H,MAAM,aAAa,2BACf,qBAAqB,IAAI,CAAC,CAAC,MAAQ,IAAI,GAAG,KAAK,4BAC/C;QACJ,IAAI,YAAY;QAChB,IAAI,cAAc,qBAAqB,IAAI,CAAC,CAAC,MAAQ,IAAI,GAAG,KAAK,aAAa;YAC5E,4BAA4B;QAC9B,OAAO;YACL,4BAA4B,oBAAoB,CAAC,EAAE,CAAC,GAAG;QACzD;IACF,GAAG;QAAC;QAAgB;QAAsB,WAAW;QAAY,WAAW;QAAgB;KAAyB;IAErH,MAAM,wBACJ,qBAAqB,IAAI,CAAC,CAAC,MAAQ,IAAI,GAAG,KAAK,6BAA6B;IAC9E,MAAM,oBAAoB,YACtB;QACE,GAAG,SAAS;QACZ,YAAY,uBAAuB,cAAc,UAAU,UAAU,IAAI;QACzE,gBAAgB,uBAAuB,UAAU,UAAU,cAAc,IAAI;IAC/E,IACA;IACJ,MAAM,wBAAwB,kBAAkB,qBAAqB,MAAM,GAAG;IAC9E,MAAM,wBAAwB,CAAC,yBAAyB,QAAQ;IAEhE,MAAM,qBAAqB,kBAAkB,wBACzC,YAAY,MAAM,CAAC,CAAC;QAClB,IAAI,sBAAsB,MAAM,EAAE,OAAO,EAAE,mBAAmB,KAAK,sBAAsB,MAAM;QAC/F,IAAI,sBAAsB,UAAU,EAAE,OAAO,EAAE,eAAe,KAAK,sBAAsB,UAAU;QACnG,OAAO;IACT,KACA;IACJ,MAAM,qBACJ,mBAAmB,IAAI,CAAC,CAAC;QACvB,MAAM,KAAK,gBAAgB,EAAE,MAAM;QACnC,OAAO,OAAO,cAAc,OAAO;IACrC,MAAM,kBAAkB,CAAC,EAAE,IAAI;IACjC,MAAM,sBACJ,OAAO,oBAAoB,cAAc,WAAW,mBAAmB,SAAS,GAAG;IACrF,MAAM,oBACJ,qBAAsB,wBAAwB,OAAO,OAAO,uBAAuB,IAAK;IAE1F,qDAAqD;IACrD,IAAA,kNAAS,EAAC;QACR,IAAI,kBAAkB,kBAAkB;YACtC,kBAAkB,EAAE;YACpB;QACF;QACA,MAAM,OAAO,eAAe,IAAI;QAChC,IAAI,mBAAmB,SAAS,gBAAgB,KAAK,EAAE;YACrD,kBAAkB,EAAE;YACpB;QACF;QACA,IAAI,KAAK,MAAM,GAAG,GAAG;YACnB,kBAAkB,EAAE;YACpB;QACF;QAEA,IAAI,eAAe,OAAO,EAAE;YAC1B,eAAe,OAAO,CAAC,KAAK;QAC9B;QACA,MAAM,aAAa,IAAI;QACvB,eAAe,OAAO,GAAG;QAEzB,MAAM,UAAU,WAAW;YACzB,IAAI;gBACF,kBAAkB;gBAClB,MAAM,MAAM,MAAM,MAAM,CAAC,oBAAoB,EAAE,mBAAmB,OAAO,EAAE;oBACzE,QAAQ,WAAW,MAAM;gBAC3B;gBACA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;gBAC1C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,IAAI;oBACxB,kBAAkB,EAAE;gBACtB,OAAO;oBACL,kBAAkB,MAAM,OAAO,CAAC,KAAK,OAAO,IAAI,KAAK,OAAO,GAAG,EAAE;gBACnE;YACF,EAAE,OAAO,KAAK;gBACZ,IAAI,AAAC,IAAc,IAAI,KAAK,cAAc;oBACxC,kBAAkB,EAAE;gBACtB;YACF,SAAU;gBACR,kBAAkB;YACpB;QACF,GAAG;QAEH,OAAO;YACL,aAAa;YACb,WAAW,KAAK;QAClB;IACF,GAAG;QAAC;QAAgB;QAAe;KAAqB;IAExD,SAAS,cAAc,MAAc;QACnC,MAAM,OAAO,YAAY,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC9C,IAAI,CAAC,MAAM,OAAO,OAAO,gBAAgB;QACzC,MAAM,YACJ,OAAO,KAAK,SAAS,KAAK,YAAY,KAAK,SAAS,IAAI,IACpD,KAAK,SAAS,GACd;QACN,OAAO,cAAc,OAAO,OAAO,gBAAgB,GAAG,KAAK,GAAG,CAAC,GAAG;IACpE;IAEA,SAAS,gBAAgB,EAAU;QACjC,MAAM,aAAa,cAAc;QACjC,eAAe,CAAC;YACd,MAAM,UAAU,IAAI,CAAC,GAAG,IAAI;YAC5B,IAAI,WAAW,YAAY,OAAO;YAClC,OAAO;gBACL,GAAG,IAAI;gBACP,CAAC,GAAG,EAAE,UAAU;YAClB;QACF;IACF;IAEA,SAAS,gBAAgB,EAAU;QACjC,eAAe,CAAC,OAAS,CAAC;gBACxB,GAAG,IAAI;gBACP,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI;YACtC,CAAC;IACH;IAEA,SAAS;QACP,IAAI,YAAY,SAAS;YACvB,IAAI,yBAAyB,CAAC,uBAAuB;gBACnD,mBAAmB;gBACnB;YACF;YACA,MAAM,SAAS;YACf,IAAI,CAAC,UAAU,CAAC,mBAAmB;gBACjC,mBAAmB;gBACnB;YACF;YAEA,gFAAgF;YAChF,IAAI,mBAAmB,CAAC,mBAAmB;gBACzC,gBAAgB;gBAChB;YACF;YAEA,IAAI,iBAAiB,mBAAmB;YACxC,gBAAgB;YAEhB,MAAM,WACJ,mBAAmB,aACf,eACA;YAEN,6CAA6C;YAC7C,MAAM,cAAc,aAAa,eAAe,SAAS;YAEzD,MAAM,gBAAgB;gBACpB,IAAI,CAAC,mBAAmB,SAAS,OAAO;gBACxC,IAAI;oBACF,MAAM,MAAM,MAAM,MAAM,uBAAuB;wBAC7C,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BACnB,SAAS,kBAAkB,OAAO;4BAClC,aAAa,kBAAkB,WAAW,IAAI;4BAC9C,YAAY,kBAAkB,UAAU,IAAI;4BAC5C;4BACA,iBAAiB;4BACjB,gBACE,kBAAkB,oBAAoB,eAAe,IAAI,KAAK,eAAe,IAAI,KAAK;wBAC1F;oBACF;oBACA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;oBAC1C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,MAAM,CAAC,MAAM,SAAS,IAAI;wBAC9C,MAAM,IAAI,MAAM,MAAM,SAAS;oBACjC;oBACA,MAAM,UAAU,KAAK,OAAO;oBAC5B,MAAM,OACJ,QAAQ,KAAK,EAAE,KAAK,CAAC,IAAM,CAAC,EAAE,SAAS,IAAI,EAAE,QAAQ,MAAM,cAC3D,QAAQ,KAAK,EAAE,CAAC,EAAE,IAClB;oBACF,OAAO;wBAAE,WAAW,QAAQ,EAAE;wBAAE,QAAQ,MAAM,MAAM;oBAAK;gBAC3D,EAAE,OAAO,KAAK;oBACZ,QAAQ,KAAK,CAAC,gCAAgC;oBAC9C,MAAM,eAAe,QAAQ,IAAI,OAAO,GAAG;oBAC3C,OAAO;gBACT;YACF;YAEA,KAAK,gBAAgB,IAAI,CAAC,CAAC;gBACzB,IAAI,CAAC,eAAe,WAAW;gBAC/B,IAAI,CAAC,aAAa,gBAAgB,aAAa,aAAa,KAAK,CAAC,cAAc,MAAM,EAAE;oBACtF,MAAM;oBACN;gBACF;gBAEA,MAAM,kBAA0C;oBAAE,CAAC,OAAO,EAAE,CAAC,EAAE,aAAa,eAAe,IAAI;gBAAE;gBACjG,MAAM,YAAY,CAAC,OAAO,KAAK,IAAI,CAAC,IAAI,CAAC,aAAa,eAAe,IAAI,CAAC;gBAE1E,eAAe;oBACb,iBAAiB;oBACjB,YAAY;wBACV,GAAI,UAAU,UAAU,IAAI,OAAO,UAAU,UAAU,KAAK,WAAW,UAAU,UAAU,GAAG,CAAC,CAAC;wBAChG,aAAa;wBACb,OAAO;wBACP;wBACA,mBAAmB;wBACnB,WAAW,qBAAqB;wBAChC,WAAW,cAAc,SAAS;wBAClC,eAAe,cAAc,MAAM,IAAI;wBACvC,cAAc,OAAO,OAAO,EAAE;oBAChC;gBACF;gBACA,YAAY;YACd;YAEA;QACF;QAEA,0EAA0E;QAC1E,IAAI,eAAe,GAAG;QAEtB,4DAA4D;QAC5D,eAAe;YACb,iBAAiB;YACjB,YAAY;gBACV,GAAI,UAAU,UAAU,IAAI,OAAO,UAAU,UAAU,KAAK,WAAW,UAAU,UAAU,GAAG,CAAC,CAAC;gBAChG;gBACA;gBACA,mBAAmB;YACrB;QACF;QAEA,YAAY;IACd;IAEA,IAAI,CAAC,UAAU;QACb,qBACE,8OAAC;YAAI,WAAU;sBAA4B;;;;;;IAI/C;IAEE,IAAI,YAAY,SAAS;QACvB,MAAM,WAAW;QACjB,MAAM,YAAY,UAAU,SAAS;QACrC,MAAM,wBAAwB;QAChC,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAO,WAAU;;sCAChB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAE,WAAU;8CAAwD;;;;;;8CAGrE,8OAAC;oCAAG,WAAU;8CAAuC;;;;;;8CACrD,8OAAC;oCAAE,WAAU;8CAAqC;;;;;;;;;;;;sCAIpD,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,WAAU;sCACX;;;;;;;;;;;;8BAKH,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;;;;;;;;;;;gBAGhB,qBAAqB,MAAM,GAAG,mBAC7B,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,WAAU;sCAAwD;;;;;;sCACrE,8OAAC;4BAAI,WAAU;sCACZ,qBAAqB,GAAG,CAAC,CAAC;gCACzB,MAAM,aAAa,IAAI,GAAG,KAAK;gCAC/B,qBACE,8OAAC;oCAEC,MAAK;oCACL,SAAS;wCACP,4BAA4B,IAAI,GAAG;wCACnC,IAAI,iBAAiB,mBAAmB;oCAC1C;oCACA,WAAW,CAAC,uDAAuD,EACjE,aACI,2FACA,uEACJ;8CAED,IAAI,KAAK;mCAZL,IAAI,GAAG;;;;;4BAelB;;;;;;;;;;;;8BAKN,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;gCACP,kBAAkB;gCAClB,iBAAiB;gCACjB,IAAI,iBAAiB,mBAAmB;4BAC1C;4BACA,UAAU,CAAC;4BACX,WAAW,CAAC,4DAA4D,EACtE,mBAAmB,eACf,gFACA,wDACL,CAAC,EAAE,CAAC,wBAAwB,kCAAkC,IAAI;;8CAEnE,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;8CACrC,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;8CAC9C,8OAAC;oCAAE,WAAU;;wCAA8B,UAAU,OAAO,CAAC;wCAAG;;;;;;;8CAChE,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;;;;;;;sCAKhD,8OAAC;4BACC,MAAK;4BACL,SAAS;gCACP,kBAAkB;gCAClB,iBAAiB;gCACjB,IAAI,iBAAiB,mBAAmB;4BAC1C;4BACA,UAAU,CAAC;4BACX,WAAW,CAAC,4DAA4D,EACtE,mBAAmB,cACf,gFACA,wDACL,CAAC,EAAE,CAAC,wBAAwB,kCAAkC,IAAI;;8CAEnE,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;8CACrC,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;8CAC9C,8OAAC;oCAAE,WAAU;;wCAA8B,UAAU,OAAO,CAAC;wCAAG;;;;;;;;;;;;;sCAGlE,8OAAC;4BACC,MAAK;4BACL,SAAS;gCACP,kBAAkB;gCAClB,iBAAiB;gCACjB,IAAI,iBAAiB,mBAAmB;4BAC1C;4BACA,UAAU,CAAC;4BACX,WAAW,CAAC,4DAA4D,EACtE,mBAAmB,aACf,gFACA,wDACL,CAAC,EAAE,CAAC,wBAAwB,kCAAkC,IAAI;;8CAEnE,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;8CACrC,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;8CAC9C,8OAAC;oCAAE,WAAU;;wCAA8B,CAAC,YAAY,CAAC,EAAE,OAAO,CAAC;wCAAG;;;;;;;;;;;;;;;;;;;gBAIzE,kBAAkB,kCACjB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,WAAU;sCAAuC;;;;;;sCACpD,8OAAC;4BAAE,WAAU;sCAAiC;;;;;;sCAG9C,8OAAC;4BAAI,WAAU;;gCACZ,gCACC,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;sDACZ,gBAAgB,SAAS,iBACxB,8OAAC;gDACC,KAAK,gBAAgB,SAAS;gDAC9B,KAAK,gBAAgB,QAAQ,IAAI,gBAAgB,QAAQ,IAAI;gDAC7D,WAAU;;;;;qEAGZ,8OAAC;gDAAI,WAAU;0DACZ,CAAC,gBAAgB,QAAQ,IAAI,gBAAgB,QAAQ,IAAI,GAAG,EAAE,KAAK,CAAC,GAAG,GAAG,WAAW;;;;;;;;;;;sDAI5F,8OAAC;4CAAK,WAAU;sDACb,gBAAgB,QAAQ,GAAG,CAAC,CAAC,EAAE,gBAAgB,QAAQ,EAAE,GAAG,gBAAgB,QAAQ,IAAI;;;;;;wCAE1F,gBAAgB,QAAQ,IAAI,gBAAgB,QAAQ,kBACnD,8OAAC;4CAAK,WAAU;;gDAA4B;gDAAG,gBAAgB,QAAQ;;;;;;;sDAEzE,8OAAC;4CACC,MAAK;4CACL,SAAS;gDACP,mBAAmB;gDACnB,kBAAkB;4CACpB;4CACA,WAAU;sDACX;;;;;;;;;;;yDAKH,8OAAC;oCACC,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC;wCACT,kBAAkB,EAAE,MAAM,CAAC,KAAK;wCAChC,mBAAmB;wCACnB,IAAI,cAAc,gBAAgB;oCACpC;oCACA,aAAY;oCACZ,WAAW,CAAC,+HAA+H,EACzI,eACI,8CACA,yCACJ;;;;;;gCAGL,8BACC,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;gCAE/C,CAAC,gBAAgB,gCAChB,8OAAC;oCAAE,WAAU;8CAAiC;;;;;;gCAE/C,CAAC,mBAAmB,CAAC,gBAAgB,CAAC,kBAAkB,eAAe,MAAM,GAAG,mBAC/E,8OAAC;oCAAI,WAAU;8CACZ,eAAe,GAAG,CAAC,CAAC,qBACnB,8OAAC;4CAEC,MAAK;4CACP,SAAS;gDACP,MAAM,WAAW,KAAK,QAAQ,GAAG,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAE,GAAG,KAAK,QAAQ,IAAI;gDACtE,kBAAkB;gDAClB,mBAAmB;oDACjB,GAAG,IAAI;oDACP,OAAO;gDACT;gDACA,kBAAkB,EAAE;gDACpB,gBAAgB;4CAClB;4CACA,WAAU;;8DAEV,8OAAC;oDAAI,WAAU;8DACZ,KAAK,SAAS,iBACb,8OAAC;wDAAI,KAAK,KAAK,SAAS;wDAAE,KAAK,KAAK,QAAQ,IAAI,KAAK,QAAQ,IAAI;wDAAQ,WAAU;;;;;6EAEnF,8OAAC;wDAAI,WAAU;kEACZ,CAAC,KAAK,QAAQ,IAAI,KAAK,QAAQ,IAAI,GAAG,EAAE,KAAK,CAAC,GAAG,GAAG,WAAW;;;;;;;;;;;8DAItE,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAK,WAAU;sEAAsB,KAAK,QAAQ,GAAG,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAE,GAAG,KAAK,QAAQ,IAAI;;;;;;wDAC5F,KAAK,QAAQ,kBACZ,8OAAC;4DAAK,WAAU;sEAA6B,KAAK,QAAQ;;;;;;;;;;;;;2CA1BzD,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;8BAqC1B,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCAA4B;;;;;;sCAG3C,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,UAAU,CAAC,oBAAoB,CAAC,yBAAyB,CAAC;4BAC1D,WAAU;sCACX;;;;;;;;;;;;gBAIF,iCACC,8OAAC;oBAAE,WAAU;8BAA8B;;;;;;gBAE5C,CAAC,mBAAmB,CAAC,yBAAyB,uCAC7C,8OAAC;oBAAE,WAAU;8BAA6B;;;;;;gBAE3C,CAAC,mBAAmB,CAAC,uCACpB,8OAAC;oBAAE,WAAU;8BAA6B;;;;;;;;;;;;IAIlD;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAO,WAAU;;kCAChB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAE,WAAU;0CAAwD;;;;;;0CAGrE,8OAAC;gCAAG,WAAU;0CAAuC;;;;;;0CAGrD,8OAAC;gCAAE,WAAU;0CAAqC;;;;;;;;;;;;kCAIpD,8OAAC;wBACC,MAAK;wBACL,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;0BAMH,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;;;;;;;;;;0BAIjB,8OAAC;gBAAI,WAAU;0BACZ,YAAY,GAAG,CAAC,CAAC;oBAChB,MAAM,IAAI,WAAW,CAAC,KAAK,EAAE,CAAC,IAAI;oBAClC,MAAM,SAAS,WAAW,KAAK,EAAE;oBACjC,MAAM,SAAS,gBAAgB,KAAK,MAAM;oBAC1C,MAAM,YAAY,WAAW,cAAc,WAAW;oBACtD,MAAM,aAAa,cAAc,KAAK,EAAE;oBACxC,MAAM,QACJ,WAAW,aACP,aACA,YACE,oBACA;oBACR,MAAM,aAAa,YACf,gDACA,WAAW,aACT,sDACA;oBAEN,qBACE,8OAAC;wBAEC,WAAU;;0CAGV,8OAAC;gCACC,MAAK;gCACL,SAAS,IAAM,WAAW,KAAK,EAAE;gCACjC,WAAU;gCACV,UAAU;;kDAEV,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAE,WAAU;0DAAyB,KAAK,IAAI;;;;;;0DAC/C,8OAAC;gDAAE,WAAU;0DACV,OAAO,KAAK,KAAK,KAAK,WACnB,GAAG,KAAK,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,GAC5B;;;;;;;;;;;;kDAIR,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDACC,WAAW,CAAC,0DAA0D,EACpE,YACI,oCACA,2CACJ;0DAED,YAAY,aAAa;;;;;;0DAE5B,8OAAC;gDACC,WAAW,CAAC,6DAA6D,EACvE,IAAI,IACA,6DACA,6CACJ;0DAED,IAAI,IAAI,IAAI,SAAS,MAAM;;;;;;;;;;;;;;;;;;4BAMjC,wBACC,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDACV,KAAK,WAAW,IAAI;;;;;;oCAGtB,2BACC,8OAAC;wCAAI,WAAU;kDAAwF;;;;;;kDAKzG,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDACC,MAAK;gDACL,SAAS,IAAM,gBAAgB,KAAK,EAAE;gDACtC,WAAU;gDACV,UAAU;0DACX;;;;;;0DAID,8OAAC;gDAAK,WAAU;0DACb;;;;;;0DAGH,8OAAC;gDACC,MAAK;gDACL,SAAS,IAAM,gBAAgB,KAAK,EAAE;gDACtC,WAAU;gDACV,UACE,aAAa,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,KAAK;0DAE/C;;;;;;;;;;;;;;;;;;;uBA3EF,KAAK,EAAE;;;;;gBAmFlB;;;;;;0BAIF,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;;4BAA4B;4BAChC;0CACP,8OAAC;gCAAK,WAAU;;oCACb,MAAM,OAAO,CAAC;oCAAG;;;;;;;;;;;;;kCAGtB,8OAAC;wBACC,MAAK;wBACL,UAAU,UAAU;wBACpB,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;;AAMT"}},
    {"offset": {"line": 1415, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/phone.ts"],"sourcesContent":["// Utils partilhados para normalizar/validar telefones de forma consistente\n\n// Remove caracteres inv√°lidos, permitindo apenas d√≠gitos e um √∫nico \"+\" no in√≠cio\nexport function sanitizePhone(input: string): string {\n  let cleaned = input.replace(/[^\\d+]/g, \"\");\n  if (cleaned.includes(\"+\")) {\n    const firstPlus = cleaned.indexOf(\"+\");\n    cleaned = \"+\" + cleaned.slice(firstPlus + 1).replace(/\\+/g, \"\");\n  }\n  return cleaned;\n}\n\n// Valida√ß√£o: d√≠gitos com opcional \"+\" no in√≠cio, 6 a 15 d√≠gitos totais\nexport function isValidPhone(input: string): boolean {\n  const value = sanitizePhone(input);\n  if (!value) return false;\n  return /^\\+?\\d{6,15}$/.test(value);\n}\n\n// Normaliza√ß√£o simples: devolve o valor sanitizado (j√° usado para guardar)\nexport function normalizePhone(input: string): string {\n  return sanitizePhone(input);\n}\n"],"names":[],"mappings":"AAAA,2EAA2E;AAE3E,kFAAkF;;;;;;;;;AAC3E,SAAS,cAAc,KAAa;IACzC,IAAI,UAAU,MAAM,OAAO,CAAC,WAAW;IACvC,IAAI,QAAQ,QAAQ,CAAC,MAAM;QACzB,MAAM,YAAY,QAAQ,OAAO,CAAC;QAClC,UAAU,MAAM,QAAQ,KAAK,CAAC,YAAY,GAAG,OAAO,CAAC,OAAO;IAC9D;IACA,OAAO;AACT;AAGO,SAAS,aAAa,KAAa;IACxC,MAAM,QAAQ,cAAc;IAC5B,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAGO,SAAS,eAAe,KAAa;IAC1C,OAAO,cAAc;AACvB"}},
    {"offset": {"line": 1445, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/username.ts"],"sourcesContent":["const USERNAME_REGEX = /^[a-z0-9](?:[a-z0-9._]*[a-z0-9])?$/;\n\nexport type UsernameValidation =\n  | { valid: true; normalized: string }\n  | { valid: false; error: string };\n\n/**\n * Remove acentos, espa√ßos e caracteres inv√°lidos, deixando apenas letras, n√∫meros, _ e . (lowercase).\n * Limita a 30 chars e evita que termine/comece em '.'.\n */\nexport function sanitizeUsername(input: string): string {\n  const base = (input ?? \"\")\n    .normalize(\"NFKD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\"); // remove diacr√≠ticos\n  const cleaned = base.replace(/[^A-Za-z0-9._]/g, \"\");\n  const trimmed = cleaned.replace(/^\\.+/, \"\").replace(/\\.+$/, \"\");\n  const collapsedDots = trimmed.replace(/\\.{2,}/g, \".\");\n  return collapsedDots.toLowerCase().slice(0, 30);\n}\n\nexport function validateUsername(raw: string): UsernameValidation {\n  const normalized = sanitizeUsername(raw);\n  if (!normalized || normalized.length < 3 || normalized.length > 30) {\n    return {\n      valid: false,\n      error: \"Escolhe um username entre 3 e 30 caracteres (letras, n√∫meros, _ ou .).\",\n    };\n  }\n  if (!USERNAME_REGEX.test(normalized)) {\n    return {\n      valid: false,\n      error: \"O username s√≥ pode ter letras, n√∫meros, _ e . (sem espa√ßos ou acentos).\",\n    };\n  }\n  if (normalized.includes(\"..\")) {\n    return {\n      valid: false,\n      error: \"O username n√£o pode ter '..' seguido.\",\n    };\n  }\n  return { valid: true, normalized };\n}\n\nexport const USERNAME_RULES_HINT =\n  \"3-30 caracteres, letras ou n√∫meros, opcionalmente _ ou ., sem espa√ßos ou acentos.\";\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,iBAAiB;AAUhB,SAAS,iBAAiB,KAAa;IAC5C,MAAM,OAAO,CAAC,SAAS,EAAE,EACtB,SAAS,CAAC,QACV,OAAO,CAAC,oBAAoB,KAAK,qBAAqB;IACzD,MAAM,UAAU,KAAK,OAAO,CAAC,mBAAmB;IAChD,MAAM,UAAU,QAAQ,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ;IAC5D,MAAM,gBAAgB,QAAQ,OAAO,CAAC,WAAW;IACjD,OAAO,cAAc,WAAW,GAAG,KAAK,CAAC,GAAG;AAC9C;AAEO,SAAS,iBAAiB,GAAW;IAC1C,MAAM,aAAa,iBAAiB;IACpC,IAAI,CAAC,cAAc,WAAW,MAAM,GAAG,KAAK,WAAW,MAAM,GAAG,IAAI;QAClE,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,IAAI,CAAC,eAAe,IAAI,CAAC,aAAa;QACpC,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,IAAI,WAAW,QAAQ,CAAC,OAAO;QAC7B,OAAO;YACL,OAAO;YACP,OAAO;QACT;IACF;IACA,OAAO;QAAE,OAAO;QAAM;IAAW;AACnC;AAEO,MAAM,sBACX"}},
    {"offset": {"line": 1491, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkout/Step2Pagamento.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport {\n  Elements,\n  PaymentElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\nimport {\n  loadStripe,\n  type Appearance,\n  type StripeElementsOptions,\n} from \"@stripe/stripe-js\";\nimport { type CheckoutBreakdown, useCheckout } from \"./contextoCheckout\";\nimport { supabaseBrowser } from \"@/lib/supabaseBrowser\";\nimport { isValidPhone, sanitizePhone } from \"@/lib/phone\";\nimport { sanitizeUsername, validateUsername } from \"@/lib/username\";\nimport { createPurchaseId } from \"@/lib/checkoutSchemas\";\n\nfunction isValidEmail(email: string) {\n  return /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/.test(email);\n}\n\nfunction formatMoney(cents: number, currency = \"EUR\") {\n  return new Intl.NumberFormat(\"pt-PT\", {\n    style: \"currency\",\n    currency,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(cents / 100);\n}\n\nfunction buildClientFingerprint(input: unknown) {\n  try {\n    return JSON.stringify(input);\n  } catch {\n    // Fallback muito raro (ex.: objeto circular) ‚Äî usamos um valor que for√ßa refresh.\n    return `fp_${Date.now()}`;\n  }\n}\n\ntype CheckoutItem = {\n  ticketId: number;\n  quantity: number;\n};\nconst scenarioCopy: Record<string, string> = {\n  GROUP_SPLIT: \"Est√°s a pagar apenas a tua parte desta dupla.\",\n  GROUP_FULL: \"Est√°s a comprar 2 lugares (tu + parceiro).\",\n  RESALE: \"Est√°s a comprar um bilhete em revenda.\",\n  FREE_CHECKOUT: \"Evento gratuito ‚Äî s√≥ para utilizadores com conta e username.\",\n};\n\ntype CheckoutWave = {\n  id: number | string;\n  price: number;\n};\n\ntype CheckoutData = {\n  slug?: string;\n  waves?: CheckoutWave[];\n  additional?: {\n    quantidades?: Record<string, number>;\n    total?: number;\n    guestName?: string;\n    guestEmail?: string;\n    guestPhone?: string | null;\n    idempotencyKey?: string;\n    purchaseId?: string | null;\n    requiresAuth?: boolean;\n  };\n  paymentScenario?: string | null;\n};\n\ntype GuestInfo = {\n  name: string;\n  email: string;\n  phone?: string;\n};\n\nconst FREE_PLACEHOLDER_INTENT_ID = \"FREE_CHECKOUT\";\n\nexport default function Step2Pagamento() {\n  const { dados, irParaPasso, atualizarDados, breakdown, setBreakdown } = useCheckout();\n\n  const [clientSecret, setClientSecret] = useState<string | null>(null);\n  const [serverAmount, setServerAmount] = useState<number | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // üîê Auth state\n  const [authChecked, setAuthChecked] = useState(false);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [authChecking, setAuthChecking] = useState(true);\n  // Preferimos convidado por defeito para reduzir fric√ß√£o\n  const [purchaseMode, setPurchaseMode] = useState<\"auth\" | \"guest\">(\"guest\");\n  const [authInfo, setAuthInfo] = useState<string | null>(null);\n  const [guestErrors, setGuestErrors] = useState<{ name?: string; email?: string; phone?: string }>({});\n  const persistedIdemKeyRef = useRef<string | null>(null);\n\n  // üë§ Guest form state\n  const [guestName, setGuestName] = useState(\"\");\n  const [guestEmail, setGuestEmail] = useState(\"\");\n  const [guestEmailConfirm, setGuestEmailConfirm] = useState(\"\");\n  const [guestPhone, setGuestPhone] = useState(\"\");\n  const [guestSubmitVersion, setGuestSubmitVersion] = useState(0);\n  const [promoInput, setPromoInput] = useState(\"\");\n  const [promoCode, setPromoCode] = useState(\"\");\n  const [appliedDiscount, setAppliedDiscount] = useState<number>(0);\n  const [promoWarning, setPromoWarning] = useState<string | null>(null);\n  const [appliedPromoLabel, setAppliedPromoLabel] = useState<string | null>(null);\n  const lastIntentKeyRef = useRef<string | null>(null);\n  const inFlightIntentRef = useRef<string | null>(null);\n  const ensuredIdemKeyRef = useRef(false);\n  const lastClearedFingerprintRef = useRef<string | null>(null);\n  const idempotencyMismatchCountRef = useRef(0);\n  const loadErrorCountRef = useRef(0);\n  const [cachedIntent, setCachedIntent] = useState<{\n    key: string;\n    clientSecret: string | null;\n    amount: number | null;\n    breakdown: CheckoutBreakdown;\n    discount: number;\n    freeCheckout: boolean;\n    paymentScenario?: string | null;\n    promoLabel?: string | null;\n    autoAppliedPromo?: boolean;\n    purchaseId?: string | null;\n  } | null>(null);\n\n  const safeDados: CheckoutData | null =\n    dados && typeof dados === \"object\" ? (dados as CheckoutData) : null;\n  const scenario = safeDados?.paymentScenario ?? cachedIntent?.paymentScenario ?? null;\n  const isFreeScenario = scenario === \"FREE_CHECKOUT\";\n  const needsStripe = !isFreeScenario;\n  const pairingId =\n    safeDados?.additional && typeof safeDados.additional === \"object\"\n      ? (safeDados.additional as Record<string, unknown>).pairingId\n      : undefined;\n  const pairingSlotId =\n    safeDados?.additional && typeof safeDados.additional === \"object\"\n      ? (safeDados.additional as Record<string, unknown>).pairingSlotId\n      : undefined;\n  const pairingTicketTypeId =\n    safeDados?.additional && typeof safeDados.additional === \"object\"\n      ? (safeDados.additional as Record<string, unknown>).ticketTypeId\n      : undefined;\n  const inviteToken =\n    safeDados?.additional && typeof safeDados.additional === \"object\"\n      ? (safeDados.additional as Record<string, unknown>).inviteToken\n      : undefined;\n\n  const additionalForRules =\n    safeDados?.additional && typeof safeDados.additional === \"object\"\n      ? safeDados.additional\n      : {};\n\n  // Regras de acesso ao checkout:\n  // - FREE_CHECKOUT: sempre com conta\n  // - GROUP_SPLIT: por defeito exige conta (capit√£o a pagar a sua parte)\n  // - Podemos for√ßar via additional.requiresAuth (SSOT no futuro)\n  const requiresAuth =\n    Boolean((additionalForRules as Record<string, unknown>)?.requiresAuth) ||\n    isFreeScenario ||\n    scenario === \"GROUP_SPLIT\";\n\n  useEffect(() => {\n    if (!safeDados) return;\n    if (ensuredIdemKeyRef.current) return;\n\n    const additional =\n      safeDados.additional && typeof safeDados.additional === \"object\"\n        ? (safeDados.additional as Record<string, unknown>)\n        : {};\n\n    const existing =\n      typeof additional.idempotencyKey === \"string\" && additional.idempotencyKey.trim()\n        ? additional.idempotencyKey.trim()\n        : null;\n\n    if (!existing) {\n      ensuredIdemKeyRef.current = true;\n      try {\n        atualizarDados({\n          additional: {\n            ...(safeDados?.additional ?? {}),\n            idempotencyKey: crypto.randomUUID(),\n          },\n        });\n      } catch {\n        // Se por algum motivo falhar (ambiente sem crypto), n√£o bloqueamos o checkout\n      }\n      return;\n    }\n\n    ensuredIdemKeyRef.current = true;\n  }, [safeDados, atualizarDados]);\n\n  useEffect(() => {\n    if (!promoCode.trim()) {\n      setAppliedDiscount(0);\n    }\n  }, [promoCode]);\n\n  useEffect(() => {\n    if (requiresAuth && purchaseMode !== \"auth\") {\n      setPurchaseMode(\"auth\");\n      setClientSecret(null);\n      setServerAmount(null);\n    }\n  }, [requiresAuth, purchaseMode]);\n\n\n  const stripePromise = useMemo(() => {\n    // FREE_CHECKOUT n√£o precisa de Stripe no cliente.\n    if (!needsStripe) return null;\n    const key = process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY;\n    if (!key) return null;\n    return loadStripe(key);\n  }, [needsStripe]);\n\n  useEffect(() => {\n    if (needsStripe && !stripePromise) {\n      setError(\"Configura√ß√£o de pagamentos indispon√≠vel. Tenta novamente mais tarde.\");\n      setLoading(false);\n    }\n  }, [stripePromise, needsStripe]);\n\n  // Primeiro: verificar se h√° sess√£o Supabase no browser e ficar a escutar mudan√ßas de auth\n  useEffect(() => {\n    let cancelled = false;\n\n    async function checkAuthOnce() {\n      try {\n        setAuthChecking(true);\n        const { data, error } = await supabaseBrowser.auth.getUser();\n\n        if (cancelled) return;\n\n        if (error || !data?.user) {\n          setUserId(null);\n          if (error) {\n            setAuthInfo(\"Sess√£o n√£o encontrada. Inicia sess√£o ou continua como convidado.\");\n          }\n        } else {\n          setUserId(data.user.id);\n          setAuthInfo(null);\n        }\n      } catch (err) {\n        console.error(\"[Step2Pagamento] Erro ao verificar auth inicial:\", err);\n        if (!cancelled) {\n          setUserId(null);\n          setAuthInfo(\"Sess√£o n√£o encontrada. Inicia sess√£o ou continua como convidado.\");\n        }\n      } finally {\n        if (!cancelled) {\n          setAuthChecked(true);\n          setAuthChecking(false);\n        }\n      }\n    }\n\n    checkAuthOnce();\n\n    const {\n      data: { subscription },\n    } = supabaseBrowser.auth.onAuthStateChange((_event, session) => {\n      if (cancelled) return;\n\n      if (session?.user) {\n        setUserId(session.user.id);\n        setAuthChecked(true);\n        setAuthChecking(false);\n        setAuthInfo(null);\n      } else {\n        setUserId(null);\n        setAuthChecked(true);\n        setAuthChecking(false);\n        setAuthInfo(\"Sess√£o n√£o encontrada. Inicia sess√£o ou continua como convidado.\");\n      }\n    });\n\n    return () => {\n      cancelled = true;\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  // Se vierem dados pr√©-preenchidos (ex.: voltar atr√°s), sincronizamos com o estado local do guest\n  useEffect(() => {\n    const additional =\n      safeDados?.additional && typeof safeDados.additional === \"object\"\n        ? safeDados.additional\n        : {};\n    if (typeof additional.guestName === \"string\") {\n      setGuestName(additional.guestName);\n    }\n    if (typeof additional.guestEmail === \"string\") {\n      setGuestEmail(additional.guestEmail);\n    }\n    if (typeof (additional as Record<string, unknown>)?.guestEmailConfirm === \"string\") {\n      setGuestEmailConfirm((additional as Record<string, string>).guestEmailConfirm);\n    }\n    if (typeof additional.guestPhone === \"string\") {\n      setGuestPhone(additional.guestPhone);\n    }\n  }, [safeDados]);\n\n  const payload = useMemo(() => {\n    if (!safeDados) return null;\n\n    const waves = Array.isArray(safeDados.waves) ? safeDados.waves : [];\n    const additional =\n      safeDados.additional && typeof safeDados.additional === \"object\"\n        ? safeDados.additional\n        : {};\n\n    const quantidades: Record<string, number> =\n      (additional.quantidades as Record<string, number> | undefined) ?? {};\n\n    if (!safeDados.slug || waves.length === 0) return null;\n\n    const items: CheckoutItem[] = (waves\n      .map((w) => {\n        const qty = quantidades[w.id] ?? 0;\n        if (!qty || qty <= 0) return null;\n        const ticketId = Number(w.id);\n        if (!Number.isFinite(ticketId)) return null;\n        return { ticketId, quantity: qty };\n      })\n      .filter(Boolean) as CheckoutItem[])\n      .sort((a, b) => a.ticketId - b.ticketId);\n\n    if (items.length === 0) return null;\n\n    const totalFromStep1 =\n      typeof additional.total === \"number\" ? additional.total : null;\n\n    // IdempotencyKey est√°vel: reutiliza a existente; se n√£o houver, gera apenas uma vez\n    let idemKey: string | undefined =\n      (safeDados?.additional as Record<string, unknown> | undefined)?.idempotencyKey as string | undefined;\n    if (!idemKey || !idemKey.trim()) {\n      if (!persistedIdemKeyRef.current) {\n        try {\n          persistedIdemKeyRef.current = crypto.randomUUID();\n        } catch {\n          persistedIdemKeyRef.current = `idem-${Date.now()}`;\n        }\n      }\n      idemKey = persistedIdemKeyRef.current ?? undefined;\n    } else {\n      persistedIdemKeyRef.current = idemKey;\n    }\n    const purchaseId = undefined;\n\n    return {\n      slug: safeDados.slug,\n      items,\n      total: totalFromStep1,\n      promoCode: promoCode.trim() || undefined,\n      paymentScenario: safeDados.paymentScenario ?? undefined,\n      requiresAuth,\n      idempotencyKey: idemKey,\n      purchaseId: purchaseId || undefined,\n      pairingId: typeof pairingId === \"number\" ? pairingId : undefined,\n      slotId: typeof pairingSlotId === \"number\" ? pairingSlotId : undefined,\n      ticketTypeId: typeof pairingTicketTypeId === \"number\" ? pairingTicketTypeId : undefined,\n      eventId: safeDados.eventId ? Number(safeDados.eventId) : undefined,\n      inviteToken: typeof inviteToken === \"string\" && inviteToken.trim() ? inviteToken.trim() : undefined,\n    };\n  }, [safeDados, promoCode, requiresAuth]);\n\n  // Garante idempotencyKey persistida no contexto para estabilizar intentKey e evitar re-renders infinitos\n  useEffect(() => {\n    if (!safeDados) return;\n    const additionalObj =\n      safeDados.additional && typeof safeDados.additional === \"object\"\n        ? (safeDados.additional as Record<string, unknown>)\n        : {};\n    const existing =\n      typeof additionalObj.idempotencyKey === \"string\" && additionalObj.idempotencyKey.trim()\n        ? additionalObj.idempotencyKey.trim()\n        : null;\n\n    if (existing) {\n      persistedIdemKeyRef.current = existing;\n      return;\n    }\n\n    let newKey = persistedIdemKeyRef.current;\n    if (!newKey) {\n      try {\n        newKey = crypto.randomUUID();\n      } catch {\n        newKey = `idem-${Date.now()}`;\n      }\n      persistedIdemKeyRef.current = newKey;\n    }\n\n    atualizarDados({\n      additional: {\n        ...(safeDados.additional as Record<string, unknown> | undefined),\n        idempotencyKey: newKey,\n      },\n    });\n  }, [safeDados, atualizarDados]);\n\n  const checkUsernameAvailability = async (value: string) => {\n    const cleaned = sanitizeUsername(value);\n    const validation = validateUsername(cleaned);\n    if (!validation.valid) {\n      setError(validation.error);\n      return { ok: false, username: cleaned };\n    }\n    try {\n      const res = await fetch(`/api/username/check?username=${encodeURIComponent(cleaned)}`);\n      const json = await res.json().catch(() => null);\n      if (!res.ok || json?.available === false) {\n        setError(\"Esse @ j√° est√° a ser usado.\");\n        return { ok: false, username: cleaned };\n      }\n      return { ok: true, username: validation.normalized };\n    } catch (err) {\n      console.error(\"[Step2Pagamento] erro a verificar username\", err);\n      setError(\"N√£o foi poss√≠vel verificar o username. Tenta novamente.\");\n      return { ok: false, username: cleaned };\n    }\n  };\n\n  useEffect(() => {\n    // Se n√£o houver dados de checkout, mandamos de volta\n    if (!payload) {\n      irParaPasso(1);\n      return;\n    }\n\n    if (needsStripe && !stripePromise) return;\n    // Enquanto n√£o sabemos se est√° logado, n√£o fazemos nada\n    if (!authChecked) return;\n\n    const isGuestFlow = purchaseMode === \"guest\";\n    const hasGuestSubmission = guestSubmitVersion > 0;\n    const guestNameClean = guestName.trim();\n    const guestEmailClean = guestEmail.trim();\n    const guestPhoneClean = guestPhone.trim();\n    const guestReady =\n      isGuestFlow && hasGuestSubmission && guestNameClean !== \"\" && guestEmailClean !== \"\";\n\n    // Se n√£o est√° logado e ainda n√£o escolheu convidado, mostramos UI e n√£o chamamos a API\n    if (!userId && !guestReady) {\n      setLoading(false);\n      setClientSecret(null);\n      setServerAmount(null);\n      return;\n    }\n\n    const guestPayload: GuestInfo | null = guestReady\n      ? {\n          name: guestNameClean,\n          email: guestEmailClean,\n          phone: guestPhoneClean || undefined,\n        }\n      : null;\n\n    const clientFingerprint = buildClientFingerprint({\n      slug: payload.slug,\n      items: payload.items,\n      total: payload.total ?? null,\n      promoCode: payload.promoCode ?? null,\n      paymentScenario: payload.paymentScenario ?? null,\n      requiresAuth,\n      mode: purchaseMode,\n      userId: userId ?? null,\n      guest: guestPayload\n        ? {\n            name: guestPayload.name,\n            email: guestPayload.email,\n            phone: guestPayload.phone ?? null,\n          }\n        : null,\n    });\n\n    const additionalObj =\n      safeDados?.additional && typeof safeDados.additional === \"object\"\n        ? (safeDados.additional as Record<string, unknown>)\n        : {};\n\n    const existingClientFingerprint =\n      typeof (additionalObj as any).clientFingerprint === \"string\"\n        ? String((additionalObj as any).clientFingerprint)\n        : null;\n\n    const currentIdempotencyKey =\n      (safeDados?.additional as Record<string, unknown> | undefined)?.idempotencyKey ??\n      (payload as any)?.idempotencyKey ??\n      null;\n\n    const existingIntentFingerprint =\n      typeof (additionalObj as any).intentFingerprint === \"string\"\n        ? String((additionalObj as any).intentFingerprint)\n        : null;\n\n    const hasExistingPurchaseState = Boolean(\n      (additionalObj as any).purchaseId || (additionalObj as any).paymentIntentId || (additionalObj as any).freeCheckout,\n    );\n\n    // Se o utilizador alterou o checkout (items/promo/guest/mode/etc.) mas ainda temos um purchaseId antigo,\n    // limpamos o estado para n√£o reutilizar o PaymentIntent errado (caso cl√°ssico: aplicar/remover promo e n√£o recalcular).\n    if (\n      hasExistingPurchaseState &&\n      existingClientFingerprint &&\n      existingClientFingerprint !== clientFingerprint &&\n      lastClearedFingerprintRef.current !== clientFingerprint\n    ) {\n      lastClearedFingerprintRef.current = clientFingerprint;\n\n      // Limpeza local imediata para evitar UI/states inconsistentes\n      setCachedIntent(null);\n      setClientSecret(null);\n      setServerAmount(null);\n      setBreakdown(null);\n      lastIntentKeyRef.current = null;\n      inFlightIntentRef.current = null;\n\n      let nextIdemKey: string | undefined;\n      try {\n        nextIdemKey = crypto.randomUUID();\n      } catch {\n        nextIdemKey = undefined;\n      }\n\n      atualizarDados({\n        additional: {\n          ...(safeDados?.additional ?? {}),\n          purchaseId: null,\n          paymentIntentId: undefined,\n          freeCheckout: undefined,\n          appliedPromoLabel: undefined,\n          // clientFingerprint √© s√≥ para o FE detetar mudan√ßas\n          clientFingerprint,\n          // intentFingerprint √© do BE (hash). Ao mudar sele√ß√£o, limpamos.\n          intentFingerprint: undefined,\n          idempotencyKey: nextIdemKey ?? (additionalObj as any).idempotencyKey,\n        },\n      });\n\n      setLoading(false);\n      return;\n    }\n\n    // Backfill: se j√° existe purchaseId mas ainda n√£o guard√°mos fingerprint, guardamos para futuras compara√ß√µes.\n    if (hasExistingPurchaseState && !existingClientFingerprint) {\n      atualizarDados({\n        additional: {\n          ...(safeDados?.additional ?? {}),\n          clientFingerprint,\n        },\n      });\n    }\n\n    // Chave est√°vel para n√£o recriar PaymentIntent sem necessidade\n    const intentKey = JSON.stringify({\n      payload,\n      guest: guestPayload,\n      userId: userId ?? \"guest\",\n      mode: purchaseMode,\n      scenario: safeDados?.paymentScenario ?? null,\n      clientFingerprint,\n      idempotencyKey: currentIdempotencyKey,\n      purchaseId:\n        (payload as any)?.purchaseId ??\n        (safeDados?.additional as any)?.purchaseId ??\n        null,\n    });\n\n    // Se j√° temos um intent em cache com a mesma key, reaproveitamos\n    if (cachedIntent?.key === intentKey) {\n      setClientSecret(cachedIntent.clientSecret);\n      setServerAmount(cachedIntent.amount);\n      setBreakdown(cachedIntent.breakdown);\n      setAppliedDiscount(cachedIntent.discount);\n      setAppliedPromoLabel(cachedIntent.promoLabel ?? null);\n      lastIntentKeyRef.current = intentKey;\n      setLoading(false);\n      if (cachedIntent.freeCheckout) {\n        irParaPasso(3);\n        return;\n      }\n      return;\n    }\n\n    // Se j√° temos clientSecret para o mesmo payload, n√£o refazemos\n    if (clientSecret && lastIntentKeyRef.current === intentKey) {\n      setLoading(false);\n      return;\n    }\n\n    // Evita requests paralelos com o mesmo payload; se detectarmos que estamos presos\n    // (ex.: Strict Mode cancela a primeira run e deixa loading a true), limpamos o ref\n    // para voltar a tentar.\n    if (inFlightIntentRef.current === intentKey) {\n      const stuck =\n        loading &&\n        !clientSecret &&\n        lastIntentKeyRef.current !== intentKey;\n      if (!stuck) {\n        return;\n      }\n      inFlightIntentRef.current = null;\n    }\n\n    let cancelled = false;\n\n    async function createIntent() {\n      try {\n        inFlightIntentRef.current = intentKey;\n        setLoading(true);\n        setError(null);\n        setBreakdown(null);\n\n        console.log(\n          \"[Step2Pagamento] A enviar payload para /api/payments/intent:\",\n          payload,\n        );\n\n        const idem =\n          (safeDados?.additional as Record<string, unknown> | undefined)?.idempotencyKey ??\n          (payload as any)?.idempotencyKey ??\n          null;\n\n        let attempt = 0;\n        // N√£o enviamos purchaseId; o backend calcula anchors determin√≠sticas. idempotencyKey segue para evitar PI terminal.\n        let currentPayload = { ...payload };\n        delete (currentPayload as any).purchaseId;\n        let currentIntentFingerprint = undefined;\n        let res: Response | null = null;\n        let data: any = null;\n        let handled409 = false;\n\n        while (attempt < 2) {\n          res = await fetch(\"/api/payments/intent\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n              ...currentPayload,\n              guest: guestPayload ?? undefined,\n              requiresAuth,\n              purchaseId: null,\n              idempotencyKey: idem,\n              intentFingerprint: currentIntentFingerprint ?? undefined,\n            }),\n          });\n\n          data = await res.json().catch(() => null);\n\n          if (res.status === 409) {\n            handled409 = true;\n            attempt += 1;\n            // Reset total: limpar caches e fazer um retry sem anchors pr√≥prias.\n            currentPayload = { ...payload };\n            delete (currentPayload as any).purchaseId;\n            currentIntentFingerprint = undefined;\n\n            if (!cancelled) {\n              setCachedIntent(null);\n              setClientSecret(null);\n              setServerAmount(null);\n              setBreakdown(null);\n              lastIntentKeyRef.current = null;\n              inFlightIntentRef.current = null;\n              try {\n                atualizarDados({\n                  additional: {\n                    ...(safeDados?.additional ?? {}),\n                    purchaseId: null,\n                    paymentIntentId: undefined,\n                    freeCheckout: undefined,\n                    appliedPromoLabel: undefined,\n                    clientFingerprint,\n                    intentFingerprint: undefined,\n                    idempotencyKey: undefined,\n                  },\n                });\n              } catch {}\n            }\n            continue;\n          }\n\n          // status != 409 ‚ûú sair do loop\n          break;\n        }\n\n        if (!data || typeof data !== \"object\") {\n          if (!cancelled) {\n            setBreakdown(null);\n            setError(\"Resposta inv√°lida do servidor. Tenta novamente.\");\n          }\n          return;\n        }\n        console.log(\"[Step2Pagamento] Resposta de /api/payments/intent:\", {\n          status: res.status,\n          ok: res.ok,\n          data,\n        });\n\n        const respCode = typeof data?.code === \"string\" ? data.code : null;\n\n        // 409 ‚ûú idempotencyKey reutilizada com payload diferente (prote√ß√£o contra intents errados/duplicados)\n        if (res.status === 409) {\n          if (!cancelled) {\n            // Reset total para for√ßar recalcular (idempotencyKey + purchaseId + PI state)\n            setCachedIntent(null);\n            setClientSecret(null);\n            setServerAmount(null);\n            setBreakdown(null);\n            lastIntentKeyRef.current = null;\n            inFlightIntentRef.current = null;\n\n            let nextIdemKey: string | undefined;\n            try {\n              nextIdemKey = crypto.randomUUID();\n            } catch {\n              nextIdemKey = undefined;\n            }\n\n            try {\n              atualizarDados({\n                additional: {\n                  ...(safeDados?.additional ?? {}),\n                  purchaseId: null,\n                  paymentIntentId: undefined,\n                  freeCheckout: undefined,\n                  appliedPromoLabel: undefined,\n                  clientFingerprint,\n                  intentFingerprint: undefined,\n                  idempotencyKey: nextIdemKey,\n                },\n              });\n            } catch {}\n\n            // For√ßa novo ciclo de prepara√ß√£o (especialmente √∫til em guest flow)\n            setGuestSubmitVersion((v) => v + 1);\n            setPromoWarning(\n              typeof (data as any)?.error === \"string\"\n                ? (data as any).error\n                : \"O teu checkout mudou e estamos a recalcular o pagamento‚Ä¶\",\n            );\n            setError(null);\n          }\n          return;\n        }\n\n        // Se a API disser 401 ‚ûú sess√£o ausente/expirada OU cen√°rio que exige auth\n        if (res.status === 401) {\n          const mustAuth =\n            requiresAuth ||\n            respCode === \"AUTH_REQUIRED_FOR_GROUP_SPLIT\" ||\n            respCode === \"AUTH_REQUIRED\";\n\n          if (!cancelled) {\n            // Garantimos estado limpo para permitir retry correto\n            setClientSecret(null);\n            setServerAmount(null);\n            setBreakdown(null);\n            setCachedIntent(null);\n          }\n\n          if (mustAuth) {\n            if (!cancelled) {\n              setPurchaseMode(\"auth\");\n              setGuestSubmitVersion(0);\n              setGuestErrors({});\n              setError(null);\n              const freeCopy =\n                respCode === \"AUTH_REQUIRED_FOR_GROUP_SPLIT\"\n                  ? \"Para pagar apenas a tua parte tens de iniciar sess√£o.\"\n                  : isFreeScenario\n                    ? \"Checkouts gratuitos exigem conta com username. Cria conta ou entra para continuar.\"\n                    : \"Este tipo de checkout requer sess√£o iniciada.\";\n              setAuthInfo(freeCopy);\n            }\n            return;\n          }\n\n          // Guest permitido, mas algo correu mal (ex.: backend rejeitou por sess√£o)\n          if (!cancelled) {\n            setError(\n              typeof data?.error === \"string\"\n                ? data.error\n                : \"Sess√£o expirada. Tenta novamente.\"\n            );\n          }\n          return;\n        }\n\n        // 403 ‚ûú utilizador autenticado mas falta username (free checkout)\n        if (res.status === 403 && respCode === \"USERNAME_REQUIRED\") {\n          if (!cancelled) {\n            setPurchaseMode(\"auth\");\n            setGuestSubmitVersion(0);\n            setGuestErrors({});\n            setError(null);\n            setAuthInfo(\"Define um username na tua conta para concluir este checkout gratuito.\");\n          }\n          return;\n        }\n\n        if (!res.ok || !data?.ok) {\n          setBreakdown(null);\n\n          const respCode = typeof data?.code === \"string\" ? data.code : null;\n          const retryable = typeof data?.retryable === \"boolean\" ? data.retryable : null;\n          const nextAction =\n            typeof data?.nextAction === \"string\" && data.nextAction\n              ? data.nextAction\n              : null;\n\n          if (respCode === \"IDEMPOTENCY_KEY_PAYLOAD_MISMATCH\") {\n            if (!cancelled) {\n              // Limita a 1 retentativa local para evitar loops de 409\n              if (idempotencyMismatchCountRef.current >= 1) {\n                setError(\n                  typeof data?.error === \"string\"\n                    ? data.error\n                    : \"O checkout mudou noutro separador. Volta ao passo anterior ou recarrega a p√°gina e tenta de novo.\",\n                );\n                setSubmitting(false);\n                setLoading(false);\n                return;\n              }\n              idempotencyMismatchCountRef.current += 1;\n\n              // Limpa estado local para for√ßar novo intent (sem reusar idempotency antiga)\n              setClientSecret(null);\n              setServerAmount(null);\n              setBreakdown(null);\n              setCachedIntent(null);\n              lastIntentKeyRef.current = null;\n              inFlightIntentRef.current = null;\n\n              try {\n                atualizarDados({\n                  additional: {\n                    ...(safeDados?.additional ?? {}),\n                    purchaseId: null,\n                    paymentIntentId: undefined,\n                    idempotencyKey: undefined,\n                    intentFingerprint: undefined,\n                    clientFingerprint,\n                    freeCheckout: undefined,\n                    appliedPromoLabel: undefined,\n                  },\n                });\n              } catch {}\n\n              setError(\n                typeof data?.error === \"string\"\n                  ? data.error\n                  : \"O checkout foi aberto noutro separador. Recri√°mos o pagamento; volta a clicar em Pagar.\",\n              );\n              // N√£o re-submete automaticamente; utilizador volta a clicar\n            }\n            return;\n          }\n\n          if (respCode === \"USERNAME_REQUIRED_FOR_FREE\") {\n            if (!cancelled) {\n              setError(\"Este evento gratuito requer sess√£o com username definido.\");\n              setPurchaseMode(\"auth\");\n              setAuthInfo(\n                \"Inicia sess√£o e define um username para concluir a inscri√ß√£o gratuita.\",\n              );\n            }\n            return;\n          }\n\n          if (respCode === \"INVITE_REQUIRED\") {\n            if (!cancelled) {\n              setError(\"Este evento √© apenas por convite.\");\n              const inviteCopy = userId\n                ? \"O teu acesso n√£o est√° na lista. Confirma o email/username convidado.\"\n                : \"Inicia sess√£o com a conta convidada ou usa o email do convite.\";\n              setAuthInfo(inviteCopy);\n            }\n            return;\n          }\n\n          const msg =\n            respCode === \"PRICE_CHANGED\"\n              ? \"Os pre√ßos foram atualizados. Rev√™ a sele√ß√£o e tenta novamente.\"\n              : respCode === \"INSUFFICIENT_STOCK\"\n                ? \"Stock insuficiente para um dos bilhetes.\"\n                : typeof data?.error === \"string\"\n                  ? data.error\n                  : \"N√£o foi poss√≠vel preparar o pagamento.\";\n\n          if (respCode === \"ORGANIZER_STRIPE_NOT_CONNECTED\") {\n            if (!cancelled) {\n              setError(\n                data?.message ||\n                  \"Pagamentos desativados para este evento enquanto o organizador n√£o ligar a Stripe.\",\n              );\n              setAuthInfo(\"Liga a Stripe em Finan√ßas & Payouts para ativares pagamentos.\");\n            }\n            return;\n          }\n\n          const promoFail =\n            payload?.promoCode &&\n            typeof data?.error === \"string\" &&\n            data.error.toLowerCase().includes(\"c√≥digo\");\n\n          if (promoFail && !cancelled) {\n            setPromoWarning(\"C√≥digo n√£o aplicado. Continuas sem desconto.\");\n            setPromoCode(\"\");\n            setAppliedDiscount(0);\n            setAppliedPromoLabel(null);\n            setError(null);\n            setBreakdown(null);\n            return;\n          }\n\n          if (!cancelled) {\n            setError(\n              respCode === \"PRICE_CHANGED\"\n                ? \"Os pre√ßos mudaram. Volta ao passo anterior e rev√™ a sele√ß√£o.\"\n                : respCode === \"INSUFFICIENT_STOCK\"\n                  ? \"Stock insuficiente. Remove itens esgotados e tenta novamente.\"\n                  : nextAction === \"PAY_NOW\" && retryable\n                    ? \"Precisamos de novo pagamento para continuar.\"\n                    : msg,\n            );\n\n            if (respCode === \"PRICE_CHANGED\" || respCode === \"INSUFFICIENT_STOCK\") {\n              setPromoWarning(null);\n              setBreakdown(null);\n              setClientSecret(null);\n              setServerAmount(null);\n            }\n          }\n          return;\n        }\n\n        if (!cancelled) {\n          const paymentScenarioResponse =\n            typeof data?.paymentScenario === \"string\"\n              ? data.paymentScenario\n              : safeDados?.paymentScenario ?? null;\n          const purchaseIdFromServer = typeof data?.purchaseId === \"string\" ? data.purchaseId : undefined;\n          const responseIntentFingerprint =\n            typeof data?.intentFingerprint === \"string\" ? data.intentFingerprint : null;\n          const responseIdemKey =\n            typeof data?.idempotencyKey === \"string\" && data.idempotencyKey.trim()\n              ? data.idempotencyKey.trim()\n              : null;\n\n          const effectiveIntentFingerprint = responseIntentFingerprint ?? existingIntentFingerprint ?? undefined;\n\n          // S√≥ fazemos backfill da idempotencyKey se por algum motivo ainda n√£o existir localmente.\n          const localIdem =\n            typeof (safeDados?.additional as Record<string, unknown> | undefined)?.idempotencyKey === \"string\" &&\n            String((safeDados?.additional as Record<string, unknown>).idempotencyKey).trim()\n              ? String((safeDados?.additional as Record<string, unknown>).idempotencyKey).trim()\n              : null;\n          const effectiveIdemKey = localIdem ?? responseIdemKey;\n\n          const promoLabel =\n            promoCode?.trim()\n              ? promoCode.trim()\n              : data.discountCents && data.discountCents > 0\n                ? \"Promo autom√°tica\"\n                : null;\n          const isAutoAppliedPromo = !promoCode?.trim() && Boolean(promoLabel);\n          const breakdownFromResponse =\n            data.breakdown && typeof data.breakdown === \"object\"\n              ? (data.breakdown as CheckoutBreakdown)\n              : null;\n          const discountCentsNumber =\n            typeof data.discountCents === \"number\"\n              ? data.discountCents\n              : typeof breakdownFromResponse?.discountCents === \"number\"\n                ? breakdownFromResponse.discountCents\n                : 0;\n          const subtotalCentsNumber =\n            typeof breakdownFromResponse?.subtotalCents === \"number\"\n              ? breakdownFromResponse.subtotalCents\n              : null;\n          const platformFeeCentsNumber =\n            typeof breakdownFromResponse?.platformFeeCents === \"number\"\n              ? breakdownFromResponse.platformFeeCents\n              : null;\n          const platformFeeCombinedCentsNumber =\n            typeof (breakdownFromResponse as any)?.platformFeeCombinedCents === \"number\"\n              ? (breakdownFromResponse as any).platformFeeCombinedCents\n              : platformFeeCentsNumber;\n          const platformFeeOryaCentsNumber =\n            typeof (breakdownFromResponse as any)?.platformFeeOryaCents === \"number\"\n              ? (breakdownFromResponse as any).platformFeeOryaCents\n              : platformFeeCentsNumber;\n          const stripeFeeEstimateCentsNumber =\n            typeof (breakdownFromResponse as any)?.stripeFeeEstimateCents === \"number\"\n              ? (breakdownFromResponse as any).stripeFeeEstimateCents\n              : null;\n          const totalCentsNumber =\n            typeof breakdownFromResponse?.totalCents === \"number\"\n              ? breakdownFromResponse.totalCents\n              : typeof data.amount === \"number\"\n                ? data.amount\n                : null;\n          const currencyFromResponse =\n            typeof breakdownFromResponse?.currency === \"string\" ? breakdownFromResponse.currency : undefined;\n\n          const statusFromResponse =\n            typeof data?.status === \"string\" ? data.status.toUpperCase() : null;\n          const nextActionFromResponse =\n            typeof data?.nextAction === \"string\" ? data.nextAction : null;\n          const paymentIntentIdFromResponse =\n            typeof data?.paymentIntentId === \"string\" ? data.paymentIntentId : null;\n\n          if (statusFromResponse === \"FAILED\") {\n            setClientSecret(null);\n            setServerAmount(null);\n            setBreakdown(null);\n            setError(typeof data?.error === \"string\" ? data.error : \"Pagamento falhou.\");\n            return;\n          }\n\n          if (data.freeCheckout || data.isFreeCheckout || statusFromResponse === \"PAID\") {\n            const totalCents = totalCentsNumber ?? 0;\n            setBreakdown(breakdownFromResponse);\n            setAppliedDiscount(discountCentsNumber > 0 ? discountCentsNumber / 100 : 0);\n            setAppliedPromoLabel(promoLabel);\n            setClientSecret(null);\n            setServerAmount(0);\n            atualizarDados({\n              additional: {\n                ...(safeDados?.additional ?? {}),\n                paymentIntentId: paymentIntentIdFromResponse ?? FREE_PLACEHOLDER_INTENT_ID,\n                purchaseId: purchaseIdFromServer,\n                subtotalCents: subtotalCentsNumber ?? undefined,\n                discountCents: discountCentsNumber ?? undefined,\n                platformFeeCents: platformFeeCombinedCentsNumber ?? undefined,\n                platformFeeOryaCents: platformFeeOryaCentsNumber ?? undefined,\n                stripeFeeEstimateCents: stripeFeeEstimateCentsNumber ?? undefined,\n                totalCents: totalCents,\n                currency: currencyFromResponse ?? undefined,\n                total: totalCents / 100,\n                freeCheckout: true,\n                clientFingerprint,\n                intentFingerprint: effectiveIntentFingerprint,\n                idempotencyKey: effectiveIdemKey ?? undefined,\n                promoCode: payload?.promoCode,\n                promoCodeRaw: payload?.promoCode,\n                appliedPromoLabel: promoLabel ?? undefined,\n                paymentScenario: paymentScenarioResponse ?? undefined,\n              },\n            });\n            lastIntentKeyRef.current = intentKey;\n            irParaPasso(3);\n            return;\n          }\n\n          setClientSecret(data.clientSecret as string);\n          setServerAmount(typeof data.amount === \"number\" ? data.amount : null);\n          setBreakdown(breakdownFromResponse);\n          setAppliedDiscount(discountCentsNumber > 0 ? discountCentsNumber / 100 : 0);\n          setAppliedPromoLabel(promoLabel);\n          atualizarDados({\n            paymentScenario: paymentScenarioResponse ?? undefined,\n            additional: {\n              ...(safeDados?.additional ?? {}),\n              clientFingerprint,\n              intentFingerprint: effectiveIntentFingerprint,\n              idempotencyKey: effectiveIdemKey ?? undefined,\n              purchaseId:\n                purchaseIdFromServer ??\n                (safeDados?.additional as Record<string, unknown> | undefined)?.purchaseId ??\n                (payload as any)?.purchaseId,\n              paymentIntentId:\n                paymentIntentIdFromResponse ??\n                safeDados?.additional?.paymentIntentId,\n              subtotalCents: subtotalCentsNumber ?? undefined,\n              discountCents: discountCentsNumber ?? undefined,\n              platformFeeCents: platformFeeCombinedCentsNumber ?? undefined,\n              platformFeeOryaCents: platformFeeOryaCentsNumber ?? undefined,\n              stripeFeeEstimateCents: stripeFeeEstimateCentsNumber ?? undefined,\n              totalCents: totalCentsNumber ?? undefined,\n              currency: currencyFromResponse ?? undefined,\n              promoCode: payload?.promoCode,\n              promoCodeRaw: payload?.promoCode,\n              appliedPromoLabel: promoLabel ?? undefined,\n            },\n          });\n          lastIntentKeyRef.current = intentKey;\n          setCachedIntent({\n            key: intentKey,\n            clientSecret: data.clientSecret as string,\n            amount: typeof data.amount === \"number\" ? data.amount : null,\n            breakdown: breakdownFromResponse,\n            discount: discountCentsNumber > 0 ? discountCentsNumber / 100 : 0,\n            freeCheckout: false,\n            paymentScenario: paymentScenarioResponse,\n            promoLabel,\n            autoAppliedPromo: isAutoAppliedPromo,\n            purchaseId: purchaseIdFromServer ?? null,\n          });\n        }\n      } catch (err) {\n        console.error(\"Erro ao criar PaymentIntent:\", err);\n        if (!cancelled) {\n          setError(\"Erro inesperado ao preparar o pagamento.\");\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n        if (inFlightIntentRef.current === intentKey) {\n          inFlightIntentRef.current = null;\n        }\n      }\n    }\n\n    createIntent();\n\n    return () => {\n      cancelled = true;\n      inFlightIntentRef.current = null;\n    };\n  }, [\n    payload,\n    irParaPasso,\n    authChecked,\n    userId,\n    stripePromise,\n    purchaseMode,\n    guestSubmitVersion,\n    cachedIntent,\n  ]);\n\n  if (!safeDados) {\n    return (\n      <div className=\"p-6 text-sm text-white/70\">\n        Ocorreu um problema com os dados do checkout. Volta atr√°s e tenta de\n        novo.\n      </div>\n    );\n  }\n\n  const additional =\n    safeDados.additional && typeof safeDados.additional === \"object\"\n      ? safeDados.additional\n      : {};\n  const totalFromContext = typeof additional.total === \"number\" ? additional.total : null;\n\n  const breakdownTotal =\n    breakdown && typeof breakdown.totalCents === \"number\" ? breakdown.totalCents / 100 : null;\n\n  const total =\n    breakdownTotal !== null\n      ? breakdownTotal\n      : totalFromContext !== null\n        ? totalFromContext\n        : serverAmount !== null\n          ? serverAmount / 100\n          : null;\n\n  const appearance: Appearance = {\n    theme: \"night\",\n    variables: {\n      colorPrimary: \"#6BFFFF\",\n      colorBackground: \"#0B0F18\",\n      colorText: \"#F7F9FF\",\n      colorDanger: \"#FF5C7A\",\n      fontFamily:\n        \"SF Pro Text, system-ui, -apple-system, BlinkMacSystemFont, sans-serif\",\n      borderRadius: \"14px\",\n    },\n    rules: {\n      \".Input\": {\n        padding: \"14px\",\n        backgroundColor: \"rgba(12,16,26,0.75)\",\n        border: \"1px solid rgba(255,255,255,0.12)\",\n      },\n      \".Label\": {\n        color: \"rgba(255,255,255,0.7)\",\n      },\n      \".Tab\": {\n        backgroundColor: \"rgba(255,255,255,0.06)\",\n        border: \"1px solid rgba(255,255,255,0.1)\",\n      },\n      \".Tab--selected\": {\n        backgroundColor: \"rgba(107,255,255,0.12)\",\n        border: \"1px solid rgba(107,255,255,0.45)\",\n      },\n    },\n  };\n\n  const options: StripeElementsOptions | undefined = clientSecret\n    ? {\n        clientSecret,\n        appearance,\n        // Nota: a lista de m√©todos permitidos √© definida no PaymentIntent (backend).\n      }\n    : undefined;\n\n  const handlePaymentElementError = () => {\n    // Evita loop infinito: s√≥ tentamos regenerar 1x automaticamente\n    if (loadErrorCountRef.current >= 1) return;\n    loadErrorCountRef.current += 1;\n\n    setError(\"Sess√£o de pagamento expirou. Vamos criar um novo intento.\");\n    setLoading(true);\n\n    setCachedIntent(null);\n    setClientSecret(null);\n    setServerAmount(null);\n    setBreakdown(null);\n    lastIntentKeyRef.current = null;\n    inFlightIntentRef.current = null;\n    setGuestSubmitVersion((v) => v + 1);\n\n    let nextIdemKey: string | undefined;\n    try {\n      nextIdemKey = crypto.randomUUID();\n    } catch {\n      nextIdemKey = undefined;\n    }\n\n    atualizarDados({\n      additional: {\n        ...(safeDados?.additional ?? {}),\n        purchaseId: null,\n        paymentIntentId: undefined,\n        freeCheckout: undefined,\n        appliedPromoLabel: safeDados?.additional?.appliedPromoLabel,\n        intentFingerprint: undefined,\n        idempotencyKey: nextIdemKey ?? (safeDados?.additional as any)?.idempotencyKey,\n      },\n    });\n  };\n\n// Callback chamado pelo AuthWall quando o utilizador faz login/cria conta com sucesso\n  const handleAuthenticated = async (newUserId: string) => {\n    setUserId(newUserId);\n    setAuthChecked(true);\n    setAuthChecking(false);\n    setPurchaseMode(\"auth\");\n\n    // Tentar migrar bilhetes de guest para este user (best-effort)\n    // Claim guest ser√° enfileirado depois da compra via /api/me/claim-guest\n  };\n\n  // Callback para continuar como convidado\n  const handleGuestContinue = () => {\n    if (requiresAuth) {\n      setError(\"Este tipo de checkout requer sess√£o iniciada.\");\n      setPurchaseMode(\"auth\");\n      setAuthInfo(\"Inicia sess√£o para continuar.\");\n      return;\n    }\n    setError(null);\n    const localErrors: { name?: string; email?: string; phone?: string } = {};\n    if (!guestName.trim()) {\n      localErrors.name = \"Nome √© obrigat√≥rio para emitir o bilhete.\";\n    }\n    if (!guestEmail.trim()) {\n      localErrors.email = \"Email √© obrigat√≥rio para enviar os bilhetes.\";\n    } else if (!isValidEmail(guestEmail.trim())) {\n      localErrors.email = \"Email inv√°lido. Confirma o formato (ex: nome@dominio.com).\";\n    } else if (guestEmailConfirm.trim() && guestEmailConfirm.trim() !== guestEmail.trim()) {\n      localErrors.email = \"Email e confirma√ß√£o n√£o coincidem.\";\n    }\n\n    const phoneNormalized = sanitizePhone(guestPhone);\n    if (phoneNormalized) {\n      if (!isValidPhone(phoneNormalized)) {\n        localErrors.phone = \"Telem√≥vel inv√°lido. Usa apenas d√≠gitos e opcional + no in√≠cio.\";\n      }\n    }\n    setGuestErrors(localErrors);\n\n    if (localErrors.name || localErrors.email || localErrors.phone) {\n      setError(\"Rev√™ os dados para continuar como convidado.\");\n      return;\n    }\n\n    atualizarDados({\n      additional: {\n        ...(safeDados?.additional ?? {}),\n        guestName: guestName.trim(),\n        guestEmail: guestEmail.trim(),\n        guestEmailConfirm: guestEmailConfirm.trim(),\n        guestPhone: phoneNormalized || undefined,\n        // Reset de estado para evitar reutiliza√ß√£o de intents/purchase antigos\n        purchaseId: null,\n        paymentIntentId: undefined,\n        freeCheckout: undefined,\n        appliedPromoLabel: undefined,\n        clientFingerprint: undefined,\n        intentFingerprint: undefined,\n        idempotencyKey: crypto.randomUUID(),\n      },\n    });\n\n    setPurchaseMode(\"guest\");\n    setClientSecret(null);\n    setServerAmount(null);\n    setGuestSubmitVersion((v) => v + 1);\n  };\n\n  const showPaymentUI =\n    (!authChecking && Boolean(userId)) ||\n    (!isFreeScenario && purchaseMode === \"guest\" && guestSubmitVersion > 0);\n\n  const handleRemovePromo = () => {\n    setPromoCode(\"\");\n    setPromoInput(\"\");\n    setAppliedDiscount(0);\n    setAppliedPromoLabel(null);\n    setPromoWarning(null);\n    setError(null);\n    setBreakdown(null);\n    setClientSecret(null);\n    setServerAmount(null);\n    setGuestSubmitVersion((v) => v + 1);\n\n    try {\n      atualizarDados({\n        additional: {\n          ...(safeDados?.additional ?? {}),\n          purchaseId: null,\n          paymentIntentId: undefined,\n          freeCheckout: undefined,\n          appliedPromoLabel: undefined,\n          clientFingerprint: undefined,\n          intentFingerprint: undefined,\n          idempotencyKey: crypto.randomUUID(),\n        },\n      });\n    } catch {}\n\n    lastIntentKeyRef.current = null;\n    inFlightIntentRef.current = null;\n  };\n\n  return (\n    <div className=\"flex flex-col gap-6 text-white\">\n      <header className=\"flex items-start justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.18em] text-white/55\">\n            Passo 2 de 3\n          </p>\n          <h2 className=\"text-2xl font-semibold leading-tight\">\n            {isFreeScenario ? \"Inscri√ß√£o gratuita\" : \"Pagamento\"}\n          </h2>\n          <p className=\"text-[11px] text-white/60 max-w-xs\">\n            {isFreeScenario\n              ? \"Confirma a tua inscri√ß√£o. Requer sess√£o iniciada e username definido.\"\n              : \"Pagamento seguro processado pela Stripe.\"}\n          </p>\n          {scenario && scenarioCopy[scenario] && (\n            <p className=\"text-[11px] text-white/75 max-w-sm\">{scenarioCopy[scenario]}</p>\n          )}\n        </div>\n      </header>\n\n      <div className=\"h-1 w-full rounded-full bg-white/10 overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.35)]\">\n        <div className=\"h-full w-2/3 rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] animate-pulse\" />\n      </div>\n\n      {/* üîê Se ainda estamos a verificar auth */}\n      {authChecking && (\n        <div className=\"flex-1 rounded-2xl border border-white/12 bg-white/[0.05] px-6 py-12 flex flex-col justify-center items-center text-center shadow-[0_18px_50px_rgba(0,0,0,0.45)] backdrop-blur-xl\">\n          <div className=\"relative mb-6\">\n            <div className=\"h-14 w-14 rounded-full border-2 border-white/20 border-t-transparent animate-spin\" />\n            <div className=\"absolute inset-0 h-14 w-14 animate-pulse rounded-full border border-[#6BFFFF]/20\" />\n          </div>\n          <h3 className=\"text-sm font-semibold mb-1 animate-pulse\">\n            A verificar sess√£o‚Ä¶\n          </h3>\n          <p className=\"text-[11px] text-white/65 max-w-xs leading-relaxed\">\n            Estamos a confirmar se j√° tens sess√£o iniciada na ORYA.\n          </p>\n        </div>\n      )}\n\n      {/* üí≥ UI de pagamento (user logado OU convidado depois de validar form) */}\n      {!authChecking && showPaymentUI ? (\n        <>\n          {error || (needsStripe && !stripePromise) ? (\n            <div className=\"flex-1 rounded-2xl border border-red-500/30 bg-red-500/10 px-5 py-6 text-sm text-red-100 shadow-[0_0_30px_rgba(255,0,0,0.35)]\">\n              <p className=\"font-semibold mb-1 flex items-center gap-2\">\n                <span className=\"text-lg\">‚ö†Ô∏è</span> Ocorreu um problema\n              </p>\n              <p className=\"text-[12px] mb-4 leading-relaxed\">\n                {error ?? \"Configura√ß√£o de pagamentos indispon√≠vel. Tenta novamente mais tarde.\"}\n              </p>\n              <button\n                type=\"button\"\n                onClick={() => window.location.reload()}\n                className=\"rounded-full bg-white text-red-700 px-5 py-1.5 text-[11px] font-semibold shadow hover:bg-white/90 transition\"\n              >\n                Tentar novamente\n              </button>\n            </div>\n          ) : loading || (needsStripe && (!clientSecret || !options)) ? (\n            <div className=\"flex-1 rounded-2xl border border-white/12 bg-white/[0.05] px-6 py-12 flex flex-col justify-center items-center text-center shadow-[0_18px_50px_rgba(0,0,0,0.45)] backdrop-blur-xl\">\n              <div className=\"relative mb-6\">\n                <div className=\"h-14 w-14 rounded-full border-2 border-white/20 border-t-transparent animate-spin\" />\n                <div className=\"absolute inset-0 h-14 w-14 animate-pulse rounded-full border border-[#6BFFFF]/20\" />\n              </div>\n              <h3 className=\"text-sm font-semibold mb-1 animate-pulse\">\n                A preparar o teu pagamento‚Ä¶\n              </h3>\n              <p className=\"text-[11px] text-white/65 max-w-xs leading-relaxed\">\n                Estamos a ligar-te √† Stripe para criar uma transa√ß√£o segura.\n              </p>\n            </div>\n          ) : error ? (\n            <div className=\"flex-1 rounded-2xl border border-red-500/30 bg-red-500/10 px-5 py-6 text-sm text-red-100 shadow-[0_0_30px_rgba(255,0,0,0.35)]\">\n              <p className=\"font-semibold mb-1 flex items-center gap-2\">\n                <span className=\"text-lg\">‚ö†Ô∏è</span> Ocorreu um problema\n              </p>\n              <p className=\"text-[12px] mb-4 leading-relaxed\">{error}</p>\n              <button\n                type=\"button\"\n                onClick={() => window.location.reload()}\n                className=\"rounded-full bg-white text-red-700 px-5 py-1.5 text-[11px] font-semibold shadow hover:bg-white/90 transition\"\n              >\n                Tentar novamente\n              </button>\n            </div>\n          ) : (\n            <div className=\"flex-1 rounded-2xl border border-white/12 bg-white/[0.05] px-6 py-6 shadow-[0_0_60px_rgba(0,0,0,0.6)] backdrop-blur-xl space-y-4\">\n              {promoWarning && (\n                <div className=\"rounded-md border border-amber-400/40 bg-amber-400/10 px-3 py-2 text-sm text-amber-100\">\n                  {promoWarning}\n                </div>\n              )}\n              {appliedPromoLabel === \"Promo autom√°tica\" && appliedDiscount > 0 && (\n                <div className=\"rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-100\">\n                  Desconto aplicado automaticamente üéâ\n                </div>\n              )}\n              <div className=\"rounded-2xl border border-white/10 bg-white/[0.04] p-4 space-y-2\">\n                <label className=\"text-xs text-white/70\">Tens um c√≥digo promocional?</label>\n                <div className=\"flex flex-col gap-2 sm:flex-row\">\n                  <input\n                    type=\"text\"\n                    value={promoInput}\n                    onChange={(e) => setPromoInput(e.target.value)}\n                    placeholder=\"Insere o c√≥digo\"\n                    className=\"flex-1 rounded-xl bg-white/[0.05] border border-white/15 px-3 py-2 text-sm outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setPromoWarning(null);\n                      setError(null);\n                      if (!promoInput.trim()) {\n                        setPromoWarning(\"Escreve um c√≥digo antes de aplicar.\");\n                        return;\n                      }\n                      // Promo altera o c√°lculo: limpamos purchase/payment state para obrigar a recalcular intent.\n                      try {\n                    atualizarDados({\n                      additional: {\n                        ...(safeDados?.additional ?? {}),\n                        purchaseId: null,\n                        paymentIntentId: undefined,\n                        freeCheckout: undefined,\n                        appliedPromoLabel: undefined,\n                        intentFingerprint: crypto.randomUUID(),\n                        idempotencyKey: crypto.randomUUID(),\n                      },\n                    });\n                      } catch {}\n                      setCachedIntent(null);\n                      setClientSecret(null);\n                      setServerAmount(null);\n                      setBreakdown(null);\n                      lastIntentKeyRef.current = null;\n                      inFlightIntentRef.current = null;\n                      setPromoCode(promoInput.trim());\n                      setGuestSubmitVersion((v) => v + 1);\n                    }}\n                    className=\"px-4 py-2 rounded-full bg-white text-black text-sm font-semibold shadow hover:scale-[1.01] active:scale-[0.99] transition\"\n                  >\n                    Aplicar\n                  </button>\n                </div>\n                {appliedDiscount > 0 && (\n                  <div className=\"flex flex-wrap items-center gap-2 rounded-lg border border-emerald-400/30 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-100\">\n                    <span>\n                      {appliedPromoLabel\n                        ? `Desconto ${appliedPromoLabel}: -${appliedDiscount.toFixed(2)} ‚Ç¨`\n                        : `Desconto aplicado: -${appliedDiscount.toFixed(2)} ‚Ç¨`}\n                    </span>\n                    <button\n                      type=\"button\"\n                      onClick={handleRemovePromo}\n                      className=\"rounded-full border border-emerald-300/40 px-2 py-0.5 text-[11px] text-emerald-50 hover:bg-emerald-500/20\"\n                    >\n                      Remover\n                    </button>\n                  </div>\n                )}\n              </div>\n              <Elements stripe={stripePromise} options={options}>\n                <PaymentForm\n                  total={total}\n                  discount={appliedDiscount}\n                  breakdown={breakdown ?? undefined}\n                  clientSecret={clientSecret}\n                  onLoadError={handlePaymentElementError}\n                />\n              </Elements>\n            </div>\n          )}\n        </>\n      ) : null}\n\n      {/* üîê/üéüÔ∏è Se n√£o est√° logado e ainda n√£o avan√ßou como convidado */}\n      {!authChecking && !userId && !showPaymentUI && (\n        <div className=\"space-y-3\">\n          {authInfo && (\n            <div className=\"rounded-xl border border-amber-400/30 bg-amber-500/15 px-3 py-2 text-[11px] text-amber-50\">\n              {authInfo}\n            </div>\n          )}\n          {error && (\n            <div className=\"rounded-xl border border-red-500/30 bg-red-500/15 px-3 py-2 text-[11px] text-red-50\">\n              {error}\n            </div>\n          )}\n          {!requiresAuth && (\n            <div className=\"flex items-center gap-2 text-[11px] bg-white/10 rounded-full p-1 border border-white/15 w-fit backdrop-blur\">\n              <button\n                type=\"button\"\n                onClick={() => setPurchaseMode(\"guest\")}\n                className={`px-3 py-1 rounded-full ${\n                  purchaseMode === \"guest\"\n                    ? \"bg-white text-black font-semibold\"\n                    : \"text-white/70\"\n                }`}\n              >\n                Comprar como convidado\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setPurchaseMode(\"auth\");\n                  setClientSecret(null);\n                  setServerAmount(null);\n                }}\n                className={`px-3 py-1 rounded-full ${\n                  purchaseMode === \"auth\"\n                    ? \"bg-white text-black font-semibold\"\n                    : \"text-white/70\"\n                }`}\n              >\n                Entrar / Criar conta\n              </button>\n            </div>\n          )}\n\n          {requiresAuth ? (\n            <div className=\"space-y-2\">\n              <div className=\"rounded-xl border border-emerald-400/30 bg-emerald-500/10 px-3 py-2 text-[11px] text-emerald-50\">\n                Este checkout exige conta. Para eventos gratuitos precisas de iniciar sess√£o e ter um username definido.\n              </div>\n              <AuthWall onAuthenticated={handleAuthenticated} />\n            </div>\n          ) : purchaseMode === \"guest\" ? (\n            <GuestCheckoutCard\n              guestName={guestName}\n              guestEmail={guestEmail}\n              guestEmailConfirm={guestEmailConfirm}\n              guestPhone={guestPhone}\n              guestErrors={guestErrors}\n              onChangeName={setGuestName}\n              onChangeEmail={setGuestEmail}\n              onChangeEmailConfirm={setGuestEmailConfirm}\n              onChangePhone={setGuestPhone}\n              onContinue={handleGuestContinue}\n            />\n          ) : (\n            <AuthWall onAuthenticated={handleAuthenticated} />\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\ntype PaymentFormProps = {\n  total: number | null;\n  discount?: number;\n  breakdown?: CheckoutBreakdown;\n  clientSecret: string | null;\n  onLoadError?: () => void;\n};\n\nfunction PaymentForm({ total, discount = 0, breakdown, clientSecret, onLoadError }: PaymentFormProps) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { irParaPasso, atualizarDados, dados } = useCheckout();\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [elementReady, setElementReady] = useState(false);\n  const currency = breakdown?.currency ?? \"EUR\";\n  const discountCents = Math.max(0, Math.round(discount * 100));\n  const hasInvoice = Boolean(breakdown?.lines?.length);\n  const feeMode =\n    typeof breakdown?.feeMode === \"string\"\n      ? breakdown.feeMode.toUpperCase()\n      : null;\n  const payorPaysFee = feeMode === \"ADDED\";\n  const platformFeeCents = payorPaysFee\n    ? Math.max(0, (breakdown as any)?.platformFeeCombinedCents ?? breakdown?.platformFeeCents ?? 0)\n    : 0;\n  const subtotalCents = breakdown?.subtotalCents ?? 0;\n  const baseSubtotalCents =\n    hasInvoice && discountCents > 0 ? subtotalCents + discountCents : subtotalCents;\n  const promoApplied = discountCents > 0;\n\n  useEffect(() => {\n    // sempre que o clientSecret muda, obrigamos o PaymentElement a fazer ready novamente\n    setElementReady(false);\n  }, [clientSecret]);\n\n  // Prote√ß√£o: se o PaymentIntent j√° estiver terminal (succeeded/canceled), for√ßa regenerar.\n  useEffect(() => {\n    if (!stripe || !clientSecret) return;\n    let cancelled = false;\n    (async () => {\n      try {\n        const pi = await stripe.retrievePaymentIntent(clientSecret);\n        if (cancelled) return;\n        const status = pi.paymentIntent?.status;\n        if (status && ![\"requires_payment_method\", \"requires_action\", \"requires_confirmation\"].includes(status)) {\n          setError(\"Sess√£o de pagamento expirou. Vamos criar um novo intento.\");\n          if (onLoadError) onLoadError();\n        }\n      } catch (err) {\n        if (cancelled) return;\n        setError(\"Falha ao validar estado do pagamento. Tenta novamente.\");\n        if (onLoadError) onLoadError();\n      }\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, [stripe, clientSecret, onLoadError]);\n\n  // Se o utilizador for redirecionado pela Stripe (ex.: 3DS), o URL volta com\n  // `payment_intent_client_secret` e `redirect_status`. Aqui recuperamos o PI\n  // e avan√ßamos automaticamente para o passo 3 quando o pagamento fica conclu√≠do.\n  useEffect(() => {\n    if (!stripe) return;\n    if (typeof window === \"undefined\") return;\n\n    const params = new URLSearchParams(window.location.search);\n    const clientSecretFromUrl = params.get(\"payment_intent_client_secret\");\n\n    if (!clientSecretFromUrl) return;\n\n    let cancelled = false;\n\n    (async () => {\n      try {\n        // Limpamos o erro antigo para n√£o confundir o utilizador.\n        setError(null);\n\n        const result = await stripe.retrievePaymentIntent(clientSecretFromUrl);\n\n        if (cancelled) return;\n\n        if (result.error) {\n          setError(result.error.message ?? \"N√£o foi poss√≠vel confirmar o estado do pagamento.\");\n          return;\n        }\n\n        const paymentIntent = result.paymentIntent;\n        if (!paymentIntent) {\n          setError(\"N√£o foi poss√≠vel confirmar o estado do pagamento.\");\n          return;\n        }\n\n        if (paymentIntent.status === \"succeeded\") {\n          atualizarDados({\n            additional: {\n              ...(dados?.additional ?? {}),\n              paymentIntentId: paymentIntent.id,\n            },\n          });\n\n          try {\n            const { trackEvent } = await import(\"@/lib/analytics\");\n            trackEvent(\"checkout_payment_confirmed\", {\n              eventId: dados?.eventId,\n              promoApplied: discountCents > 0,\n              currency,\n              totalCents: total ? Math.round(total * 100) : null,\n              viaRedirect: true,\n            });\n          } catch (err) {\n            console.warn(\"[trackEvent] checkout_payment_confirmed (redirect) falhou\", err);\n          }\n\n          irParaPasso(3);\n          return;\n        }\n\n        if (paymentIntent.status === \"processing\") {\n          setError(\"Pagamento em processamento. Aguarda uns segundos e verifica o teu email.\");\n          return;\n        }\n\n        if (paymentIntent.status === \"requires_payment_method\") {\n          setError(\"O pagamento n√£o foi conclu√≠do. Tenta novamente ou usa outro m√©todo.\");\n          return;\n        }\n\n        // Para outros estados, mostramos uma mensagem gen√©rica.\n        setError(\"O pagamento n√£o ficou conclu√≠do. Tenta novamente.\");\n      } catch (err) {\n        console.error(\"[PaymentForm] Erro a recuperar PaymentIntent do redirect:\", err);\n        if (!cancelled) setError(\"N√£o foi poss√≠vel confirmar o estado do pagamento.\");\n      } finally {\n        // Removemos os query params de redirect para evitar loops se o utilizador fizer refresh.\n        try {\n          const url = new URL(window.location.href);\n          url.searchParams.delete(\"payment_intent\");\n          url.searchParams.delete(\"payment_intent_client_secret\");\n          url.searchParams.delete(\"redirect_status\");\n          window.history.replaceState({}, \"\", url.toString());\n        } catch {}\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [stripe, atualizarDados, dados?.additional, dados?.eventId, irParaPasso, currency, total, discountCents]);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    if (!stripe || !elements || !elementReady) return;\n\n    setSubmitting(true);\n    setError(null);\n\n    try {\n      const returnUrl =\n        typeof window !== \"undefined\" ? window.location.href : undefined;\n\n      const { error, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        confirmParams: returnUrl ? { return_url: returnUrl } : undefined,\n        redirect: \"if_required\",\n      });\n\n      if (error) {\n        setError(error.message ?? \"O pagamento n√£o foi conclu√≠do.\");\n        return;\n      }\n\n      if (paymentIntent && paymentIntent.status === \"succeeded\") {\n        atualizarDados({\n          additional: {\n            ...(dados?.additional ?? {}),\n            paymentIntentId: paymentIntent.id,\n          },\n        });\n        try {\n          const { trackEvent } = await import(\"@/lib/analytics\");\n          trackEvent(\"checkout_payment_confirmed\", {\n            eventId: dados?.eventId,\n            promoApplied,\n            currency,\n            totalCents: total ? Math.round(total * 100) : null,\n          });\n        } catch (err) {\n          console.warn(\"[trackEvent] checkout_payment_confirmed falhou\", err);\n        }\n        irParaPasso(3);\n      }\n    } catch (err) {\n      console.error(\"Erro ao confirmar pagamento:\", err);\n      setError(\"Erro inesperado ao confirmar o pagamento.\");\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  if (!clientSecret) {\n    return (\n      <div className=\"rounded-2xl border border-red-500/30 bg-red-500/10 px-5 py-6 text-sm text-red-100 shadow-[0_0_30px_rgba(255,0,0,0.35)]\">\n        <p className=\"font-semibold mb-1 flex items-center gap-2\">\n          <span className=\"text-lg\">‚ö†Ô∏è</span> N√£o foi poss√≠vel preparar o pagamento.\n        </p>\n        <p className=\"text-[12px] mb-4 leading-relaxed\">\n          Volta atr√°s e tenta novamente ou recarrega a p√°gina.\n        </p>\n        <div className=\"flex gap-2\">\n          <button\n            type=\"button\"\n            onClick={() => window.location.reload()}\n            className=\"rounded-full bg-white text-red-700 px-5 py-1.5 text-[11px] font-semibold shadow hover:bg-white/90 transition\"\n          >\n            Recarregar\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => irParaPasso(1)}\n            className=\"rounded-full border border-white/30 px-5 py-1.5 text-[11px] text-white hover:bg-white/10 transition\"\n          >\n            Voltar\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex flex-col gap-5\">\n      {(hasInvoice || total !== null) && (\n        <div className=\"rounded-2xl border border-white/12 bg-white/[0.05] px-5 py-4 shadow-inner shadow-black/40 backdrop-blur-xl space-y-3\">\n          <div className=\"flex items-center justify-between text-xs text-white/70\">\n            <span className=\"uppercase tracking-[0.14em]\">Resumo</span>\n            <span className=\"inline-flex items-center gap-1 rounded-full bg-white/5 px-3 py-1 border border-white/10 text-[11px] text-white/70\">\n              üîí Pagamento seguro\n            </span>\n          </div>\n\n          {hasInvoice && (\n            <div className=\"space-y-2\">\n              {breakdown?.lines?.map((line) => (\n                <div\n                  key={`${line.ticketTypeId}-${line.name}-${line.quantity}`}\n                  className=\"flex items-center justify-between text-sm text-white/80\"\n                >\n                  <div className=\"flex flex-col\">\n                    <span className=\"font-medium\">{line.name}</span>\n                    <span className=\"text-[11px] text-white/55\">x{line.quantity}</span>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-[13px] font-semibold\">\n                      {formatMoney(line.lineTotalCents, line.currency || currency)}\n                    </p>\n                    <p className=\"text-[11px] text-white/45\">\n                      {formatMoney(line.unitPriceCents, line.currency || currency)} / bilhete\n                    </p>\n                  </div>\n                </div>\n              ))}\n\n              <div className=\"h-px w-full bg-white/10\" />\n\n              {discountCents > 0 && (\n                <>\n                  <div className=\"flex items-center justify-between text-sm text-white/70\">\n                    <span>Subtotal (antes de desconto)</span>\n                    <span className=\"font-semibold\">\n                      {formatMoney(baseSubtotalCents, currency)}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between text-sm text-emerald-300\">\n                    <span>Desconto aplicado</span>\n                    <span>-{formatMoney(discountCents, currency)}</span>\n                  </div>\n                </>\n              )}\n\n              <div className=\"flex items-center justify-between text-sm text-white/80\">\n                <span>Subtotal</span>\n                <span className=\"font-semibold\">\n                  {formatMoney(subtotalCents, currency)}\n                </span>\n              </div>\n\n              {platformFeeCents > 0 && (\n                <div className=\"flex items-center justify-between text-sm text-white/70\">\n                  <span>Taxa da plataforma (inclui processamento)</span>\n                  <span>{formatMoney(platformFeeCents, currency)}</span>\n                </div>\n              )}\n            </div>\n          )}\n\n          {total !== null && (\n          <div className=\"flex items-center justify-between rounded-xl bg-white/10 px-4 py-3 border border-white/12\">\n              <div className=\"flex flex-col text-white/80\">\n                <span className=\"text-[12px]\">Total a pagar</span>\n                {feeMode === \"INCLUDED\" && (\n                  <span className=\"text-[11px] text-white/55\">\n                    Taxas j√° inclu√≠das\n                  </span>\n                )}\n              </div>\n              <span className=\"text-xl font-semibold text-white\">\n                {formatMoney(Math.round(total * 100), currency)}\n              </span>\n            </div>\n          )}\n        </div>\n      )}\n\n      <div className=\"rounded-2xl border border-white/12 bg-white/[0.05] px-4 py-4 text-sm backdrop-blur-xl payment-scroll\">\n        <div className=\"flex items-center justify-between text-[11px] text-white/70 mb-3\">\n          <span className=\"uppercase tracking-[0.16em]\">M√©todo de pagamento</span>\n          <span className=\"rounded-full border border-white/15 bg-white/5 px-2 py-0.5 text-[10px] text-white/70\">\n            Stripe\n          </span>\n        </div>\n        <div className=\"relative\">\n          {!elementReady && (\n            <div className=\"absolute inset-0 rounded-xl border border-white/10 bg-white/5 animate-pulse pointer-events-none\" />\n          )}\n          <PaymentElement\n            // key for√ßa remount quando o clientSecret muda para evitar usar intents antigos\n            key={clientSecret ?? \"payment-element\"}\n            options={{}}\n            onReady={() => setElementReady(true)}\n            onLoadError={(err) => {\n              console.error(\"[PaymentElement] loaderror\", err);\n              setElementReady(false);\n              setError(err?.message ?? \"N√£o foi poss√≠vel carregar o formul√°rio de pagamento. Tenta novamente.\");\n              if (onLoadError) onLoadError();\n              // Debug extra: tentar perceber o estado do PI associado\n              if (stripe && clientSecret) {\n                stripe\n                  .retrievePaymentIntent(clientSecret)\n                  .then((res) => {\n                    console.warn(\"[PaymentElement] PI status\", res.paymentIntent?.status, res.paymentIntent?.id);\n                  })\n                  .catch(() => undefined);\n              }\n            }}\n          />\n        </div>\n      </div>\n\n      {error && (\n        <p className=\"text-[11px] text-red-300 mt-1 leading-snug\">{error}</p>\n      )}\n\n      <button\n        type=\"submit\"\n        disabled={submitting || !stripe || !elements || !elementReady}\n        className=\"mt-3 inline-flex w-full items-center justify-center rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] px-6 py-3 text-xs font-semibold text-black shadow-[0_0_32px_rgba(107,255,255,0.55)] disabled:opacity-40 disabled:cursor-not-allowed hover:scale-[1.03] active:scale-95 transition-transform\"\n      >\n        {submitting ? \"A processar‚Ä¶\" : \"Pagar agora\"}\n      </button>\n\n      <p className=\"mt-2 text-[10px] text-white/40 text-center leading-snug\">\n        Pagamento seguro processado pela Stripe. A ORYA nunca guarda dados do\n        teu cart√£o.\n      </p>\n    </form>\n  );\n}\n\ntype AuthWallProps = {\n  onAuthenticated?: (userId: string) => void;\n};\n\nfunction delay(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nfunction AuthWall({ onAuthenticated }: AuthWallProps) {\n  const [mode, setMode] = useState<\"login\" | \"signup\" | \"verify\">(\"login\");\n  const [identifier, setIdentifier] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [fullName, setFullName] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [otp, setOtp] = useState(\"\");\n  const [authOtpCooldown, setAuthOtpCooldown] = useState(0);\n  const [authOtpResending, setAuthOtpResending] = useState(false);\n\n  function isUnconfirmedError(err: unknown) {\n    if (!err) return false;\n    const anyErr = err as { message?: string; status?: number; error_description?: string };\n    const msg = (anyErr.message || anyErr.error_description || \"\").toLowerCase();\n    return (\n      msg.includes(\"not confirmed\") ||\n      msg.includes(\"confirm your email\") ||\n      msg.includes(\"email_not_confirmed\")\n    );\n  }\n\n  useEffect(() => {\n    if (authOtpCooldown <= 0) return;\n    const t = setInterval(() => {\n      setAuthOtpCooldown((prev) => (prev > 0 ? prev - 1 : 0));\n    }, 1000);\n    return () => clearInterval(t);\n  }, [authOtpCooldown]);\n\n  async function triggerResendOtp(email: string) {\n    setError(null);\n    setAuthOtpResending(true);\n    setAuthOtpCooldown(60);\n    try {\n      const res = await fetch(\"/api/auth/resend-otp\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email }),\n      });\n      const data = await res.json().catch(() => null);\n      if (!res.ok) {\n        setError(data?.error ?? \"N√£o foi poss√≠vel reenviar o c√≥digo.\");\n        setAuthOtpCooldown(0);\n      }\n    } catch (err) {\n      console.error(\"[AuthWall] resend OTP error:\", err);\n      setError(\"N√£o foi poss√≠vel reenviar o c√≥digo.\");\n      setAuthOtpCooldown(0);\n    } finally {\n      setAuthOtpResending(false);\n    }\n  }\n\n  async function handleGoogle() {\n    setSubmitting(true);\n    setError(null);\n    try {\n      const redirectTo =\n        typeof window !== \"undefined\"\n          ? `${window.location.origin}/auth/callback?redirect=${encodeURIComponent(window.location.href)}`\n          : undefined;\n      if (typeof window !== \"undefined\") {\n        try {\n          localStorage.setItem(\"orya_post_auth_redirect\", window.location.href);\n        } catch {}\n      }\n      const { error } = await supabaseBrowser.auth.signInWithOAuth({\n        provider: \"google\",\n        options: { redirectTo },\n      });\n      if (error) {\n        setError(error.message ?? \"N√£o foi poss√≠vel iniciar sess√£o com Google.\");\n      }\n    } catch (err) {\n      console.error(\"[AuthWall] Google OAuth error:\", err);\n      setError(\"N√£o foi poss√≠vel iniciar sess√£o com Google.\");\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setSubmitting(true);\n    setError(null);\n\n    try {\n      if (mode === \"verify\") {\n        if (!identifier || !otp.trim()) {\n          setError(\"Indica o email e o c√≥digo recebido.\");\n          return;\n        }\n        const emailToUse = identifier.trim().toLowerCase();\n        const token = otp.trim();\n        const { error: verifyErr } = await supabaseBrowser.auth.verifyOtp({\n          type: \"signup\",\n          email: emailToUse,\n          token,\n        });\n        if (verifyErr) {\n          setError(verifyErr.message || \"C√≥digo inv√°lido ou expirado.\");\n          setAuthOtpCooldown(0);\n          return;\n        }\n        await delay(400);\n        const { data: userData } = await supabaseBrowser.auth.getUser();\n        if (userData?.user) onAuthenticated?.(userData.user.id);\n        return;\n      }\n\n      if (!identifier || !password) {\n        setError(\"Preenche o email e a palavra-passe.\");\n        return;\n      }\n\n      let emailToUse = identifier.trim().toLowerCase();\n      if (!identifier.includes(\"@\")) {\n        const res = await fetch(\"/api/auth/resolve-identifier\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ identifier }),\n        });\n        const data = await res.json().catch(() => null);\n        if (!res.ok || !data?.ok || !data?.email) {\n          setError(\"Credenciais inv√°lidas. Confirma username/email e password.\");\n          return;\n        }\n        emailToUse = data.email;\n      }\n\n      if (mode === \"login\") {\n        const { error } = await supabaseBrowser.auth.signInWithPassword({\n          email: emailToUse,\n          password,\n        });\n        if (error) {\n          if (isUnconfirmedError(error)) {\n            setMode(\"verify\");\n            setIdentifier(emailToUse);\n            setError(\"Email ainda n√£o confirmado. Reenviei-te um novo c√≥digo.\");\n            await triggerResendOtp(emailToUse);\n            return;\n          }\n          setError(error.message ?? \"N√£o foi poss√≠vel iniciar sess√£o.\");\n          return;\n        }\n      } else {\n        if (password.length < 6) {\n          setError(\"A password deve ter pelo menos 6 caracteres.\");\n          return;\n        }\n        if (password !== confirmPassword) {\n          setError(\"As passwords n√£o coincidem.\");\n          return;\n        }\n        if (!fullName.trim()) {\n          setError(\"Nome √© obrigat√≥rio para criar conta.\");\n          return;\n        }\n        const usernameCheck = await checkUsernameAvailability(username);\n        if (!usernameCheck.ok) {\n          setSubmitting(false);\n          return;\n        }\n\n        const res = await fetch(\"/api/auth/send-otp\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            email: emailToUse,\n            password,\n            username: usernameCheck.username,\n            fullName: fullName.trim(),\n          }),\n        });\n        const data = await res.json().catch(() => null);\n        if (!res.ok || !data?.ok) {\n          const message = data?.error ?? \"N√£o foi poss√≠vel enviar o c√≥digo de verifica√ß√£o.\";\n          setError(message);\n          return;\n        }\n\n        setMode(\"verify\");\n        setIdentifier(emailToUse);\n        setError(\"Envi√°mos um c√≥digo para confirmar o email. Introduz para continuares.\");\n        setAuthOtpCooldown(60);\n        return;\n      }\n\n      // Pequeno delay para garantir que a sess√£o foi escrita nos cookies\n      await delay(600);\n\n      // Depois do delay, garantimos que a sess√£o est√° dispon√≠vel e notificamos o Step2\n      try {\n        const { data: userData } = await supabaseBrowser.auth.getUser();\n        if (userData?.user) {\n          onAuthenticated?.(userData.user.id);\n        }\n      } catch (e: unknown) {\n        console.warn(\"[AuthWall] N√£o foi poss√≠vel ler user ap√≥s login:\", e);\n      }\n    } catch (err) {\n      console.error(\"[AuthWall] Erro:\", err);\n      setError(\"Ocorreu um erro. Tenta novamente.\");\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"flex-1 rounded-2xl border border-white/12 bg-white/[0.05] px-6 py-6 shadow-[0_0_40px_rgba(0,0,0,0.6)] flex flex-col gap-4\">\n      <div className=\"flex items-start justify-between gap-4\">\n        <div>\n          <h3 className=\"text-sm font-semibold mb-1\">\n            Inicia sess√£o para continuar\n          </h3>\n          <p className=\"text-[11px] text-white/60 max-w-sm leading-relaxed\">\n            Para associar os bilhetes √† tua conta ORYA e evitar problemas no\n            check-in, tens de estar com a sess√£o iniciada antes de pagar.\n          </p>\n        </div>\n        <span className=\"text-[20px]\">üîê</span>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"flex flex-col gap-3 mt-2\">\n        {mode !== \"verify\" && (\n          <div className=\"flex gap-2 text-[11px] bg-black/40 rounded-full p-1 border border-white/10 w-fit\">\n            <button\n              type=\"button\"\n              onClick={() => setMode(\"login\")}\n              className={`px-3 py-1 rounded-full ${mode === \"login\" ? \"bg-white text-black font-semibold\" : \"text-white/70\"}`}\n            >\n              J√° tenho conta\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setMode(\"signup\")}\n              className={`px-3 py-1 rounded-full ${mode === \"signup\" ? \"bg-white text-black font-semibold\" : \"text-white/70\"}`}\n            >\n              Criar conta\n            </button>\n          </div>\n        )}\n\n        <div className=\"flex flex-col gap-2 text-[12px]\">\n          {mode !== \"verify\" ? (\n            <>\n              <div className=\"flex flex-col gap-1\">\n                <label className=\"text-white/70\">Email</label>\n                <input\n                  type=\"email\"\n                  className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                  placeholder=\"nome@exemplo.com\"\n                  value={identifier}\n                  onChange={(e) => setIdentifier(e.target.value)}\n                  autoComplete=\"email\"\n                />\n              </div>\n              <div className=\"flex flex-col gap-1\">\n                <label className=\"text-white/70\">Palavra-passe</label>\n                <input\n                  type=\"password\"\n                  className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                  placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  autoComplete={mode === \"login\" ? \"current-password\" : \"new-password\"}\n                />\n              </div>\n              {mode === \"signup\" && (\n                <>\n                  <div className=\"flex flex-col gap-1\">\n                    <label className=\"text-white/70\">Confirmar palavra-passe</label>\n                    <input\n                      type=\"password\"\n                      className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                      placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                      value={confirmPassword}\n                      onChange={(e) => setConfirmPassword(e.target.value)}\n                      autoComplete=\"new-password\"\n                    />\n                  </div>\n                  <div className=\"flex flex-col gap-1\">\n                    <label className=\"text-white/70\">Nome completo</label>\n                    <input\n                      type=\"text\"\n                      className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                      placeholder=\"O teu nome\"\n                      value={fullName}\n                      onChange={(e) => setFullName(e.target.value)}\n                      autoComplete=\"name\"\n                    />\n                  </div>\n                  <div className=\"flex flex-col gap-1\">\n                    <label className=\"text-white/70\">Username</label>\n                    <input\n                      type=\"text\"\n                      className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                      placeholder=\"@teuuser\"\n                      value={username}\n                      onChange={(e) => setUsername(e.target.value)}\n                      autoComplete=\"username\"\n                    />\n                  </div>\n                </>\n              )}\n            </>\n          ) : (\n            <>\n              <p className=\"text-[12px] text-white/70\">\n                Envi√°mos um c√≥digo de confirma√ß√£o para <strong>{identifier}</strong>. Introduz abaixo ou pede novo c√≥digo.\n              </p>\n              <div className=\"flex flex-col gap-1\">\n                <label className=\"text-white/70\">C√≥digo</label>\n                <input\n                  type=\"text\"\n                  maxLength={8}\n                  className=\"w-full rounded-xl bg-black/60 border border-white/15 px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF]\"\n                  placeholder=\"87612097\"\n                  value={otp}\n                  onChange={(e) => setOtp(e.target.value)}\n                  autoComplete=\"one-time-code\"\n                />\n              </div>\n              <div className=\"text-[11px] text-white/65 flex items-center justify-between\">\n                <span>\n                  N√£o chegou? {authOtpCooldown > 0 ? `Podes reenviar em ${authOtpCooldown}s.` : \"Reenvia um novo c√≥digo.\"}\n                </span>\n                <button\n                  type=\"button\"\n                  onClick={() => identifier && triggerResendOtp(identifier)}\n                  disabled={authOtpCooldown > 0 || authOtpResending || !identifier}\n                  className=\"text-[#6BFFFF] hover:text-white transition disabled:opacity-50\"\n                >\n                  Reenviar c√≥digo\n                </button>\n              </div>\n            </>\n          )}\n        </div>\n\n        {error && (\n          <p className=\"text-[11px] text-red-300 mt-1 leading-snug\">{error}</p>\n        )}\n        {authOtpCooldown > 0 && mode === \"verify\" && (\n          <p className=\"text-[11px] text-white/60\">Podes reenviar c√≥digo em {authOtpCooldown}s.</p>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={handleGoogle}\n          disabled={submitting}\n          className=\"inline-flex w-full items-center justify-center gap-2 rounded-full border border-white/20 bg-black/50 px-6 py-2.5 text-xs font-semibold text-white shadow hover:border-white/40 hover:bg-black/60 transition-colors disabled:opacity-50\"\n        >\n          <span>Continuar com Google</span>\n        </button>\n\n        <button\n          type=\"submit\"\n          disabled={submitting}\n          className=\"mt-2 inline-flex w-full items-center justify-center rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] px-6 py-2.5 text-xs font-semibold text-black shadow-[0_0_24px_rgba(107,255,255,0.55)] disabled:opacity-40 disabled:cursor-not-allowed hover:scale-[1.02] active:scale-95 transition-transform\"\n        >\n          {mode === \"verify\"\n            ? submitting\n              ? \"A confirmar‚Ä¶\"\n              : \"Confirmar c√≥digo e continuar\"\n            : mode === \"login\"\n            ? submitting\n              ? \"A entrar‚Ä¶\"\n              : \"Iniciar sess√£o e continuar\"\n            : submitting\n            ? \"A enviar c√≥digo‚Ä¶\"\n            : \"Criar conta e enviar c√≥digo\"}\n        </button>\n      </form>\n    </div>\n  );\n}\n\ntype GuestCheckoutCardProps = {\n  guestName: string;\n  guestEmail: string;\n  guestEmailConfirm: string;\n  guestPhone: string;\n  guestErrors: { name?: string; email?: string; phone?: string };\n  onChangeName: (v: string) => void;\n  onChangeEmail: (v: string) => void;\n  onChangeEmailConfirm: (v: string) => void;\n  onChangePhone: (v: string) => void;\n  onContinue: () => void;\n};\n\nfunction GuestCheckoutCard({\n  guestName,\n  guestEmail,\n  guestEmailConfirm,\n  guestPhone,\n  guestErrors,\n  onChangeName,\n  onChangeEmail,\n  onChangeEmailConfirm,\n  onChangePhone,\n  onContinue,\n}: GuestCheckoutCardProps) {\n  return (\n    <div className=\"flex-1 rounded-2xl border border-white/12 bg-white/[0.06] px-6 py-6 shadow-[0_20px_60px_rgba(0,0,0,0.55)] backdrop-blur-xl flex flex-col gap-4\">\n      <div className=\"flex items-start justify-between gap-4\">\n        <div>\n          <h3 className=\"text-sm font-semibold mb-1\">Continuar como convidado</h3>\n          <p className=\"text-[11px] text-white/60 max-w-sm leading-relaxed\">\n            Compra em 30 segundos. Guardamos os teus bilhetes pelo email e podes\n            criar conta depois para os ligar ao teu perfil.\n          </p>\n          <div className=\"mt-2 space-y-1 text-[11px] text-white/55\">\n            <p>‚Ä¢ Email √© usado para entregar bilhetes e recibo.</p>\n            <p>‚Ä¢ Telefone ajuda no contacto no dia do evento (opcional).</p>\n          </div>\n        </div>\n        <span className=\"text-[20px]\">üéüÔ∏è</span>\n      </div>\n\n      <div className=\"flex flex-col gap-3 text-[12px]\">\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-white/70\">Nome completo</label>\n          <input\n            type=\"text\"\n            className={`w-full rounded-xl bg-white/[0.05] border px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF] ${\n              guestErrors.name ? \"border-red-400/70\" : \"border-white/15\"\n            }`}\n            placeholder=\"Como queres que apare√ßa no bilhete\"\n            value={guestName}\n            onChange={(e) => onChangeName(e.target.value)}\n            autoComplete=\"name\"\n          />\n          {guestErrors.name && (\n            <span className=\"text-[11px] text-red-300\">{guestErrors.name}</span>\n          )}\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-white/70\">Email</label>\n          <input\n            type=\"email\"\n            className={`w-full rounded-xl bg-white/[0.05] border px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF] ${\n              guestErrors.email ? \"border-red-400/70\" : \"border-white/15\"\n            }`}\n            placeholder=\"nome@exemplo.com\"\n            value={guestEmail}\n            onChange={(e) => onChangeEmail(e.target.value)}\n            autoComplete=\"email\"\n          />\n          {guestErrors.email && (\n            <span className=\"text-[11px] text-red-300\">{guestErrors.email}</span>\n          )}\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-white/70\">Confirmar email</label>\n          <input\n            type=\"email\"\n            className={`w-full rounded-xl bg-white/[0.05] border px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF] ${\n              guestErrors.email ? \"border-red-400/70\" : \"border-white/15\"\n            }`}\n            placeholder=\"repete o teu email\"\n            value={guestEmailConfirm}\n            onChange={(e) => onChangeEmailConfirm(e.target.value)}\n            autoComplete=\"email\"\n          />\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-white/70\">Telem√≥vel (opcional)</label>\n          <input\n            type=\"tel\"\n            inputMode=\"tel\"\n            className={`w-full rounded-xl bg-white/[0.05] border px-3 py-2 text-[12px] outline-none focus:border-[#6BFFFF] focus:ring-1 focus:ring-[#6BFFFF] ${\n              guestErrors.phone ? \"border-red-400/70\" : \"border-white/15\"\n            }`}\n            placeholder=\"+351 ...\"\n            value={guestPhone}\n            onChange={(e) => {\n              const sanitized = sanitizePhone(e.target.value);\n              onChangePhone(sanitized);\n            }}\n            autoComplete=\"tel\"\n          />\n          {guestErrors.phone && (\n            <span className=\"text-[11px] text-red-300\">{guestErrors.phone}</span>\n          )}\n        </div>\n      </div>\n\n      <button\n        type=\"button\"\n        onClick={onContinue}\n        className=\"mt-1 inline-flex w-full items-center justify-center rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] px-6 py-2.5 text-xs font-semibold text-black shadow-[0_0_24px_rgba(107,255,255,0.55)] hover:scale-[1.02] active:scale-95 transition-transform\"\n      >\n        Continuar como convidado\n      </button>\n\n      <p className=\"mt-1 text-[10px] text-white/40 leading-snug\">\n        Vamos enviar os bilhetes para este email. Depois podes criar conta e\n        migrar todos os bilhetes para o teu perfil.\n      </p>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4390, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/money.ts"],"sourcesContent":["// lib/money.ts\nconst EUR_NUMBER_FORMATTER = new Intl.NumberFormat(\"pt-PT\", {\n  minimumFractionDigits: 2,\n  maximumFractionDigits: 2,\n});\n\n/**\n * Formata um valor em EUR para apresenta√ß√£o (ex.: 24,95 ‚Ç¨).\n */\nexport function formatEuro(amount: number | null | undefined): string {\n  if (amount === null || amount === undefined || Number.isNaN(amount)) return \"\";\n\n  // Intl usa espa√ßos n√£o separ√°veis em PT; trocamos para espa√ßo normal para evitar chars estranhos.\n  const formatted = EUR_NUMBER_FORMATTER.format(amount).replace(/\\u00A0/g, \" \");\n  return `${formatted} ‚Ç¨`;\n}\n\n/**\n * Converte um valor em c√™ntimos para euros mantendo float com 2 casas.\n */\nexport function centsToEuro(cents: number | null | undefined): number | null {\n  if (cents === null || cents === undefined || Number.isNaN(cents)) return null;\n  return cents / 100;\n}\n"],"names":[],"mappings":"AAAA,eAAe;;;;;;;AACf,MAAM,uBAAuB,IAAI,KAAK,YAAY,CAAC,SAAS;IAC1D,uBAAuB;IACvB,uBAAuB;AACzB;AAKO,SAAS,WAAW,MAAiC;IAC1D,IAAI,WAAW,QAAQ,WAAW,aAAa,OAAO,KAAK,CAAC,SAAS,OAAO;IAE5E,kGAAkG;IAClG,MAAM,YAAY,qBAAqB,MAAM,CAAC,QAAQ,OAAO,CAAC,WAAW;IACzE,OAAO,GAAG,UAAU,EAAE,CAAC;AACzB;AAKO,SAAS,YAAY,KAAgC;IAC1D,IAAI,UAAU,QAAQ,UAAU,aAAa,OAAO,KAAK,CAAC,QAAQ,OAAO;IACzE,OAAO,QAAQ;AACjB"}},
    {"offset": {"line": 4415, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkout/Step3Sucesso.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useCheckout } from \"./contextoCheckout\";\nimport { formatEuro } from \"@/lib/money\";\n\nconst FREE_PLACEHOLDER_INTENT_ID = \"FREE_CHECKOUT\";\n\nconst scenarioCopy: Record<string, string> = {\n  GROUP_SPLIT: \"Pagaste apenas a tua parte desta dupla.\",\n  GROUP_FULL: \"Pagaste 2 lugares (tu + parceiro).\",\n  RESALE: \"Compra de bilhete em revenda.\",\n  FREE_CHECKOUT: \"Inscri√ß√£o gratuita conclu√≠da.\",\n};\n\nfunction normalizeCheckoutStatus(raw: unknown): \"PROCESSING\" | \"PAID\" | \"FAILED\" {\n  const v = typeof raw === \"string\" ? raw.trim().toUpperCase() : \"\";\n  if ([\"PAID\", \"OK\", \"SUCCEEDED\", \"SUCCESS\", \"COMPLETED\", \"CONFIRMED\"].includes(v)) return \"PAID\";\n  if ([\"FAILED\", \"ERROR\", \"CANCELED\", \"CANCELLED\", \"REQUIRES_PAYMENT_METHOD\"].includes(v)) return \"FAILED\";\n  return \"PROCESSING\";\n}\n\nfunction numberFromUnknown(v: unknown): number | null {\n  return typeof v === \"number\" && Number.isFinite(v) ? v : null;\n}\n\nfunction eurosToCents(v: number): number {\n  return Math.max(0, Math.round(v * 100));\n}\n\nfunction centsFromAdditional(additional: Record<string, unknown>, key: string): number | null {\n  // Convention used in this checkout:\n  // - `*Cents` fields are cents\n  // - `total` (without suffix) has historically been stored as euros\n  const centsKey = `${key}Cents`;\n  const cents = numberFromUnknown(additional[centsKey]);\n  if (cents !== null) return cents;\n\n  if (key === \"total\") {\n    const totalEuros = numberFromUnknown(additional.total);\n    if (totalEuros !== null) return eurosToCents(totalEuros);\n  }\n\n  return null;\n}\n\nexport default function Step3Sucesso() {\n  const { dados, fecharCheckout, breakdown: checkoutBreakdown } = useCheckout();\n  const router = useRouter();\n  const [statusError, setStatusError] = useState<string | null>(null);\n\n  const additional:\n    | Record<string, unknown>\n    | undefined =\n    dados?.additional && typeof dados.additional === \"object\"\n      ? (dados.additional as Record<string, unknown>)\n      : undefined;\n\n  const scenario =\n    (dados?.paymentScenario as string | null | undefined) ??\n    (additional && typeof additional.paymentScenario === \"string\"\n      ? (additional.paymentScenario as string)\n      : null);\n\n  const isFreeScenario = scenario === \"FREE_CHECKOUT\";\n\n  const paymentIntentId =\n    additional && typeof additional.paymentIntentId === \"string\"\n      ? additional.paymentIntentId\n      : null;\n\n  const fallbackPurchaseId =\n    paymentIntentId && paymentIntentId !== FREE_PLACEHOLDER_INTENT_ID ? paymentIntentId : null;\n\n  const purchaseId =\n    additional && typeof additional.purchaseId === \"string\"\n      ? additional.purchaseId\n      : fallbackPurchaseId;\n\n  useEffect(() => {\n    if (dados && !purchaseId && !isFreeScenario) {\n      router.replace(\"/explorar\");\n    }\n  }, [dados, router, purchaseId, isFreeScenario]);\n\n  // Revalidar bilhetes ap√≥s sucesso (traz novos bilhetes mais depressa)\n  useEffect(() => {\n    async function revalidateTickets() {\n      try {\n        await fetch(\"/api/me/wallet\", { method: \"GET\", cache: \"no-store\" });\n      } catch (err) {\n        console.warn(\"[Step3Sucesso] Falha ao revalidar /api/me/wallet\", err);\n      }\n    }\n    revalidateTickets();\n  }, []);\n\n  const guestEmail =\n    additional && typeof additional.guestEmail === \"string\" ? additional.guestEmail : null;\n\n  const breakdown = (() => {\n    const add = additional ?? {};\n\n    const subtotalFromContext =\n      typeof checkoutBreakdown?.subtotalCents === \"number\" ? checkoutBreakdown.subtotalCents : null;\n\n    const subtotalFromLines =\n      checkoutBreakdown?.lines?.reduce((sum, line) => sum + Number(line.lineTotalCents ?? 0), 0) ?? null;\n\n    // If we lost the context breakdown (refresh), we fallback to additional.\n    // NOTE: `additional.total` is stored as euros in Step2, so we convert to cents.\n    const subtotalCentsRaw =\n      subtotalFromContext ??\n      numberFromUnknown(add.subtotalCents) ??\n      numberFromUnknown(add.totalCents) ??\n      centsFromAdditional(add, \"total\") ??\n      0;\n\n    const subtotalCents =\n      subtotalCentsRaw && subtotalCentsRaw > 0\n        ? subtotalCentsRaw\n        : subtotalFromLines && subtotalFromLines > 0\n          ? subtotalFromLines\n          : 0;\n\n    const feeModeRaw =\n      typeof checkoutBreakdown?.feeMode === \"string\"\n        ? checkoutBreakdown.feeMode\n        : typeof add.feeMode === \"string\"\n          ? (add.feeMode as string)\n          : null;\n    const feeMode =\n      typeof feeModeRaw === \"string\" ? feeModeRaw.toUpperCase() : null;\n\n    const discountCents =\n      typeof checkoutBreakdown?.discountCents === \"number\"\n        ? checkoutBreakdown.discountCents\n        : numberFromUnknown(add.discountCents) ?? 0;\n\n    const platformFeeOryaCents =\n      typeof (checkoutBreakdown as any)?.platformFeeOryaCents === \"number\"\n        ? (checkoutBreakdown as any).platformFeeOryaCents\n        : numberFromUnknown((add as any).platformFeeOryaCents) ??\n          numberFromUnknown(add.platformFeeCents) ??\n          0;\n\n    const platformFeeCombinedCents =\n      typeof (checkoutBreakdown as any)?.platformFeeCombinedCents === \"number\"\n        ? (checkoutBreakdown as any).platformFeeCombinedCents\n        : numberFromUnknown(add.platformFeeCents) ?? platformFeeOryaCents;\n\n    // S√≥ mostrar/contabilizar taxa se o modo for ADDED (pago pelo comprador).\n    const payorPaysFee = feeMode === \"ADDED\";\n    const platformFeeCents = payorPaysFee ? platformFeeCombinedCents : 0;\n\n    const totalCentsFromContext =\n      typeof checkoutBreakdown?.totalCents === \"number\" ? checkoutBreakdown.totalCents : null;\n\n    const totalCentsFromAdditional =\n      numberFromUnknown(add.totalCents) ?? centsFromAdditional(add, \"total\");\n\n    const computedTotalFallback = Math.max(0, subtotalCents - discountCents + platformFeeCents);\n\n    const totalCents = totalCentsFromContext ?? totalCentsFromAdditional ?? computedTotalFallback;\n\n    const code =\n      typeof add.appliedPromoLabel === \"string\"\n        ? add.appliedPromoLabel\n        : typeof add.promoCodeRaw === \"string\"\n          ? add.promoCodeRaw\n          : typeof add.promoCode === \"string\"\n            ? add.promoCode\n            : null;\n\n    const currency =\n      typeof checkoutBreakdown?.currency === \"string\"\n        ? checkoutBreakdown.currency\n        : typeof add.currency === \"string\"\n          ? add.currency\n          : \"EUR\";\n\n    if (\n      Number.isNaN(subtotalCents) &&\n      Number.isNaN(discountCents) &&\n      Number.isNaN(platformFeeCents) &&\n      Number.isNaN(totalCents)\n    ) {\n      return null;\n    }\n\n    return {\n      subtotalCents,\n      discountCents,\n      platformFeeCents,\n      totalCents,\n      code,\n      currency,\n      feeMode,\n    };\n  })();\n  const subtotalEur = breakdown ? breakdown.subtotalCents / 100 : null;\n  const discountEur = breakdown ? breakdown.discountCents / 100 : null;\n  const platformFeeEur = breakdown\n    ? ((breakdown as any).platformFeeCombinedCents ?? breakdown.platformFeeCents) / 100\n    : null;\n  const totalEur = breakdown ? breakdown.totalCents / 100 : null;\n\n  const initialStatus: \"PROCESSING\" | \"PAID\" | \"FAILED\" =\n    isFreeScenario ? \"PAID\" : purchaseId ? \"PROCESSING\" : \"PROCESSING\";\n  const [status, setStatus] = useState<\"PROCESSING\" | \"PAID\" | \"FAILED\">(initialStatus);\n\n  useEffect(() => {\n    if (isFreeScenario) setStatus(\"PAID\");\n  }, [isFreeScenario]);\n\n  useEffect(() => {\n    if (!purchaseId || isFreeScenario) return;\n\n    let cancelled = false;\n    let interval: ReturnType<typeof setInterval> | null = null;\n\n    const poll = async () => {\n      try {\n        const url = new URL(\"/api/checkout/status\", window.location.origin);\n        url.searchParams.set(\"purchaseId\", purchaseId);\n        if (paymentIntentId && paymentIntentId !== purchaseId) {\n          url.searchParams.set(\"paymentIntentId\", paymentIntentId);\n        }\n        const res = await fetch(url.toString(), { cache: \"no-store\" });\n        const data = await res.json().catch(() => null);\n        const mapped = normalizeCheckoutStatus(data?.status);\n        if (cancelled) return;\n\n        if (mapped === \"PAID\") {\n          setStatus(\"PAID\");\n          setStatusError(null);\n          if (interval) clearInterval(interval);\n          // revalidate once more after confirmed\n          try {\n            await fetch(\"/api/me/wallet\", { method: \"GET\", cache: \"no-store\" });\n          } catch {}\n          return;\n        }\n\n        if (mapped === \"FAILED\") {\n          setStatus(\"FAILED\");\n          setStatusError(typeof data?.error === \"string\" ? data.error : null);\n          if (interval) clearInterval(interval);\n          return;\n        }\n\n        setStatus(\"PROCESSING\");\n        setStatusError(null);\n      } catch (err) {\n        console.warn(\"[Step3Sucesso] Poll status falhou\", err);\n        if (!cancelled) setStatusError(null);\n      }\n    };\n\n    poll();\n    interval = setInterval(poll, 3000);\n\n    return () => {\n      cancelled = true;\n      if (interval) clearInterval(interval);\n    };\n  }, [purchaseId, isFreeScenario]);\n\n  if (!dados) {\n    return (\n      <div className=\"text-center space-y-4\">\n        <h2 className=\"text-xl font-semibold text-black\">Algo correu mal ü§î</h2>\n        <p className=\"text-sm text-black/70\">\n          N√£o encontr√°mos os dados do bilhete. Fecha esta janela e tenta novamente.\n        </p>\n        <button\n          onClick={fecharCheckout}\n          className=\"mt-4 w-full rounded-xl bg-black text-white py-2 text-sm font-medium hover:bg-black/80\"\n        >\n          Fechar\n        </button>\n      </div>\n    );\n  }\n\n  if (!purchaseId && !isFreeScenario) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex flex-col items-center text-center gap-6 py-6 px-4 text-white\">\n      <div className=\"w-full\">\n        <p className=\"text-[11px] uppercase tracking-[0.18em] text-white/55\">\n          Passo 3 de 3\n        </p>\n        <div className=\"mt-2 h-1 w-full rounded-full bg-white/10 overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.35)]\">\n          <div className=\"h-full w-full rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5]\" />\n        </div>\n      </div>\n\n      {/* T√≠tulo */}\n      <div className=\"space-y-1\">\n        <h2 className=\"text-3xl font-semibold bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] bg-clip-text text-transparent\">\n          {status === \"PAID\"\n            ? isFreeScenario\n              ? \"Inscri√ß√£o confirmada üéâ\"\n              : \"Compra Confirmada üéâ\"\n            : status === \"FAILED\"\n              ? \"Pagamento n√£o confirmado\"\n              : \"A confirmar pagamento‚Ä¶\"}\n        </h2>\n        <p className=\"text-sm text-white/70\">\n          {status === \"FAILED\"\n            ? statusError ?? \"N√£o conseguimos confirmar o pagamento. Tenta novamente ou contacta suporte.\"\n            : status === \"PAID\"\n              ? guestEmail\n                ? `Obrigado! Envi√°mos os teus bilhetes para ${guestEmail}.`\n                : isFreeScenario\n                  ? \"A tua inscri√ß√£o gratuita est√° confirmada.\"\n                  : \"Compra confirmada. J√° podes ver os teus bilhetes.\"\n              : guestEmail\n                ? `Estamos a confirmar o pagamento. Assim que estiver confirmado, vais receber os bilhetes em ${guestEmail}.`\n                : \"Estamos a confirmar o pagamento. Mant√©m esta p√°gina aberta.\"}\n        </p>\n      </div>\n\n      {/* Card principal estilo Apple Wallet */}\n      <div className=\"w-full rounded-3xl bg-white/[0.05] backdrop-blur-2xl border border-white/12 px-6 py-8 shadow-[0_20px_60px_rgba(0,0,0,0.55)] space-y-6\">\n\n        {/* Evento */}\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-widest text-white/50\">Evento</p>\n          <p className=\"text-xl font-semibold\">\n            {dados.ticketName ?? \"Bilhete\"}\n          </p>\n          {scenario && scenarioCopy[scenario] && (\n            <p className=\"text-[11px] text-white/70\">{scenarioCopy[scenario]}</p>\n          )}\n        </div>\n\n        {/* Breakdown */}\n        {status === \"PAID\" && breakdown && (\n          <div className=\"space-y-2 text-sm text-white/80\">\n            <div className=\"flex items-center justify-between border-b border-white/10 pb-2\">\n              <span className=\"text-white/60 text-[11px] uppercase tracking-widest\">Total dos bilhetes</span>\n              <span className=\"font-semibold\">\n                {formatEuro(subtotalEur)}\n              </span>\n            </div>\n            {breakdown.discountCents > 0 && (\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-white/60\">Desconto {breakdown.code ? `(${breakdown.code})` : \"\"}</span>\n                <span className=\"text-emerald-300\">-{formatEuro(discountEur)}</span>\n              </div>\n            )}\n            {(((breakdown as any).platformFeeCombinedCents ?? breakdown.platformFeeCents) ?? 0) > 0 && (\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-white/60\">Taxa da plataforma</span>\n                <span className=\"text-orange-200\">{formatEuro(platformFeeEur)}</span>\n              </div>\n            )}\n            <div className=\"flex items-center justify-between border-t border-white/10 pt-2\">\n              <span className=\"text-white text-[12px] font-semibold uppercase tracking-widest\">Total Pago</span>\n              <span className=\"text-xl font-semibold\">\n                {formatEuro(totalEur)}\n              </span>\n            </div>\n          </div>\n        )}\n\n        {/* Info */}\n        <div className=\"space-y-1 text-sm text-white/60\">\n          <p>\n            {status === \"PAID\"\n              ? guestEmail\n                ? \"Guarda o email com os bilhetes. Podes criar conta e ligar estes bilhetes mais tarde.\"\n                : \"A tua compra foi conclu√≠da com sucesso.\"\n              : status === \"FAILED\"\n                ? `O pagamento n√£o ficou confirmado. Se o teu banco debitou, contacta suporte${purchaseId ? ` com o ID de compra: ${purchaseId}` : \"\"}.`\n                : \"Estamos a confirmar o pagamento. Se demorares mais de alguns minutos, fecha e volta a abrir o checkout.\"}\n          </p>\n        </div>\n\n        {/* Bot√£o ver bilhetes */}\n        {status === \"PAID\" ? (\n          <button\n            onClick={() => (guestEmail ? router.push(\"/login\") : router.push(\"/me\"))}\n            className=\"w-full rounded-full bg-gradient-to-r from-[#FF00C8] via-[#6BFFFF] to-[#1646F5] text-black py-3 text-sm font-semibold shadow-[0_0_30px_rgba(107,255,255,0.55)] hover:scale-[1.03] active:scale-95 transition-transform\"\n          >\n            {guestEmail ? \"Criar conta e ligar bilhetes\" : \"Ver os teus bilhetes\"}\n          </button>\n        ) : status === \"FAILED\" ? (\n          <div className=\"w-full rounded-2xl border border-red-500/40 bg-red-500/10 text-sm text-red-100 py-3 text-center\">\n            Pagamento n√£o confirmado. Verifica o m√©todo de pagamento ou tenta novamente.\n          </div>\n        ) : (\n          <div className=\"w-full rounded-full border border-white/15 bg-white/10 text-white text-sm font-semibold py-3 text-center\">\n            A confirmar‚Ä¶\n          </div>\n        )}\n      </div>\n\n      {/* Fechar */}\n      <button\n        onClick={fecharCheckout}\n        className=\"w-full rounded-full border border-white/15 bg-white/10 text-white font-semibold py-2.5 text-sm shadow-[0_14px_30px_rgba(0,0,0,0.45)] hover:bg-white/20 hover:scale-[1.02] active:scale-95 transition\"\n      >\n        Fechar\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4921, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkout/ModalCheckout.tsx"],"sourcesContent":["\"use client\";\n\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { ReactNode, useEffect } from \"react\";\nimport { useCheckout } from \"./contextoCheckout\";\nimport Step1Bilhete from \"./Step1Bilhete\";\nimport Step2Pagamento from \"./Step2Pagamento\";\nimport Step3Sucesso from \"./Step3Sucesso\";\n\ntype ModalCheckoutProps = {\n  children: ReactNode;\n};\n\nexport default function ModalCheckout() {\n  const { isOpen, passo, fecharCheckout, irParaPasso } = useCheckout();\n\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = \"hidden\";\n    } else {\n      document.body.style.overflow = \"\";\n    }\n\n    return () => {\n      document.body.style.overflow = \"\";\n    };\n  }, [isOpen]);\n\n  // üî• Escutar evento vindo do WavesSectionClient e for√ßar passo 1\n  useEffect(() => {\n    function forceStep1() {\n      irParaPasso(1);\n    }\n    window.addEventListener(\"ORYA_CHECKOUT_FORCE_STEP1\", forceStep1);\n    return () => window.removeEventListener(\"ORYA_CHECKOUT_FORCE_STEP1\", forceStep1);\n  }, [irParaPasso]);\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Overlay */}\n          <motion.div\n            className=\"fixed inset-0 z-[200] bg-gradient-to-br from-[#040712]/90 via-[#050918]/85 to-[#02040c]/90 backdrop-blur-3xl\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={fecharCheckout}\n          />\n\n          {/* Modal */}\n          <motion.div\n            className=\"fixed inset-0 z-[210] flex items-center justify-center p-4 overflow-hidden\"\n            initial={{ opacity: 0, y: 40 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 30 }}\n          >\n            <div className=\"relative w-full max-w-3xl max-h-[88vh] rounded-3xl border border-white/12 bg-white/[0.08] backdrop-blur-2xl shadow-[0_30px_100px_rgba(0,0,0,0.6)] text-white overflow-hidden\">\n              {/* ambient glows */}\n              <div className=\"pointer-events-none absolute -left-24 -top-32 h-72 w-72 rounded-full bg-[radial-gradient(circle_at_center,_rgba(255,0,200,0.35),_transparent_60%)] blur-2xl\" />\n              <div className=\"pointer-events-none absolute -right-24 -bottom-32 h-72 w-72 rounded-full bg-[radial-gradient(circle_at_center,_rgba(107,255,255,0.32),_transparent_60%)] blur-2xl\" />\n              <div className=\"relative\">\n                <div className=\"flex items-center justify-between px-6 py-4 border-b border-white/10 bg-white/5 backdrop-blur-xl\">\n                  {passo > 1 && passo !== 3 ? (\n                    <button\n                      type=\"button\"\n                      onClick={() => irParaPasso(Math.max(1, passo - 1) as 1 | 2 | 3)}\n                    className=\"text-[12px] inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-3 py-1 text-white/75 hover:text-white hover:border-white/30 transition\"\n                    >\n                    ‚Üê Voltar\n                    </button>\n                  ) : (\n                    <span className=\"text-[12px] text-white/60\">\n                      {passo === 3 ? \"Pagamento conclu√≠do\" : \"Checkout\"}\n                    </span>\n                  )}\n                  <button\n                    type=\"button\"\n                    onClick={fecharCheckout}\n                    className=\"h-9 w-9 inline-flex items-center justify-center rounded-full border border-white/15 bg-white/10 text-white/85 hover:bg-white/20 transition\"\n                    aria-label=\"Fechar checkout\"\n                  >\n                    √ó\n                  </button>\n                </div>\n                <div className=\"p-6 overflow-y-auto max-h-[78vh] bg-gradient-to-b from-white/[0.03] via-transparent to-white/[0.02]\">\n                  <StepController />\n                </div>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n\nfunction StepController() {\n  const { passo, irParaPasso } = useCheckout();\n\n  useEffect(() => {\n    function handler() {\n      irParaPasso(1);\n    }\n    window.addEventListener(\"ORYA_CHECKOUT_FORCE_STEP1\", handler);\n    return () => window.removeEventListener(\"ORYA_CHECKOUT_FORCE_STEP1\", handler);\n  }, [irParaPasso]);\n\n  return (\n    <>\n      {passo === 1 && <Step1Bilhete />}\n      {passo === 2 && <Step2Pagamento />}\n      {passo === 3 && <Step3Sucesso />}\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAae,SAAS;IACtB,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,cAAc,EAAE,WAAW,EAAE,GAAG,IAAA,iKAAW;IAElE,IAAA,kNAAS,EAAC;QACR,IAAI,QAAQ;YACV,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC;QAEA,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC;IACF,GAAG;QAAC;KAAO;IAEX,iEAAiE;IACjE,IAAA,kNAAS,EAAC;QACR,SAAS;YACP,YAAY;QACd;QACA,OAAO,gBAAgB,CAAC,6BAA6B;QACrD,OAAO,IAAM,OAAO,mBAAmB,CAAC,6BAA6B;IACvE,GAAG;QAAC;KAAY;IAEhB,qBACE,8OAAC,4MAAe;kBACb,wBACC;;8BAEE,8OAAC,oMAAM,CAAC,GAAG;oBACT,WAAU;oBACV,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,SAAS;;;;;;8BAIX,8OAAC,oMAAM,CAAC,GAAG;oBACT,WAAU;oBACV,SAAS;wBAAE,SAAS;wBAAG,GAAG;oBAAG;oBAC7B,SAAS;wBAAE,SAAS;wBAAG,GAAG;oBAAE;oBAC5B,MAAM;wBAAE,SAAS;wBAAG,GAAG;oBAAG;8BAE1B,cAAA,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC;gCAAI,WAAU;;;;;;0CACf,8OAAC;gCAAI,WAAU;;;;;;0CACf,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;4CACZ,QAAQ,KAAK,UAAU,kBACtB,8OAAC;gDACC,MAAK;gDACL,SAAS,IAAM,YAAY,KAAK,GAAG,CAAC,GAAG,QAAQ;gDACjD,WAAU;0DACT;;;;;qEAID,8OAAC;gDAAK,WAAU;0DACb,UAAU,IAAI,wBAAwB;;;;;;0DAG3C,8OAAC;gDACC,MAAK;gDACL,SAAS;gDACT,WAAU;gDACV,cAAW;0DACZ;;;;;;;;;;;;kDAIH,8OAAC;wCAAI,WAAU;kDACb,cAAA,8OAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASnB;AAEA,SAAS;IACP,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,IAAA,iKAAW;IAE1C,IAAA,kNAAS,EAAC;QACR,SAAS;YACP,YAAY;QACd;QACA,OAAO,gBAAgB,CAAC,6BAA6B;QACrD,OAAO,IAAM,OAAO,mBAAmB,CAAC,6BAA6B;IACvE,GAAG;QAAC;KAAY;IAEhB,qBACE;;YACG,UAAU,mBAAK,8OAAC,yJAAY;;;;;YAC5B,UAAU,mBAAK,8OAAC,2JAAc;;;;;YAC9B,UAAU,mBAAK,8OAAC,yJAAY;;;;;;;AAGnC"}},
    {"offset": {"line": 5128, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/eventos/%5Bslug%5D/EventPageClient.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useRef } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport ModalCheckout from \"@/app/components/checkout/ModalCheckout\";\nimport { useCheckout } from \"@/app/components/checkout/contextoCheckout\";\n\ntype WaveTicket = {\n  id: string;\n  name: string;\n  price: number;\n  currency: string;\n  remaining: number | null;\n  status: \"on_sale\" | \"upcoming\" | \"closed\" | \"sold_out\";\n  startsAt: string | null;\n  endsAt: string | null;\n  available: boolean;\n  isVisible: boolean;\n  padelCategoryId?: number | null;\n  padelCategoryLinkId?: number | null;\n};\n\ntype EventPageClientProps = {\n  slug: string;\n  uiTickets: WaveTicket[];\n  checkoutUiVariant: \"DEFAULT\" | \"PADEL\";\n  padelMeta?: {\n    eventId: number;\n    organizerId: number | null;\n    categoryId?: number | null;\n    categoryLinkId?: number | null;\n  };\n  defaultPadelTicketId?: number | null;\n};\n\ntype InvitePairing = {\n  id: number;\n  paymentMode: \"FULL\" | \"SPLIT\" | string;\n  eventId: number;\n  slots: Array<{\n    id: number;\n    slotStatus: string;\n    paymentStatus: string;\n    profileId: string | null;\n    invitedContact: string | null;\n    slotRole: string;\n  }>;\n};\n\nexport default function EventPageClient({\n  slug,\n  uiTickets,\n  checkoutUiVariant,\n  padelMeta,\n  defaultPadelTicketId,\n}: EventPageClientProps) {\n  const searchParams = useSearchParams();\n  const { abrirCheckout, atualizarDados, irParaPasso } = useCheckout();\n  const inviteHandledRef = useRef<string | null>(null);\n  const checkoutHandledRef = useRef(false);\n\n  const inviteToken = searchParams.get(\"inviteToken\");\n\n  const fallbackWaves = useMemo(() => {\n    if (uiTickets && uiTickets.length > 0) return uiTickets;\n    return [];\n  }, [uiTickets]);\n\n  useEffect(() => {\n    const wantsCheckout = searchParams.get(\"checkout\");\n    if (!wantsCheckout || checkoutHandledRef.current) return;\n\n    const visibleTickets = fallbackWaves.filter((ticket) => ticket.isVisible);\n    const purchasableTickets = visibleTickets.filter(\n      (ticket) => ticket.status === \"on_sale\" || ticket.status === \"upcoming\",\n    );\n    const preferredTicket =\n      typeof defaultPadelTicketId === \"number\"\n        ? visibleTickets.find((ticket) => Number(ticket.id) === defaultPadelTicketId)\n        : null;\n    const selectedTicket = preferredTicket ?? purchasableTickets[0] ?? visibleTickets[0];\n\n    if (!selectedTicket) return;\n    checkoutHandledRef.current = true;\n\n    atualizarDados({\n      slug,\n      waves: visibleTickets,\n      additional: { checkoutUiVariant, padelMeta },\n    });\n\n    abrirCheckout({\n      slug,\n      ticketId: selectedTicket.id,\n      price: selectedTicket.price,\n      ticketName: selectedTicket.name,\n      eventId: padelMeta?.eventId ? String(padelMeta.eventId) : undefined,\n      waves: visibleTickets,\n      additional: { checkoutUiVariant, padelMeta },\n    });\n\n    setTimeout(() => {\n      try {\n        const evt = new Event(\"ORYA_CHECKOUT_FORCE_STEP1\");\n        window.dispatchEvent(evt);\n      } catch {}\n    }, 30);\n  }, [\n    abrirCheckout,\n    atualizarDados,\n    checkoutUiVariant,\n    defaultPadelTicketId,\n    fallbackWaves,\n    padelMeta,\n    searchParams,\n    slug,\n  ]);\n\n  useEffect(() => {\n    if (!inviteToken) return;\n    if (inviteHandledRef.current === inviteToken) return;\n    inviteHandledRef.current = inviteToken;\n\n    let cancelled = false;\n\n    const handleInvite = async () => {\n      try {\n        const res = await fetch(`/api/padel/pairings/claim/${encodeURIComponent(inviteToken)}`);\n        const json = await res.json().catch(() => null);\n        if (!res.ok || !json?.ok || !json?.pairing?.id) {\n          throw new Error(json?.error || \"Convite inv√°lido.\");\n        }\n\n        if (cancelled) return;\n\n        const pairing = json.pairing as InvitePairing;\n        const pairingMode = pairing.paymentMode === \"FULL\" ? \"GROUP_FULL\" : \"GROUP_SPLIT\";\n        const pendingSlot =\n          pairing.slots.find((s) => s.slotStatus === \"PENDING\" || s.paymentStatus === \"UNPAID\") ??\n          pairing.slots[0];\n\n        if (!pendingSlot) {\n          throw new Error(\"N√£o foi poss√≠vel identificar o slot da dupla.\");\n        }\n\n        const ticketTypes: Array<{ id: number; name: string; price: number; currency?: string | null }> =\n          Array.isArray(json.ticketTypes) ? json.ticketTypes : [];\n\n        const preferredTicketId =\n          typeof defaultPadelTicketId === \"number\" && ticketTypes.some((t) => t.id === defaultPadelTicketId)\n            ? defaultPadelTicketId\n            : ticketTypes.length > 0\n              ? ticketTypes[0].id\n              : null;\n\n        const fallbackTicket =\n          typeof preferredTicketId === \"number\"\n            ? ticketTypes.find((t) => t.id === preferredTicketId) ?? ticketTypes[0]\n            : ticketTypes[0];\n\n        const ticketFromWaves =\n          typeof preferredTicketId === \"number\"\n            ? fallbackWaves.find((w) => Number(w.id) === preferredTicketId)\n            : null;\n\n        const ticketId = ticketFromWaves\n          ? Number(ticketFromWaves.id)\n          : fallbackTicket?.id ?? null;\n\n        if (!ticketId) {\n          throw new Error(\"Bilhete inv√°lido para este convite.\");\n        }\n\n        const unitPrice =\n          ticketFromWaves?.price ??\n          (typeof fallbackTicket?.price === \"number\" ? fallbackTicket.price : 0);\n\n        const ticketName =\n          ticketFromWaves?.name ??\n          (fallbackTicket?.name || \"Bilhete Padel\");\n\n        const waves =\n          fallbackWaves.length > 0\n            ? fallbackWaves\n            : ticketTypes.map((t) => ({\n                id: String(t.id),\n                name: t.name ?? \"Bilhete\",\n                price: t.price ?? 0,\n                currency: t.currency ?? \"EUR\",\n                remaining: null,\n                status: \"on_sale\" as const,\n                startsAt: null,\n                endsAt: null,\n                available: true,\n                isVisible: true,\n              }));\n\n        const quantity = pairingMode === \"GROUP_FULL\" ? 2 : 1;\n        const total = unitPrice * quantity;\n\n        const pairingCategoryId =\n          typeof json?.pairing?.categoryId === \"number\" ? json.pairing.categoryId : null;\n        const metaFromInvite = {\n          eventId: pairing.eventId,\n          organizerId: json.organizerId ?? null,\n          categoryId: pairingCategoryId,\n          categoryLinkId: ticketFromWaves?.padelCategoryLinkId ?? null,\n        };\n\n        if (pendingSlot.paymentStatus === \"PAID\") {\n          const claimRes = await fetch(`/api/padel/pairings/claim/${encodeURIComponent(inviteToken)}`, {\n            method: \"POST\",\n          });\n          const claimJson = await claimRes.json().catch(() => null);\n          if (!claimRes.ok || !claimJson?.ok) {\n            throw new Error(claimJson?.error || \"N√£o foi poss√≠vel aceitar o convite.\");\n          }\n          alert(\"Convite aceite. J√° est√°s inscrito.\");\n          return;\n        }\n\n        const additional = {\n          checkoutUiVariant,\n          padelMeta: metaFromInvite,\n          pairingId: pairing.id,\n          pairingSlotId: pendingSlot.id,\n          ticketTypeId: ticketId,\n          inviteToken,\n          quantidades: { [ticketId]: quantity },\n          total,\n        };\n\n        abrirCheckout({\n          slug,\n          ticketId: String(ticketId),\n          price: unitPrice,\n          ticketName,\n          eventId: String(pairing.eventId),\n          waves,\n          additional,\n          pairingId: pairing.id,\n          pairingSlotId: pendingSlot.id,\n          ticketTypeId: ticketId,\n        });\n        atualizarDados({\n          paymentScenario: pairingMode,\n          additional,\n        });\n        irParaPasso(2);\n      } catch (err) {\n        console.error(\"[EventPageClient] convite padel\", err);\n        alert(err instanceof Error ? err.message : \"Erro ao processar o convite.\");\n      }\n    };\n\n    void handleInvite();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [\n    abrirCheckout,\n    atualizarDados,\n    checkoutUiVariant,\n    defaultPadelTicketId,\n    fallbackWaves,\n    inviteToken,\n    irParaPasso,\n    padelMeta,\n    slug,\n  ]);\n\n  return <ModalCheckout />;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5320, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/avatars.ts"],"sourcesContent":["export const DEFAULT_GUEST_AVATAR = \"/images/guest-avatar.svg\";\n"],"names":[],"mappings":";;;;AAAO,MAAM,uBAAuB"}},
    {"offset": {"line": 5329, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerPremium.ts"],"sourcesContent":["import type { LiveHubModule } from \"@/lib/liveHubConfig\";\n\ntype OrganizerRef = {\n  id?: number | null;\n  username?: string | null;\n  // Gerido por subscri√ß√£o (SaaS), n√£o editar manualmente na UI.\n  liveHubPremiumEnabled?: boolean | null;\n};\n\ntype OrganizerPremiumModules = {\n  inscricoes?: boolean;\n  loja?: boolean;\n  galeria?: boolean;\n};\n\ntype LiveHubMatchOrder = \"ONEVONE\";\n\ntype OrganizerPremiumConfig = {\n  key: \"ONEVONE\";\n  organizerId: number;\n  username: string;\n  liveHubModules?: LiveHubModule[];\n  profileModules?: OrganizerPremiumModules;\n  liveHubMatchOrder?: LiveHubMatchOrder;\n};\n\nconst CUSTOM_PREMIUM_CONFIGS: OrganizerPremiumConfig[] = [\n  {\n    key: \"ONEVONE\",\n    organizerId: 23,\n    username: \"onevone\",\n    liveHubModules: [\"HERO\", \"VIDEO\", \"NOW_PLAYING\", \"NEXT_MATCHES\", \"RESULTS\", \"BRACKET\", \"SPONSORS\"],\n    profileModules: { inscricoes: true, loja: true, galeria: true },\n    liveHubMatchOrder: \"ONEVONE\",\n  },\n];\n\nconst normalizeUsername = (value?: string | null) => (typeof value === \"string\" ? value.trim().toLowerCase() : \"\");\n\nexport function getCustomPremiumConfig(organizer?: OrganizerRef | null) {\n  if (!organizer) return null;\n  const normalizedUsername = normalizeUsername(organizer.username);\n  return (\n    CUSTOM_PREMIUM_CONFIGS.find(\n      (config) =>\n        (config.organizerId && organizer.id === config.organizerId) ||\n        (normalizedUsername && config.username === normalizedUsername),\n    ) ?? null\n  );\n}\n\nexport function isCustomPremiumOrganizer(organizer?: OrganizerRef | null) {\n  return Boolean(getCustomPremiumConfig(organizer));\n}\n\nexport function isCustomPremiumActive(organizer?: OrganizerRef | null, premiumEnabled?: boolean | null) {\n  const config = getCustomPremiumConfig(organizer);\n  if (!config) return false;\n  const enabled = premiumEnabled ?? organizer?.liveHubPremiumEnabled ?? false;\n  return Boolean(enabled);\n}\n\nexport function getCustomPremiumKey(organizer?: OrganizerRef | null) {\n  return getCustomPremiumConfig(organizer)?.key ?? null;\n}\n\nexport function getCustomLiveHubModules(organizer?: OrganizerRef | null) {\n  return getCustomPremiumConfig(organizer)?.liveHubModules ?? null;\n}\n\nexport function getCustomPremiumProfileModules(organizer?: OrganizerRef | null) {\n  return getCustomPremiumConfig(organizer)?.profileModules ?? null;\n}\n\nexport function getCustomLiveHubMatchOrder(organizer?: OrganizerRef | null) {\n  return getCustomPremiumConfig(organizer)?.liveHubMatchOrder ?? null;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AA0BA,MAAM,yBAAmD;IACvD;QACE,KAAK;QACL,aAAa;QACb,UAAU;QACV,gBAAgB;YAAC;YAAQ;YAAS;YAAe;YAAgB;YAAW;YAAW;SAAW;QAClG,gBAAgB;YAAE,YAAY;YAAM,MAAM;YAAM,SAAS;QAAK;QAC9D,mBAAmB;IACrB;CACD;AAED,MAAM,oBAAoB,CAAC,QAA2B,OAAO,UAAU,WAAW,MAAM,IAAI,GAAG,WAAW,KAAK;AAExG,SAAS,uBAAuB,SAA+B;IACpE,IAAI,CAAC,WAAW,OAAO;IACvB,MAAM,qBAAqB,kBAAkB,UAAU,QAAQ;IAC/D,OACE,uBAAuB,IAAI,CACzB,CAAC,SACC,AAAC,OAAO,WAAW,IAAI,UAAU,EAAE,KAAK,OAAO,WAAW,IACzD,sBAAsB,OAAO,QAAQ,KAAK,uBAC1C;AAET;AAEO,SAAS,yBAAyB,SAA+B;IACtE,OAAO,QAAQ,uBAAuB;AACxC;AAEO,SAAS,sBAAsB,SAA+B,EAAE,cAA+B;IACpG,MAAM,SAAS,uBAAuB;IACtC,IAAI,CAAC,QAAQ,OAAO;IACpB,MAAM,UAAU,kBAAkB,WAAW,yBAAyB;IACtE,OAAO,QAAQ;AACjB;AAEO,SAAS,oBAAoB,SAA+B;IACjE,OAAO,uBAAuB,YAAY,OAAO;AACnD;AAEO,SAAS,wBAAwB,SAA+B;IACrE,OAAO,uBAAuB,YAAY,kBAAkB;AAC9D;AAEO,SAAS,+BAA+B,SAA+B;IAC5E,OAAO,uBAAuB,YAAY,kBAAkB;AAC9D;AAEO,SAAS,2BAA2B,SAA+B;IACxE,OAAO,uBAAuB,YAAY,qBAAqB;AACjE"}},
    {"offset": {"line": 5398, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/eventos/%5Bslug%5D/EventLiveClient.tsx"],"sourcesContent":["\"use client\";\n\nimport useSWR from \"swr\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname, useSearchParams } from \"next/navigation\";\nimport type { LiveHubModule, LiveHubViewerRole } from \"@/lib/liveHubConfig\";\nimport { DEFAULT_GUEST_AVATAR } from \"@/lib/avatars\";\nimport { useAuthModal } from \"@/app/components/autentica√ß√£o/AuthModalContext\";\nimport { useUser } from \"@/app/hooks/useUser\";\nimport { getCustomLiveHubMatchOrder } from \"@/lib/organizerPremium\";\n\nconst fetcher = (url: string) => fetch(url).then((r) => r.json());\nconst LOCALE = \"pt-PT\";\nconst DEFAULT_TIMEZONE = \"Europe/Lisbon\";\n\ntype PairingMeta = {\n  id: number;\n  label: string;\n  subLabel?: string | null;\n  avatarUrl?: string | null;\n  profileUsername?: string | null;\n  href?: string | null;\n};\n\ntype EventPayload = {\n  id: number;\n  slug: string;\n  title: string;\n  description: string | null;\n  templateType?: string | null;\n  startsAt: string;\n  endsAt: string;\n  status: string;\n  locationName: string;\n  locationCity: string | null;\n  coverImageUrl: string | null;\n  liveStreamUrl: string | null;\n  timezone?: string | null;\n};\n\ntype MatchPayload = {\n  id: number;\n  stageId: number;\n  groupId?: number | null;\n  pairing1Id?: number | null;\n  pairing2Id?: number | null;\n  courtId?: number | null;\n  round?: number | null;\n  roundLabel?: string | null;\n  startAt?: string | null;\n  status: string;\n  statusLabel: string;\n  score?: { sets?: Array<{ a: number; b: number }>; goals?: { a: number; b: number; limit?: number } } | null;\n  updatedAt?: string | null;\n};\n\ntype SponsorSlot = {\n  label?: string | null;\n  logoUrl?: string | null;\n  url?: string | null;\n};\n\ntype SponsorsConfig = {\n  hero?: SponsorSlot | null;\n  sideA?: SponsorSlot | null;\n  sideB?: SponsorSlot | null;\n  nowPlaying?: SponsorSlot | null;\n} | null;\n\ntype GoalLimitsConfig = {\n  defaultLimit?: number | null;\n  roundLimits?: Record<string, number> | null;\n} | null;\n\nfunction formatDateRange(start?: string, end?: string, timeZone: string = DEFAULT_TIMEZONE) {\n  if (!start) return \"\";\n  const startDate = new Date(start);\n  const endDate = end ? new Date(end) : null;\n  const day = startDate.toLocaleDateString(LOCALE, { day: \"2-digit\", month: \"long\", timeZone });\n  const time = startDate.toLocaleTimeString(LOCALE, { hour: \"2-digit\", minute: \"2-digit\", timeZone });\n  if (!endDate) return `${day} ¬∑ ${time}`;\n  const endTime = endDate.toLocaleTimeString(LOCALE, { hour: \"2-digit\", minute: \"2-digit\", timeZone });\n  return `${day} ¬∑ ${time} - ${endTime}`;\n}\n\nfunction formatTime(value?: string | null, timeZone: string = DEFAULT_TIMEZONE) {\n  if (!value) return \"Por definir\";\n  return new Date(value).toLocaleTimeString(LOCALE, { hour: \"2-digit\", minute: \"2-digit\", timeZone });\n}\n\nfunction formatCountdown(start?: string, nowMs?: number) {\n  if (!start || !nowMs) return null;\n  const diff = new Date(start).getTime() - nowMs;\n  if (diff <= 0) return null;\n  const totalSeconds = Math.floor(diff / 1000);\n  const days = Math.floor(totalSeconds / 86400);\n  const hours = Math.floor((totalSeconds % 86400) / 3600);\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\n  const seconds = totalSeconds % 60;\n  if (days > 0) return `${days}d ${hours}h ${minutes}m`;\n  if (hours > 0) return `${hours}h ${minutes}m`;\n  return `${minutes}m ${seconds}s`;\n}\n\nfunction getEventStatusLabel(start?: string, end?: string) {\n  if (!start) return \"Por anunciar\";\n  const now = new Date();\n  const startsAt = new Date(start);\n  const endsAt = end ? new Date(end) : null;\n  if (now < startsAt) return \"Pr√≥ximo\";\n  if (endsAt && now > endsAt) return \"Conclu√≠do\";\n  return \"A decorrer\";\n}\n\nfunction escapeIcsText(value?: string | null) {\n  if (!value) return \"\";\n  return value.replace(/\\\\/g, \"\\\\\\\\\").replace(/\\n/g, \"\\\\n\").replace(/,/g, \"\\\\,\").replace(/;/g, \"\\\\;\");\n}\n\nfunction formatCalendarDate(value: Date) {\n  return value.toISOString().replace(/[-:]/g, \"\").replace(/\\.\\d{3}Z$/, \"Z\");\n}\n\nfunction buildCalendarLinks(event: EventPayload, timeZone: string) {\n  const startsAt = new Date(event.startsAt);\n  const endsAt = event.endsAt ? new Date(event.endsAt) : startsAt;\n  const location = [event.locationName, event.locationCity].filter(Boolean).join(\" ¬∑ \");\n  const description = event.description?.trim() || `Evento ${event.title}`;\n  const dtStart = formatCalendarDate(startsAt);\n  const dtEnd = formatCalendarDate(endsAt);\n  const uid = `${event.slug || event.id}@orya`;\n\n  const googleUrl = new URL(\"https://calendar.google.com/calendar/render\");\n  googleUrl.searchParams.set(\"action\", \"TEMPLATE\");\n  googleUrl.searchParams.set(\"text\", event.title);\n  googleUrl.searchParams.set(\"dates\", `${dtStart}/${dtEnd}`);\n  if (description) googleUrl.searchParams.set(\"details\", description);\n  if (location) googleUrl.searchParams.set(\"location\", location);\n  if (timeZone) googleUrl.searchParams.set(\"ctz\", timeZone);\n\n  const icsLines = [\n    \"BEGIN:VCALENDAR\",\n    \"VERSION:2.0\",\n    \"PRODID:-//ORYA//LiveHub//PT\",\n    \"BEGIN:VEVENT\",\n    `UID:${escapeIcsText(uid)}`,\n    `DTSTAMP:${formatCalendarDate(new Date())}`,\n    `DTSTART:${dtStart}`,\n    `DTEND:${dtEnd}`,\n    `SUMMARY:${escapeIcsText(event.title)}`,\n    `DESCRIPTION:${escapeIcsText(description)}`,\n    `LOCATION:${escapeIcsText(location)}`,\n    \"END:VEVENT\",\n    \"END:VCALENDAR\",\n  ];\n\n  const icsUrl = `data:text/calendar;charset=utf-8,${encodeURIComponent(icsLines.join(\"\\n\"))}`;\n  return { google: googleUrl.toString(), ics: icsUrl };\n}\n\nfunction compareMatchOrder(a: MatchPayload, b: MatchPayload) {\n  if (a.startAt && b.startAt) {\n    const diff = new Date(a.startAt).getTime() - new Date(b.startAt).getTime();\n    if (diff !== 0) return diff;\n  } else if (a.startAt && !b.startAt) {\n    return -1;\n  } else if (!a.startAt && b.startAt) {\n    return 1;\n  }\n  const aRound = a.round ?? 0;\n  const bRound = b.round ?? 0;\n  if (aRound !== bRound) return aRound - bRound;\n  return a.id - b.id;\n}\n\nfunction compareBracketOrder(a: MatchPayload, b: MatchPayload) {\n  const aRound = a.round ?? 0;\n  const bRound = b.round ?? 0;\n  if (aRound !== bRound) return aRound - bRound;\n  return a.id - b.id;\n}\n\nfunction formatScore(score?: MatchPayload[\"score\"]) {\n  if (score?.goals) return `${score.goals.a}-${score.goals.b}`;\n  if (score?.sets?.length) return score.sets.map((s) => `${s.a}-${s.b}`).join(\" ¬∑ \");\n  return \"‚Äî\";\n}\n\nfunction getScoreSummary(score?: MatchPayload[\"score\"]) {\n  if (score?.goals) {\n    return { a: score.goals.a, b: score.goals.b };\n  }\n  if (!score?.sets?.length) return null;\n  let a = 0;\n  let b = 0;\n  score.sets.forEach((s) => {\n    if (s.a > s.b) a += 1;\n    if (s.b > s.a) b += 1;\n  });\n  return { a, b };\n}\n\nfunction getWinnerSide(score?: MatchPayload[\"score\"]) {\n  if (score?.goals) {\n    const limit = score.goals.limit;\n    if (Number.isFinite(limit)) {\n      if (score.goals.a === limit) return \"A\";\n      if (score.goals.b === limit) return \"B\";\n      return null;\n    }\n    if (score.goals.a === score.goals.b) return null;\n    return score.goals.a > score.goals.b ? \"A\" : \"B\";\n  }\n  const summary = getScoreSummary(score);\n  if (!summary) return null;\n  if (summary.a === summary.b) return null;\n  return summary.a > summary.b ? \"A\" : \"B\";\n}\n\nfunction resolveBracketAdvancement(matches: MatchPayload[]) {\n  const cloned = matches.map((match) => ({ ...match }));\n  const matchesByRound = cloned.reduce<Record<number, MatchPayload[]>>((acc, match) => {\n    const round = match.round ?? 0;\n    if (round <= 0) return acc;\n    if (!acc[round]) acc[round] = [];\n    acc[round].push(match);\n    return acc;\n  }, {});\n  const rounds = Object.keys(matchesByRound)\n    .map((round) => Number(round))\n    .filter((round) => round > 0)\n    .sort((a, b) => a - b);\n\n  for (let idx = 0; idx < rounds.length - 1; idx += 1) {\n    const round = rounds[idx];\n    const nextRound = rounds[idx + 1];\n    const currentMatches = (matchesByRound[round] ?? []).slice().sort(compareBracketOrder);\n    const nextMatches = (matchesByRound[nextRound] ?? []).slice().sort(compareBracketOrder);\n\n    currentMatches.forEach((match, matchIdx) => {\n      if (match.status !== \"DONE\") return;\n      const winnerSide = getWinnerSide(match.score);\n      if (!winnerSide) return;\n      const winnerPairingId = winnerSide === \"A\" ? match.pairing1Id : match.pairing2Id;\n      if (!winnerPairingId) return;\n      const target = nextMatches[Math.floor(matchIdx / 2)];\n      if (!target) return;\n      if (matchIdx % 2 === 0) {\n        if (!target.pairing1Id) target.pairing1Id = winnerPairingId;\n      } else if (!target.pairing2Id) {\n        target.pairing2Id = winnerPairingId;\n      }\n    });\n  }\n\n  return cloned;\n}\n\nfunction buildRoundLabels(totalRounds: number) {\n  if (totalRounds <= 1) return [\"Final\"];\n  if (totalRounds === 2) return [\"Meias\", \"Final\"];\n  if (totalRounds === 3) return [\"Quartos\", \"Meias\", \"Final\"];\n  if (totalRounds === 4) return [\"Oitavos\", \"Quartos\", \"Meias\", \"Final\"];\n  if (totalRounds === 5) return [\"R32\", \"Oitavos\", \"Quartos\", \"Meias\", \"Final\"];\n  return [\"R64\", \"R32\", \"Oitavos\", \"Quartos\", \"Meias\", \"Final\"];\n}\n\nfunction normalizeGoalLimits(input: GoalLimitsConfig): GoalLimitsConfig {\n  if (!input) return null;\n  const defaultLimit =\n    typeof input.defaultLimit === \"number\" && Number.isFinite(input.defaultLimit) ? input.defaultLimit : null;\n  const roundLimitsRaw = input.roundLimits ?? null;\n  const roundLimits: Record<string, number> = {};\n  if (roundLimitsRaw && typeof roundLimitsRaw === \"object\") {\n    Object.entries(roundLimitsRaw).forEach(([key, value]) => {\n      if (typeof value === \"number\" && Number.isFinite(value)) {\n        roundLimits[key] = value;\n      }\n    });\n  }\n  return {\n    defaultLimit,\n    roundLimits: Object.keys(roundLimits).length ? roundLimits : null,\n  };\n}\n\nfunction resolveGoalLimit(round: number | null | undefined, limits: GoalLimitsConfig) {\n  const normalized = normalizeGoalLimits(limits);\n  const fallback = normalized?.defaultLimit ?? 3;\n  if (!round || !normalized?.roundLimits) return fallback;\n  const roundKey = String(round);\n  const roundLimit = normalized.roundLimits[roundKey];\n  return Number.isFinite(roundLimit) ? roundLimit : fallback;\n}\n\nfunction getStreamEmbed(url?: string | null) {\n  if (!url) return { embedUrl: null, href: null, provider: null };\n  try {\n    const parsed = new URL(url);\n    const host = parsed.hostname.replace(/^www\\./, \"\");\n    const parentHost =\n      typeof window !== \"undefined\"\n        ? window.location.hostname\n        : (process.env.NEXT_PUBLIC_BASE_URL ?? process.env.NEXT_PUBLIC_APP_URL ?? \"app.orya.pt\")\n            .replace(/^https?:\\/\\//, \"\");\n\n    if (host === \"youtu.be\") {\n      const id = parsed.pathname.split(\"/\").filter(Boolean)[0];\n      return id\n        ? { embedUrl: `https://www.youtube.com/embed/${id}`, href: url, provider: \"youtube\" }\n        : { embedUrl: null, href: url, provider: \"youtube\" };\n    }\n\n    if (host.endsWith(\"youtube.com\")) {\n      const queryId = parsed.searchParams.get(\"v\");\n      if (queryId) {\n        return { embedUrl: `https://www.youtube.com/embed/${queryId}`, href: url, provider: \"youtube\" };\n      }\n      const parts = parsed.pathname.split(\"/\").filter(Boolean);\n      const pathType = parts[0];\n      const pathId = parts[1];\n      if (pathId && [\"live\", \"embed\", \"shorts\"].includes(pathType)) {\n        return { embedUrl: `https://www.youtube.com/embed/${pathId}`, href: url, provider: \"youtube\" };\n      }\n      return { embedUrl: null, href: url, provider: \"youtube\" };\n    }\n\n    if (host.endsWith(\"twitch.tv\") || host === \"player.twitch.tv\") {\n      let channel = parsed.searchParams.get(\"channel\");\n      let video = parsed.searchParams.get(\"video\");\n\n      if (!channel && !video) {\n        const parts = parsed.pathname.split(\"/\").filter(Boolean);\n        if (parts[0] === \"videos\" && parts[1]) {\n          video = parts[1];\n        } else if (parts[0]) {\n          channel = parts[0];\n        }\n      }\n\n      const embedBase = \"https://player.twitch.tv/\";\n      if (channel) {\n        return {\n          embedUrl: `${embedBase}?channel=${channel}&parent=${parentHost}`,\n          href: url,\n          provider: \"twitch\",\n        };\n      }\n      if (video) {\n        return {\n          embedUrl: `${embedBase}?video=${video}&parent=${parentHost}`,\n          href: url,\n          provider: \"twitch\",\n        };\n      }\n      return { embedUrl: null, href: url, provider: \"twitch\" };\n    }\n\n    return { embedUrl: null, href: url, provider: \"unknown\" };\n  } catch {\n    return { embedUrl: null, href: url ?? null, provider: null };\n  }\n}\n\nfunction pairingMeta(id: number | null | undefined, pairings: Record<number, PairingMeta>) {\n  if (!id) return null;\n  return pairings[id] ?? null;\n}\n\nfunction pairingLabelPlain(id: number | null | undefined, pairings: Record<number, PairingMeta>) {\n  if (!id) return \"\";\n  return pairings[id]?.label ?? \"\";\n}\n\nfunction renderPairingName(id: number | null | undefined, pairings: Record<number, PairingMeta>, className?: string) {\n  if (!id) return <span className={className} />;\n  const meta = pairings[id];\n  const label = meta?.label ?? `#${id}`;\n  const subLabel = meta?.subLabel;\n  const avatarUrl = meta?.avatarUrl || DEFAULT_GUEST_AVATAR;\n  const content = (\n    <span className=\"inline-flex items-center gap-2\">\n      <span\n        className=\"h-5 w-5 rounded-full border border-white/10 bg-white/10 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${avatarUrl})` }}\n      />\n      <span>{label}</span>\n      {subLabel && <span className=\"text-[11px] text-white/40\">{subLabel}</span>}\n    </span>\n  );\n  if (meta?.href) {\n    return (\n      <Link href={meta.href} className={className ? `${className} hover:underline` : \"hover:underline\"}>\n        {content}\n      </Link>\n    );\n  }\n  return <span className={className}>{content}</span>;\n}\n\nfunction RoleBadge({ role }: { role: LiveHubViewerRole }) {\n  const style =\n    role === \"ORGANIZER\"\n      ? \"border-emerald-400/40 bg-emerald-500/10 text-emerald-100\"\n      : role === \"PARTICIPANT\"\n        ? \"border-sky-400/40 bg-sky-500/10 text-sky-100\"\n        : \"border-white/15 bg-white/5 text-white/70\";\n  const label = role === \"ORGANIZER\" ? \"Organizador\" : role === \"PARTICIPANT\" ? \"Participante\" : \"P√∫blico\";\n  return <span className={`rounded-full border px-3 py-1 text-[11px] uppercase tracking-[0.2em] ${style}`}>{label}</span>;\n}\n\nfunction SponsorsStrip({ organizer }: { organizer: { publicName?: string | null } | null }) {\n  const sponsorLabels = organizer?.publicName ? [organizer.publicName] : [];\n  return (\n    <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex flex-wrap items-center gap-2\">\n          {sponsorLabels.length > 0 ? (\n            sponsorLabels.map((label) => (\n              <span\n                key={`sponsor-${label}`}\n                className=\"rounded-full border border-white/15 bg-white/5 px-3 py-1 text-xs text-white/70\"\n              >\n                {label}\n              </span>\n            ))\n          ) : (\n            <span className=\"text-sm text-white/60\">Sponsors em breve</span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2 text-xs text-white/50\">\n          <span>Powered by</span>\n          <span className=\"text-white/80\">ORYA</span>\n        </div>\n      </div>\n    </section>\n  );\n}\n\nfunction MatchCard({\n  match,\n  pairings,\n  highlight,\n  timeZone,\n  size = \"md\",\n  showCourt,\n}: {\n  match: MatchPayload;\n  pairings: Record<number, PairingMeta>;\n  highlight?: boolean;\n  timeZone: string;\n  size?: \"md\" | \"lg\";\n  showCourt: boolean;\n}) {\n  const titleClass = size === \"lg\" ? \"text-base\" : \"text-sm\";\n  const metaClass = size === \"lg\" ? \"text-xs\" : \"text-[11px]\";\n  const statusClass = size === \"lg\" ? \"text-[11px]\" : \"text-[11px]\";\n  const scoreClass = size === \"lg\" ? \"text-sm\" : \"text-xs\";\n  const timeLabel = formatTime(match.startAt, timeZone);\n  const metaParts = [`Jogo #${match.id}`];\n  if (match.round) metaParts.push(`R${match.round}`);\n  metaParts.push(timeLabel);\n  if (showCourt) {\n    metaParts.push(match.courtId ? `Campo ${match.courtId}` : \"Campo ‚Äî\");\n  }\n  return (\n    <div\n      className={`rounded-xl border px-3 py-2 transition ${\n        highlight ? \"border-emerald-400/60 bg-emerald-500/10\" : \"border-white/10 bg-white/5\"\n      }`}\n    >\n      <div className=\"flex items-center justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className={`text-white font-medium ${titleClass}`}>\n            {renderPairingName(match.pairing1Id, pairings)} <span className=\"text-white/40\">vs</span>{\" \"}\n            {renderPairingName(match.pairing2Id, pairings)}\n          </p>\n          <p className={`${metaClass} text-white/60`}>\n            {metaParts.join(\" ¬∑ \")}\n          </p>\n        </div>\n        <div className=\"text-right\">\n          <p className={`${statusClass} uppercase tracking-[0.18em] text-white/50`}>{match.statusLabel}</p>\n          <p className={`text-white/80 ${scoreClass}`}>{formatScore(match.score)}</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction EmptyCard({ title, children }: { title: string; children: string }) {\n  return (\n    <div className=\"rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70\">\n      <p className=\"text-white font-semibold\">{title}</p>\n      <p className=\"mt-2 text-white/60\">{children}</p>\n    </div>\n  );\n}\n\nfunction OrganizerMatchEditor({\n  match,\n  tournamentId,\n  onUpdated,\n  goalLimit,\n  locked = false,\n  lockedReason,\n  canResolveDispute = false,\n}: {\n  match: MatchPayload;\n  tournamentId: number;\n  onUpdated: () => void;\n  goalLimit: number;\n  locked?: boolean;\n  lockedReason?: string | null;\n  canResolveDispute?: boolean;\n}) {\n  const [score, setScore] = useState(() => ({\n    a: match.score?.goals?.a ?? 0,\n    b: match.score?.goals?.b ?? 0,\n  }));\n  const [expectedUpdatedAt, setExpectedUpdatedAt] = useState<string | null>(match.updatedAt ?? null);\n  const [saving, setSaving] = useState(false);\n  const [undoing, setUndoing] = useState(false);\n  const [disputePending, setDisputePending] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [info, setInfo] = useState<string | null>(null);\n  const pendingScoreRef = useRef<{ a: number; b: number } | null>(null);\n  const debounceRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const expectedUpdatedAtRef = useRef<string | null>(match.updatedAt ?? null);\n  const savingRef = useRef(false);\n\n  useEffect(() => {\n    setScore({ a: match.score?.goals?.a ?? 0, b: match.score?.goals?.b ?? 0 });\n  }, [match.id, match.updatedAt, match.score?.goals?.a, match.score?.goals?.b]);\n\n  useEffect(() => {\n    const next = match.updatedAt ?? null;\n    setExpectedUpdatedAt(next);\n    expectedUpdatedAtRef.current = next;\n    pendingScoreRef.current = null;\n    if (debounceRef.current) {\n      clearTimeout(debounceRef.current);\n      debounceRef.current = null;\n    }\n  }, [match.id, match.updatedAt]);\n\n  useEffect(() => {\n    return () => {\n      if (debounceRef.current) {\n        clearTimeout(debounceRef.current);\n      }\n    };\n  }, []);\n\n  const flushPending = () => {\n    if (savingRef.current || !pendingScoreRef.current) return;\n    const pending = pendingScoreRef.current;\n    pendingScoreRef.current = null;\n    pushScore(pending.a, pending.b);\n  };\n\n  const clampScore = (value: number) => Math.max(0, Math.min(goalLimit, value));\n\n  const pushScore = async (nextA: number, nextB: number) => {\n    if (locked) {\n      setError(lockedReason || \"Este jogo est√° bloqueado.\");\n      return;\n    }\n    const expected = expectedUpdatedAtRef.current ?? match.updatedAt ?? null;\n    if (!expected) {\n      setError(\"Sem vers√£o do jogo.\");\n      return;\n    }\n    setSaving(true);\n    savingRef.current = true;\n    setError(null);\n    const res = await fetch(`/api/organizador/tournaments/${tournamentId}/matches/${match.id}/result`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        score: { goals: { a: nextA, b: nextB, limit: goalLimit } },\n        expectedUpdatedAt: expected,\n      }),\n    });\n    const json = await res.json().catch(() => null);\n    setSaving(false);\n    savingRef.current = false;\n    if (!json?.ok) {\n      if (json?.error === \"MATCH_CONFLICT\") {\n        setError(\"Resultados atualizados noutro local. A atualizar...\");\n        onUpdated();\n        return;\n      }\n      setError(json?.error || \"Falha ao guardar resultado.\");\n      return;\n    }\n    if (json?.match?.updatedAt) {\n      setExpectedUpdatedAt(json.match.updatedAt as string);\n      expectedUpdatedAtRef.current = json.match.updatedAt as string;\n    }\n    if (!pendingScoreRef.current) {\n      setScore({ a: nextA, b: nextB });\n    }\n    onUpdated();\n    flushPending();\n  };\n\n  const adjust = (side: \"A\" | \"B\", delta: number) => {\n    if (locked) {\n      setError(lockedReason || \"Este jogo est√° bloqueado.\");\n      return;\n    }\n    const nextA = clampScore(side === \"A\" ? score.a + delta : score.a);\n    const nextB = clampScore(side === \"B\" ? score.b + delta : score.b);\n    if (nextA === score.a && nextB === score.b) return;\n    setScore({ a: nextA, b: nextB });\n    pendingScoreRef.current = { a: nextA, b: nextB };\n    if (debounceRef.current) {\n      clearTimeout(debounceRef.current);\n    }\n    debounceRef.current = setTimeout(() => {\n      flushPending();\n    }, 120);\n  };\n\n\n  const overrideWinner = async (side: \"A\" | \"B\") => {\n    if (saving) return;\n    if (locked) {\n      setError(lockedReason || \"Este jogo est√° bloqueado.\");\n      return;\n    }\n    const expected = expectedUpdatedAtRef.current ?? match.updatedAt ?? null;\n    if (!expected) {\n      setError(\"Sem vers√£o do jogo.\");\n      return;\n    }\n    const pairingId = side === \"A\" ? match.pairing1Id : match.pairing2Id;\n    if (!pairingId) {\n      setError(\"Sem jogador atribu√≠do.\");\n      return;\n    }\n    const confirmed = window.confirm(\"Confirmar override manual? Isto vai marcar o jogo como terminado.\");\n    if (!confirmed) return;\n    const nextA = side === \"A\" ? goalLimit : 0;\n    const nextB = side === \"B\" ? goalLimit : 0;\n    setSaving(true);\n    savingRef.current = true;\n    setError(null);\n    const res = await fetch(`/api/organizador/tournaments/${tournamentId}/matches/${match.id}/result`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        score: { goals: { a: nextA, b: nextB, limit: goalLimit } },\n        winnerPairingId: pairingId,\n        status: \"DONE\",\n        expectedUpdatedAt: expected,\n        force: true,\n      }),\n    });\n    const json = await res.json().catch(() => null);\n    setSaving(false);\n    savingRef.current = false;\n    if (!json?.ok) {\n      if (json?.error === \"MATCH_CONFLICT\") {\n        setError(\"Resultados atualizados noutro local. A atualizar...\");\n        onUpdated();\n        return;\n      }\n      setError(json?.error || \"Falha ao aplicar override.\");\n      return;\n    }\n    if (json?.match?.updatedAt) {\n      setExpectedUpdatedAt(json.match.updatedAt as string);\n      expectedUpdatedAtRef.current = json.match.updatedAt as string;\n    }\n    setScore({ a: nextA, b: nextB });\n    onUpdated();\n  };\n\n  const markDisputed = async () => {\n    if (saving || disputePending) return;\n    if (locked) {\n      setError(lockedReason || \"Este jogo est√° bloqueado.\");\n      return;\n    }\n    const expected = expectedUpdatedAtRef.current ?? match.updatedAt ?? null;\n    if (!expected) {\n      setError(\"Sem vers√£o do jogo.\");\n      return;\n    }\n    const confirmed = window.confirm(\"Marcar este jogo como disputado? Isto vai bloquear o avan√ßo autom√°tico.\");\n    if (!confirmed) return;\n    setDisputePending(true);\n    setError(null);\n    setInfo(null);\n    try {\n      const res = await fetch(`/api/organizador/tournaments/${tournamentId}/matches/${match.id}/result`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          status: \"DISPUTED\",\n          expectedUpdatedAt: expected,\n          force: true,\n        }),\n      });\n      const json = await res.json().catch(() => null);\n      if (!res.ok || !json?.ok) {\n        setError(json?.error || \"Falha ao marcar disputa.\");\n        return;\n      }\n      if (json?.match?.updatedAt) {\n        setExpectedUpdatedAt(json.match.updatedAt as string);\n        expectedUpdatedAtRef.current = json.match.updatedAt as string;\n      }\n      setInfo(\"Jogo marcado como disputado.\");\n      onUpdated();\n    } finally {\n      setDisputePending(false);\n    }\n  };\n\n  const resolveDispute = async () => {\n    if (saving || disputePending) return;\n    if (!canResolveDispute) {\n      setError(\"Apenas ADMIN pode resolver a disputa.\");\n      return;\n    }\n    const expected = expectedUpdatedAtRef.current ?? match.updatedAt ?? null;\n    if (!expected) {\n      setError(\"Sem vers√£o do jogo.\");\n      return;\n    }\n    const confirmed = window.confirm(\"Resolver disputa e reabrir o jogo?\");\n    if (!confirmed) return;\n    setDisputePending(true);\n    setError(null);\n    setInfo(null);\n    const nextStatus = score.a > 0 || score.b > 0 ? \"IN_PROGRESS\" : \"PENDING\";\n    try {\n      const res = await fetch(`/api/organizador/tournaments/${tournamentId}/matches/${match.id}/result`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          status: nextStatus,\n          expectedUpdatedAt: expected,\n          force: true,\n        }),\n      });\n      const json = await res.json().catch(() => null);\n      if (!res.ok || !json?.ok) {\n        setError(json?.error || \"Falha ao resolver disputa.\");\n        return;\n      }\n      if (json?.match?.updatedAt) {\n        setExpectedUpdatedAt(json.match.updatedAt as string);\n        expectedUpdatedAtRef.current = json.match.updatedAt as string;\n      }\n      setInfo(\"Disputa resolvida.\");\n      onUpdated();\n    } finally {\n      setDisputePending(false);\n    }\n  };\n\n  const undoLast = async () => {\n    if (undoing || saving) return;\n    setUndoing(true);\n    setError(null);\n    setInfo(null);\n    try {\n      const res = await fetch(`/api/organizador/tournaments/${tournamentId}/matches/${match.id}/undo`, {\n        method: \"POST\",\n      });\n      const json = await res.json().catch(() => null);\n      if (!res.ok || !json?.ok) {\n        setError(json?.error || \"Undo indispon√≠vel.\");\n        return;\n      }\n      if (json?.match?.updatedAt) {\n        setExpectedUpdatedAt(json.match.updatedAt as string);\n        expectedUpdatedAtRef.current = json.match.updatedAt as string;\n      }\n      setScore({\n        a: json?.match?.score?.goals?.a ?? 0,\n        b: json?.match?.score?.goals?.b ?? 0,\n      });\n      setInfo(\"√öltima a√ß√£o desfeita.\");\n      onUpdated();\n    } finally {\n      setUndoing(false);\n    }\n  };\n\n  return (\n    <div className=\"rounded-xl border border-white/10 bg-black/30 px-3 py-2\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-white text-sm\">Golos (limite {goalLimit})</span>\n      </div>\n      <div className=\"mt-2 grid gap-2 text-xs text-white/70\">\n        {([\"A\", \"B\"] as const).map((side) => {\n          const value = side === \"A\" ? score.a : score.b;\n          const finished = score.a === goalLimit || score.b === goalLimit;\n          return (\n            <div key={`${match.id}-score-${side}`} className=\"flex items-center justify-between gap-2\">\n              <span className=\"text-white/60\">{side === \"A\" ? \"Jogador A\" : \"Jogador B\"}</span>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  type=\"button\"\n                  disabled={locked || value <= 0}\n                  onClick={() => adjust(side, -1)}\n                  className=\"h-7 w-7 rounded-full border border-white/15 text-white/70 hover:border-white/40 disabled:opacity-50\"\n                >\n                  ‚àí\n                </button>\n                <span className=\"min-w-[24px] text-center text-sm text-white\">{value}</span>\n                <button\n                  type=\"button\"\n                  disabled={locked || value >= goalLimit || finished}\n                  onClick={() => adjust(side, 1)}\n                  className=\"h-7 w-7 rounded-full border border-white/15 text-white/70 hover:border-white/40 disabled:opacity-50\"\n                >\n                  +\n                </button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n      {error && <p className=\"mt-2 text-[11px] text-rose-300\">{error}</p>}\n      {info && <p className=\"mt-2 text-[11px] text-emerald-200\">{info}</p>}\n      <div className=\"mt-3 flex flex-wrap gap-2\">\n        <button\n          type=\"button\"\n          onClick={undoLast}\n          disabled={undoing || saving}\n          className=\"rounded-full border border-white/15 px-3 py-1 text-[11px] text-white/70 hover:border-white/40 disabled:opacity-60\"\n        >\n          {undoing ? \"A desfazer‚Ä¶\" : \"Undo (60s)\"}\n        </button>\n        {match.status === \"DISPUTED\" ? (\n          <button\n            type=\"button\"\n            onClick={resolveDispute}\n            disabled={disputePending || saving || !canResolveDispute}\n            className=\"rounded-full border border-amber-400/40 px-3 py-1 text-[11px] text-amber-100 hover:border-amber-200/70 disabled:opacity-60\"\n          >\n            {disputePending ? \"A resolver‚Ä¶\" : canResolveDispute ? \"Resolver disputa\" : \"Resolver disputa (ADMIN)\"}\n          </button>\n        ) : (\n          <button\n            type=\"button\"\n            onClick={markDisputed}\n            disabled={disputePending || saving || locked}\n            className=\"rounded-full border border-rose-400/40 px-3 py-1 text-[11px] text-rose-100 hover:border-rose-200/70 disabled:opacity-60\"\n          >\n            {disputePending ? \"A marcar‚Ä¶\" : \"Marcar disputa\"}\n          </button>\n        )}\n      </div>\n      <details className=\"mt-3 rounded-lg border border-amber-400/30 bg-amber-500/10 px-3 py-2 text-[11px] text-amber-100\">\n        <summary className=\"cursor-pointer uppercase tracking-[0.18em] text-[11px]\">\n          Override manual\n        </summary>\n        <div className=\"mt-2 space-y-2\">\n          <p className=\"text-[11px] text-amber-100/80\">Usa s√≥ em casos excecionais.</p>\n          <div className=\"flex flex-wrap gap-2\">\n            <button\n              type=\"button\"\n              disabled={saving || !match.pairing1Id}\n              onClick={() => overrideWinner(\"A\")}\n              className=\"rounded-full border border-amber-400/40 px-3 py-1 text-[11px] text-amber-100 hover:border-amber-200/70 disabled:opacity-60\"\n            >\n              For√ßar {match.pairing1Id ? `Jogador #${match.pairing1Id}` : \"Jogador A\"}\n            </button>\n            <button\n              type=\"button\"\n              disabled={saving || !match.pairing2Id}\n              onClick={() => overrideWinner(\"B\")}\n              className=\"rounded-full border border-amber-400/40 px-3 py-1 text-[11px] text-amber-100 hover:border-amber-200/70 disabled:opacity-60\"\n            >\n              For√ßar {match.pairing2Id ? `Jogador #${match.pairing2Id}` : \"Jogador B\"}\n            </button>\n          </div>\n        </div>\n      </details>\n    </div>\n  );\n}\n\nfunction LiveHubTv({\n  event,\n  tournament,\n  pairings,\n  timeZone,\n  showCourt,\n}: {\n  event: EventPayload;\n  tournament: any;\n  pairings: Record<number, PairingMeta>;\n  timeZone: string;\n  showCourt: boolean;\n}) {\n  const matches = tournament.stages.flatMap((s: any) => [...s.matches, ...s.groups.flatMap((g: any) => g.matches)]);\n\n  const upcoming = matches\n    .filter((m: MatchPayload) => m.status !== \"DONE\" && m.status !== \"IN_PROGRESS\" && m.status !== \"LIVE\")\n    .sort((a: MatchPayload, b: MatchPayload) => {\n      if (a.startAt && b.startAt) {\n        const diff = new Date(a.startAt).getTime() - new Date(b.startAt).getTime();\n        if (diff !== 0) return diff;\n      }\n      if (showCourt) {\n        const aCourt = a.courtId ?? 9999;\n        const bCourt = b.courtId ?? 9999;\n        return aCourt - bCourt;\n      }\n      return 0;\n    })\n    .slice(0, 8);\n\n  const live = matches.filter((m: MatchPayload) => m.status === \"IN_PROGRESS\" || m.status === \"LIVE\").slice(0, 6);\n  const playoffStage =\n    tournament.stages.find((s: any) => s.stageType === \"PLAYOFF\" && s.matches?.length) ??\n    tournament.stages.find((s: any) => s.matches?.length) ??\n    tournament.stages[0];\n  const tvBracketMatches = playoffStage?.matches?.slice(0, 8) ?? [];\n  const tvGroupStages = tournament.stages.filter((s: any) => (s.groups ?? []).length > 0);\n\n  return (\n    <div className=\"space-y-8\">\n      <header className=\"flex flex-wrap items-end justify-between gap-6\">\n        <div>\n          <p className=\"text-[11px] uppercase tracking-[0.4em] text-white/60\">Modo TV</p>\n          <h1 className=\"text-4xl font-semibold text-white\">{event.title}</h1>\n          <p className=\"text-white/60\">{formatDateRange(event.startsAt, event.endsAt, timeZone)}</p>\n        </div>\n        <div className=\"rounded-2xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-white/70\">\n          Atualiza automaticamente\n        </div>\n      </header>\n\n      <div className=\"grid gap-5 lg:grid-cols-2\">\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Agora a jogar</h2>\n            <span className=\"text-white/60 text-sm\">{live.length} ativos</span>\n          </div>\n          {live.length === 0 && <p className=\"text-white/60\">Sem jogos em curso.</p>}\n          {live.map((m: MatchPayload) => (\n            <MatchCard key={`live-${m.id}`} match={m} pairings={pairings} timeZone={timeZone} size=\"lg\" showCourt={showCourt} />\n          ))}\n        </section>\n\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Pr√≥ximos jogos</h2>\n            <span className=\"text-white/60 text-sm\">{upcoming.length} agendados</span>\n          </div>\n          {upcoming.length === 0 && <p className=\"text-white/60\">Sem jogos agendados.</p>}\n          {upcoming.map((m: MatchPayload) => (\n            <MatchCard key={`up-${m.id}`} match={m} pairings={pairings} timeZone={timeZone} size=\"lg\" showCourt={showCourt} />\n          ))}\n        </section>\n      </div>\n\n      {tvBracketMatches.length > 0 && (\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Bracket</h2>\n            <span className=\"text-white/60 text-sm\">{tvBracketMatches.length} jogos</span>\n          </div>\n          <div className=\"grid gap-3 md:grid-cols-2\">\n            {tvBracketMatches.map((match: MatchPayload) => (\n              <MatchCard key={`tv-bracket-${match.id}`} match={match} pairings={pairings} timeZone={timeZone} size=\"lg\" showCourt={showCourt} />\n            ))}\n          </div>\n        </section>\n      )}\n      {tvBracketMatches.length === 0 && tvGroupStages.length > 0 && (\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-xl font-semibold\">Tabela</h2>\n            <span className=\"text-white/60 text-sm\">Classifica√ß√µes</span>\n          </div>\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            {tvGroupStages.map((stage: any) =>\n              stage.groups.map((group: any) => (\n                <div key={`tv-group-${group.id}`} className=\"rounded-2xl border border-white/10 bg-black/30 p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-white font-semibold\">{group.name || \"Grupo\"}</h3>\n                    <span className=\"text-[11px] uppercase tracking-[0.18em] text-white/50\">{stage.stageType}</span>\n                  </div>\n                  <div className=\"mt-3 space-y-2 text-sm\">\n                    {(group.standings ?? []).length === 0 && (\n                      <p className=\"text-white/60\">Sem classifica√ß√£o dispon√≠vel.</p>\n                    )}\n                    {(group.standings ?? []).map((row: any, idx: number) => (\n                      <div key={`tv-group-${group.id}-${row.pairingId}`} className=\"flex items-center justify-between text-white/80\">\n                        <div className=\"flex items-center gap-3\">\n                          <span className=\"text-white/50\">{idx + 1}</span>\n                          {renderPairingName(row.pairingId, pairings)}\n                        </div>\n                        <span className=\"text-white/50\">{row.wins}-{row.losses}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )),\n            )}\n          </div>\n        </section>\n      )}\n    </div>\n  );\n}\n\nfunction BracketRoundsView({\n  matches,\n  pairings,\n  isOrganizerEdit,\n  tournamentId,\n  onUpdated,\n  goalLimits,\n  highlightPairingId,\n  canResolveDispute,\n  view = \"split\",\n}: {\n  matches: MatchPayload[];\n  pairings: Record<number, PairingMeta>;\n  isOrganizerEdit: boolean;\n  tournamentId: number | null;\n  onUpdated: () => void;\n  goalLimits: GoalLimitsConfig;\n  highlightPairingId?: number | null;\n  canResolveDispute?: boolean;\n  view?: \"split\" | \"full\";\n}) {\n  const [activeRound, setActiveRound] = useState<number | null>(null);\n\n  const matchesByRound = matches.reduce((acc: Record<number, MatchPayload[]>, match: MatchPayload) => {\n    const round = match.round ?? 0;\n    if (!acc[round]) acc[round] = [];\n    acc[round].push(match);\n    return acc;\n  }, {});\n  const rounds = Object.keys(matchesByRound)\n    .map((r) => Number(r))\n    .sort((a, b) => a - b);\n  const roundLabels = buildRoundLabels(rounds.length);\n  const finalRound = rounds.length > 0 ? rounds[rounds.length - 1] : null;\n  const roundLabelMap = rounds.reduce((acc, round, idx) => {\n    acc[round] = roundLabels[idx] || `Ronda ${round}`;\n    return acc;\n  }, {} as Record<number, string>);\n  const treeRowHeight = 32;\n  const liveMatches = matches.filter((match) => match.status === \"IN_PROGRESS\" || match.status === \"LIVE\");\n  const liveRounds = new Set<number>(liveMatches.map((match) => match.round ?? 0).filter((round) => round > 0));\n  const liveRound = liveMatches[0]?.round ?? null;\n  const roundIsComplete = (round: number) => {\n    const list = matchesByRound[round] ?? [];\n    return list.length > 0 && list.every((match) => match.status === \"DONE\");\n  };\n  const roundHasLive = (round: number) => {\n    const list = matchesByRound[round] ?? [];\n    return list.some((match) => match.status === \"IN_PROGRESS\" || match.status === \"LIVE\");\n  };\n  const currentRound =\n    (liveRound && rounds.includes(liveRound) ? liveRound : null) ??\n    rounds.find((round) => !roundIsComplete(round)) ??\n    finalRound;\n  const roundIsLocked = (round: number) => {\n    const idx = rounds.indexOf(round);\n    if (idx <= 0) return false;\n    return rounds.slice(0, idx).some((r) => !roundIsComplete(r));\n  };\n  const desktopTreeStartIndex = Math.max(0, rounds.length - 3);\n  const mobileTreeStartIndex = Math.max(0, rounds.length - 2);\n  const activeRoundIndex = activeRound ? rounds.indexOf(activeRound) : -1;\n  const desktopTreeRounds = rounds.slice(desktopTreeStartIndex);\n  const mobileTreeRounds = rounds.slice(mobileTreeStartIndex);\n  const showDesktopTree = activeRoundIndex >= desktopTreeStartIndex;\n  const showMobileTree = activeRoundIndex >= mobileTreeStartIndex;\n\n  const renderRow = (\n    side: \"A\" | \"B\",\n    match: MatchPayload,\n    winnerSide: \"A\" | \"B\" | null,\n    summary: { a: number; b: number } | null,\n    compact?: boolean,\n    final?: boolean,\n  ) => {\n    const pairingId = side === \"A\" ? match.pairing1Id : match.pairing2Id;\n    const isWinner = winnerSide === side;\n    const isLoser = winnerSide && winnerSide !== side;\n    const score = summary ? (side === \"A\" ? summary.a : summary.b) : 0;\n    const scoreTone = isWinner ? \"text-emerald-300\" : isLoser ? \"text-rose-300\" : \"text-white/70\";\n    const nameTone = isLoser ? \"text-white/50\" : \"text-white/85\";\n    const textClass = compact ? \"text-[11px]\" : \"text-sm\";\n    const paddingClass = compact ? \"py-1\" : \"py-2\";\n    if (compact) {\n      const meta = pairingMeta(pairingId, pairings);\n      const fallbackLabel = pairingId ? `#${pairingId}` : \"A definir\";\n      const label = meta?.label ?? fallbackLabel;\n      const displayLabel = label.length > 16 ? label.slice(0, 16) : label;\n      const avatarUrl = meta?.avatarUrl || DEFAULT_GUEST_AVATAR;\n      const avatarClass = final ? \"h-14 w-14\" : \"h-12 w-12\";\n      return (\n        <div className={`flex items-center justify-between gap-3 ${paddingClass}`}>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex flex-col items-center gap-1\">\n              <span\n                className={`${avatarClass} rounded-full border border-white/10 bg-white/10 bg-cover bg-center`}\n                style={{ backgroundImage: `url(${avatarUrl})` }}\n              />\n              <span className={`max-w-[120px] truncate text-[11px] ${nameTone}`} title={label}>\n                {displayLabel}\n              </span>\n            </div>\n          </div>\n          <span\n            className={`min-w-[22px] text-right text-base font-semibold tabular-nums ${final ? \"text-lg\" : \"\"} ${scoreTone}`}\n          >\n            {score}\n          </span>\n        </div>\n      );\n    }\n    return (\n      <div className={`flex items-center justify-between gap-2 ${paddingClass}`}>\n        <div className={`min-w-0 ${textClass} ${nameTone}`}>{renderPairingName(pairingId, pairings, \"truncate\")}</div>\n        <span className={`${textClass} min-w-[24px] text-right font-semibold tabular-nums ${scoreTone}`}>{score}</span>\n      </div>\n    );\n  };\n\n  const renderListMatch = (\n    match: MatchPayload,\n    options?: {\n      withConnector?: boolean;\n      connectorSide?: \"left\" | \"right\";\n      connectorDirection?: \"up\" | \"down\";\n      connectorHeight?: number;\n      compact?: boolean;\n      accent?: boolean;\n      final?: boolean;\n      locked?: boolean;\n      style?: Record<string, string | number>;\n    },\n  ) => {\n    const summary = getScoreSummary(match.score);\n    const winnerSide = match.status === \"DONE\" ? getWinnerSide(match.score) : null;\n    const isLive = match.status === \"IN_PROGRESS\" || match.status === \"LIVE\";\n    const isDisputed = match.status === \"DISPUTED\";\n    const isLocked = Boolean(options?.locked || isDisputed);\n    const lockedReason = isDisputed\n      ? \"Jogo em disputa. Resolve antes de editar.\"\n      : options?.locked\n        ? \"Esta fase ainda n√£o est√° ativa.\"\n        : null;\n    const useCompact = Boolean(options?.compact);\n    const isHighlighted =\n      typeof highlightPairingId === \"number\" &&\n      (match.pairing1Id === highlightPairingId || match.pairing2Id === highlightPairingId);\n    const wrapperTone = useCompact\n      ? \"border-transparent bg-transparent\"\n      : isDisputed\n        ? \"border-rose-400/60 bg-rose-500/10\"\n        : isLive\n        ? \"border-emerald-400/70 bg-emerald-500/15\"\n        : isHighlighted\n          ? \"border-emerald-400/50 bg-emerald-500/10\"\n          : \"border-white/10 bg-black/30\";\n    const isFinal = Boolean(options?.final);\n    const paddingClass = isFinal ? \"p-3\" : useCompact ? \"p-2\" : \"p-3\";\n    const accentClass = options?.accent ? \"ring-1 ring-white/25 shadow-[0_10px_24px_rgba(0,0,0,0.35)]\" : \"\";\n    const liveClass = isLive ? \"ring-1 ring-emerald-400/60 shadow-[0_0_16px_rgba(16,185,129,0.25)]\" : \"\";\n    const disputeClass = isDisputed ? \"ring-1 ring-rose-400/60 shadow-[0_0_16px_rgba(244,63,94,0.28)]\" : \"\";\n    const finalClass = isFinal\n      ? \"ring-1 ring-amber-300/70 shadow-[0_18px_40px_rgba(0,0,0,0.45)]\"\n      : \"\";\n    const needsRelative = Boolean(options?.withConnector || options?.connectorSide || isLive);\n    const lockedClass = isLocked ? \"opacity-70\" : \"\";\n    const wrapperClass = `${needsRelative ? \"relative\" : \"\"} rounded-2xl border ${wrapperTone} ${paddingClass} ${accentClass} ${liveClass} ${disputeClass} ${finalClass} ${lockedClass}`;\n    return (\n      <div key={`list-${match.id}`} className={wrapperClass} style={options?.style}>\n        {isLive && (\n          <span className=\"absolute -top-2 left-3 rounded-full border border-emerald-400/60 bg-emerald-500/20 px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] text-emerald-100\">\n            Live\n          </span>\n        )}\n        {isDisputed && (\n          <span className=\"absolute -top-2 left-3 rounded-full border border-rose-400/60 bg-rose-500/20 px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] text-rose-100\">\n            Disputa\n          </span>\n        )}\n        {isFinal && (\n          <span className=\"absolute -top-2 right-3 rounded-full border border-amber-300/70 bg-amber-500/20 px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] text-amber-100\">\n            Final\n          </span>\n        )}\n        {isFinal ? (\n          <div className=\"grid grid-cols-2 gap-4\">\n            {renderRow(\"A\", match, winnerSide, summary, useCompact, isFinal)}\n            {renderRow(\"B\", match, winnerSide, summary, useCompact, isFinal)}\n          </div>\n        ) : (\n          <div className={useCompact ? \"space-y-1\" : \"space-y-2\"}>\n            {renderRow(\"A\", match, winnerSide, summary, useCompact, isFinal)}\n            {renderRow(\"B\", match, winnerSide, summary, useCompact, isFinal)}\n          </div>\n        )}\n        {(options?.withConnector || options?.connectorSide) && (\n          <div\n            className={`pointer-events-none absolute top-1/2 h-px w-6 bg-white/15 ${\n              options?.connectorSide === \"left\" ? \"left-[-18px]\" : \"right-[-18px]\"\n            }`}\n          />\n        )}\n        {options?.connectorHeight && options?.connectorDirection && (\n          <div\n            className={`pointer-events-none absolute w-px bg-white/15 ${\n              options?.connectorSide === \"left\" ? \"left-[-18px]\" : \"right-[-18px]\"\n            } ${options?.connectorDirection === \"up\" ? \"bottom-1/2\" : \"top-1/2\"}`}\n            style={{ height: options.connectorHeight }}\n          />\n        )}\n        {isOrganizerEdit && tournamentId && (\n          <div className=\"pt-1\">\n            <OrganizerMatchEditor\n              match={match}\n              tournamentId={tournamentId}\n              onUpdated={onUpdated}\n              goalLimit={resolveGoalLimit(match.round ?? null, goalLimits)}\n              locked={isLocked}\n              lockedReason={lockedReason}\n              canResolveDispute={canResolveDispute}\n            />\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  useEffect(() => {\n    if (rounds.length === 0) return;\n    if (!activeRound || !rounds.includes(activeRound)) {\n      setActiveRound(currentRound ?? rounds[0]);\n    }\n  }, [activeRound, currentRound, rounds.join(\",\")]);\n\n  const activeMatches = activeRound ? matchesByRound[activeRound] ?? [] : [];\n  const activeMatchesSorted = activeMatches.slice().sort((a, b) => a.id - b.id);\n  const splitIndex = Math.ceil(activeMatchesSorted.length / 2);\n  const leftMatches = activeMatchesSorted.slice(0, splitIndex);\n  const rightMatches = activeMatchesSorted.slice(splitIndex);\n\n  const renderSymmetricTreeGrid = (\n    treeRounds: number[],\n    options?: { compact?: boolean; rowHeight?: number; minColWidth?: number; accentRound?: number | null },\n  ) => {\n    if (treeRounds.length === 0) return null;\n    const lastRound = treeRounds[treeRounds.length - 1];\n    const leftRounds = treeRounds.filter((round) => round !== lastRound);\n    const leftCount = leftRounds.length;\n    const columns = leftCount * 2 + 1;\n    const rowHeight = options?.rowHeight ?? treeRowHeight;\n    const minColWidth = options?.minColWidth ?? 160;\n    const treeRows = leftCount > 0 ? 2 ** leftCount : 1;\n    const leftIndexMap = leftRounds.reduce((acc, round, idx) => {\n      acc[round] = idx;\n      return acc;\n    }, {} as Record<number, number>);\n    const rightRounds = [...leftRounds].reverse();\n    const columnLabels = [\n      ...leftRounds.map((round) => roundLabelMap[round] || `Ronda ${round}`),\n      roundLabelMap[lastRound] || `Ronda ${lastRound}`,\n      ...rightRounds.map((round) => roundLabelMap[round] || `Ronda ${round}`),\n    ];\n    const roundMatches = (round: number) =>\n      (matchesByRound[round] ?? []).slice().sort((a, b) => compareBracketOrder(a, b));\n    const roundSplit = (round: number) => {\n      const list = roundMatches(round);\n      const half = Math.ceil(list.length / 2);\n      return { left: list.slice(0, half), right: list.slice(half) };\n    };\n    const finalMatch = roundMatches(lastRound)[0] ?? null;\n    const finalRow = leftCount > 0 ? 2 ** (leftCount - 1) : 1;\n    const accentRound = options?.accentRound ?? null;\n    const columnTemplate =\n      options?.minColWidth && options.minColWidth > 0\n        ? `repeat(${columns}, minmax(${options.minColWidth}px, 1fr))`\n        : `repeat(${columns}, minmax(0, 1fr))`;\n\n    return (\n      <div className=\"space-y-3\">\n        <div className=\"grid gap-4\" style={{ gridTemplateColumns: columnTemplate }}>\n          {columnLabels.map((label, idx) => (\n            <p key={`sym-label-${idx}`} className=\"text-[11px] uppercase tracking-[0.24em] text-white/50\">\n              {label}\n            </p>\n          ))}\n        </div>\n        <div\n          className=\"grid gap-x-6 gap-y-2\"\n          style={{\n            gridTemplateColumns: columnTemplate,\n            gridTemplateRows: `repeat(${treeRows}, minmax(${rowHeight}px, 1fr))`,\n            minHeight: treeRows ? `${treeRows * rowHeight}px` : undefined,\n          }}\n        >\n          {leftRounds.flatMap((round, colIdx) => {\n            const { left } = roundSplit(round);\n            const roundIndex = leftIndexMap[round] ?? colIdx;\n            const connectorHeight = left.length > 1 ? rowHeight * 2 ** roundIndex : 0;\n            return left.map((match, matchIdx) => {\n              const row = 2 ** roundIndex * (2 * matchIdx + 1);\n              const connectorDirection = matchIdx % 2 === 0 ? \"down\" : \"up\";\n              return renderListMatch(match, {\n                connectorSide: \"right\",\n                connectorDirection: connectorHeight ? connectorDirection : undefined,\n                connectorHeight: connectorHeight || undefined,\n                compact: options?.compact,\n                locked: roundIsLocked(round),\n                style: { gridColumn: colIdx + 1, gridRow: row },\n              });\n            });\n          })}\n          {finalMatch &&\n            renderListMatch(finalMatch, {\n              compact: options?.compact,\n              accent: accentRound === lastRound,\n              final: true,\n              locked: roundIsLocked(lastRound),\n              style: { gridColumn: leftCount + 1, gridRow: finalRow },\n            })}\n          {rightRounds.flatMap((round, idx) => {\n            const { right } = roundSplit(round);\n            const roundIndex = leftIndexMap[round] ?? 0;\n            const col = leftCount + 2 + idx;\n            const connectorHeight = right.length > 1 ? rowHeight * 2 ** roundIndex : 0;\n            return right.map((match, matchIdx) => {\n              const row = 2 ** roundIndex * (2 * matchIdx + 1);\n              const connectorDirection = matchIdx % 2 === 0 ? \"down\" : \"up\";\n              return renderListMatch(match, {\n                connectorSide: \"left\",\n                connectorDirection: connectorHeight ? connectorDirection : undefined,\n                connectorHeight: connectorHeight || undefined,\n                compact: options?.compact,\n                locked: roundIsLocked(round),\n                style: { gridColumn: col, gridRow: row },\n              });\n            });\n          })}\n        </div>\n      </div>\n    );\n  };\n\n  const renderMobileFinalTree = (treeRounds: number[]) => {\n    if (treeRounds.length === 0) return null;\n    const finalRound = treeRounds[treeRounds.length - 1];\n    const semiRound = treeRounds.length > 1 ? treeRounds[treeRounds.length - 2] : null;\n    const finalMatch = (matchesByRound[finalRound] ?? []).slice().sort(compareBracketOrder)[0] ?? null;\n    const semiMatches = semiRound\n      ? (matchesByRound[semiRound] ?? []).slice().sort(compareBracketOrder)\n      : [];\n    return (\n      <div className=\"space-y-4\">\n        {semiRound && (\n          <div className=\"space-y-2\">\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">\n              {roundLabelMap[semiRound] || `Ronda ${semiRound}`}\n            </p>\n            <div className=\"grid gap-3 sm:grid-cols-2\">\n              {semiMatches.map((match) =>\n                renderListMatch(match, { locked: roundIsLocked(match.round ?? 0) }),\n              )}\n            </div>\n          </div>\n        )}\n        {finalMatch && (\n          <div className=\"space-y-2\">\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">\n              {roundLabelMap[finalRound] || `Ronda ${finalRound}`}\n            </p>\n            <div className=\"mx-auto max-w-sm\">\n              {renderListMatch(finalMatch, { final: true, accent: true, locked: roundIsLocked(finalRound) })}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  if (view === \"full\") {\n    return (\n      <div className=\"space-y-4\">\n        {rounds.map((round, idx) => (\n          <div key={`full-round-${round}`} className=\"space-y-2\">\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">\n              {roundLabels[idx] || `Ronda ${round}`}\n            </p>\n            {(matchesByRound[round] ?? [])\n              .slice()\n              .sort((a, b) => a.id - b.id)\n              .map((match) => renderListMatch(match, { locked: roundIsLocked(match.round ?? 0) }))}\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex min-w-0 flex-1 items-center gap-2 overflow-x-auto py-1\">\n          {rounds.map((round) => {\n            const isActive = activeRound === round;\n            const isLiveRound = roundHasLive(round);\n            const isCompleted = roundIsComplete(round);\n            const isLocked = roundIsLocked(round);\n            const isCurrent = round === currentRound;\n            const tone = isCompleted\n              ? \"border-purple-400/60 bg-purple-500/15 text-purple-100\"\n              : isLiveRound || isCurrent\n                ? \"border-emerald-400/60 bg-emerald-500/15 text-emerald-100\"\n                : isLocked\n                  ? \"border-white/10 bg-white/5 text-white/40\"\n                  : \"border-white/15 bg-white/5 text-white/60\";\n            return (\n              <button\n                key={`round-tab-${round}`}\n                type=\"button\"\n                onClick={() => {\n                  if (!isLocked) setActiveRound(round);\n                }}\n                disabled={isLocked}\n                className={`shrink-0 rounded-full border px-3 py-1 text-[11px] uppercase tracking-[0.18em] ${tone} ${\n                  isLocked ? \"cursor-not-allowed\" : \"hover:border-white/40\"\n                } ${isActive ? \"ring-1 ring-white/30\" : \"\"}`}\n              >\n                <span>{roundLabelMap[round] || `Ronda ${round}`}</span>\n                {isCompleted && (\n                  <span className=\"ml-2 rounded-full border border-purple-400/50 bg-purple-500/20 px-1.5 py-0.5 text-[10px] text-purple-100\">\n                    Concluida\n                  </span>\n                )}\n                {!isCompleted && isLiveRound && (\n                  <span className=\"ml-2 rounded-full border border-emerald-400/50 bg-emerald-500/20 px-1.5 py-0.5 text-[10px] text-emerald-100\">\n                    Live\n                  </span>\n                )}\n              </button>\n            );\n          })}\n        </div>\n      </div>\n\n      <div className=\"hidden md:block\">\n        {showDesktopTree ? (\n          <div className=\"space-y-3\">\n            {renderSymmetricTreeGrid(desktopTreeRounds, {\n              compact: true,\n              rowHeight: 32,\n              minColWidth: 140,\n              accentRound: activeRound === finalRound ? finalRound : null,\n            })}\n          </div>\n        ) : (\n          <div className=\"grid gap-3 md:grid-cols-2\">\n            <div className=\"space-y-3\">\n              {leftMatches.map((match) =>\n                renderListMatch(match, { locked: roundIsLocked(match.round ?? 0) })\n              )}\n            </div>\n            <div className=\"space-y-3\">\n              {rightMatches.map((match) =>\n                renderListMatch(match, { locked: roundIsLocked(match.round ?? 0) })\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"md:hidden\">\n        {showMobileTree ? (\n          <div className=\"space-y-3\">{renderMobileFinalTree(mobileTreeRounds)}</div>\n        ) : (\n          <div className=\"space-y-3\">\n            {activeMatchesSorted.map((match) =>\n              renderListMatch(match, { locked: roundIsLocked(match.round ?? 0) })\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction OneVOneBracket({\n  stage,\n  pairings,\n  eventStatus,\n  isOrganizerEdit,\n  tournamentId,\n  onUpdated,\n  goalLimits,\n  canResolveDispute,\n}: {\n  stage: { matches?: MatchPayload[]; name?: string | null } | null;\n  pairings: Record<number, PairingMeta>;\n  eventStatus: string;\n  isOrganizerEdit: boolean;\n  tournamentId: number | null;\n  onUpdated: () => void;\n  goalLimits: GoalLimitsConfig;\n  canResolveDispute?: boolean;\n}) {\n  if (!stage || !stage.matches || stage.matches.length === 0) {\n    return (\n      <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 text-white/70\">\n        <p className=\"text-[11px] uppercase tracking-[0.3em] text-white/50\">Bracket</p>\n        <h2 className=\"mt-2 text-xl font-semibold text-white\">Chave em prepara√ß√£o</h2>\n        <p className=\"text-sm text-white/60\">Em breve os jogos v√£o aparecer aqui.</p>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <p className=\"text-[11px] uppercase tracking-[0.3em] text-white/50\">Bracket</p>\n          <h2 className=\"text-xl font-semibold text-white\">{stage.name || \"Eliminat√≥rias 1v1\"}</h2>\n        </div>\n        <span className=\"text-xs text-white/50\">{eventStatus === \"Pr√≥ximo\" ? \"Pr√©-evento\" : \"Ao vivo\"}</span>\n      </div>\n      <BracketRoundsView\n        matches={stage.matches}\n        pairings={pairings}\n        isOrganizerEdit={isOrganizerEdit}\n        tournamentId={tournamentId}\n        onUpdated={onUpdated}\n        goalLimits={goalLimits}\n        canResolveDispute={canResolveDispute}\n      />\n    </section>\n  );\n}\n\nfunction OneVOneLiveLayout({\n  event,\n  organizer,\n  tournament,\n  pairings,\n  timeZone,\n  eventStatus,\n  countdownLabel,\n  nowMatch,\n  championLabel,\n  sponsors,\n  onToggleFollow,\n  followPending,\n  isFollowing,\n  showSponsors,\n  isOrganizerEdit,\n  canManageLiveConfig,\n  canResolveDispute,\n  onRefresh,\n  variant = \"full\",\n}: {\n  event: EventPayload;\n  organizer: { id: number; publicName: string; username: string | null; brandingAvatarUrl: string | null } | null;\n  tournament: any;\n  pairings: Record<number, PairingMeta>;\n  timeZone: string;\n  eventStatus: string;\n  countdownLabel: string | null;\n  nowMatch: MatchPayload | null;\n  championLabel: string | null;\n  sponsors: SponsorsConfig;\n  onToggleFollow: () => void;\n  followPending: boolean;\n  isFollowing: boolean;\n  showSponsors: boolean;\n  isOrganizerEdit: boolean;\n  canManageLiveConfig: boolean;\n  canResolveDispute: boolean;\n  onRefresh: () => void;\n  variant?: \"full\" | \"inline\";\n}) {\n  const streamEmbed = getStreamEmbed(event.liveStreamUrl);\n  const embedUrl = streamEmbed.embedUrl;\n  const streamHref = streamEmbed.href;\n  const streamLabel =\n    streamEmbed.provider === \"youtube\"\n      ? \"Abrir no YouTube\"\n      : streamEmbed.provider === \"twitch\"\n        ? \"Abrir na Twitch\"\n        : \"Abrir stream\";\n  const [streamUrl, setStreamUrl] = useState(event.liveStreamUrl ?? \"\");\n  const [savingConfig, setSavingConfig] = useState(false);\n  const [configMessage, setConfigMessage] = useState<string | null>(null);\n  const [sponsorDraft, setSponsorDraft] = useState<SponsorsConfig>(sponsors ?? {});\n  const [goalLimitsDraft, setGoalLimitsDraft] = useState<GoalLimitsConfig>(\n    normalizeGoalLimits(tournament?.goalLimits as GoalLimitsConfig),\n  );\n  const [activeTab, setActiveTab] = useState<\"chat\" | \"stats\" | \"rules\">(\"chat\");\n  const featuredMatchId = typeof tournament?.featuredMatchId === \"number\" ? tournament.featuredMatchId : null;\n  const bracketStage =\n    tournament?.stages?.find((s: any) => s.stageType === \"PLAYOFF\" && s.matches?.length) ??\n    tournament?.stages?.find((s: any) => s.matches?.length) ??\n    null;\n  const flatMatches: MatchPayload[] = tournament?.stages\n    ? tournament.stages.flatMap((s: any) => [...s.matches, ...(s.groups ?? []).flatMap((g: any) => g.matches)])\n    : [];\n  const firstRoundMatches = bracketStage?.matches?.filter((m: MatchPayload) => (m.round ?? 0) === 1) ?? [];\n  const playerCount = firstRoundMatches.length ? firstRoundMatches.length * 2 : null;\n  const locationLabel = [event.locationCity, event.locationName].filter(Boolean).join(\" ¬∑ \");\n\n  const nowLabelParts = nowMatch\n    ? [pairingLabelPlain(nowMatch.pairing1Id, pairings), pairingLabelPlain(nowMatch.pairing2Id, pairings)].filter(Boolean)\n    : [];\n  const nowLabel = nowLabelParts.length ? nowLabelParts.join(\" vs \") : null;\n  const scoreLabel = nowMatch ? formatScore(nowMatch.score) : null;\n  const heroStatus =\n    eventStatus === \"A decorrer\"\n      ? `Ao vivo${nowLabel ? ` ¬∑ Agora a jogar: ${nowLabel}${scoreLabel && scoreLabel !== \"‚Äî\" ? ` (${scoreLabel})` : \"\"}` : \"\"}`\n      : eventStatus === \"Conclu√≠do\"\n        ? championLabel\n          ? `Conclu√≠do ¬∑ Campe√£o: ${championLabel}`\n          : \"Conclu√≠do\"\n        : \"A live come√ßa em breve\";\n\n  const hasHeroSponsor = Boolean(sponsors?.hero?.logoUrl || sponsors?.hero?.label);\n  const nowSponsor = sponsors?.nowPlaying ?? null;\n  const sideSponsors = [sponsors?.sideA, sponsors?.sideB].filter(\n    (slot) => slot && (slot.logoUrl || slot.label),\n  ) as SponsorSlot[];\n  const goalLimits = normalizeGoalLimits(tournament?.goalLimits as GoalLimitsConfig);\n  const goalDefaultLimit = goalLimits?.defaultLimit ?? 3;\n  const goalRoundOverrides = goalLimits?.roundLimits ?? null;\n  const roundNumbers = bracketStage?.matches\n    ? Array.from(new Set(bracketStage.matches.map((m: MatchPayload) => m.round ?? 0))).filter((r) => r > 0).sort((a, b) => a - b)\n    : [];\n  const roundLabels = buildRoundLabels(roundNumbers.length);\n  const roundLabelMap = roundNumbers.reduce((acc, round, idx) => {\n    acc[round] = roundLabels[idx] || `Ronda ${round}`;\n    return acc;\n  }, {} as Record<number, string>);\n  const nowSummary = nowMatch ? getScoreSummary(nowMatch.score) : null;\n  const nowWinnerSide = nowMatch && nowMatch.status === \"DONE\" ? getWinnerSide(nowMatch.score) : null;\n  const nowIsLive = nowMatch ? nowMatch.status === \"IN_PROGRESS\" || nowMatch.status === \"LIVE\" : false;\n  const nowMetaA = nowMatch ? pairingMeta(nowMatch.pairing1Id, pairings) : null;\n  const nowMetaB = nowMatch ? pairingMeta(nowMatch.pairing2Id, pairings) : null;\n  const nowLabelA = nowMetaA?.label ?? \"\";\n  const nowLabelB = nowMetaB?.label ?? \"\";\n  const nowDisplayLabelA = nowLabelA.length > 16 ? nowLabelA.slice(0, 16) : nowLabelA;\n  const nowDisplayLabelB = nowLabelB.length > 16 ? nowLabelB.slice(0, 16) : nowLabelB;\n  const nowAvatarA = nowMetaA?.avatarUrl || DEFAULT_GUEST_AVATAR;\n  const nowAvatarB = nowMetaB?.avatarUrl || DEFAULT_GUEST_AVATAR;\n  const nowScoreA = nowSummary ? nowSummary.a : 0;\n  const nowScoreB = nowSummary ? nowSummary.b : 0;\n  const overrideActive = Boolean(featuredMatchId && nowMatch?.id === featuredMatchId);\n  const [featuredDraft, setFeaturedDraft] = useState<number | null>(featuredMatchId);\n\n  useEffect(() => {\n    setStreamUrl(event.liveStreamUrl ?? \"\");\n  }, [event.liveStreamUrl]);\n\n  useEffect(() => {\n    setSponsorDraft(sponsors ?? {});\n  }, [sponsors]);\n\n  useEffect(() => {\n    setGoalLimitsDraft(normalizeGoalLimits(tournament?.goalLimits as GoalLimitsConfig));\n  }, [tournament?.goalLimits]);\n\n  useEffect(() => {\n    setFeaturedDraft(featuredMatchId);\n  }, [featuredMatchId]);\n\n  const saveFeaturedMatch = async (matchId: number | null) => {\n    if (!tournament?.id) return;\n    setSavingConfig(true);\n    setConfigMessage(null);\n    try {\n      await fetch(`/api/organizador/tournaments/${tournament.id}/featured-match`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ matchId }),\n      });\n      setConfigMessage(matchId ? \"Override aplicado.\" : \"Override removido.\");\n      onRefresh();\n    } catch {\n      setConfigMessage(\"Erro ao atualizar override.\");\n    } finally {\n      setSavingConfig(false);\n      setTimeout(() => setConfigMessage(null), 2000);\n    }\n  };\n\n  const saveLiveConfig = async () => {\n    setSavingConfig(true);\n    setConfigMessage(null);\n    try {\n      if (streamUrl.trim() !== (event.liveStreamUrl ?? \"\")) {\n        await fetch(\"/api/organizador/events/update\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            eventId: event.id,\n            liveStreamUrl: streamUrl.trim() || null,\n          }),\n        });\n      }\n      if (tournament?.id) {\n        await fetch(`/api/organizador/tournaments/${tournament.id}/sponsors`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            hero: sponsorDraft?.hero ?? null,\n            sideA: sponsorDraft?.sideA ?? null,\n            sideB: sponsorDraft?.sideB ?? null,\n            nowPlaying: sponsorDraft?.nowPlaying ?? null,\n          }),\n        });\n        await fetch(`/api/organizador/tournaments/${tournament.id}/rules`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            defaultLimit: goalLimitsDraft?.defaultLimit ?? null,\n            roundLimits: goalLimitsDraft?.roundLimits ?? {},\n          }),\n        });\n      }\n      setConfigMessage(\"Configura√ß√£o guardada.\");\n      onRefresh();\n    } catch {\n      setConfigMessage(\"Erro ao guardar configura√ß√£o.\");\n    } finally {\n      setSavingConfig(false);\n      setTimeout(() => setConfigMessage(null), 2000);\n    }\n  };\n\n  const updateDefaultLimit = (value: string) => {\n    const next = value === \"\" ? null : Number(value);\n    if (value !== \"\" && !Number.isFinite(next)) return;\n    setGoalLimitsDraft((prev) => ({\n      ...(prev ?? {}),\n      defaultLimit: next,\n      roundLimits: prev?.roundLimits ?? null,\n    }));\n  };\n\n  const updateRoundLimit = (round: number, value: string) => {\n    const next = value === \"\" ? null : Number(value);\n    if (value !== \"\" && !Number.isFinite(next)) return;\n    setGoalLimitsDraft((prev) => {\n      const roundLimits = { ...(prev?.roundLimits ?? {}) };\n      if (next === null) {\n        delete roundLimits[String(round)];\n      } else {\n        roundLimits[String(round)] = next;\n      }\n      return {\n        ...(prev ?? {}),\n        roundLimits: Object.keys(roundLimits).length ? roundLimits : null,\n      };\n    });\n  };\n\n  const heroSponsorSection = hasHeroSponsor ? (\n    <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n      <a\n        href={sponsors?.hero?.url || undefined}\n        target={sponsors?.hero?.url ? \"_blank\" : undefined}\n        rel={sponsors?.hero?.url ? \"noreferrer\" : undefined}\n        className=\"flex items-center justify-between gap-4\"\n      >\n        <div className=\"space-y-1\">\n          <p className=\"text-[11px] uppercase tracking-[0.24em] text-white/60\">Sponsor principal</p>\n          {sponsors?.hero?.label && <p className=\"text-white/80\">{sponsors.hero.label}</p>}\n        </div>\n        {sponsors?.hero?.logoUrl && (\n          // eslint-disable-next-line @next/next/no-img-element\n          <img\n            src={sponsors.hero.logoUrl}\n            alt={sponsors.hero.label || \"Sponsor\"}\n            className=\"h-10 w-auto rounded-xl border border-white/10 bg-white/5 px-3 py-2 object-contain\"\n          />\n        )}\n      </a>\n    </section>\n  ) : null;\n\n  const nowPlayingSection = (\n    <section className=\"rounded-3xl border border-white/10 bg-white/5 p-5 space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold text-white\">Agora a jogar</h3>\n        <div className=\"flex items-center gap-2 text-xs text-white/50\">\n          {overrideActive && (\n            <span className=\"rounded-full border border-white/15 bg-white/5 px-2 py-0.5 text-[10px] uppercase tracking-[0.2em] text-white/70\">\n              Override\n            </span>\n          )}\n          <span>{nowMatch ? (nowIsLive ? \"Ao vivo\" : \"Ultimo resultado\") : \"Sem destaque\"}</span>\n        </div>\n      </div>\n      {nowSponsor && (\n        <div className=\"flex items-center justify-between rounded-2xl border border-white/10 bg-black/30 px-3 py-2 text-[11px] text-white/70\">\n          <span className=\"uppercase tracking-[0.2em] text-white/50\">Sponsor do jogo</span>\n          <div className=\"flex items-center gap-2\">\n            {nowSponsor.logoUrl && (\n              // eslint-disable-next-line @next/next/no-img-element\n              <img\n                src={nowSponsor.logoUrl}\n                alt={nowSponsor.label || \"Sponsor\"}\n                className=\"h-7 w-auto rounded-lg border border-white/10 bg-white/5 px-2 py-1 object-contain\"\n              />\n            )}\n            {nowSponsor.label && <span>{nowSponsor.label}</span>}\n          </div>\n        </div>\n      )}\n      {!nowMatch && <p className=\"text-sm text-white/60\">Sem jogos em curso.</p>}\n      {nowMatch && (\n        <div\n          className={`rounded-2xl border p-4 ${\n            nowIsLive ? \"border-emerald-400/50 bg-emerald-500/10\" : \"border-white/10 bg-black/20\"\n          }`}\n        >\n          <div className=\"grid items-center gap-6 md:grid-cols-[1fr_auto_1fr]\">\n            <div className=\"flex flex-col items-center gap-2\">\n              <div\n                className={`h-20 w-20 rounded-full border border-white/10 bg-white/10 bg-cover bg-center ${\n                  nowWinnerSide === \"A\" ? \"ring-2 ring-emerald-400/60 shadow-[0_0_20px_rgba(16,185,129,0.35)]\" : \"\"\n                }`}\n                style={{ backgroundImage: `url(${nowAvatarA})` }}\n              />\n              <span className=\"max-w-[140px] truncate text-sm text-white/85\" title={nowLabelA}>\n                {nowDisplayLabelA}\n              </span>\n              <span\n                className={`text-3xl font-semibold ${\n                  nowWinnerSide === \"A\" ? \"text-emerald-300\" : nowWinnerSide ? \"text-rose-300\" : \"text-white/70\"\n                }`}\n              >\n                {nowScoreA}\n              </span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2 text-center\">\n              <span className=\"text-[11px] uppercase tracking-[0.3em] text-white/50\">\n                {nowIsLive ? \"Agora a jogar\" : \"Resultado\"}\n              </span>\n              <span className=\"text-sm font-semibold text-white/80\">VS</span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n              <div\n                className={`h-20 w-20 rounded-full border border-white/10 bg-white/10 bg-cover bg-center ${\n                  nowWinnerSide === \"B\" ? \"ring-2 ring-emerald-400/60 shadow-[0_0_20px_rgba(16,185,129,0.35)]\" : \"\"\n                }`}\n                style={{ backgroundImage: `url(${nowAvatarB})` }}\n              />\n              <span className=\"max-w-[140px] truncate text-sm text-white/85\" title={nowLabelB}>\n                {nowDisplayLabelB}\n              </span>\n              <span\n                className={`text-3xl font-semibold ${\n                  nowWinnerSide === \"B\" ? \"text-emerald-300\" : nowWinnerSide ? \"text-rose-300\" : \"text-white/70\"\n                }`}\n              >\n                {nowScoreB}\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </section>\n  );\n\n  if (variant === \"inline\") {\n    return (\n      <div className=\"space-y-4\">\n        {heroSponsorSection}\n        {nowPlayingSection}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <header className=\"rounded-3xl border border-white/10 bg-[radial-gradient(circle_at_top,rgba(99,102,241,0.2),transparent_55%),linear-gradient(135deg,rgba(6,8,20,0.9),rgba(15,18,35,0.8))] p-6 text-center\">\n        <p className=\"text-[12px] uppercase tracking-[0.45em] text-white/50\">Live</p>\n        <h1 className=\"mt-2 text-3xl font-semibold text-white md:text-4xl\">{event.title} ‚Äî Live</h1>\n        <p className=\"mt-2 text-sm text-white/60\">\n          {locationLabel}\n          {playerCount ? ` ¬∑ ${playerCount} jogadores` : \"\"}\n          {\" ¬∑ Eliminat√≥rias 1v1\"}\n        </p>\n        <p className=\"mt-2 text-sm text-white/70\">{heroStatus}</p>\n        {eventStatus === \"Pr√≥ximo\" && countdownLabel && (\n          <div className=\"mx-auto mt-4 inline-flex items-center gap-3 rounded-2xl border border-white/15 bg-white/5 px-4 py-2 text-sm text-white/80\">\n            <span className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">O evento come√ßa em</span>\n            <span className=\"text-lg font-semibold text-white\">{countdownLabel}</span>\n          </div>\n        )}\n      </header>\n\n      {nowPlayingSection}\n\n      <div className={`grid gap-6 ${hasHeroSponsor ? \"lg:grid-cols-[1.6fr_1fr]\" : \"\"}`}>\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-[11px] uppercase tracking-[0.24em] text-white/60\">Live stream</p>\n              <h2 className=\"text-lg font-semibold text-white\">{embedUrl ? \"Em direto\" : \"Live em breve\"}</h2>\n            </div>\n            {eventStatus === \"A decorrer\" && (\n              <span className=\"rounded-full border border-rose-400/50 bg-rose-500/10 px-3 py-1 text-[11px] uppercase tracking-[0.2em] text-rose-200\">\n                Live\n              </span>\n            )}\n          </div>\n          {embedUrl ? (\n            <div className=\"aspect-video w-full overflow-hidden rounded-2xl border border-white/10 bg-black\">\n              <iframe\n                src={embedUrl}\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                allowFullScreen\n                className=\"h-full w-full\"\n                title=\"Live stream\"\n              />\n            </div>\n          ) : (\n            <div className=\"rounded-2xl border border-white/10 bg-black/40 p-6 text-sm text-white/70\">\n              A live vai come√ßar em breve. Assim que o link estiver ativo aparece aqui.\n            </div>\n          )}\n          {!embedUrl && streamHref && (\n            <a\n              href={streamHref}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"rounded-full border border-white/15 px-4 py-2 text-sm text-white/80 hover:border-white/40\"\n            >\n              {streamLabel}\n            </a>\n          )}\n          {!embedUrl && organizer && (\n            <button\n              type=\"button\"\n              disabled={followPending}\n              onClick={onToggleFollow}\n              className=\"rounded-full border border-white/20 px-4 py-2 text-sm text-white/80 hover:border-white/40 disabled:opacity-60\"\n            >\n              {followPending ? \"A atualizar‚Ä¶\" : isFollowing ? \"A seguir\" : \"Segue para receber notifica√ß√£o\"}\n            </button>\n          )}\n          <div className=\"flex items-center gap-2 pt-2 text-[11px] uppercase tracking-[0.18em] text-white/50\">\n            {([\"chat\", \"stats\", \"rules\"] as const).map((tab) => (\n              <button\n                key={tab}\n                type=\"button\"\n                onClick={() => setActiveTab(tab)}\n                className={`rounded-full border px-3 py-1 ${\n                  activeTab === tab\n                    ? \"border-fuchsia-400/40 bg-fuchsia-500/10 text-fuchsia-100\"\n                    : \"border-white/15 bg-white/5 text-white/60\"\n                }`}\n              >\n                {tab === \"chat\" ? \"Chat\" : tab === \"stats\" ? \"Stats\" : \"Regras\"}\n              </button>\n            ))}\n          </div>\n          <div className=\"rounded-2xl border border-white/10 bg-black/30 p-4 text-sm text-white/70\">\n            {activeTab === \"chat\" && \"Chat dispon√≠vel em breve.\"}\n            {activeTab === \"stats\" && \"Stats do torneio em breve.\"}\n            {activeTab === \"rules\" && (\n              <ul className=\"space-y-1 text-sm text-white/70\">\n                <li>Jogo a eliminar direto (1v1).</li>\n                <li>Vence quem chega primeiro ao limite de golos.</li>\n                <li>Limite padr√£o: {goalDefaultLimit} golos.</li>\n                {goalRoundOverrides && (\n                  <li>Existem limites por ronda configurados pelo organizador.</li>\n                )}\n                <li>Fair play obrigat√≥rio.</li>\n                <li>Decis√µes do staff s√£o finais.</li>\n              </ul>\n            )}\n          </div>\n        </section>\n\n        {heroSponsorSection}\n      </div>\n\n      <OneVOneBracket\n        stage={bracketStage}\n        pairings={pairings}\n        eventStatus={eventStatus}\n        isOrganizerEdit={isOrganizerEdit}\n        tournamentId={tournament?.id ?? null}\n        onUpdated={onRefresh}\n        goalLimits={tournament?.goalLimits as GoalLimitsConfig}\n        canResolveDispute={canResolveDispute}\n      />\n\n      {sideSponsors.length > 0 && (\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n          <div className=\"grid gap-2 md:grid-cols-2\">\n            {sideSponsors.map((slot, idx) => (\n              <a\n                key={`side-sponsor-${idx}`}\n                href={slot.url || undefined}\n                target={slot.url ? \"_blank\" : undefined}\n                rel={slot.url ? \"noreferrer\" : undefined}\n                className=\"flex items-center gap-3 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white/70\"\n              >\n                {slot.logoUrl && (\n                  // eslint-disable-next-line @next/next/no-img-element\n                  <img src={slot.logoUrl} alt={slot.label || \"Sponsor\"} className=\"h-8 w-auto object-contain\" />\n                )}\n                {slot.label && <span>{slot.label}</span>}\n              </a>\n            ))}\n          </div>\n        </section>\n      )}\n\n      {showSponsors && !hasHeroSponsor && sideSponsors.length === 0 && <SponsorsStrip organizer={organizer} />}\n\n      {isOrganizerEdit && (\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-base font-semibold text-white\">Live Ops (overlay)</h3>\n            <span className=\"text-xs text-white/50\">Organizador</span>\n          </div>\n          <div className=\"rounded-2xl border border-white/10 bg-black/30 p-3 space-y-2\">\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">Agora a jogar</p>\n            <div className=\"flex flex-wrap gap-2\">\n              <select\n                value={featuredDraft ?? \"\"}\n                onChange={(e) => {\n                  const value = e.target.value;\n                  setFeaturedDraft(value ? Number(value) : null);\n                }}\n                className=\"min-w-[220px] flex-1 rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n              >\n                <option value=\"\">Autom√°tico</option>\n                {flatMatches\n                  .filter((m) => m.pairing1Id && m.pairing2Id)\n                  .sort(compareMatchOrder)\n                  .map((match) => {\n                    const label = `${pairingLabelPlain(match.pairing1Id, pairings)} vs ${pairingLabelPlain(match.pairing2Id, pairings)}`;\n                    return (\n                      <option key={`featured-${match.id}`} value={match.id}>\n                        #{match.id} ¬∑ {label || \"Jogo\"}\n                      </option>\n                    );\n                  })}\n              </select>\n              <button\n                type=\"button\"\n                disabled={savingConfig}\n                onClick={() => saveFeaturedMatch(featuredDraft ?? null)}\n                className=\"rounded-full border border-white/20 px-4 py-2 text-[12px] text-white/80 hover:border-white/40 disabled:opacity-60\"\n              >\n                {savingConfig ? \"A guardar‚Ä¶\" : \"Aplicar override\"}\n              </button>\n              <button\n                type=\"button\"\n                disabled={savingConfig}\n                onClick={() => saveFeaturedMatch(null)}\n                className=\"rounded-full border border-white/20 px-4 py-2 text-[12px] text-white/60 hover:border-white/40 disabled:opacity-60\"\n              >\n                Reset autom√°tico\n              </button>\n            </div>\n            {featuredMatchId && (\n              <p className=\"text-[11px] text-white/50\">Override ativo no jogo #{featuredMatchId}.</p>\n            )}\n          </div>\n          {configMessage && <p className=\"text-xs text-white/60\">{configMessage}</p>}\n          {canManageLiveConfig ? (\n            <>\n              <div className=\"grid gap-3 md:grid-cols-2\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm text-white/70\">URL da livestream</label>\n                  <input\n                    value={streamUrl}\n                    onChange={(e) => setStreamUrl(e.target.value)}\n                    placeholder=\"https://youtube.com/...\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                  {streamUrl && (\n                    <a\n                      href={streamUrl}\n                      target=\"_blank\"\n                      rel=\"noreferrer\"\n                      className=\"text-xs text-white/60 hover:text-white\"\n                    >\n                      Testar embed ‚Üó\n                    </a>\n                  )}\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm text-white/70\">Sponsor principal</label>\n                  <input\n                    value={sponsorDraft?.hero?.label ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        hero: { ...(prev?.hero ?? {}), label: e.target.value },\n                      }))\n                    }\n                    placeholder=\"Nome do sponsor\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                  <input\n                    value={sponsorDraft?.hero?.logoUrl ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        hero: { ...(prev?.hero ?? {}), logoUrl: e.target.value },\n                      }))\n                    }\n                    placeholder=\"URL do logo\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                  <input\n                    value={sponsorDraft?.hero?.url ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        hero: { ...(prev?.hero ?? {}), url: e.target.value },\n                      }))\n                    }\n                    placeholder=\"Link (site/Instagram)\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm text-white/70\">Sponsor agora a jogar</label>\n                  <input\n                    value={sponsorDraft?.nowPlaying?.label ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        nowPlaying: { ...(prev?.nowPlaying ?? {}), label: e.target.value },\n                      }))\n                    }\n                    placeholder=\"Nome do sponsor\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                  <input\n                    value={sponsorDraft?.nowPlaying?.logoUrl ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        nowPlaying: { ...(prev?.nowPlaying ?? {}), logoUrl: e.target.value },\n                      }))\n                    }\n                    placeholder=\"URL do logo\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                  <input\n                    value={sponsorDraft?.nowPlaying?.url ?? \"\"}\n                    onChange={(e) =>\n                      setSponsorDraft((prev) => ({\n                        ...(prev ?? {}),\n                        nowPlaying: { ...(prev?.nowPlaying ?? {}), url: e.target.value },\n                      }))\n                    }\n                    placeholder=\"Link (site/Instagram)\"\n                    className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid gap-3 md:grid-cols-2\">\n                {([\"sideA\", \"sideB\"] as Array<\"sideA\" | \"sideB\">).map((slotKey) => {\n                  const slot = sponsorDraft?.[slotKey] ?? null;\n                  return (\n                    <div key={slotKey} className=\"space-y-2\">\n                      <label className=\"text-sm text-white/70\">\n                        Sponsor {slotKey === \"sideA\" ? \"secund√°rio A\" : \"secund√°rio B\"}\n                      </label>\n                      <input\n                        value={slot?.label ?? \"\"}\n                        onChange={(e) =>\n                          setSponsorDraft((prev) => ({\n                            ...(prev ?? {}),\n                            [slotKey]: { ...(slot ?? {}), label: e.target.value },\n                          }))\n                        }\n                        placeholder=\"Nome\"\n                        className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                      />\n                      <input\n                        value={slot?.logoUrl ?? \"\"}\n                        onChange={(e) =>\n                          setSponsorDraft((prev) => ({\n                            ...(prev ?? {}),\n                            [slotKey]: { ...(slot ?? {}), logoUrl: e.target.value },\n                          }))\n                        }\n                        placeholder=\"URL do logo\"\n                        className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                      />\n                      <input\n                        value={slot?.url ?? \"\"}\n                        onChange={(e) =>\n                          setSponsorDraft((prev) => ({\n                            ...(prev ?? {}),\n                            [slotKey]: { ...(slot ?? {}), url: e.target.value },\n                          }))\n                        }\n                        placeholder=\"Link (site/Instagram)\"\n                        className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                      />\n                    </div>\n                  );\n                })}\n              </div>\n\n              <div className=\"rounded-2xl border border-white/10 bg-black/30 p-4 space-y-3\">\n                <div>\n                  <p className=\"text-[11px] uppercase tracking-[0.24em] text-white/60\">Regras de golos</p>\n                  <h4 className=\"text-sm font-semibold text-white\">Limite por ronda</h4>\n                </div>\n                <div className=\"grid gap-2 sm:grid-cols-2\">\n                  <label className=\"space-y-1 text-sm text-white/70\">\n                    <span>Limite padr√£o</span>\n                    <input\n                      type=\"number\"\n                      min={1}\n                      value={goalLimitsDraft?.defaultLimit ?? \"\"}\n                      onChange={(e) => updateDefaultLimit(e.target.value)}\n                      placeholder=\"Ex: 3\"\n                      className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                    />\n                  </label>\n                  {roundNumbers.map((round) => (\n                    <label key={`round-limit-${round}`} className=\"space-y-1 text-sm text-white/70\">\n                      <span>{roundLabelMap[round] || `Ronda ${round}`}</span>\n                      <input\n                        type=\"number\"\n                        min={1}\n                        value={goalLimitsDraft?.roundLimits?.[String(round)] ?? \"\"}\n                        onChange={(e) => updateRoundLimit(round, e.target.value)}\n                        placeholder={`${goalDefaultLimit}`}\n                        className=\"w-full rounded-xl border border-white/15 bg-black/40 px-3 py-2 text-sm text-white\"\n                      />\n                    </label>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-3\">\n                <button\n                  type=\"button\"\n                  disabled={savingConfig}\n                  onClick={saveLiveConfig}\n                  className=\"rounded-full border border-emerald-400/40 bg-emerald-500/10 px-4 py-2 text-sm text-emerald-100 hover:border-emerald-300/70 disabled:opacity-60\"\n                >\n                  {savingConfig ? \"A guardar‚Ä¶\" : \"Guardar configura√ß√£o\"}\n                </button>\n              </div>\n            </>\n          ) : (\n            <p className=\"text-xs text-white/50\">Configura√ß√£o avan√ßada reservada a ADMIN.</p>\n          )}\n        </section>\n      )}\n    </div>\n  );\n}\n\nexport default function EventLiveClient({\n  slug,\n  variant = \"full\",\n}: {\n  slug: string;\n  variant?: \"full\" | \"inline\";\n}) {\n  const searchParams = useSearchParams();\n  const pathname = usePathname();\n  const { isLoggedIn } = useUser();\n  const { openModal } = useAuthModal();\n  const [showFullBracket, setShowFullBracket] = useState(false);\n  const [followPending, setFollowPending] = useState(false);\n  const [isFollowing, setIsFollowing] = useState(false);\n  const [startingMatchId, setStartingMatchId] = useState<number | null>(null);\n  const [startMessage, setStartMessage] = useState<string | null>(null);\n  const isTv = searchParams?.get(\"tv\") === \"1\";\n  const isOrganizerRoute = Boolean(pathname && pathname.startsWith(\"/organizador/\"));\n  const [nowMs, setNowMs] = useState(() => Date.now());\n\n  const url = useMemo(() => `/api/livehub/${slug}`, [slug]);\n  const { data, error, mutate } = useSWR(url, fetcher, { refreshInterval: 10000 });\n\n  const organizer = (data?.organizer as\n    | {\n        id: number;\n        publicName: string;\n        username: string | null;\n        brandingAvatarUrl: string | null;\n        liveHubPremiumEnabled?: boolean | null;\n        isFollowed?: boolean;\n      }\n    | null) ?? null;\n  const access = data?.access as\n    | {\n        liveHubAllowed?: boolean;\n        liveHubVisibility?: \"PUBLIC\" | \"PRIVATE\" | \"DISABLED\";\n      }\n    | undefined;\n  const tournament = data?.tournament ?? null;\n  const tournamentStages = useMemo(() => {\n    if (!tournament?.stages) return [];\n    return tournament.stages.map((stage: any) => {\n      const shouldResolve = stage.stageType === \"PLAYOFF\";\n      const matches = Array.isArray(stage.matches)\n        ? shouldResolve\n          ? resolveBracketAdvancement(stage.matches)\n          : stage.matches\n        : [];\n      return { ...stage, matches };\n    });\n  }, [tournament]);\n  const tournamentView = tournament ? { ...tournament, stages: tournamentStages } : null;\n  const pairings: Record<number, PairingMeta> = data?.pairings || {};\n\n  useEffect(() => {\n    setIsFollowing(Boolean(organizer?.isFollowed));\n  }, [organizer?.isFollowed]);\n\n  useEffect(() => {\n    const interval = setInterval(() => setNowMs(Date.now()), 1000);\n    return () => clearInterval(interval);\n  }, []);\n\n  if (error) {\n    return <div className=\"p-4 text-white/70\">Erro a carregar live.</div>;\n  }\n  if (!data) {\n    return <div className=\"p-4 text-white/70\">A carregar‚Ä¶</div>;\n  }\n  if (!data?.ok) {\n    return <div className=\"p-4 text-white/70\">Live indispon√≠vel para este evento.</div>;\n  }\n\n  const event: EventPayload = data.event;\n  const viewerRole: LiveHubViewerRole = data.viewerRole;\n  const canEditMatches = Boolean(data?.canEditMatches);\n  const organizerRole = typeof data?.organizerRole === \"string\" ? data.organizerRole : null;\n  const canManageLiveConfig =\n    organizerRole === \"OWNER\" || organizerRole === \"CO_OWNER\" || organizerRole === \"ADMIN\";\n  const canResolveDispute = canManageLiveConfig;\n  const liveHub = data.liveHub as { modules: LiveHubModule[]; mode: \"DEFAULT\" | \"PREMIUM\" };\n  const pairingIdFromQuery = searchParams?.get(\"pairingId\");\n  const showCourt = event.templateType === \"PADEL\";\n\n  if (access?.liveHubAllowed === false) {\n    const visibility = access?.liveHubVisibility ?? \"PUBLIC\";\n    const message =\n      visibility === \"DISABLED\"\n        ? \"O LiveHub foi desativado pelo organizador.\"\n        : visibility === \"PRIVATE\"\n          ? \"O LiveHub est√° reservado para participantes.\"\n          : \"O LiveHub est√° indispon√≠vel.\";\n    return (\n      <div className=\"rounded-3xl border border-white/10 bg-black/40 p-6 text-white/70 space-y-2\">\n        <p className=\"text-[11px] uppercase tracking-[0.3em] text-white/50\">Acesso reservado</p>\n        <h2 className=\"text-xl font-semibold text-white\">Este LiveHub n√£o est√° dispon√≠vel agora.</h2>\n        <p className=\"text-sm text-white/60\">{message}</p>\n      </div>\n    );\n  }\n\n  const timeZone = event.timezone || DEFAULT_TIMEZONE;\n\n  const ensureAuthForFollow = () => {\n    if (isLoggedIn) return true;\n    const redirectTo =\n      typeof window !== \"undefined\" ? `${window.location.pathname}${window.location.search}` : \"/\";\n    openModal({ mode: \"login\", redirectTo });\n    return false;\n  };\n\n  const toggleFollow = async () => {\n    if (!organizer) return;\n    if (!ensureAuthForFollow()) return;\n    const next = !isFollowing;\n    setFollowPending(true);\n    setIsFollowing(next);\n    try {\n      const res = await fetch(next ? \"/api/social/follow-organizer\" : \"/api/social/unfollow-organizer\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ organizerId: organizer.id }),\n      });\n      if (!res.ok) {\n        setIsFollowing(!next);\n      }\n    } catch {\n      setIsFollowing(!next);\n    } finally {\n      setFollowPending(false);\n    }\n  };\n\n  if (isTv && tournamentView) {\n    return (\n      <LiveHubTv event={event} tournament={tournamentView} pairings={pairings} timeZone={timeZone} showCourt={showCourt} />\n    );\n  }\n\n  const flatMatches: MatchPayload[] = tournamentView\n    ? tournamentView.stages.flatMap((s: any) => [...s.matches, ...s.groups.flatMap((g: any) => g.matches)])\n    : [];\n\n  const roundsGlobal = Array.from(new Set(flatMatches.map((m) => m.round ?? 0)))\n    .filter((r) => r > 0)\n    .sort((a, b) => a - b);\n  const roundIsCompleteGlobal = (round: number) => {\n    const list = flatMatches.filter((m) => (m.round ?? 0) === round);\n    return list.length > 0 && list.every((m) => m.status === \"DONE\");\n  };\n  const roundIsLockedGlobal = (round: number) => {\n    const idx = roundsGlobal.indexOf(round);\n    if (idx <= 0) return false;\n    return roundsGlobal.slice(0, idx).some((r) => !roundIsCompleteGlobal(r));\n  };\n\n  const liveMatches = flatMatches.filter((m) => m.status === \"IN_PROGRESS\" || m.status === \"LIVE\");\n  const completedMatches = flatMatches.filter((m) => m.status === \"DONE\");\n  const byUpdatedAtDesc = (a: MatchPayload, b: MatchPayload) =>\n    a.updatedAt && b.updatedAt ? new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime() : 0;\n  const latestCompletedMatch = completedMatches.slice().sort(byUpdatedAtDesc)[0] ?? null;\n  const defaultNowMatch = liveMatches.sort(compareMatchOrder)[0] ?? latestCompletedMatch;\n  const oneVOneOrderedMatches = flatMatches.slice().sort(compareBracketOrder);\n  const oneVOneLiveMatches = oneVOneOrderedMatches.filter((m) => m.status === \"IN_PROGRESS\" || m.status === \"LIVE\");\n  const oneVOneLatestCompleted = oneVOneOrderedMatches.filter((m) => m.status === \"DONE\").sort(byUpdatedAtDesc)[0] ?? null;\n  const oneVOneNowMatch = oneVOneLiveMatches[0] ?? oneVOneLatestCompleted;\n  const usePremium = liveHub?.mode === \"PREMIUM\";\n  const matchOrder = usePremium ? getCustomLiveHubMatchOrder(organizer) : null;\n  const useOneVOneOrdering = matchOrder === \"ONEVONE\";\n  const isOneVOne = useOneVOneOrdering;\n  const featuredMatchId = typeof tournamentView?.featuredMatchId === \"number\" ? tournamentView.featuredMatchId : null;\n  const featuredMatch = featuredMatchId ? flatMatches.find((m) => m.id === featuredMatchId) ?? null : null;\n  const featuredActive =\n    featuredMatch && featuredMatch.status !== \"DONE\" && featuredMatch.status !== \"CANCELLED\" ? featuredMatch : null;\n  const autoNowMatch = useOneVOneOrdering ? oneVOneNowMatch : defaultNowMatch;\n  const nowMatch = featuredActive ?? autoNowMatch;\n\n  const upcomingMatches = flatMatches\n    .filter((m) => m.status !== \"DONE\" && m.id !== (nowMatch?.id ?? -1))\n    .sort(compareMatchOrder)\n    .slice(0, 4);\n\n  const recentResults = flatMatches\n    .filter((m) => m.status === \"DONE\")\n    .sort((a, b) =>\n      a.updatedAt && b.updatedAt ? new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime() : 0,\n    )\n    .slice(0, 6);\n\n  const modules = liveHub?.modules ?? [];\n  const resolvedModules =\n    event.liveStreamUrl && !modules.includes(\"VIDEO\") ? [\"VIDEO\", ...modules] : modules;\n  const eventStatus = getEventStatusLabel(event.startsAt, event.endsAt);\n  const calendarLinks = event.startsAt ? buildCalendarLinks(event, timeZone) : null;\n  const countdownLabel = formatCountdown(event.startsAt, nowMs);\n  const goalLimits = normalizeGoalLimits(tournamentView?.goalLimits as GoalLimitsConfig);\n  const sponsors = (tournamentView?.sponsors as SponsorsConfig) ?? null;\n  const derivedChampionPairingId = (() => {\n    if (!tournamentView?.stages?.length) return null;\n    const playoffStages = tournamentView.stages.filter(\n      (stage: any) => stage.stageType === \"PLAYOFF\" && stage.matches?.length,\n    );\n    const bracketStage =\n      playoffStages[playoffStages.length - 1] ?? tournamentView.stages.find((stage: any) => stage.matches?.length);\n    if (!bracketStage?.matches?.length) return null;\n    const maxRound = Math.max(...bracketStage.matches.map((match: MatchPayload) => match.round ?? 0));\n    if (!Number.isFinite(maxRound) || maxRound <= 0) return null;\n    const finalMatch = bracketStage.matches\n      .filter((match: MatchPayload) => (match.round ?? 0) === maxRound)\n      .sort((a: MatchPayload, b: MatchPayload) => b.id - a.id)[0];\n    if (!finalMatch || finalMatch.status !== \"DONE\") return null;\n    const winnerSide = getWinnerSide(finalMatch.score);\n    if (!winnerSide) return null;\n    return winnerSide === \"A\" ? finalMatch.pairing1Id ?? null : finalMatch.pairing2Id ?? null;\n  })();\n  const championLabel = tournamentView?.championPairingId\n    ? pairingLabelPlain(tournamentView.championPairingId, pairings) || null\n    : derivedChampionPairingId\n      ? pairingLabelPlain(derivedChampionPairingId, pairings) || null\n      : null;\n  const isOrganizerEdit =\n    viewerRole === \"ORGANIZER\" && canEditMatches && isOrganizerRoute && searchParams?.get(\"edit\") === \"1\";\n  const organizerEditHref = (() => {\n    const base = isOrganizerRoute && pathname ? pathname : `/organizador/eventos/${event.id}/live`;\n    const params = new URLSearchParams(searchParams?.toString());\n    params.set(\"tab\", \"preview\");\n    params.set(\"edit\", \"1\");\n    return `${base}?${params.toString()}`;\n  })();\n  const pendingMatches = flatMatches\n    .filter((match) => match.status === \"PENDING\" || match.status === \"SCHEDULED\")\n    .sort(compareMatchOrder);\n  const firstPlayableMatch = pendingMatches.find((match) => match.pairing1Id && match.pairing2Id) ?? null;\n\n  const startFirstMatch = async () => {\n    if (!tournamentView || !firstPlayableMatch) {\n      setStartMessage(\"Sem jogos completos para iniciar.\");\n      return;\n    }\n    if (!firstPlayableMatch.updatedAt) {\n      setStartMessage(\"Sem vers√£o do jogo.\");\n      return;\n    }\n    setStartingMatchId(firstPlayableMatch.id);\n    setStartMessage(null);\n    try {\n      const res = await fetch(\n        `/api/organizador/tournaments/${tournamentView.id}/matches/${firstPlayableMatch.id}/result`,\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            status: \"IN_PROGRESS\",\n            expectedUpdatedAt: firstPlayableMatch.updatedAt,\n          }),\n        },\n      );\n      const json = await res.json().catch(() => null);\n      if (!res.ok || !json?.ok) {\n        setStartMessage(json?.error || \"Erro ao come√ßar o jogo.\");\n        return;\n      }\n      setStartMessage(\"Jogo iniciado.\");\n      mutate();\n    } catch {\n      setStartMessage(\"Erro ao come√ßar o jogo.\");\n    } finally {\n      setStartingMatchId(null);\n    }\n  };\n  const nextPendingLabel = firstPlayableMatch\n    ? [pairingLabelPlain(firstPlayableMatch.pairing1Id, pairings), pairingLabelPlain(firstPlayableMatch.pairing2Id, pairings)]\n        .filter(Boolean)\n        .join(\" vs \")\n    : null;\n\n  if (variant === \"inline\" && !isOneVOne) {\n    const hero = sponsors?.hero;\n    const inlineStatus = nowMatch\n      ? nowMatch.status === \"IN_PROGRESS\" || nowMatch.status === \"LIVE\"\n        ? \"Ao vivo\"\n        : \"Ultimo resultado\"\n      : \"Sem destaque\";\n    return (\n      <div className=\"space-y-4\">\n        {hero && (\n          <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n            <a\n              href={hero.url || undefined}\n              target={hero.url ? \"_blank\" : undefined}\n              rel={hero.url ? \"noreferrer\" : undefined}\n              className=\"flex items-center justify-between gap-4\"\n            >\n              <div className=\"space-y-1\">\n                <p className=\"text-[11px] uppercase tracking-[0.24em] text-white/60\">Sponsor principal</p>\n                {hero.label && <p className=\"text-white/80\">{hero.label}</p>}\n              </div>\n              {hero.logoUrl && (\n                // eslint-disable-next-line @next/next/no-img-element\n                <img\n                  src={hero.logoUrl}\n                  alt={hero.label || \"Sponsor\"}\n                  className=\"h-10 w-auto rounded-xl border border-white/10 bg-white/5 px-3 py-2 object-contain\"\n                />\n              )}\n            </a>\n          </section>\n        )}\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-semibold text-white\">Agora a jogar</h3>\n            <span className=\"text-xs text-white/50\">{inlineStatus}</span>\n          </div>\n          {!nowMatch && <p className=\"text-sm text-white/60\">Sem jogos em curso.</p>}\n          {nowMatch && (\n            <MatchCard\n              match={nowMatch}\n              pairings={pairings}\n              timeZone={timeZone}\n              size=\"lg\"\n              showCourt={showCourt}\n            />\n          )}\n        </section>\n      </div>\n    );\n  }\n\n  if (isOneVOne) {\n    const showSponsors = resolvedModules.includes(\"SPONSORS\");\n    return (\n      <div className=\"space-y-6\">\n        {variant === \"full\" && viewerRole === \"ORGANIZER\" && canEditMatches && isOrganizerRoute && !isOrganizerEdit && (\n          <div className=\"rounded-3xl border border-white/10 bg-white/5 p-4 text-sm text-white/70\">\n            Est√°s em modo p√∫blico.{\" \"}\n            <Link href={organizerEditHref} className=\"text-white underline\">\n              Ativar overlay do organizador\n            </Link>\n            .\n          </div>\n        )}\n        {variant === \"full\" && viewerRole === \"ORGANIZER\" && canEditMatches && isOrganizerRoute && (\n          <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex flex-wrap items-center justify-between gap-3\">\n              <div className=\"space-y-1\">\n                <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">Arranque</p>\n                <p className=\"text-sm text-white/70\">Come√ßa o primeiro jogo pendente.</p>\n                {nextPendingLabel && (\n                  <p className=\"text-[11px] text-white/50\">Pr√≥ximo: {nextPendingLabel}</p>\n                )}\n              </div>\n              <button\n                type=\"button\"\n                onClick={startFirstMatch}\n                disabled={!firstPlayableMatch || Boolean(startingMatchId)}\n                className=\"rounded-full border border-emerald-400/40 bg-emerald-500/10 px-4 py-2 text-[12px] font-semibold text-emerald-100 hover:border-emerald-300/70 disabled:opacity-60\"\n              >\n                {startingMatchId ? \"A iniciar‚Ä¶\" : \"Come√ßar jogos\"}\n              </button>\n            </div>\n            {startMessage && <p className=\"mt-2 text-[11px] text-white/60\">{startMessage}</p>}\n          </section>\n        )}\n        <OneVOneLiveLayout\n          event={event}\n          organizer={organizer}\n          tournament={tournamentView}\n          pairings={pairings}\n          timeZone={timeZone}\n          eventStatus={eventStatus}\n          countdownLabel={countdownLabel}\n          nowMatch={nowMatch}\n          championLabel={championLabel}\n          sponsors={sponsors}\n          onToggleFollow={toggleFollow}\n          followPending={followPending}\n          isFollowing={isFollowing}\n          showSponsors={showSponsors}\n          isOrganizerEdit={isOrganizerEdit}\n          canManageLiveConfig={canManageLiveConfig}\n          canResolveDispute={canResolveDispute}\n          onRefresh={() => mutate()}\n          variant={variant}\n        />\n\n      </div>\n    );\n  }\n\n  const renderModule = (mod: LiveHubModule) => {\n    switch (mod) {\n      case \"HERO\": {\n        const statusTone =\n          eventStatus === \"A decorrer\"\n            ? \"border-emerald-400/40 bg-emerald-500/10 text-emerald-100\"\n            : eventStatus === \"Pr√≥ximo\"\n              ? \"border-sky-400/40 bg-sky-500/10 text-sky-100\"\n              : eventStatus === \"Conclu√≠do\"\n                ? \"border-amber-300/40 bg-amber-400/10 text-amber-100\"\n                : \"border-white/15 bg-white/5 text-white/70\";\n        return (\n          <section key=\"hero\" className=\"rounded-3xl border border-white/10 bg-black/40 p-5 space-y-4\">\n            <div className=\"flex flex-wrap items-start justify-between gap-4\">\n              <div className=\"space-y-2\">\n                <p className=\"text-[11px] uppercase tracking-[0.3em] text-white/60\">LiveHub</p>\n                <h1 className=\"text-2xl font-semibold text-white md:text-3xl\">{event.title}</h1>\n                <p className=\"text-white/70 text-sm\">{formatDateRange(event.startsAt, event.endsAt, timeZone)}</p>\n                {event.locationName && (\n                  <p className=\"text-white/50 text-sm\">\n                    {event.locationName}{event.locationCity ? ` ¬∑ ${event.locationCity}` : \"\"}\n                  </p>\n                )}\n                {eventStatus === \"Pr√≥ximo\" && countdownLabel && (\n                  <p className=\"text-sm text-white/60\">Come√ßa em {countdownLabel}</p>\n                )}\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <RoleBadge role={viewerRole} />\n                <span className={`rounded-full border px-3 py-1 text-[11px] uppercase tracking-[0.2em] ${statusTone}`}>\n                  {eventStatus}\n                </span>\n                <span className=\"rounded-full border border-white/10 bg-white/5 px-3 py-1 text-[11px] uppercase tracking-[0.2em] text-white/60\">\n                  Modo autom√°tico\n                </span>\n                {calendarLinks && (\n                  <a\n                    href={calendarLinks.ics}\n                    download={`${event.slug || \"evento\"}.ics`}\n                    className=\"rounded-full border border-white/15 px-3 py-1 text-[11px] uppercase tracking-[0.2em] text-white/70 hover:border-white/40\"\n                  >\n                    Adicionar ao calend√°rio\n                  </a>\n                )}\n              </div>\n            </div>\n\n            {organizer && (\n              <div className=\"flex items-center gap-3 rounded-2xl border border-white/10 bg-white/5 px-4 py-3\">\n                <div className=\"h-10 w-10 overflow-hidden rounded-full border border-white/10 bg-white/10\">\n                  {organizer.brandingAvatarUrl ? (\n                    // eslint-disable-next-line @next/next/no-img-element\n                    <img src={organizer.brandingAvatarUrl} alt=\"Organizador\" className=\"h-full w-full object-cover\" />\n                  ) : (\n                    <div className=\"flex h-full w-full items-center justify-center text-xs text-white/60\">\n                      {organizer.publicName?.slice(0, 2) ?? \"OR\"}\n                    </div>\n                  )}\n                </div>\n                <div>\n                  <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">Organizado por</p>\n                  <p className=\"text-white font-medium\">{organizer.publicName}</p>\n                  {organizer.username && <p className=\"text-white/50 text-xs\">@{organizer.username}</p>}\n                </div>\n              </div>\n            )}\n          </section>\n        );\n      }\n      case \"VIDEO\": {\n        const streamEmbed = getStreamEmbed(event.liveStreamUrl);\n        const embedUrl = streamEmbed.embedUrl;\n        const streamHref = streamEmbed.href;\n        const streamLabel =\n          streamEmbed.provider === \"youtube\"\n            ? \"Abrir no YouTube\"\n            : streamEmbed.provider === \"twitch\"\n              ? \"Abrir na Twitch\"\n              : \"Abrir stream\";\n        if (!embedUrl) {\n          return (\n            <section key=\"video\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n              <div>\n                <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Live</p>\n                <h2 className=\"text-lg font-semibold text-white\">Live stream em breve</h2>\n              </div>\n              <p className=\"text-sm text-white/60\">\n                Ainda n√£o existe uma livestream ativa. Assim que o link estiver dispon√≠vel, aparece aqui.\n              </p>\n              {streamHref && (\n                <a\n                  href={streamHref}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"rounded-full border border-white/15 px-3 py-1 text-xs text-white/70 hover:border-white/40\"\n                >\n                  {streamLabel}\n                </a>\n              )}\n              {organizer && (\n                <button\n                  type=\"button\"\n                  disabled={followPending}\n                  onClick={toggleFollow}\n                  className=\"rounded-full border border-white/20 px-4 py-2 text-sm text-white/80 hover:border-white/40 disabled:opacity-60\"\n                >\n                  {followPending ? \"A atualizar‚Ä¶\" : isFollowing ? \"A seguir\" : \"Segue para receber notifica√ß√£o\"}\n                </button>\n              )}\n            </section>\n          );\n        }\n        return (\n          <section key=\"video\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Live</p>\n                <h2 className=\"text-lg font-semibold text-white\">Assistir agora</h2>\n              </div>\n              {streamHref && (\n                <a\n                  href={streamHref}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"rounded-full border border-white/15 px-3 py-1 text-xs text-white/70 hover:border-white/40\"\n                >\n                  {streamLabel}\n                </a>\n              )}\n            </div>\n            <div className=\"aspect-video w-full overflow-hidden rounded-2xl border border-white/10 bg-black\">\n              <iframe\n                src={embedUrl}\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                allowFullScreen\n                className=\"h-full w-full\"\n                title=\"Live stream\"\n              />\n            </div>\n          </section>\n        );\n      }\n      case \"NOW_PLAYING\": {\n        if (!tournamentView) return <EmptyCard key=\"now\" title=\"Agora a jogar\" children=\"Sem torneio associado.\" />;\n        return (\n          <section key=\"now\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-semibold text-white\">Agora a jogar</h2>\n              <span className=\"text-xs text-white/50\">{liveMatches.length} em jogo</span>\n            </div>\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              {liveMatches.length === 0 && <p className=\"text-white/60\">Sem jogos em curso.</p>}\n              {liveMatches.map((match) => (\n                <MatchCard key={`now-${match.id}`} match={match} pairings={pairings} timeZone={timeZone} highlight showCourt={showCourt} />\n              ))}\n            </div>\n          </section>\n        );\n      }\n      case \"NEXT_MATCHES\": {\n        if (!tournamentView) return <EmptyCard key=\"next\" title=\"Pr√≥ximos jogos\" children=\"Sem torneio associado.\" />;\n        return (\n          <section key=\"next\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-semibold text-white\">Pr√≥ximos jogos</h2>\n              <span className=\"text-xs text-white/50\">{upcomingMatches.length} previstos</span>\n            </div>\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              {upcomingMatches.length === 0 && <p className=\"text-white/60\">Sem jogos agendados.</p>}\n              {upcomingMatches.map((match) => {\n                const highlight =\n                  (pairingIdFromQuery &&\n                    (`${match.pairing1Id}` === pairingIdFromQuery || `${match.pairing2Id}` === pairingIdFromQuery)) ||\n                  (tournamentView?.userPairingId &&\n                    (match.pairing1Id === tournamentView.userPairingId || match.pairing2Id === tournamentView.userPairingId));\n                return (\n                  <MatchCard\n                    key={`next-${match.id}`}\n                    match={match}\n                    pairings={pairings}\n                    highlight={highlight}\n                    timeZone={timeZone}\n                    showCourt={showCourt}\n                  />\n                );\n              })}\n            </div>\n          </section>\n        );\n      }\n      case \"RESULTS\": {\n        if (!tournamentView) return <EmptyCard key=\"results\" title=\"Resultados\" children=\"Sem torneio associado.\" />;\n        return (\n          <section key=\"results\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-semibold text-white\">Resultados recentes</h2>\n              <span className=\"text-xs text-white/50\">{recentResults.length} jogos</span>\n            </div>\n            <div className=\"grid gap-3 md:grid-cols-2\">\n              {recentResults.length === 0 && <p className=\"text-white/60\">Sem resultados registados.</p>}\n              {recentResults.map((match) => (\n                <MatchCard key={`res-${match.id}`} match={match} pairings={pairings} timeZone={timeZone} showCourt={showCourt} />\n              ))}\n            </div>\n          </section>\n        );\n      }\n      case \"BRACKET\": {\n        if (!tournamentView) return <EmptyCard key=\"bracket\" title=\"Bracket\" children=\"Sem torneio associado.\" />;\n        const stages = tournamentView.stages ?? [];\n        const playoffStages = stages.filter((stage: any) => stage.stageType === \"PLAYOFF\" && stage.matches?.length);\n        const bracketStages = playoffStages.length > 0 ? playoffStages : stages.filter((stage: any) => stage.matches?.length);\n        const hasBracket = bracketStages.length > 0;\n        const hasGroups = stages.some((stage: any) => stage.groups?.length);\n\n        if (hasBracket) {\n          const bracketHasEarlyRounds = bracketStages.some((stage: any) => {\n            const roundCount = new Set(stage.matches.map((m: MatchPayload) => m.round ?? 0)).size;\n            return roundCount > 3;\n          });\n          const highlightPairingId = (() => {\n            if (pairingIdFromQuery) {\n              const parsed = Number(pairingIdFromQuery);\n              return Number.isFinite(parsed) ? parsed : null;\n            }\n            return tournamentView?.userPairingId ?? null;\n          })();\n          return (\n            <section key=\"bracket\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-4\">\n              <div className=\"flex flex-wrap items-center justify-between gap-3\">\n                <div>\n                  <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Bracket</p>\n                  <h2 className=\"text-lg font-semibold text-white\">Chave completa</h2>\n                </div>\n                {bracketHasEarlyRounds && (\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowFullBracket((prev) => !prev)}\n                    className=\"hidden md:inline-flex rounded-full border border-white/15 px-3 py-1 text-xs text-white/70 hover:border-white/40\"\n                  >\n                    {showFullBracket ? \"Mostrar menos\" : \"Ver bracket completo\"}\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-4\">\n                {bracketStages.map((stage: any) => {\n                  if (!stage.matches.length) return null;\n                  return (\n                    <div key={stage.id} className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-white font-semibold\">{stage.name || \"Playoffs\"}</h3>\n                        <span className=\"text-[11px] uppercase tracking-[0.18em] text-white/50\">{stage.stageType}</span>\n                      </div>\n                      <BracketRoundsView\n                        matches={stage.matches}\n                        pairings={pairings}\n                        isOrganizerEdit={isOrganizerEdit}\n                        tournamentId={tournamentView?.id ?? null}\n                        onUpdated={onRefresh}\n                        goalLimits={goalLimits}\n                        highlightPairingId={highlightPairingId}\n                        canResolveDispute={canResolveDispute}\n                        view={showFullBracket ? \"full\" : \"split\"}\n                      />\n                    </div>\n                  );\n                })}\n              </div>\n            </section>\n          );\n        }\n\n        if (hasGroups) {\n          return (\n            <section key=\"bracket\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-4\">\n              <div>\n                <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Tabela</p>\n                <h2 className=\"text-lg font-semibold text-white\">Classifica√ß√£o dos grupos</h2>\n              </div>\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                {stages.map((stage: any) =>\n                  stage.groups?.map((group: any) => (\n                    <div key={`group-${group.id}`} className=\"rounded-2xl border border-white/10 bg-black/30 p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-white font-semibold\">{group.name || \"Grupo\"}</h3>\n                        <span className=\"text-[11px] uppercase tracking-[0.18em] text-white/50\">{stage.stageType}</span>\n                      </div>\n                      <div className=\"mt-3 space-y-2\">\n                        {(group.standings ?? []).length === 0 && (\n                          <p className=\"text-sm text-white/60\">Sem classifica√ß√£o dispon√≠vel.</p>\n                        )}\n                        {(group.standings ?? []).map((row: any, idx: number) => {\n                          return (\n                            <div key={`group-${group.id}-row-${row.pairingId}`} className=\"flex items-center justify-between text-sm text-white/80\">\n                              <div className=\"flex items-center gap-3\">\n                                <span className=\"text-white/50\">{idx + 1}</span>\n                                {renderPairingName(row.pairingId, pairings)}\n                              </div>\n                              <span className=\"text-white/50\">{row.wins}-{row.losses}</span>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  )),\n                )}\n              </div>\n            </section>\n          );\n        }\n\n        return <EmptyCard key=\"bracket\" title=\"Bracket\" children=\"Sem chave definida.\" />;\n      }\n      case \"CHAMPION\": {\n        if (!tournamentView) return <EmptyCard key=\"champ\" title=\"Campe√£o\" children=\"Sem torneio associado.\" />;\n        const championId = (tournamentView.championPairingId as number | null) ?? derivedChampionPairingId;\n        const meta = pairingMeta(championId, pairings);\n        if (!championId || !meta) {\n          return <EmptyCard key=\"champ\" title=\"Campe√£o\" children=\"Ainda n√£o existe campe√£o definido.\" />;\n        }\n        return (\n          <section key=\"champ\" className=\"rounded-3xl border border-amber-300/30 bg-[linear-gradient(135deg,rgba(255,215,120,0.12),rgba(20,20,20,0.8))] p-5\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex h-14 w-14 items-center justify-center rounded-2xl border border-amber-200/40 bg-amber-300/10 text-2xl\">\n                üèÜ\n              </div>\n              <div>\n                <p className=\"text-[11px] uppercase tracking-[0.3em] text-amber-100/70\">Campe√£o</p>\n                <div className=\"text-xl font-semibold text-white\">\n                  {renderPairingName(championId, pairings)}\n                </div>\n              </div>\n            </div>\n          </section>\n        );\n      }\n      case \"SUMMARY\": {\n        return (\n          <section key=\"summary\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-2\">\n            <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Resumo</p>\n            <h2 className=\"text-lg font-semibold text-white\">Sobre este evento</h2>\n            <p className=\"text-white/70 text-sm leading-relaxed\">\n              {event.description?.trim() || \"Descri√ß√£o em breve.\"}\n            </p>\n          </section>\n        );\n      }\n      case \"CTA\": {\n        const ctaCopy =\n          viewerRole === \"PUBLIC\"\n            ? \"Queres aparecer como participante? Garante o teu bilhete.\"\n            : \"J√° tens acesso como participante. Aproveita o LiveHub.\";\n        const ctaLabel = viewerRole === \"PUBLIC\" ? \"Garantir lugar\" : \"Ver o meu bilhete\";\n        return (\n          <section key=\"cta\" className=\"rounded-3xl border border-white/10 bg-white/5 p-4\">\n            <div className=\"flex flex-wrap items-center justify-between gap-3\">\n              <div>\n                <p className=\"text-[11px] uppercase tracking-[0.25em] text-white/60\">Participa√ß√£o</p>\n                <p className=\"text-white/80\">{ctaCopy}</p>\n              </div>\n              <Link\n                href={`/eventos/${event.slug}`}\n                className=\"rounded-full border border-white/20 px-4 py-2 text-sm text-white/80 hover:border-white/40\"\n              >\n                {ctaLabel}\n              </Link>\n            </div>\n          </section>\n        );\n      }\n      case \"SPONSORS\": {\n        return <SponsorsStrip organizer={organizer} />;\n      }\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {resolvedModules.map((mod) => renderModule(mod))}\n\n      {viewerRole === \"ORGANIZER\" && canEditMatches && tournamentView && isOrganizerRoute && (\n        <section className=\"rounded-3xl border border-white/10 bg-white/5 p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg font-semibold text-white\">Gest√£o r√°pida</h2>\n            <span className=\"text-xs text-white/50\">Organizador</span>\n          </div>\n          <div className=\"rounded-2xl border border-white/10 bg-black/30 px-4 py-3\">\n            <div className=\"flex flex-wrap items-center justify-between gap-3\">\n              <div className=\"space-y-1\">\n                <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/50\">Arranque</p>\n                <p className=\"text-sm text-white/70\">Come√ßa o primeiro jogo pendente.</p>\n                {nextPendingLabel && (\n                  <p className=\"text-[11px] text-white/50\">Pr√≥ximo: {nextPendingLabel}</p>\n                )}\n              </div>\n              <button\n                type=\"button\"\n                onClick={startFirstMatch}\n                disabled={!firstPlayableMatch || Boolean(startingMatchId)}\n                className=\"rounded-full border border-emerald-400/40 bg-emerald-500/10 px-4 py-2 text-[12px] font-semibold text-emerald-100 hover:border-emerald-300/70 disabled:opacity-60\"\n              >\n                {startingMatchId ? \"A iniciar‚Ä¶\" : \"Come√ßar jogos\"}\n              </button>\n            </div>\n            {startMessage && <p className=\"mt-2 text-[11px] text-white/60\">{startMessage}</p>}\n          </div>\n          <div className=\"space-y-3\">\n            {flatMatches\n              .filter((m) => m.status !== \"DONE\")\n              .slice(0, 6)\n              .map((match) => (\n                <div key={`edit-${match.id}`} className=\"space-y-2\">\n                  <MatchCard match={match} pairings={pairings} timeZone={timeZone} showCourt={showCourt} />\n                  <OrganizerMatchEditor\n                    match={match}\n                    tournamentId={tournamentView.id}\n                    onUpdated={() => mutate()}\n                    goalLimit={resolveGoalLimit(match.round ?? null, goalLimits)}\n                    locked={roundIsLockedGlobal(match.round ?? 0) || match.status === \"DISPUTED\"}\n                    lockedReason={\n                      match.status === \"DISPUTED\"\n                        ? \"Jogo em disputa. Resolve antes de editar.\"\n                        : roundIsLockedGlobal(match.round ?? 0)\n                          ? \"Esta fase ainda n√£o est√° ativa.\"\n                          : null\n                    }\n                    canResolveDispute={canResolveDispute}\n                  />\n                </div>\n              ))}\n            {flatMatches.filter((m) => m.status !== \"DONE\").length === 0 && (\n              <p className=\"text-white/60\">Sem jogos pendentes para editar.</p>\n            )}\n          </div>\n        </section>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10748, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/eventos/%5Bslug%5D/EventBackgroundTuner.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\n\ntype BackgroundDefaults = {\n  blur: number;\n  scale: number;\n  saturate: number;\n  brightness: number;\n  maskStops: [number, number, number, number, number, number];\n  maskAlphas: [number, number, number, number, number, number];\n  overlayTop: number;\n  overlayMid: number;\n  overlayBottom: number;\n  fadeStart: number;\n  fadeMid: number;\n  fadeEnd: number;\n  fadeDark: number;\n};\n\ntype EventBackgroundTunerProps = {\n  targetId: string;\n  defaults: BackgroundDefaults;\n};\n\ntype PresetKey =\n  | \"nebula\"\n  | \"aurora\"\n  | \"obsidian\"\n  | \"ember\"\n  | \"sapphire\"\n  | \"rose\";\n\nconst NEBULA_PRESET: BackgroundDefaults = {\n  blur: 72,\n  scale: 1.34,\n  saturate: 1.4,\n  brightness: 1.08,\n  maskStops: [0, 22, 44, 66, 86, 100],\n  maskAlphas: [1, 0.96, 0.78, 0.46, 0.2, 0],\n  overlayTop: 0.32,\n  overlayMid: 0.2,\n  overlayBottom: 0.08,\n  fadeStart: 84,\n  fadeMid: 94,\n  fadeEnd: 100,\n  fadeDark: 0.86,\n};\n\nconst AURORA_PRESET: BackgroundDefaults = {\n  blur: 62,\n  scale: 1.3,\n  saturate: 1.5,\n  brightness: 1.12,\n  maskStops: [0, 24, 46, 68, 88, 100],\n  maskAlphas: [1, 0.96, 0.78, 0.5, 0.22, 0],\n  overlayTop: 0.28,\n  overlayMid: 0.16,\n  overlayBottom: 0.04,\n  fadeStart: 80,\n  fadeMid: 92,\n  fadeEnd: 100,\n  fadeDark: 0.78,\n};\n\nconst OBSIDIAN_PRESET: BackgroundDefaults = {\n  blur: 58,\n  scale: 1.22,\n  saturate: 0.75,\n  brightness: 0.9,\n  maskStops: [0, 18, 36, 56, 78, 100],\n  maskAlphas: [1, 0.98, 0.82, 0.55, 0.28, 0],\n  overlayTop: 0.72,\n  overlayMid: 0.55,\n  overlayBottom: 0.28,\n  fadeStart: 54,\n  fadeMid: 72,\n  fadeEnd: 90,\n  fadeDark: 0.96,\n};\n\nconst EMBER_PRESET: BackgroundDefaults = {\n  blur: 52,\n  scale: 1.2,\n  saturate: 1.4,\n  brightness: 1.18,\n  maskStops: [0, 26, 50, 70, 88, 100],\n  maskAlphas: [1, 0.95, 0.75, 0.45, 0.2, 0],\n  overlayTop: 0.32,\n  overlayMid: 0.2,\n  overlayBottom: 0.06,\n  fadeStart: 78,\n  fadeMid: 90,\n  fadeEnd: 98,\n  fadeDark: 0.72,\n};\n\nconst SAPPHIRE_PRESET: BackgroundDefaults = {\n  blur: 78,\n  scale: 1.34,\n  saturate: 1.15,\n  brightness: 1.08,\n  maskStops: [0, 30, 54, 74, 90, 100],\n  maskAlphas: [1, 0.98, 0.85, 0.55, 0.25, 0],\n  overlayTop: 0.24,\n  overlayMid: 0.14,\n  overlayBottom: 0.04,\n  fadeStart: 86,\n  fadeMid: 95,\n  fadeEnd: 100,\n  fadeDark: 0.7,\n};\n\nconst ROSE_PRESET: BackgroundDefaults = {\n  blur: 66,\n  scale: 1.26,\n  saturate: 1.22,\n  brightness: 1.04,\n  maskStops: [0, 22, 44, 64, 84, 100],\n  maskAlphas: [1, 0.96, 0.8, 0.5, 0.22, 0],\n  overlayTop: 0.36,\n  overlayMid: 0.22,\n  overlayBottom: 0.08,\n  fadeStart: 82,\n  fadeMid: 93,\n  fadeEnd: 100,\n  fadeDark: 0.8,\n};\n\nconst PRESET_OPTIONS: Array<{ key: PresetKey; label: string }> = [\n  { key: \"nebula\", label: \"Nebula Drift\" },\n  { key: \"aurora\", label: \"Aurora Veil\" },\n  { key: \"obsidian\", label: \"Obsidian Luxe\" },\n  { key: \"ember\", label: \"Ember Horizon\" },\n  { key: \"sapphire\", label: \"Sapphire Mist\" },\n  { key: \"rose\", label: \"Rose Quartz\" },\n];\n\nexport default function EventBackgroundTuner({\n  targetId,\n  defaults,\n}: EventBackgroundTunerProps) {\n  const searchParams = useSearchParams();\n  const enabled = searchParams?.get(\"bgtools\") === \"1\";\n  const [activePreset, setActivePreset] = useState<PresetKey>(\"nebula\");\n\n  const activeValues = useMemo<BackgroundDefaults>(() => {\n    if (activePreset === \"nebula\") return NEBULA_PRESET;\n    if (activePreset === \"aurora\") return AURORA_PRESET;\n    if (activePreset === \"obsidian\") return OBSIDIAN_PRESET;\n    if (activePreset === \"ember\") return EMBER_PRESET;\n    if (activePreset === \"sapphire\") return SAPPHIRE_PRESET;\n    if (activePreset === \"rose\") return ROSE_PRESET;\n    return defaults;\n  }, [activePreset, defaults]);\n\n  const cssVars = useMemo(\n    () => ({\n      \"--event-bg-blur\": `${activeValues.blur}px`,\n      \"--event-bg-scale\": `${activeValues.scale}`,\n      \"--event-bg-saturate\": `${activeValues.saturate}`,\n      \"--event-bg-brightness\": `${activeValues.brightness}`,\n      \"--event-bg-mask-stop-1\": `${activeValues.maskStops[0]}%`,\n      \"--event-bg-mask-stop-2\": `${activeValues.maskStops[1]}%`,\n      \"--event-bg-mask-stop-3\": `${activeValues.maskStops[2]}%`,\n      \"--event-bg-mask-stop-4\": `${activeValues.maskStops[3]}%`,\n      \"--event-bg-mask-stop-5\": `${activeValues.maskStops[4]}%`,\n      \"--event-bg-mask-stop-6\": `${activeValues.maskStops[5]}%`,\n      \"--event-bg-mask-alpha-1\": `${activeValues.maskAlphas[0]}`,\n      \"--event-bg-mask-alpha-2\": `${activeValues.maskAlphas[1]}`,\n      \"--event-bg-mask-alpha-3\": `${activeValues.maskAlphas[2]}`,\n      \"--event-bg-mask-alpha-4\": `${activeValues.maskAlphas[3]}`,\n      \"--event-bg-mask-alpha-5\": `${activeValues.maskAlphas[4]}`,\n      \"--event-bg-mask-alpha-6\": `${activeValues.maskAlphas[5]}`,\n      \"--event-bg-overlay-top\": `${activeValues.overlayTop}`,\n      \"--event-bg-overlay-mid\": `${activeValues.overlayMid}`,\n      \"--event-bg-overlay-bottom\": `${activeValues.overlayBottom}`,\n      \"--event-bg-fade-start\": `${activeValues.fadeStart}%`,\n      \"--event-bg-fade-mid\": `${activeValues.fadeMid}%`,\n      \"--event-bg-fade-end\": `${activeValues.fadeEnd}%`,\n      \"--event-bg-fade-dark\": `${activeValues.fadeDark}`,\n    }),\n    [activeValues],\n  );\n\n  useEffect(() => {\n    const target = document.getElementById(targetId);\n    if (!target) return;\n    Object.entries(cssVars).forEach(([key, value]) => {\n      target.style.setProperty(key, value);\n    });\n  }, [targetId, cssVars]);\n\n  if (!enabled) return null;\n\n  return (\n    <div className=\"fixed bottom-4 left-4 z-[60] w-[260px] rounded-2xl border border-white/15 bg-black/70 p-4 text-white shadow-[0_20px_40px_rgba(0,0,0,0.5)] backdrop-blur-xl\">\n      <p className=\"text-[10px] uppercase tracking-[0.2em] text-white/50\">\n        Background presets\n      </p>\n      <p className=\"text-sm font-semibold\">Evento</p>\n      <div className=\"mt-4 grid gap-2\">\n        {PRESET_OPTIONS.map((preset) => (\n          <button\n            key={preset.key}\n            type=\"button\"\n            onClick={() => setActivePreset(preset.key)}\n            className={`rounded-xl border px-3 py-2 text-left text-[12px] font-semibold transition ${\n              activePreset === preset.key\n                ? \"border-white/40 bg-white/15 text-white shadow-[0_0_20px_rgba(255,255,255,0.12)]\"\n                : \"border-white/15 bg-white/5 text-white/70 hover:border-white/30 hover:bg-white/10\"\n            }`}\n          >\n            {preset.label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11060, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/eventos/%5Bslug%5D/InviteGateClient.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport WavesSectionClient, { type WaveTicket } from \"./WavesSectionClient\";\n\nconst EMAIL_REGEX = /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/;\n\ntype InviteGateClientProps = {\n  slug: string;\n  isFree: boolean;\n  isAuthenticated: boolean;\n  hasUsername: boolean;\n  userEmailNormalized: string | null;\n  usernameNormalized: string | null;\n  uiTickets: WaveTicket[];\n  checkoutUiVariant: \"DEFAULT\" | \"PADEL\";\n  padelMeta?: {\n    eventId: number;\n    organizerId: number | null;\n    categoryId?: number | null;\n  };\n};\n\ntype CheckResponse = {\n  ok?: boolean;\n  invited?: boolean;\n  type?: \"email\" | \"username\";\n  normalized?: string;\n  error?: string;\n};\n\nexport default function InviteGateClient({\n  slug,\n  isFree,\n  isAuthenticated,\n  hasUsername,\n  userEmailNormalized,\n  usernameNormalized,\n  uiTickets,\n  checkoutUiVariant,\n  padelMeta,\n}: InviteGateClientProps) {\n  const [identifier, setIdentifier] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [inviteType, setInviteType] = useState<\"email\" | \"username\" | null>(null);\n  const [inviteNormalized, setInviteNormalized] = useState<string | null>(null);\n  const [validated, setValidated] = useState(false);\n\n  const handleCheck = async () => {\n    const trimmed = identifier.trim();\n    if (!trimmed) {\n      setError(\"Indica o email ou @username do convite.\");\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/eventos/${encodeURIComponent(slug)}/invites/check`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ identifier: trimmed, scope: \"PUBLIC\" }),\n      });\n      const json = (await res.json().catch(() => null)) as CheckResponse | null;\n      if (!res.ok || !json?.ok) {\n        throw new Error(json?.error || \"N√£o foi poss√≠vel validar o convite.\");\n      }\n      if (!json.invited) {\n        setValidated(false);\n        setInviteType(null);\n        setInviteNormalized(null);\n        setError(\"Sem convite v√°lido para este evento.\");\n        return;\n      }\n      const type = json.type === \"username\" ? \"username\" : \"email\";\n      setInviteType(type);\n      setValidated(true);\n      setInviteNormalized(json.normalized ?? trimmed);\n    } catch (err) {\n      setValidated(false);\n      setInviteType(null);\n      setInviteNormalized(null);\n      setError(err instanceof Error ? err.message : \"N√£o foi poss√≠vel validar o convite.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const inviteMatchesAccount =\n    validated &&\n    isAuthenticated &&\n    ((inviteType === \"email\" &&\n      inviteNormalized &&\n      userEmailNormalized &&\n      inviteNormalized === userEmailNormalized) ||\n      (inviteType === \"username\" &&\n        inviteNormalized &&\n        usernameNormalized &&\n        inviteNormalized === usernameNormalized));\n\n  const paidInviteMatches = inviteMatchesAccount && !isFree;\n  const freeInviteMatches = inviteMatchesAccount && isFree && hasUsername;\n\n  const gateMessage = (() => {\n    if (!validated) return null;\n    if (!isAuthenticated) {\n      return \"Convite validado. Inicia sess√£o com a conta convidada para continuar.\";\n    }\n    if (inviteType === \"email\") {\n      if (!inviteNormalized || !userEmailNormalized || inviteNormalized !== userEmailNormalized) {\n        return \"Este convite n√£o corresponde ao email desta conta.\";\n      }\n      if (isFree && !hasUsername) {\n        return \"Define um username na tua conta para concluir a inscri√ß√£o gratuita.\";\n      }\n      return isFree\n        ? \"Convite validado. Podes continuar a inscri√ß√£o gratuita.\"\n        : \"Convite validado. Podes continuar o checkout.\";\n    }\n    if (inviteType === \"username\") {\n      if (!hasUsername) {\n        return \"Define um username na tua conta para continuar.\";\n      }\n      if (!inviteNormalized || !usernameNormalized || inviteNormalized !== usernameNormalized) {\n        return \"Este convite n√£o corresponde ao teu username.\";\n      }\n      return isFree\n        ? \"Convite validado. Podes continuar a inscri√ß√£o gratuita.\"\n        : \"Convite validado. Podes continuar o checkout.\";\n    }\n    return null;\n  })();\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"rounded-2xl border border-white/20 bg-[linear-gradient(135deg,rgba(255,255,255,0.08),rgba(6,10,24,0.9))] px-4 py-4 text-sm text-white/85 shadow-[0_18px_45px_rgba(0,0,0,0.55)]\">\n        <div className=\"flex items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-white/60\">\n          <span>Acesso exclusivo</span>\n          <span className=\"h-1 w-1 rounded-full bg-white/30\" />\n          <span>Convites ORYA</span>\n        </div>\n        <p className=\"mt-2 text-base font-semibold text-white\">Este evento √© apenas por convite.</p>\n        <p className=\"text-[12px] text-white/65\">\n          S√≥ convidados podem ver o checkout. Valida o teu convite para desbloquear o acesso.\n        </p>\n      </div>\n\n      <div className=\"rounded-2xl border border-white/12 bg-black/50 px-4 py-4 text-sm text-white/80\">\n        <label className=\"text-[11px] uppercase tracking-[0.18em] text-white/60\">\n          Tenho convite\n        </label>\n        <div className=\"mt-2 flex flex-col gap-2 sm:flex-row\">\n          <input\n            value={identifier}\n            onChange={(e) => setIdentifier(e.target.value)}\n            placeholder=\"Email do convite ou @username\"\n            className=\"w-full rounded-md border border-white/15 bg-black/40 px-3 py-2 text-sm outline-none focus:border-white/60\"\n          />\n          <button\n            type=\"button\"\n            onClick={handleCheck}\n            disabled={loading}\n            className=\"rounded-full border border-white/20 px-4 py-2 text-[12px] font-semibold text-white hover:bg-white/10 disabled:opacity-60\"\n          >\n            {loading ? \"A validar‚Ä¶\" : \"Validar\"}\n          </button>\n        </div>\n        {error && <p className=\"mt-2 text-[12px] font-semibold text-amber-100\">{error}</p>}\n\n        {gateMessage && <p className=\"mt-2 text-[12px] text-amber-100\">{gateMessage}</p>}\n        {!validated && !error && (\n          <p className=\"mt-2 text-[12px] text-white/60\">\n            {isAuthenticated\n              ? \"Se n√£o tiveres convite, n√£o consegues continuar.\"\n              : \"Sem convite v√°lido n√£o consegues aceder ao evento.\"}\n          </p>\n        )}\n      </div>\n\n      {paidInviteMatches && (\n        <WavesSectionClient\n          slug={slug}\n          tickets={uiTickets}\n          checkoutUiVariant={checkoutUiVariant}\n          padelMeta={padelMeta}\n          inviteEmail={inviteType === \"email\" ? inviteNormalized ?? undefined : undefined}\n        />\n      )}\n\n      {freeInviteMatches && (\n        <WavesSectionClient\n          slug={slug}\n          tickets={uiTickets}\n          isFreeEvent\n          checkoutUiVariant={checkoutUiVariant}\n          padelMeta={padelMeta}\n        />\n      )}\n\n      {!validated && identifier.trim() && EMAIL_REGEX.test(identifier.trim()) && !isFree && (\n        <div className=\"rounded-xl border border-white/12 bg-black/50 px-3.5 py-2.5 text-[11px] text-white/65\">\n          Usa o mesmo email na tua conta para desbloquear o convite.\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKA,MAAM,cAAc;AA0BL,SAAS,iBAAiB,EACvC,IAAI,EACJ,MAAM,EACN,eAAe,EACf,WAAW,EACX,mBAAmB,EACnB,kBAAkB,EAClB,SAAS,EACT,iBAAiB,EACjB,SAAS,EACa;IACtB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAA8B;IAC1E,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAgB;IACxE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,MAAM,cAAc;QAClB,MAAM,UAAU,WAAW,IAAI;QAC/B,IAAI,CAAC,SAAS;YACZ,SAAS;YACT;QACF;QACA,WAAW;QACX,SAAS;QACT,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,aAAa,EAAE,mBAAmB,MAAM,cAAc,CAAC,EAAE;gBAChF,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,YAAY;oBAAS,OAAO;gBAAS;YAC9D;YACA,MAAM,OAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;YAC3C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,IAAI;gBACxB,MAAM,IAAI,MAAM,MAAM,SAAS;YACjC;YACA,IAAI,CAAC,KAAK,OAAO,EAAE;gBACjB,aAAa;gBACb,cAAc;gBACd,oBAAoB;gBACpB,SAAS;gBACT;YACF;YACA,MAAM,OAAO,KAAK,IAAI,KAAK,aAAa,aAAa;YACrD,cAAc;YACd,aAAa;YACb,oBAAoB,KAAK,UAAU,IAAI;QACzC,EAAE,OAAO,KAAK;YACZ,aAAa;YACb,cAAc;YACd,oBAAoB;YACpB,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;QAChD,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,uBACJ,aACA,mBACA,CAAC,AAAC,eAAe,WACf,oBACA,uBACA,qBAAqB,uBACpB,eAAe,cACd,oBACA,sBACA,qBAAqB,kBAAmB;IAE9C,MAAM,oBAAoB,wBAAwB,CAAC;IACnD,MAAM,oBAAoB,wBAAwB,UAAU;IAE5D,MAAM,cAAc,CAAC;QACnB,IAAI,CAAC,WAAW,OAAO;QACvB,IAAI,CAAC,iBAAiB;YACpB,OAAO;QACT;QACA,IAAI,eAAe,SAAS;YAC1B,IAAI,CAAC,oBAAoB,CAAC,uBAAuB,qBAAqB,qBAAqB;gBACzF,OAAO;YACT;YACA,IAAI,UAAU,CAAC,aAAa;gBAC1B,OAAO;YACT;YACA,OAAO,SACH,4DACA;QACN;QACA,IAAI,eAAe,YAAY;YAC7B,IAAI,CAAC,aAAa;gBAChB,OAAO;YACT;YACA,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,qBAAqB,oBAAoB;gBACvF,OAAO;YACT;YACA,OAAO,SACH,4DACA;QACN;QACA,OAAO;IACT,CAAC;IAED,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;0CAAK;;;;;;0CACN,8OAAC;gCAAK,WAAU;;;;;;0CAChB,8OAAC;0CAAK;;;;;;;;;;;;kCAER,8OAAC;wBAAE,WAAU;kCAA0C;;;;;;kCACvD,8OAAC;wBAAE,WAAU;kCAA4B;;;;;;;;;;;;0BAK3C,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAM,WAAU;kCAAwD;;;;;;kCAGzE,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,OAAO;gCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;gCAC7C,aAAY;gCACZ,WAAU;;;;;;0CAEZ,8OAAC;gCACC,MAAK;gCACL,SAAS;gCACT,UAAU;gCACV,WAAU;0CAET,UAAU,eAAe;;;;;;;;;;;;oBAG7B,uBAAS,8OAAC;wBAAE,WAAU;kCAAiD;;;;;;oBAEvE,6BAAe,8OAAC;wBAAE,WAAU;kCAAmC;;;;;;oBAC/D,CAAC,aAAa,CAAC,uBACd,8OAAC;wBAAE,WAAU;kCACV,kBACG,qDACA;;;;;;;;;;;;YAKT,mCACC,8OAAC,4JAAkB;gBACjB,MAAM;gBACN,SAAS;gBACT,mBAAmB;gBACnB,WAAW;gBACX,aAAa,eAAe,UAAU,oBAAoB,YAAY;;;;;;YAIzE,mCACC,8OAAC,4JAAkB;gBACjB,MAAM;gBACN,SAAS;gBACT,WAAW;gBACX,mBAAmB;gBACnB,WAAW;;;;;;YAId,CAAC,aAAa,WAAW,IAAI,MAAM,YAAY,IAAI,CAAC,WAAW,IAAI,OAAO,CAAC,wBAC1E,8OAAC;gBAAI,WAAU;0BAAwF;;;;;;;;;;;;AAM/G"}}]
}