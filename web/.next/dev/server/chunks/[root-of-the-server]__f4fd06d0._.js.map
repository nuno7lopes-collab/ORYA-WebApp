{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/env.ts"],"sourcesContent":["// Central helper for server-side environment variables (server-only).\n// ⚠️ Não importar este módulo em componentes com \"use client\".\nconst required = [\n  \"SUPABASE_URL\",\n  \"SUPABASE_ANON_KEY\",\n  \"SUPABASE_SERVICE_ROLE\",\n  \"DATABASE_URL\",\n  \"STRIPE_SECRET_KEY\",\n  \"STRIPE_WEBHOOK_SECRET\",\n  \"QR_SECRET_KEY\",\n  \"RESEND_API_KEY\",\n] as const;\n\ntype EnvKey = (typeof required)[number];\n\nfunction getEnv(key: EnvKey): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing env var: ${key}`);\n  }\n  return value;\n}\n\nfunction getOptionalUrlEnv(...keys: string[]) {\n  for (const key of keys) {\n    const value = process.env[key];\n    if (typeof value === \"string\" && value.trim().length > 0) {\n      return value.trim().replace(/\\/+$/, \"\"); // remove trailing slash para URLs previsíveis\n    }\n  }\n  return \"\";\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseList(raw: unknown) {\n  if (typeof raw !== \"string\") return [];\n  return raw\n    .split(/[,\\s]+/g)\n    .map((item) => item.trim())\n    .filter(Boolean);\n}\n\nexport const env = {\n  supabaseUrl: getEnv(\"SUPABASE_URL\"),\n  supabaseAnonKey: getEnv(\"SUPABASE_ANON_KEY\"),\n  serviceRoleKey: getEnv(\"SUPABASE_SERVICE_ROLE\"),\n  dbUrl: getEnv(\"DATABASE_URL\"),\n  stripeSecretKey: getEnv(\"STRIPE_SECRET_KEY\"),\n  stripeWebhookSecret: getEnv(\"STRIPE_WEBHOOK_SECRET\"),\n  qrSecretKey: getEnv(\"QR_SECRET_KEY\"),\n  resendApiKey: getEnv(\"RESEND_API_KEY\"),\n  resendFrom:\n    process.env.RESEND_FROM ??\n    process.env.RESEND_FROM_EMAIL ??\n    \"no-reply@orya.pt\",\n  appBaseUrl: getOptionalUrlEnv(\"APP_BASE_URL\", \"NEXT_PUBLIC_BASE_URL\", \"NEXT_PUBLIC_SITE_URL\", \"VERCEL_URL\"),\n  uploadsBucket:\n    process.env.SUPABASE_STORAGE_BUCKET_UPLOADS ??\n    process.env.SUPABASE_STORAGE_BUCKET ??\n    \"uploads\",\n  avatarsBucket: process.env.SUPABASE_STORAGE_BUCKET_AVATARS ?? \"\",\n  eventCoversBucket: process.env.SUPABASE_STORAGE_BUCKET_EVENT_COVERS ?? \"\",\n  storageSignedUrls: parseBoolean(process.env.SUPABASE_STORAGE_SIGNED_URLS, false),\n  storageSignedTtlSeconds: parseNumber(process.env.SUPABASE_STORAGE_SIGNED_TTL_SECONDS, 60 * 60 * 24 * 30), // 30 dias\n  stripePremiumPriceIds: parseList(process.env.STRIPE_PREMIUM_PRICE_IDS),\n  stripePremiumProductIds: parseList(process.env.STRIPE_PREMIUM_PRODUCT_IDS),\n};\n"],"names":[],"mappings":"AAAA,sEAAsE;AACtE,+DAA+D;;;;;AAC/D,MAAM,WAAW;IACf;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAID,SAAS,OAAO,GAAW;IACzB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,KAAK;IAC3C;IACA,OAAO;AACT;AAEA,SAAS,kBAAkB,GAAG,IAAc;IAC1C,KAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;QAC9B,IAAI,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;YACxD,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,KAAK,8CAA8C;QACzF;IACF;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAY,EAAE,QAAiB;IACnD,IAAI,OAAO,QAAQ,WAAW,OAAO;IACrC,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,aAAa,IAAI,IAAI,GAAG,WAAW;QACzC,IAAI;YAAC;YAAK;YAAQ;YAAO;SAAK,CAAC,QAAQ,CAAC,aAAa,OAAO;QAC5D,IAAI;YAAC;YAAK;YAAS;YAAM;SAAM,CAAC,QAAQ,CAAC,aAAa,OAAO;IAC/D;IACA,OAAO;AACT;AAEA,SAAS,YAAY,GAAY,EAAE,QAAgB;IACjD,MAAM,IAAI,OAAO;IACjB,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI;AAClC;AAEA,SAAS,UAAU,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO,EAAE;IACtC,OAAO,IACJ,KAAK,CAAC,WACN,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,IACvB,MAAM,CAAC;AACZ;AAEO,MAAM,MAAM;IACjB,aAAa,OAAO;IACpB,iBAAiB,OAAO;IACxB,gBAAgB,OAAO;IACvB,OAAO,OAAO;IACd,iBAAiB,OAAO;IACxB,qBAAqB,OAAO;IAC5B,aAAa,OAAO;IACpB,cAAc,OAAO;IACrB,YACE,QAAQ,GAAG,CAAC,WAAW,IACvB,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IACF,YAAY,kBAAkB,gBAAgB,wBAAwB,wBAAwB;IAC9F,eACE,QAAQ,GAAG,CAAC,+BAA+B,IAC3C,QAAQ,GAAG,CAAC,uBAAuB,IACnC;IACF,eAAe,QAAQ,GAAG,CAAC,+BAA+B,IAAI;IAC9D,mBAAmB,QAAQ,GAAG,CAAC,oCAAoC,IAAI;IACvE,mBAAmB,aAAa,QAAQ,GAAG,CAAC,4BAA4B,EAAE;IAC1E,yBAAyB,YAAY,QAAQ,GAAG,CAAC,mCAAmC,EAAE,KAAK,KAAK,KAAK;IACrG,uBAAuB,UAAU,QAAQ,GAAG,CAAC,wBAAwB;IACrE,yBAAyB,UAAU,QAAQ,GAAG,CAAC,0BAA0B;AAC3E"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { Prisma, PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport { env } from \"@/lib/env\";\n\n// Toggle de logs verbose (queries) via env: PRISMA_LOG_QUERIES=true\nconst enableQueryLog = process.env.PRISMA_LOG_QUERIES === \"true\";\nconst logLevels: (Prisma.LogLevel | Prisma.LogDefinition)[] =\n  process.env.NODE_ENV === \"development\"\n    ? enableQueryLog\n      ? [\"query\", \"error\", \"warn\"]\n      : [\"error\", \"warn\"]\n    : [\"error\"];\n\n// Evitar múltiplas instâncias em dev (hot reload)\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n};\n\n// Pool e adapter para usar o client engine (\"library\") com Postgres\nconst pool = new Pool({\n  connectionString: env.dbUrl,\n  ssl:\n    process.env.NODE_ENV === \"production\"\n      ? undefined\n      : { rejectUnauthorized: false },\n});\n\nconst adapter = new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: logLevels,\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;AAChB;AACA;AACA;AACA;;;;;;;;;;AAEA,oEAAoE;AACpE,MAAM,iBAAiB,QAAQ,GAAG,CAAC,kBAAkB,KAAK;AAC1D,MAAM,YACJ,uCACI,iBACE;IAAC;IAAS;IAAS;CAAO,GAC1B;IAAC;IAAS;CAAO,GACnB;AAEN,kDAAkD;AAClD,MAAM,kBAAkB;AAIxB,oEAAoE;AACpE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,mHAAG,CAAC,KAAK;IAC3B,KACE,sCACI,0BACA;QAAE,oBAAoB;IAAM;AACpC;AAEA,MAAM,UAAU,IAAI,8JAAQ,CAAC;AAEtB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK;AACP;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/supabaseServer.ts"],"sourcesContent":["import \"server-only\";\nimport { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { env } from \"@/lib/env\";\n\nfunction decodeBase64Cookie(raw: string) {\n  const BASE64_PREFIX = \"base64-\";\n  if (!raw.startsWith(BASE64_PREFIX)) return raw;\n\n  const base = raw.slice(BASE64_PREFIX.length);\n  const encodings: BufferEncoding[] = [\"base64url\", \"base64\"];\n\n  for (const enc of encodings) {\n    try {\n      return Buffer.from(base, enc).toString(\"utf-8\");\n    } catch {\n      /* try next */\n    }\n  }\n\n  // Se não conseguirmos decodificar, tratamos como cookie ausente para evitar JSON.parse de strings inválidas\n  return undefined;\n}\n\n/**\n * Server-side Supabase client (SSR + Route Handlers)\n * - Safe cookie reading\n * - Safe cookie writing\n * - Prevents JSON parse errors\n * - No profile fetching here\n */\nexport async function createSupabaseServer() {\n  const cookieStore = (await cookies());\n\n  const supabase = createServerClient(\n    env.supabaseUrl,\n    env.supabaseAnonKey,\n    {\n      cookies: {\n        get(name: string) {\n          try {\n            // Só devolvemos cookies do Supabase (sb-*) e ignoramos o resto\n            if (!name.startsWith(\"sb-\")) return undefined;\n            const raw = cookieStore.get(name)?.value;\n            if (!raw) return undefined;\n\n            // Se for um chunk (sb-*.0, sb-*.1, ...), deixamos intacto para o combinador do Supabase tratar\n            const isChunk = /\\.\\d+$/.test(name);\n            return isChunk ? raw : decodeBase64Cookie(raw);\n          } catch {\n            return undefined;\n          }\n        },\n        set(name: string, value: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value, ...options });\n          } catch {\n            /* ignore errors for RSC */\n          }\n        },\n        remove(name: string, options: Record<string, unknown>) {\n          try {\n            cookieStore.set({ name, value: \"\", ...options, maxAge: 0 });\n          } catch {\n            /* ignore */\n          }\n        },\n      },\n    }\n  );\n\n  return supabase;\n}\n\n\nexport async function getCurrentUser() {\n  const supabase = await createSupabaseServer();\n\n  try {\n    const { data, error } = await supabase.auth.getUser();\n\n    if (error || !data?.user) {\n      return { user: null, error };\n    }\n\n    return { user: data.user, error: null };\n  } catch (err) {\n    return { user: null, error: err };\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,SAAS,mBAAmB,GAAW;IACrC,MAAM,gBAAgB;IACtB,IAAI,CAAC,IAAI,UAAU,CAAC,gBAAgB,OAAO;IAE3C,MAAM,OAAO,IAAI,KAAK,CAAC,cAAc,MAAM;IAC3C,MAAM,YAA8B;QAAC;QAAa;KAAS;IAE3D,KAAK,MAAM,OAAO,UAAW;QAC3B,IAAI;YACF,OAAO,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;QACzC,EAAE,OAAM;QACN,YAAY,GACd;IACF;IAEA,4GAA4G;IAC5G,OAAO;AACT;AASO,eAAe;IACpB,MAAM,cAAe,MAAM,IAAA,4IAAO;IAElC,MAAM,WAAW,IAAA,iMAAkB,EACjC,mHAAG,CAAC,WAAW,EACf,mHAAG,CAAC,eAAe,EACnB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,IAAI;oBACF,+DAA+D;oBAC/D,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,OAAO;oBACpC,MAAM,MAAM,YAAY,GAAG,CAAC,OAAO;oBACnC,IAAI,CAAC,KAAK,OAAO;oBAEjB,+FAA+F;oBAC/F,MAAM,UAAU,SAAS,IAAI,CAAC;oBAC9B,OAAO,UAAU,MAAM,mBAAmB;gBAC5C,EAAE,OAAM;oBACN,OAAO;gBACT;YACF;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAgC;gBAC/D,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAM;gBACN,yBAAyB,GAC3B;YACF;YACA,QAAO,IAAY,EAAE,OAAgC;gBACnD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ;oBAAE;gBAC3D,EAAE,OAAM;gBACN,UAAU,GACZ;YACF;QACF;IACF;IAGF,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAEnD,IAAI,SAAS,CAAC,MAAM,MAAM;YACxB,OAAO;gBAAE,MAAM;gBAAM;YAAM;QAC7B;QAEA,OAAO;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO;QAAK;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,MAAM;YAAM,OAAO;QAAI;IAClC;AACF"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/platformSettings.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\nexport type PlatformFeeConfig = {\n  feeBps: number;\n  feeFixedCents: number;\n};\n\ntype FeeKeys =\n  | \"platform_fee_bps\"\n  | \"platform_fee_fixed_cents\"\n  | \"stripe_fee_bps_eu\"\n  | \"stripe_fee_fixed_cents_eu\";\n\ntype PlatformSettingKey = FeeKeys | \"org_transfer_enabled\";\n\nconst envPlatformFeeBps = process.env.PLATFORM_FEE_BPS ?? process.env.NEXT_PUBLIC_PLATFORM_FEE_BPS;\nconst envPlatformFeePercent = process.env.PLATFORM_FEE_PERCENT ?? process.env.NEXT_PUBLIC_PLATFORM_FEE_PERCENT;\nconst envPlatformFeeFixedCents =\n  process.env.PLATFORM_FEE_FIXED_CENTS ?? process.env.NEXT_PUBLIC_PLATFORM_FEE_FIXED_CENTS;\nconst envPlatformFeeFixedEur =\n  process.env.PLATFORM_FEE_FIXED_EUR ?? process.env.NEXT_PUBLIC_PLATFORM_FEE_FIXED_EUR;\n\nconst DEFAULT_PLATFORM_FEE_BPS = Number.isFinite(Number(envPlatformFeeBps))\n  ? Number(envPlatformFeeBps)\n  : Math.round(Number(envPlatformFeePercent ?? 0.08) * 10_000) || 800; // 8%\nconst DEFAULT_PLATFORM_FEE_FIXED_CENTS = Number.isFinite(Number(envPlatformFeeFixedCents))\n  ? Number(envPlatformFeeFixedCents)\n  : Math.round(Number(envPlatformFeeFixedEur ?? 0.3) * 100) || 30; // €0.30\n\nconst DEFAULT_STRIPE_FEE_BPS_EU = Number.isFinite(Number(process.env.STRIPE_FEE_BPS_EU))\n  ? Number(process.env.STRIPE_FEE_BPS_EU)\n  : Math.round(Number(process.env.STRIPE_FEE_PERCENT_EU ?? 0.014) * 10_000) || 140; // 1.4%\nconst DEFAULT_STRIPE_FEE_FIXED_CENTS_EU = Number.isFinite(Number(process.env.STRIPE_FEE_FIXED_CENTS_EU))\n  ? Number(process.env.STRIPE_FEE_FIXED_CENTS_EU)\n  : Math.round(Number(process.env.STRIPE_FEE_FIXED_EUR_EU ?? 0.25) * 100) || 25; // €0.25\n\nfunction parseNumber(raw: unknown, fallback: number) {\n  const n = Number(raw);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction parseBoolean(raw: unknown, fallback: boolean) {\n  if (typeof raw === \"boolean\") return raw;\n  if (typeof raw === \"string\") {\n    const normalized = raw.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"on\"].includes(normalized)) return true;\n    if ([\"0\", \"false\", \"no\", \"off\"].includes(normalized)) return false;\n  }\n  return fallback;\n}\n\nasync function getSettingsMap(keys: PlatformSettingKey[]): Promise<Record<string, string>> {\n  const rows = await prisma.platformSetting.findMany({\n    where: {\n      key: {\n        in: keys,\n      },\n    },\n  });\n\n  return rows.reduce<Record<string, string>>((acc, row) => {\n    acc[row.key] = row.value;\n    return acc;\n  }, {});\n}\n\nasync function upsertSettings(values: { key: PlatformSettingKey; value: string }[]) {\n  const tasks = values.map(({ key, value }) =>\n    prisma.platformSetting.upsert({\n      where: { key },\n      create: { key, value },\n      update: { value },\n    }),\n  );\n  await Promise.all(tasks);\n}\n\n/**\n * Lê platform_settings (DB). Se não houver valores guardados, aplica defaults/env.\n */\nexport async function getPlatformFees(): Promise<PlatformFeeConfig> {\n  const map = await getSettingsMap([\"platform_fee_bps\", \"platform_fee_fixed_cents\"]);\n\n  return {\n    feeBps: parseNumber(map[\"platform_fee_bps\"], DEFAULT_PLATFORM_FEE_BPS),\n    feeFixedCents: parseNumber(map[\"platform_fee_fixed_cents\"], DEFAULT_PLATFORM_FEE_FIXED_CENTS),\n  };\n}\n\nexport async function setPlatformFees(config: Partial<PlatformFeeConfig>) {\n  const updates: { key: FeeKeys; value: string }[] = [];\n\n  if (config.feeBps !== undefined) {\n    updates.push({ key: \"platform_fee_bps\", value: String(Math.max(0, Math.round(config.feeBps))) });\n  }\n  if (config.feeFixedCents !== undefined) {\n    updates.push({\n      key: \"platform_fee_fixed_cents\",\n      value: String(Math.max(0, Math.round(config.feeFixedCents))),\n    });\n  }\n\n  if (updates.length > 0) {\n    await upsertSettings(updates);\n  }\n\n  return getPlatformFees();\n}\n\nexport async function getStripeBaseFees() {\n  const map = await getSettingsMap([\"stripe_fee_bps_eu\", \"stripe_fee_fixed_cents_eu\"]);\n\n  return {\n    feeBps: parseNumber(map[\"stripe_fee_bps_eu\"], DEFAULT_STRIPE_FEE_BPS_EU),\n    feeFixedCents: parseNumber(map[\"stripe_fee_fixed_cents_eu\"], DEFAULT_STRIPE_FEE_FIXED_CENTS_EU),\n    region: \"UE\",\n  };\n}\n\nexport async function setStripeBaseFees(config: Partial<PlatformFeeConfig>) {\n  const updates: { key: FeeKeys; value: string }[] = [];\n\n  if (config.feeBps !== undefined) {\n    updates.push({ key: \"stripe_fee_bps_eu\", value: String(Math.max(0, Math.round(config.feeBps))) });\n  }\n  if (config.feeFixedCents !== undefined) {\n    updates.push({\n      key: \"stripe_fee_fixed_cents_eu\",\n      value: String(Math.max(0, Math.round(config.feeFixedCents))),\n    });\n  }\n\n  if (updates.length > 0) {\n    await upsertSettings(updates);\n  }\n\n  return getStripeBaseFees();\n}\n\nexport async function getPlatformAndStripeFees() {\n  const [orya, stripe] = await Promise.all([getPlatformFees(), getStripeBaseFees()]);\n  return { orya, stripe };\n}\n\nexport async function getOrgTransferEnabled(): Promise<boolean> {\n  const map = await getSettingsMap([\"org_transfer_enabled\"]);\n  return parseBoolean(map[\"org_transfer_enabled\"], false);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 466, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/phone.ts"],"sourcesContent":["// Utils partilhados para normalizar/validar telefones de forma consistente\n\n// Remove caracteres inválidos, permitindo apenas dígitos e um único \"+\" no início\nexport function sanitizePhone(input: string): string {\n  let cleaned = input.replace(/[^\\d+]/g, \"\");\n  if (cleaned.includes(\"+\")) {\n    const firstPlus = cleaned.indexOf(\"+\");\n    cleaned = \"+\" + cleaned.slice(firstPlus + 1).replace(/\\+/g, \"\");\n  }\n  return cleaned;\n}\n\n// Validação: dígitos com opcional \"+\" no início, 6 a 15 dígitos totais\nexport function isValidPhone(input: string): boolean {\n  const value = sanitizePhone(input);\n  if (!value) return false;\n  return /^\\+?\\d{6,15}$/.test(value);\n}\n\n// Normalização simples: devolve o valor sanitizado (já usado para guardar)\nexport function normalizePhone(input: string): string {\n  return sanitizePhone(input);\n}\n"],"names":[],"mappings":"AAAA,2EAA2E;AAE3E,kFAAkF;;;;;;;;;AAC3E,SAAS,cAAc,KAAa;IACzC,IAAI,UAAU,MAAM,OAAO,CAAC,WAAW;IACvC,IAAI,QAAQ,QAAQ,CAAC,MAAM;QACzB,MAAM,YAAY,QAAQ,OAAO,CAAC;QAClC,UAAU,MAAM,QAAQ,KAAK,CAAC,YAAY,GAAG,OAAO,CAAC,OAAO;IAC9D;IACA,OAAO;AACT;AAGO,SAAS,aAAa,KAAa;IACxC,MAAM,QAAQ,cAAc;IAC5B,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAGO,SAAS,eAAe,KAAa;IAC1C,OAAO,cAAc;AACvB"}},
    {"offset": {"line": 498, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerRoles.ts"],"sourcesContent":["import { OrganizerMemberRole, Prisma, PrismaClient } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\n\ntype TxLike = Prisma.TransactionClient | PrismaClient;\n\n/**\n * Garante unicidade de OWNER numa organização:\n * - promove/cria o utilizador como OWNER\n * - despromove todos os outros OWNER para CO_OWNER\n */\nexport async function setSoleOwner(\n  client: TxLike,\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  await client.organizerMember.upsert({\n    where: { organizerId_userId: { organizerId, userId } },\n    update: { role: OrganizerMemberRole.OWNER },\n    create: {\n      organizerId,\n      userId,\n      role: OrganizerMemberRole.OWNER,\n      invitedByUserId: invitedByUserId ?? undefined,\n    },\n  });\n\n  await client.organizerMember.updateMany({\n    where: { organizerId, role: OrganizerMemberRole.OWNER, userId: { not: userId } },\n    data: { role: OrganizerMemberRole.CO_OWNER },\n  });\n}\n\n/**\n * Marca o perfil como \"organizer\" no array de roles (idempotente).\n */\nexport async function ensureUserIsOrganizer(client: TxLike, userId: string) {\n  const targetProfile = await client.profile.findUnique({\n    where: { id: userId },\n    select: { roles: true },\n  });\n  if (!targetProfile) return;\n\n  const roles = Array.isArray(targetProfile.roles) ? targetProfile.roles : [];\n  if (!roles.includes(\"organizer\")) {\n    await client.profile.update({\n      where: { id: userId },\n      data: { roles: [...roles, \"organizer\"] },\n    });\n  }\n}\n\n/**\n * Wrapper que permite usar helper fora de transação quando necessário.\n */\nexport async function setSoleOwnerSafe(\n  organizerId: number,\n  userId: string,\n  invitedByUserId?: string | null,\n) {\n  return setSoleOwner(prisma, organizerId, userId, invitedByUserId);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AASO,eAAe,aACpB,MAAc,EACd,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,MAAM,OAAO,eAAe,CAAC,MAAM,CAAC;QAClC,OAAO;YAAE,oBAAoB;gBAAE;gBAAa;YAAO;QAAE;QACrD,QAAQ;YAAE,MAAM,oJAAmB,CAAC,KAAK;QAAC;QAC1C,QAAQ;YACN;YACA;YACA,MAAM,oJAAmB,CAAC,KAAK;YAC/B,iBAAiB,mBAAmB;QACtC;IACF;IAEA,MAAM,OAAO,eAAe,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE;YAAa,MAAM,oJAAmB,CAAC,KAAK;YAAE,QAAQ;gBAAE,KAAK;YAAO;QAAE;QAC/E,MAAM;YAAE,MAAM,oJAAmB,CAAC,QAAQ;QAAC;IAC7C;AACF;AAKO,eAAe,sBAAsB,MAAc,EAAE,MAAc;IACxE,MAAM,gBAAgB,MAAM,OAAO,OAAO,CAAC,UAAU,CAAC;QACpD,OAAO;YAAE,IAAI;QAAO;QACpB,QAAQ;YAAE,OAAO;QAAK;IACxB;IACA,IAAI,CAAC,eAAe;IAEpB,MAAM,QAAQ,MAAM,OAAO,CAAC,cAAc,KAAK,IAAI,cAAc,KAAK,GAAG,EAAE;IAC3E,IAAI,CAAC,MAAM,QAAQ,CAAC,cAAc;QAChC,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC;YAC1B,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,OAAO;uBAAI;oBAAO;iBAAY;YAAC;QACzC;IACF;AACF;AAKO,eAAe,iBACpB,WAAmB,EACnB,MAAc,EACd,eAA+B;IAE/B,OAAO,aAAa,yHAAM,EAAE,aAAa,QAAQ;AACnD"}},
    {"offset": {"line": 578, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerId.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport type { NextRequest } from \"next/server\";\n\nexport const ORGANIZER_COOKIE_NAME = \"orya_org\";\n\nexport function parseOrganizerId(value: unknown): number | null {\n  if (typeof value === \"number\") {\n    return Number.isFinite(value) && value > 0 ? value : null;\n  }\n  if (typeof value !== \"string\") return null;\n  const trimmed = value.trim();\n  if (!trimmed) return null;\n  const parsed = Number(trimmed);\n  return Number.isFinite(parsed) && parsed > 0 ? parsed : null;\n}\n\nexport async function resolveOrganizerIdFromCookies(): Promise<number | null> {\n  try {\n    const cookieStore = await cookies();\n    return parseOrganizerId(cookieStore.get(ORGANIZER_COOKIE_NAME)?.value);\n  } catch {\n    return null;\n  }\n}\n\nexport function resolveOrganizerIdFromRequest(req: NextRequest): number | null {\n  const params = req.nextUrl.searchParams;\n  const paramValue = params.get(\"organizerId\") ?? params.get(\"org\");\n  return parseOrganizerId(paramValue) ?? parseOrganizerId(req.cookies.get(ORGANIZER_COOKIE_NAME)?.value);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,wBAAwB;AAE9B,SAAS,iBAAiB,KAAc;IAC7C,IAAI,OAAO,UAAU,UAAU;QAC7B,OAAO,OAAO,QAAQ,CAAC,UAAU,QAAQ,IAAI,QAAQ;IACvD;IACA,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,UAAU,MAAM,IAAI;IAC1B,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,SAAS,OAAO;IACtB,OAAO,OAAO,QAAQ,CAAC,WAAW,SAAS,IAAI,SAAS;AAC1D;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,OAAO,iBAAiB,YAAY,GAAG,CAAC,wBAAwB;IAClE,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,8BAA8B,GAAgB;IAC5D,MAAM,SAAS,IAAI,OAAO,CAAC,YAAY;IACvC,MAAM,aAAa,OAAO,GAAG,CAAC,kBAAkB,OAAO,GAAG,CAAC;IAC3D,OAAO,iBAAiB,eAAe,iBAAiB,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB;AAClG"}},
    {"offset": {"line": 620, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizerContext.ts"],"sourcesContent":["import { OrganizerMemberRole } from \"@prisma/client\";\nimport { prisma } from \"@/lib/prisma\";\nimport { ensureUserIsOrganizer } from \"@/lib/organizerRoles\";\nimport { resolveOrganizerIdFromCookies } from \"@/lib/organizerId\";\n\ntype Options = {\n  organizerId?: number | null;\n  roles?: OrganizerMemberRole[];\n  // Se quisermos forçar leitura de cookie, basta passar organizerId externamente\n};\n\nexport async function ensureLegacyOrganizerMemberships(userId: string, organizerId?: number | null) {\n  if (!userId) return 0;\n\n  const legacyOrganizers = await prisma.organizer.findMany({\n    where: {\n      userId,\n      ...(Number.isFinite(organizerId) ? { id: organizerId! } : {}),\n    },\n    select: { id: true },\n  });\n\n  if (legacyOrganizers.length === 0) return 0;\n\n  try {\n    await prisma.$transaction(async (tx) => {\n      for (const organizer of legacyOrganizers) {\n        await tx.organizerMember.upsert({\n          where: {\n            organizerId_userId: {\n              organizerId: organizer.id,\n              userId,\n            },\n          },\n          update: { role: OrganizerMemberRole.OWNER },\n          create: {\n            organizerId: organizer.id,\n            userId,\n            role: OrganizerMemberRole.OWNER,\n          },\n        });\n      }\n\n      await ensureUserIsOrganizer(tx, userId);\n    });\n  } catch (err: unknown) {\n    const msg =\n      typeof err === \"object\" && err && \"message\" in err ? String((err as { message?: unknown }).message) : \"\";\n    if (msg.includes(\"does not exist\") || msg.includes(\"organizer_members\")) {\n      return 0;\n    }\n    throw err;\n  }\n\n  return legacyOrganizers.length;\n}\n\nexport async function getActiveOrganizerForUser(userId: string, opts: Options = {}) {\n  const { roles } = opts;\n  const directOrganizerId =\n    typeof opts.organizerId === \"number\" && Number.isFinite(opts.organizerId)\n      ? opts.organizerId\n      : null;\n  const cookieOrganizerId = directOrganizerId ? null : await resolveOrganizerIdFromCookies();\n  const organizerId = directOrganizerId ?? cookieOrganizerId;\n\n  // 1) Se organizerId foi especificado, tenta buscar diretamente essa membership primeiro\n  if (organizerId) {\n    const direct = await prisma.organizerMember.findFirst({\n      where: {\n        userId,\n        organizerId,\n        ...(roles ? { role: { in: roles } } : {}),\n        organizer: { status: \"ACTIVE\" },\n      },\n      include: { organizer: true },\n    });\n    if (direct?.organizer) {\n      return { organizer: direct.organizer, membership: direct };\n    }\n\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId, organizerId);\n    if (legacyFixed > 0) {\n      const retry = await prisma.organizerMember.findFirst({\n        where: {\n          userId,\n          organizerId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n      });\n      if (retry?.organizer) {\n        return { organizer: retry.organizer, membership: retry };\n      }\n    }\n    // Se o organizerId foi pedido explicitamente e não existe membership, não faz fallback.\n    return { organizer: null, membership: null };\n  }\n\n  let memberships = await prisma.organizerMember.findMany({\n    where: {\n      userId,\n      ...(roles ? { role: { in: roles } } : {}),\n      organizer: { status: \"ACTIVE\" },\n    },\n    include: { organizer: true },\n    orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n  });\n\n  if (memberships.length === 0) {\n    const legacyFixed = await ensureLegacyOrganizerMemberships(userId);\n    if (legacyFixed > 0) {\n      memberships = await prisma.organizerMember.findMany({\n        where: {\n          userId,\n          ...(roles ? { role: { in: roles } } : {}),\n          organizer: { status: \"ACTIVE\" },\n        },\n        include: { organizer: true },\n        orderBy: [{ lastUsedAt: \"desc\" }, { createdAt: \"asc\" }],\n      });\n    }\n  }\n\n  if (memberships && memberships.length > 0) {\n    if (memberships.length > 1) {\n      return { organizer: null, membership: null };\n    }\n    const selected = memberships[0];\n    if (selected?.organizer) {\n      return { organizer: selected.organizer, membership: selected };\n    }\n  }\n\n  return { organizer: null, membership: null };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 824, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/organizationCategories.ts"],"sourcesContent":["export const ORGANIZATION_CATEGORIES = [\"EVENTOS\", \"PADEL\", \"VOLUNTARIADO\"] as const;\nexport type OrganizationCategory = (typeof ORGANIZATION_CATEGORIES)[number];\n\nexport const ORGANIZATION_MODULES = [\"INSCRICOES\", \"LOJA\", \"GALERIA\"] as const;\nexport type OrganizationModule = (typeof ORGANIZATION_MODULES)[number];\n\nexport const DEFAULT_ORGANIZATION_CATEGORY: OrganizationCategory = \"EVENTOS\";\nexport const DEFAULT_ORGANIZATION_MODULES: OrganizationModule[] = [\"INSCRICOES\"];\n\nconst organizationCategorySet = new Set<OrganizationCategory>(ORGANIZATION_CATEGORIES);\nconst organizationModuleSet = new Set<OrganizationModule>(ORGANIZATION_MODULES);\n\nexport function parseOrganizationCategory(value: unknown): OrganizationCategory | null {\n  if (typeof value !== \"string\") return null;\n  const normalized = value.trim().toUpperCase();\n  if (!normalized) return null;\n  return organizationCategorySet.has(normalized as OrganizationCategory)\n    ? (normalized as OrganizationCategory)\n    : null;\n}\n\nexport function parseOrganizationModules(value: unknown): OrganizationModule[] | null {\n  if (!Array.isArray(value)) return null;\n  const normalized: OrganizationModule[] = [];\n  for (const entry of value) {\n    if (typeof entry !== \"string\") return null;\n    const candidate = entry.trim().toUpperCase();\n    if (!candidate) return null;\n    if (!organizationModuleSet.has(candidate as OrganizationModule)) return null;\n    if (!normalized.includes(candidate as OrganizationModule)) {\n      normalized.push(candidate as OrganizationModule);\n    }\n  }\n  return normalized;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAO,MAAM,0BAA0B;IAAC;IAAW;IAAS;CAAe;AAGpE,MAAM,uBAAuB;IAAC;IAAc;IAAQ;CAAU;AAG9D,MAAM,gCAAsD;AAC5D,MAAM,+BAAqD;IAAC;CAAa;AAEhF,MAAM,0BAA0B,IAAI,IAA0B;AAC9D,MAAM,wBAAwB,IAAI,IAAwB;AAEnD,SAAS,0BAA0B,KAAc;IACtD,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,aAAa,MAAM,IAAI,GAAG,WAAW;IAC3C,IAAI,CAAC,YAAY,OAAO;IACxB,OAAO,wBAAwB,GAAG,CAAC,cAC9B,aACD;AACN;AAEO,SAAS,yBAAyB,KAAc;IACrD,IAAI,CAAC,MAAM,OAAO,CAAC,QAAQ,OAAO;IAClC,MAAM,aAAmC,EAAE;IAC3C,KAAK,MAAM,SAAS,MAAO;QACzB,IAAI,OAAO,UAAU,UAAU,OAAO;QACtC,MAAM,YAAY,MAAM,IAAI,GAAG,WAAW;QAC1C,IAAI,CAAC,WAAW,OAAO;QACvB,IAAI,CAAC,sBAAsB,GAAG,CAAC,YAAkC,OAAO;QACxE,IAAI,CAAC,WAAW,QAAQ,CAAC,YAAkC;YACzD,WAAW,IAAI,CAAC;QAClB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 878, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/lib/validation/organization.ts"],"sourcesContent":["import { z } from \"zod\";\nimport { ORGANIZATION_CATEGORIES, ORGANIZATION_MODULES } from \"@/lib/organizationCategories\";\n\n/**\n * Valida NIF português (9 dígitos, dígito de controlo módulo 11).\n */\nexport function isValidPortugueseNIF(value: string): boolean {\n  const numeric = value.replace(/\\D/g, \"\");\n  if (numeric.length !== 9) return false;\n\n  const firstDigit = Number(numeric[0]);\n  if (![1, 2, 3, 5, 6, 8, 9].includes(firstDigit)) return false;\n\n  const digits = numeric.split(\"\").map((d) => Number(d));\n  const sum = digits.slice(0, 8).reduce((acc, digit, idx) => acc + digit * (9 - idx), 0);\n  const modulo11 = sum % 11;\n  const checkDigit = modulo11 < 2 ? 0 : 11 - modulo11;\n\n  return checkDigit === digits[8];\n}\n\n/**\n * Valida IBAN (internacional) pelo algoritmo oficial.\n * Aceita qualquer país; não restringe a PT.\n */\nexport function isValidIBAN(value: string): boolean {\n  const cleaned = value.replace(/\\s+/g, \"\").toUpperCase();\n  if (!/^[A-Z]{2}\\d{2}[A-Z0-9]{1,30}$/.test(cleaned)) return false;\n  if (cleaned.length < 15 || cleaned.length > 34) return false;\n\n  // Move os 4 primeiros caracteres para o fim\n  const rearranged = `${cleaned.slice(4)}${cleaned.slice(0, 4)}`;\n\n  // Substitui letras por números (A=10 ... Z=35)\n  const numericRepresentation = rearranged\n    .split(\"\")\n    .map((char) => (/[A-Z]/.test(char) ? (char.charCodeAt(0) - 55).toString() : char))\n    .join(\"\");\n\n  // Calcula mod 97 com BigInt para evitar overflow\n  let remainder = 0n;\n  for (let i = 0; i < numericRepresentation.length; i += 1) {\n    const digit = BigInt(numericRepresentation[i] ?? \"0\");\n    remainder = (remainder * 10n + digit) % 97n;\n  }\n\n  return remainder === 1n;\n}\n\n/**\n * Valida website (URL com domínio válido).\n */\nexport function isValidWebsite(value: string): boolean {\n  const trimmed = value.trim();\n  if (!trimmed) return true;\n\n  const normalized = /^https?:\\/\\//i.test(trimmed) ? trimmed : `https://${trimmed}`;\n  try {\n    const url = new URL(normalized);\n    return Boolean(url.hostname);\n  } catch {\n    return false;\n  }\n}\n\nconst optionalTrimmedString = z\n  .union([z.string(), z.undefined(), z.null()])\n  .transform((v) => (v ?? \"\").trim());\n\nconst moduleKeys = ORGANIZATION_MODULES as unknown as [string, ...string[]];\n\nexport const becomeOrganizerSchema = z.object({\n  organizationCategory: z\n    .string()\n    .trim()\n    .min(1, \"Escolhe a categoria principal.\")\n    .refine((value) => ORGANIZATION_CATEGORIES.includes(value as (typeof ORGANIZATION_CATEGORIES)[number]), {\n      message: \"Categoria inválida.\",\n    }),\n  modules: z.array(z.enum(moduleKeys)).default([]),\n  entityType: z\n    .string()\n    .trim()\n    .min(1, \"Escolhe o tipo de entidade.\"),\n  businessName: z\n    .string()\n    .trim()\n    .min(1, \"Indica o nome da tua organização.\"),\n  city: z\n    .string()\n    .trim()\n    .min(1, \"Escolhe a cidade base.\"),\n  username: z\n    .string()\n    .trim()\n    .min(1, \"O username é obrigatório.\")\n    .max(30, \"Máximo 30 caracteres.\"),\n  website: optionalTrimmedString.refine(\n    (value) => value === \"\" || isValidWebsite(value),\n    {\n      message: \"Website inválido. Usa um URL válido (ex: https://orya.pt).\",\n    },\n  ),\n  iban: optionalTrimmedString.refine(\n    (value) => value === \"\" || isValidIBAN(value),\n    { message: \"IBAN inválido. Verifica os dados do teu banco.\" },\n  ),\n  taxId: optionalTrimmedString.refine(\n    (value) => value === \"\" || isValidPortugueseNIF(value),\n    { message: \"NIF inválido. Verifica se tem 9 dígitos e está correto.\" },\n  ),\n});\n\nexport type BecomeOrganizerSchema = typeof becomeOrganizerSchema;\nexport type BecomeOrganizerFormValues = z.input<typeof becomeOrganizerSchema>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 969, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/api/organizador/me/route.ts"],"sourcesContent":["\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { createSupabaseServer } from \"@/lib/supabaseServer\";\nimport { getOrgTransferEnabled, getPlatformFees } from \"@/lib/platformSettings\";\nimport { isValidPhone, normalizePhone } from \"@/lib/phone\";\nimport { getActiveOrganizerForUser } from \"@/lib/organizerContext\";\nimport { isValidWebsite } from \"@/lib/validation/organization\";\nimport { Resend } from \"resend\";\nimport { cookies } from \"next/headers\";\nimport {\n  DEFAULT_ORGANIZATION_CATEGORY,\n  parseOrganizationCategory,\n  parseOrganizationModules,\n} from \"@/lib/organizationCategories\";\n\nconst resendApiKey = process.env.RESEND_API_KEY;\nconst resendFromEmail = process.env.RESEND_FROM_EMAIL;\nconst resendClient = resendApiKey ? new Resend(resendApiKey) : null;\n\nexport async function GET(req: NextRequest) {\n  try {\n    const supabase = await createSupabaseServer();\n    const { data: { user }, error } = await supabase.auth.getUser();\n    if (!user || error) {\n      return NextResponse.json(\n        {\n          ok: false,\n          error: \"Não autenticado.\",\n          profile: null,\n          organizer: null,\n        },\n        { status: 401 }\n      );\n    }\n\n    const profile = await prisma.profile.findUnique({\n      where: { id: user.id },\n    });\n    if (!profile) {\n      return NextResponse.json(\n        {\n          ok: false,\n          error: \"Perfil não encontrado.\",\n          profile: null,\n          organizer: null,\n        },\n        { status: 404 }\n      );\n    }\n\n    const cookieStore = await cookies();\n    const cookieOrgId = cookieStore.get(\"orya_org\")?.value;\n    const urlOrg = req.nextUrl.searchParams.get(\"org\");\n    const forcedOrgId = urlOrg ? Number(urlOrg) : cookieOrgId ? Number(cookieOrgId) : undefined;\n    const { organizer, membership } = await getActiveOrganizerForUser(profile.id, {\n      organizerId: Number.isFinite(forcedOrgId) ? forcedOrgId : undefined,\n    });\n    const [platformFees, orgTransferEnabled, organizerModules] = await Promise.all([\n      getPlatformFees(),\n      getOrgTransferEnabled(),\n      organizer\n        ? prisma.organizationModuleEntry.findMany({\n            where: { organizerId: organizer.id, enabled: true },\n            select: { moduleKey: true },\n            orderBy: { moduleKey: \"asc\" },\n          })\n        : Promise.resolve([]),\n    ]);\n\n    const profilePayload = {\n      id: profile.id,\n      username: profile.username,\n      fullName: profile.fullName,\n      avatarUrl: profile.avatarUrl,\n      bio: profile.bio,\n      city: profile.city,\n      favouriteCategories: profile.favouriteCategories,\n      onboardingDone: profile.onboardingDone,\n      roles: profile.roles,\n    };\n    const profileRoles = (profile.roles || []) as string[];\n    const isAdmin = profileRoles.some((r) => r?.toLowerCase() === \"admin\");\n\n    const organizerPayload = organizer\n      ? {\n          id: organizer.id,\n          username: organizer.username,\n          stripeAccountId: organizer.stripeAccountId,\n          status: organizer.status,\n          stripeChargesEnabled: organizer.stripeChargesEnabled,\n          stripePayoutsEnabled: organizer.stripePayoutsEnabled,\n          feeMode: organizer.feeMode,\n          platformFeeBps: organizer.platformFeeBps,\n          platformFeeFixedCents: organizer.platformFeeFixedCents,\n          businessName: organizer.businessName,\n          entityType: organizer.entityType,\n          city: organizer.city,\n          payoutIban: organizer.payoutIban,\n          language: (organizer as { language?: string | null }).language ?? \"pt\",\n          publicListingEnabled: (organizer as { publicListingEnabled?: boolean | null }).publicListingEnabled ?? true,\n          alertsEmail: (organizer as { alertsEmail?: string | null }).alertsEmail ?? null,\n          alertsSalesEnabled: (organizer as { alertsSalesEnabled?: boolean | null }).alertsSalesEnabled ?? true,\n          alertsPayoutEnabled: (organizer as { alertsPayoutEnabled?: boolean | null }).alertsPayoutEnabled ?? false,\n          officialEmail: (organizer as { officialEmail?: string | null }).officialEmail ?? null,\n          officialEmailVerifiedAt: (organizer as { officialEmailVerifiedAt?: Date | null }).officialEmailVerifiedAt ?? null,\n          brandingAvatarUrl: (organizer as { brandingAvatarUrl?: string | null }).brandingAvatarUrl ?? null,\n          brandingCoverUrl: (organizer as { brandingCoverUrl?: string | null }).brandingCoverUrl ?? null,\n          brandingPrimaryColor: (organizer as { brandingPrimaryColor?: string | null }).brandingPrimaryColor ?? null,\n          brandingSecondaryColor: (organizer as { brandingSecondaryColor?: string | null }).brandingSecondaryColor ?? null,\n          organizationKind: (organizer as any).organizationKind ?? \"PESSOA_SINGULAR\",\n          organizationCategory:\n            (organizer as { organizationCategory?: string | null }).organizationCategory ??\n            DEFAULT_ORGANIZATION_CATEGORY,\n          modules: organizerModules.map((module) => module.moduleKey),\n          liveHubPremiumEnabled: organizer.liveHubPremiumEnabled,\n          publicName: organizer.publicName,\n          address: (organizer as { address?: string | null }).address ?? null,\n          showAddressPublicly: (organizer as { showAddressPublicly?: boolean | null }).showAddressPublicly ?? false,\n          publicWebsite: (organizer as { publicWebsite?: string | null }).publicWebsite ?? null,\n          publicInstagram: (organizer as { publicInstagram?: string | null }).publicInstagram ?? null,\n          publicYoutube: (organizer as { publicYoutube?: string | null }).publicYoutube ?? null,\n          publicDescription: (organizer as { publicDescription?: string | null }).publicDescription ?? null,\n          publicHours: (organizer as { publicHours?: string | null }).publicHours ?? null,\n          infoRules: (organizer as { infoRules?: string | null }).infoRules ?? null,\n          infoFaq: (organizer as { infoFaq?: string | null }).infoFaq ?? null,\n          infoRequirements: (organizer as { infoRequirements?: string | null }).infoRequirements ?? null,\n          infoPolicies: (organizer as { infoPolicies?: string | null }).infoPolicies ?? null,\n          infoLocationNotes: (organizer as { infoLocationNotes?: string | null }).infoLocationNotes ?? null,\n          padelDefaults: {\n            shortName: (organizer as any).padelDefaultShortName ?? null,\n            city: (organizer as any).padelDefaultCity ?? null,\n            address: (organizer as any).padelDefaultAddress ?? null,\n            courts: (organizer as any).padelDefaultCourts ?? 0,\n            hours: (organizer as any).padelDefaultHours ?? null,\n            ruleSetId: (organizer as any).padelDefaultRuleSetId ?? null,\n            favoriteCategories: (organizer as any).padelFavoriteCategories ?? [],\n          },\n        }\n      : null;\n\n    const profileStatus =\n      organizer &&\n      organizer.businessName &&\n      organizer.entityType &&\n      organizer.city &&\n      user.email\n        ? \"OK\"\n        : \"MISSING_CONTACT\";\n\n    const lowerName = (organizer?.publicName ?? organizer?.username ?? \"\").toLowerCase();\n    const isPlatformAccount =\n      isAdmin ||\n      (organizer as { payoutMode?: string | null })?.payoutMode === \"PLATFORM\" ||\n      organizer?.organizationKind === \"EMPRESA_MARCA\" ||\n      lowerName === \"orya\" ||\n      lowerName.startsWith(\"orya \");\n    const paymentsStatus = organizer\n      ? isPlatformAccount\n        ? \"READY\"\n        : organizer.stripeAccountId\n          ? organizer.stripeChargesEnabled && organizer.stripePayoutsEnabled\n            ? \"READY\"\n            : \"PENDING\"\n          : \"NO_STRIPE\"\n      : \"NO_STRIPE\";\n\n    return NextResponse.json(\n      {\n        ok: true,\n        profile: profilePayload,\n        organizer: organizerPayload,\n        platformFees,\n        orgTransferEnabled,\n        contactEmail: user.email,\n        profileStatus,\n        paymentsStatus,\n        paymentsMode: isPlatformAccount ? \"PLATFORM\" : \"CONNECT\",\n        membershipRole: membership?.role ?? null,\n      },\n      { status: 200 }\n    );\n  } catch (err) {\n    console.error(\"GET /api/organizador/me error:\", err);\n    return NextResponse.json(\n      {\n        ok: false,\n        error: \"Erro interno.\",\n        profile: null,\n        organizer: null,\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PATCH(req: NextRequest) {\n  try {\n    const supabase = await createSupabaseServer();\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser();\n\n    if (!user || error) {\n      return NextResponse.json({ ok: false, error: \"Não autenticado.\" }, { status: 401 });\n    }\n\n    const body = await req.json().catch(() => null);\n    if (!body) {\n      return NextResponse.json({ ok: false, error: \"Payload inválido.\" }, { status: 400 });\n    }\n\n    const {\n      businessName,\n      entityType,\n      city,\n      payoutIban,\n      fullName,\n      contactPhone,\n      language,\n      publicListingEnabled,\n      alertsEmail,\n      alertsSalesEnabled,\n      alertsPayoutEnabled,\n      brandingAvatarUrl,\n      brandingCoverUrl,\n      brandingPrimaryColor,\n      brandingSecondaryColor,\n      organizationKind,\n      publicName,\n      publicWebsite,\n      publicInstagram,\n      publicYoutube,\n      publicDescription,\n      publicHours,\n      infoRules,\n      infoFaq,\n      infoRequirements,\n      infoPolicies,\n      infoLocationNotes,\n      address,\n      showAddressPublicly,\n      padelDefaultShortName,\n      padelDefaultCity,\n      padelDefaultAddress,\n      padelDefaultCourts,\n      padelDefaultHours,\n      padelDefaultRuleSetId,\n      padelFavoriteCategories,\n    } = body as Record<string, unknown>;\n    const organizationCategoryRaw = (body as Record<string, unknown>).organizationCategory;\n    const modulesRaw = (body as Record<string, unknown>).modules;\n\n    const organizationCategoryProvided = Object.prototype.hasOwnProperty.call(body, \"organizationCategory\");\n    const modulesProvided = Object.prototype.hasOwnProperty.call(body, \"modules\");\n    const premiumProvided = Object.prototype.hasOwnProperty.call(body, \"liveHubPremiumEnabled\");\n\n    const organizationCategory = organizationCategoryProvided\n      ? parseOrganizationCategory(organizationCategoryRaw)\n      : null;\n    if (organizationCategoryProvided && !organizationCategory) {\n      return NextResponse.json(\n        { ok: false, error: \"organizationCategory inválido. Usa EVENTOS, PADEL ou VOLUNTARIADO.\" },\n        { status: 400 },\n      );\n    }\n\n    const parsedModules = modulesProvided ? parseOrganizationModules(modulesRaw) : null;\n    if (modulesProvided && parsedModules === null) {\n      return NextResponse.json(\n        { ok: false, error: \"modules inválido. Usa uma lista de módulos válidos (ex.: INSCRICOES).\" },\n        { status: 400 },\n      );\n    }\n    if (premiumProvided) {\n      return NextResponse.json(\n        { ok: false, error: \"O premium é gerido automaticamente pela subscrição.\" },\n        { status: 400 },\n      );\n    }\n\n    // Validação de telefone (opcional, mas consistente com checkout)\n    if (typeof contactPhone === \"string\" && contactPhone.trim()) {\n      const phoneRaw = contactPhone.trim();\n      if (!isValidPhone(phoneRaw)) {\n        return NextResponse.json(\n          { ok: false, error: \"Telefone inválido. Usa um número real (podes incluir indicativo, ex.: +351...).\" },\n          { status: 400 },\n        );\n      }\n    }\n\n    const { organizer, membership } = await getActiveOrganizerForUser(user.id, {\n      roles: [\"OWNER\", \"CO_OWNER\", \"ADMIN\"],\n    });\n\n    if (!organizer) {\n      return NextResponse.json({ ok: false, error: \"Ainda não és organizador.\" }, { status: 403 });\n    }\n    if (!membership || membership.role !== \"OWNER\") {\n      return NextResponse.json({ ok: false, error: \"Apenas o Owner pode alterar estas definições.\" }, { status: 403 });\n    }\n    if (organizationCategoryProvided && organizationCategory) {\n      const existingCategory = organizer.organizationCategory ?? null;\n      if (existingCategory && existingCategory !== organizationCategory) {\n        return NextResponse.json(\n          { ok: false, error: \"A categoria da organização é fixa e não pode ser alterada.\" },\n          { status: 400 },\n        );\n      }\n    }\n\n    const profileUpdates: Record<string, unknown> = {};\n    if (typeof fullName === \"string\") profileUpdates.fullName = fullName.trim() || null;\n    if (typeof city === \"string\") profileUpdates.city = city.trim() || null;\n    if (typeof contactPhone === \"string\") profileUpdates.contactPhone = normalizePhone(contactPhone.trim()) || null;\n    if (typeof alertsEmail === \"string\" && alertsEmail.trim()) {\n      const email = alertsEmail.trim();\n      const emailRegex = /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/;\n      if (!emailRegex.test(email)) {\n        return NextResponse.json({ ok: false, error: \"Email de alertas inválido.\" }, { status: 400 });\n      }\n    }\n\n    const organizerUpdates: Record<string, unknown> = {};\n    const businessNameClean = typeof businessName === \"string\" ? businessName.trim() : undefined;\n    const publicNameInput = typeof publicName === \"string\" ? publicName.trim() : undefined;\n    const addressInput = typeof address === \"string\" ? address.trim() : undefined;\n    const showAddressPubliclyInput = typeof showAddressPublicly === \"boolean\" ? showAddressPublicly : undefined;\n    const normalizeSocialLink = (value: string, kind: \"instagram\" | \"youtube\") => {\n      const trimmed = value.trim();\n      if (!trimmed) return { value: null as string | null };\n      let normalized = trimmed;\n      if (trimmed.startsWith(\"@\")) {\n        normalized =\n          kind === \"instagram\"\n            ? `https://instagram.com/${trimmed.slice(1)}`\n            : `https://youtube.com/@${trimmed.slice(1)}`;\n      } else if (!/^https?:\\/\\//i.test(trimmed)) {\n        normalized = `https://${trimmed}`;\n      }\n      if (!isValidWebsite(normalized)) {\n        return {\n          error: `${kind === \"instagram\" ? \"Instagram\" : \"YouTube\"} inválido. Usa um URL válido.`,\n        };\n      }\n      return { value: normalized };\n    };\n\n    if (businessNameClean !== undefined) organizerUpdates.businessName = businessNameClean || null;\n    if (publicNameInput !== undefined) {\n      const fallbackPublic =\n        businessNameClean ??\n        organizer.businessName ??\n        organizer.publicName ??\n        null;\n      organizerUpdates.publicName = publicNameInput || fallbackPublic || null;\n    }\n    if (addressInput !== undefined) organizerUpdates.address = addressInput || null;\n    if (showAddressPubliclyInput !== undefined) organizerUpdates.showAddressPublicly = showAddressPubliclyInput;\n    if (typeof publicWebsite === \"string\") {\n      const trimmed = publicWebsite.trim();\n      if (!trimmed) {\n        organizerUpdates.publicWebsite = null;\n      } else {\n        const normalized = /^https?:\\/\\//i.test(trimmed) ? trimmed : `https://${trimmed}`;\n        if (!isValidWebsite(normalized)) {\n          return NextResponse.json(\n            { ok: false, error: \"Website inválido. Usa um URL válido (ex: https://orya.pt).\" },\n            { status: 400 },\n          );\n        }\n        organizerUpdates.publicWebsite = normalized;\n      }\n    }\n\n    if (typeof publicInstagram === \"string\") {\n      const normalized = normalizeSocialLink(publicInstagram, \"instagram\");\n      if (normalized.error) {\n        return NextResponse.json({ ok: false, error: normalized.error }, { status: 400 });\n      }\n      organizerUpdates.publicInstagram = normalized.value;\n    }\n    if (typeof publicYoutube === \"string\") {\n      const normalized = normalizeSocialLink(publicYoutube, \"youtube\");\n      if (normalized.error) {\n        return NextResponse.json({ ok: false, error: normalized.error }, { status: 400 });\n      }\n      organizerUpdates.publicYoutube = normalized.value;\n    }\n    if (typeof publicDescription === \"string\") {\n      organizerUpdates.publicDescription = publicDescription.trim() || null;\n    }\n    if (typeof publicHours === \"string\") {\n      organizerUpdates.publicHours = publicHours.trim() || null;\n    }\n    if (typeof infoRules === \"string\") {\n      organizerUpdates.infoRules = infoRules.trim() || null;\n    }\n    if (typeof infoFaq === \"string\") {\n      organizerUpdates.infoFaq = infoFaq.trim() || null;\n    }\n    if (typeof infoRequirements === \"string\") {\n      organizerUpdates.infoRequirements = infoRequirements.trim() || null;\n    }\n    if (typeof infoPolicies === \"string\") {\n      organizerUpdates.infoPolicies = infoPolicies.trim() || null;\n    }\n    if (typeof infoLocationNotes === \"string\") {\n      organizerUpdates.infoLocationNotes = infoLocationNotes.trim() || null;\n    }\n    if (typeof entityType === \"string\") organizerUpdates.entityType = entityType.trim() || null;\n    if (typeof city === \"string\") organizerUpdates.city = city.trim() || null;\n    if (typeof payoutIban === \"string\") organizerUpdates.payoutIban = payoutIban.trim() || null;\n    if (typeof language === \"string\") {\n      const lang = language.toLowerCase();\n      organizerUpdates.language = lang === \"en\" ? \"en\" : \"pt\";\n    }\n    if (typeof publicListingEnabled === \"boolean\") organizerUpdates.publicListingEnabled = publicListingEnabled;\n    if (typeof alertsEmail === \"string\") organizerUpdates.alertsEmail = alertsEmail.trim() || null;\n    if (typeof alertsSalesEnabled === \"boolean\") organizerUpdates.alertsSalesEnabled = alertsSalesEnabled;\n    if (typeof alertsPayoutEnabled === \"boolean\") organizerUpdates.alertsPayoutEnabled = alertsPayoutEnabled;\n    if (brandingAvatarUrl === null) organizerUpdates.brandingAvatarUrl = null;\n    if (typeof brandingAvatarUrl === \"string\") organizerUpdates.brandingAvatarUrl = brandingAvatarUrl.trim() || null;\n    if (brandingCoverUrl === null) organizerUpdates.brandingCoverUrl = null;\n    if (typeof brandingCoverUrl === \"string\") organizerUpdates.brandingCoverUrl = brandingCoverUrl.trim() || null;\n    if (typeof brandingPrimaryColor === \"string\") organizerUpdates.brandingPrimaryColor = brandingPrimaryColor.trim() || null;\n    if (typeof brandingSecondaryColor === \"string\")\n      organizerUpdates.brandingSecondaryColor = brandingSecondaryColor.trim() || null;\n    if (organizationCategoryProvided && organizationCategory) {\n      organizerUpdates.organizationCategory = organizationCategory;\n    }\n    if (typeof organizationKind === \"string\") {\n      const kind = organizationKind.toUpperCase();\n      const allowed = [\"CLUBE_PADEL\", \"RESTAURANTE\", \"EMPRESA_EVENTOS\", \"ASSOCIACAO\", \"PESSOA_SINGULAR\"];\n      if (!allowed.includes(kind)) {\n        return NextResponse.json(\n          { ok: false, error: \"organizationKind inválido. Usa CLUBE_PADEL, RESTAURANTE, EMPRESA_EVENTOS, ASSOCIACAO ou PESSOA_SINGULAR.\" },\n          { status: 400 },\n        );\n      }\n      organizerUpdates.organizationKind = kind;\n    }\n    if (typeof padelDefaultShortName === \"string\") {\n      organizerUpdates.padelDefaultShortName = padelDefaultShortName.trim() || null;\n    }\n    if (typeof padelDefaultCity === \"string\") {\n      organizerUpdates.padelDefaultCity = padelDefaultCity.trim() || null;\n    }\n    if (typeof padelDefaultAddress === \"string\") {\n      organizerUpdates.padelDefaultAddress = padelDefaultAddress.trim() || null;\n    }\n    if (typeof padelDefaultHours === \"string\") {\n      organizerUpdates.padelDefaultHours = padelDefaultHours.trim() || null;\n    }\n    if (typeof padelDefaultCourts === \"number\") {\n      organizerUpdates.padelDefaultCourts = Math.max(0, Math.floor(padelDefaultCourts));\n    }\n    if (typeof padelDefaultRuleSetId === \"number\" && Number.isFinite(padelDefaultRuleSetId)) {\n      organizerUpdates.padelDefaultRuleSetId = padelDefaultRuleSetId;\n    }\n    if (Array.isArray(padelFavoriteCategories)) {\n      const nums = padelFavoriteCategories\n        .map((v) => (typeof v === \"number\" && Number.isFinite(v) ? Math.floor(v) : null))\n        .filter((v): v is number => v !== null);\n      organizerUpdates.padelFavoriteCategories = nums;\n    }\n\n    if (Object.keys(profileUpdates).length > 0) {\n      await prisma.profile.update({\n        where: { id: user.id },\n        data: profileUpdates,\n      });\n    }\n\n    if (Object.keys(organizerUpdates).length > 0) {\n      await prisma.organizer.update({\n        where: { id: organizer.id },\n        data: organizerUpdates,\n      });\n    }\n\n    if (modulesProvided) {\n      await prisma.organizationModuleEntry.deleteMany({\n        where: { organizerId: organizer.id },\n      });\n      if (parsedModules && parsedModules.length > 0) {\n        await prisma.organizationModuleEntry.createMany({\n          data: parsedModules.map((moduleKey) => ({\n            organizerId: organizer.id,\n            moduleKey,\n            enabled: true,\n          })),\n        });\n      }\n    }\n\n    const nextModules = modulesProvided\n      ? parsedModules ?? []\n      : (\n          await prisma.organizationModuleEntry.findMany({\n            where: { organizerId: organizer.id, enabled: true },\n            select: { moduleKey: true },\n            orderBy: { moduleKey: \"asc\" },\n          })\n        ).map((module) => module.moduleKey);\n\n    const verifiedOfficialEmail =\n      organizer && (organizer as { officialEmailVerifiedAt?: Date | null })?.officialEmailVerifiedAt\n        ? (organizer as { officialEmail?: string | null }).officialEmail ?? null\n        : null;\n    const alertsTarget =\n      verifiedOfficialEmail ??\n      (typeof alertsEmail === \"string\" && alertsEmail.trim().length > 0 ? alertsEmail.trim() : organizer.alertsEmail);\n    const alertsSales = typeof alertsSalesEnabled === \"boolean\" ? alertsSalesEnabled : organizer.alertsSalesEnabled;\n    if (alertsTarget && alertsSales && resendClient && resendFromEmail) {\n      try {\n        await resendClient.emails.send({\n          from: resendFromEmail,\n          to: alertsTarget,\n          subject: \"Alertas de vendas ORYA ativados\",\n          text: \"Passaste a receber alertas de vendas nesta caixa de email. Se não foste tu, desativa nas definições do organizador.\",\n        });\n      } catch (emailErr) {\n        console.warn(\"[alerts] falha ao enviar email de alerta\", emailErr);\n      }\n    }\n\n    return NextResponse.json(\n      {\n        ok: true,\n        organizer: {\n          organizationCategory:\n            organizationCategory ??\n            (organizer as { organizationCategory?: string | null }).organizationCategory ??\n            DEFAULT_ORGANIZATION_CATEGORY,\n          modules: nextModules,\n        },\n      },\n      { status: 200 },\n    );\n  } catch (err) {\n    console.error(\"PATCH /api/organizador/me error:\", err);\n    return NextResponse.json({ ok: false, error: \"Erro interno.\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}