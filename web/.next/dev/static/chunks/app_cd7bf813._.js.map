{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/components/checkin/CheckinScanner.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\n\ntype PreviewPayload = {\n  code: string;\n  window?: { start: string | null; end: string | null };\n  checkedInAt?: string | null;\n  entitlement?: {\n    id: string;\n    status: string;\n    holderKey: string;\n    snapshotTitle: string;\n    snapshotVenue: string | null;\n    snapshotStartAt: string | null;\n    snapshotTimezone: string | null;\n  };\n};\n\ntype Props = {\n  backHref: string;\n  backLabel: string;\n  title?: string;\n  subtitle?: string;\n  allowOrganizerEvents?: boolean;\n  embedded?: boolean;\n  showBackLink?: boolean;\n  eventIdOverride?: number | null;\n};\n\nconst STATUS_META: Record<\n  string,\n  { label: string; tone: string; canConfirm: boolean; hint: string }\n> = {\n  OK: {\n    label: \"Pronto para confirmar\",\n    tone: \"border-emerald-400/50 bg-emerald-500/10 text-emerald-50\",\n    canConfirm: true,\n    hint: \"Confirma o check-in no passo seguinte.\",\n  },\n  ALREADY_USED: {\n    label: \"Já usado\",\n    tone: \"border-amber-400/50 bg-amber-500/10 text-amber-50\",\n    canConfirm: false,\n    hint: \"Este bilhete já foi validado.\",\n  },\n  INVALID: {\n    label: \"QR inválido\",\n    tone: \"border-red-400/50 bg-red-500/10 text-red-50\",\n    canConfirm: false,\n    hint: \"O QR não está ativo ou expirou.\",\n  },\n  REFUNDED: {\n    label: \"Reembolsado\",\n    tone: \"border-red-400/50 bg-red-500/10 text-red-50\",\n    canConfirm: false,\n    hint: \"Bilhete reembolsado — não pode entrar.\",\n  },\n  REVOKED: {\n    label: \"Revogado\",\n    tone: \"border-red-400/50 bg-red-500/10 text-red-50\",\n    canConfirm: false,\n    hint: \"Bilhete revogado — não pode entrar.\",\n  },\n  SUSPENDED: {\n    label: \"Suspenso\",\n    tone: \"border-red-400/50 bg-red-500/10 text-red-50\",\n    canConfirm: false,\n    hint: \"Bilhete suspenso — pede ajuda ao organizador.\",\n  },\n  NOT_ALLOWED: {\n    label: \"Não permitido\",\n    tone: \"border-red-400/50 bg-red-500/10 text-red-50\",\n    canConfirm: false,\n    hint: \"Este QR não pertence a este evento.\",\n  },\n  OUTSIDE_WINDOW: {\n    label: \"Fora da janela\",\n    tone: \"border-amber-400/50 bg-amber-500/10 text-amber-50\",\n    canConfirm: false,\n    hint: \"Check-in só disponível na janela do evento.\",\n  },\n};\n\nconst formatDateTime = (value?: string | null) => {\n  if (!value) return \"A definir\";\n  const parsed = new Date(value);\n  if (Number.isNaN(parsed.getTime())) return \"A definir\";\n  return parsed.toLocaleString(\"pt-PT\", {\n    day: \"2-digit\",\n    month: \"short\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n};\n\nfunction resolveMeta(code: string) {\n  return STATUS_META[code] ?? {\n    label: \"Estado desconhecido\",\n    tone: \"border-white/20 bg-white/5 text-white/80\",\n    canConfirm: false,\n    hint: \"Revê o QR e tenta novamente.\",\n  };\n}\n\nexport function CheckinScanner({\n  backHref,\n  backLabel,\n  title = \"Modo Receção\",\n  subtitle = \"Valida o Pass ORYA em 2 passos: pré-visualizar e confirmar.\",\n  allowOrganizerEvents = false,\n  embedded = false,\n  showBackLink = true,\n  eventIdOverride = null,\n}: Props) {\n  const search = useSearchParams();\n  const eventIdRaw = search.get(\"eventId\");\n  const eventId = eventIdRaw ? Number(eventIdRaw) : Number.NaN;\n  const hasQueryEvent = Number.isFinite(eventId) && eventId > 0;\n  const hasOverride = Number.isFinite(eventIdOverride) && (eventIdOverride ?? 0) > 0;\n  const [selectedEventId, setSelectedEventId] = useState<number | null>(\n    hasOverride ? (eventIdOverride as number) : hasQueryEvent ? eventId : null,\n  );\n  const [events, setEvents] = useState<\n    Array<{ id: number; title: string; startsAt: string | null; locationName: string | null }>\n  >([]);\n  const [eventsLoading, setEventsLoading] = useState(false);\n  const [eventsError, setEventsError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (hasOverride) {\n      setSelectedEventId(eventIdOverride as number);\n      return;\n    }\n    if (hasQueryEvent) {\n      setSelectedEventId(eventId);\n    }\n  }, [eventId, eventIdOverride, hasOverride, hasQueryEvent]);\n\n  const effectiveEventId = hasOverride ? (eventIdOverride as number) : hasQueryEvent ? eventId : selectedEventId ?? Number.NaN;\n  const hasEvent = Number.isFinite(effectiveEventId) && effectiveEventId > 0;\n\n  useEffect(() => {\n    if (!allowOrganizerEvents || hasQueryEvent || hasOverride) return;\n    let active = true;\n    setEventsLoading(true);\n    setEventsError(null);\n    fetch(\"/api/organizador/events/list?limit=60\")\n      .then(async (res) => {\n        const data = await res.json().catch(() => null);\n        if (!res.ok || !data?.ok) {\n          throw new Error(data?.error || \"Erro ao carregar eventos.\");\n        }\n        if (!active) return;\n        setEvents(data.items ?? []);\n      })\n      .catch((err) => {\n        if (!active) return;\n        setEventsError(err instanceof Error ? err.message : \"Erro ao carregar eventos.\");\n      })\n      .finally(() => {\n        if (active) setEventsLoading(false);\n      });\n\n    return () => {\n      active = false;\n    };\n  }, [allowOrganizerEvents, hasQueryEvent, hasOverride]);\n\n  const [deviceId, setDeviceId] = useState(\"\");\n  const [qrToken, setQrToken] = useState(\"\");\n  const [preview, setPreview] = useState<PreviewPayload | null>(null);\n  const [previewing, setPreviewing] = useState(false);\n  const [confirming, setConfirming] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [confirmedCode, setConfirmedCode] = useState<string | null>(null);\n\n  useEffect(() => {\n    const existing = window.localStorage.getItem(\"oryaCheckinDeviceId\");\n    if (existing) {\n      setDeviceId(existing);\n      return;\n    }\n    const next =\n      typeof crypto?.randomUUID === \"function\"\n        ? crypto.randomUUID()\n        : `device-${Math.random().toString(36).slice(2)}`;\n    window.localStorage.setItem(\"oryaCheckinDeviceId\", next);\n    setDeviceId(next);\n  }, []);\n\n  const meta = useMemo(() => {\n    const code = confirmedCode ?? preview?.code ?? \"\";\n    const base = resolveMeta(code);\n    if (confirmedCode === \"OK\") {\n      return {\n        ...base,\n        label: \"Check-in confirmado\",\n        hint: \"Entrada validada com sucesso.\",\n        tone: \"border-emerald-400/50 bg-emerald-500/10 text-emerald-50\",\n      };\n    }\n    return base;\n  }, [preview, confirmedCode]);\n\n  const handlePreview = async () => {\n    setError(null);\n    setPreview(null);\n    setConfirmedCode(null);\n    if (!qrToken.trim()) {\n      setError(\"Indica o QR token.\");\n      return;\n    }\n    if (!hasEvent) {\n      setError(\"Seleciona um evento válido.\");\n      return;\n    }\n    setPreviewing(true);\n    try {\n      const res = await fetch(\"/api/organizador/checkin/preview\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ qrToken: qrToken.trim(), eventId: effectiveEventId }),\n      });\n      const data = (await res.json().catch(() => null)) as PreviewPayload | null;\n      if (!res.ok) {\n        setError(data?.code ? `Erro: ${data.code}` : \"Não foi possível validar o QR.\");\n        setPreviewing(false);\n        return;\n      }\n      setPreview(data);\n    } catch (err) {\n      console.error(\"[checkin][preview]\", err);\n      setError(\"Erro inesperado ao validar.\");\n    } finally {\n      setPreviewing(false);\n    }\n  };\n\n  const handleConfirm = async () => {\n    if (!preview || preview.code !== \"OK\") return;\n    setConfirming(true);\n    setError(null);\n    try {\n      const res = await fetch(\"/api/organizador/checkin\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ qrToken: qrToken.trim(), eventId: effectiveEventId, deviceId }),\n      });\n      const data = (await res.json().catch(() => null)) as { code?: string } | null;\n      if (!res.ok) {\n        setError(\"Erro ao confirmar check-in.\");\n        setConfirming(false);\n        return;\n      }\n      setConfirmedCode(data?.code ?? \"OK\");\n    } catch (err) {\n      console.error(\"[checkin][confirm]\", err);\n      setError(\"Erro inesperado ao confirmar.\");\n    } finally {\n      setConfirming(false);\n    }\n  };\n\n  const handleReset = () => {\n    setPreview(null);\n    setConfirmedCode(null);\n    setQrToken(\"\");\n    setError(null);\n  };\n\n  const shellClass = embedded\n    ? \"relative w-full text-white\"\n    : \"relative orya-body-bg min-h-screen w-full overflow-hidden text-white\";\n  const containerClass = embedded ? \"relative mx-auto w-full max-w-5xl space-y-6\" : \"relative mx-auto flex max-w-4xl flex-col gap-6 px-4 py-10\";\n\n  return (\n    <div className={shellClass}>\n      {!embedded && (\n        <div className=\"pointer-events-none fixed inset-0\" aria-hidden=\"true\">\n          <div className=\"absolute -top-36 right-[-140px] h-[420px] w-[420px] rounded-full bg-[radial-gradient(circle_at_35%_35%,rgba(255,0,200,0.28),transparent_60%)] opacity-80 blur-3xl\" />\n          <div className=\"absolute top-[22vh] -left-40 h-[360px] w-[360px] rounded-full bg-[radial-gradient(circle_at_30%_30%,rgba(107,255,255,0.22),transparent_60%)] opacity-80 blur-3xl\" />\n          <div className=\"absolute bottom-[-180px] right-[12%] h-[420px] w-[420px] rounded-full bg-[radial-gradient(circle_at_40%_40%,rgba(22,70,245,0.25),transparent_60%)] opacity-70 blur-3xl\" />\n          <div className=\"absolute inset-0 bg-[linear-gradient(180deg,rgba(255,255,255,0.05),transparent_35%,rgba(0,0,0,0.65))] mix-blend-screen\" />\n        </div>\n      )}\n\n      <section className={containerClass}>\n        <div className=\"flex flex-col gap-3 rounded-3xl border border-white/15 bg-white/5 p-6 shadow-[0_24px_70px_rgba(0,0,0,0.7)] backdrop-blur-2xl\">\n          {showBackLink && (\n            <a href={backHref} className=\"text-xs uppercase tracking-[0.2em] text-white/60 hover:text-white\">\n              ← {backLabel}\n            </a>\n          )}\n          <h1 className=\"text-3xl font-semibold\">{title}</h1>\n          <p className=\"text-sm text-white/70\">{subtitle}</p>\n        </div>\n\n        {!hasEvent && (\n          <div className=\"rounded-2xl border border-amber-400/40 bg-amber-500/10 p-4 text-sm text-amber-50\">\n            Precisas de escolher um evento para iniciar o check-in.\n          </div>\n        )}\n\n        {allowOrganizerEvents && !hasQueryEvent && !hasOverride && (\n          <div className=\"rounded-2xl border border-white/15 bg-white/5 p-4 text-sm text-white/80\">\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/60\">Evento</p>\n            <p className=\"mt-1 text-[12px] text-white/70\">\n              Seleciona o evento antes de validar o QR.\n            </p>\n            <div className=\"mt-3 space-y-2\">\n              <select\n                value={selectedEventId ?? \"\"}\n                onChange={(e) => setSelectedEventId(e.target.value ? Number(e.target.value) : null)}\n                className=\"w-full rounded-xl border border-white/20 bg-black/30 px-3 py-2 text-sm text-white outline-none transition focus:border-[#6BFFFF]\"\n              >\n                <option value=\"\">Seleciona um evento</option>\n                {events.map((ev) => (\n                  <option key={ev.id} value={ev.id}>\n                    {ev.title}\n                  </option>\n                ))}\n              </select>\n              {eventsLoading && <p className=\"text-[11px] text-white/60\">A carregar eventos…</p>}\n              {eventsError && <p className=\"text-[11px] text-red-300\">{eventsError}</p>}\n              {selectedEventId && (\n                <p className=\"text-[11px] text-white/60\">\n                  {formatDateTime(events.find((ev) => ev.id === selectedEventId)?.startsAt ?? null)} ·{\" \"}\n                  {events.find((ev) => ev.id === selectedEventId)?.locationName ?? \"Local a anunciar\"}\n                </p>\n              )}\n            </div>\n          </div>\n        )}\n\n        <div className=\"grid gap-4 md:grid-cols-[1.15fr_0.85fr]\">\n          <div className=\"space-y-4 rounded-3xl border border-white/15 bg-white/5 p-5 shadow-[0_24px_60px_rgba(0,0,0,0.6)] backdrop-blur-2xl\">\n            <p className=\"text-[11px] uppercase tracking-[0.26em] text-white/60\">Passo 1</p>\n            <h2 className=\"text-lg font-semibold\">Validar o QR</h2>\n            <p className=\"text-[12px] text-white/65\">\n              Introduz o QR token ou lê o código. A validação não consome o bilhete.\n            </p>\n            <input\n              type=\"text\"\n              value={qrToken}\n              onChange={(e) => setQrToken(e.target.value)}\n              placeholder=\"QR token\"\n              className=\"w-full rounded-xl border border-white/20 bg-black/30 px-3 py-2 text-sm text-white outline-none transition focus:border-[#6BFFFF]\"\n            />\n            <button\n              type=\"button\"\n              onClick={handlePreview}\n              disabled={previewing}\n              className=\"w-full rounded-full bg-white px-4 py-2 text-sm font-semibold text-black transition hover:scale-[1.01] disabled:opacity-60\"\n            >\n              {previewing ? \"A validar...\" : \"Validar QR\"}\n            </button>\n            {error && <p className=\"text-sm text-red-300\">{error}</p>}\n          </div>\n\n          <div className=\"space-y-4 rounded-3xl border border-white/15 bg-white/5 p-5 shadow-[0_24px_60px_rgba(0,0,0,0.6)] backdrop-blur-2xl\">\n            <p className=\"text-[11px] uppercase tracking-[0.26em] text-white/60\">Passo 2</p>\n            <h2 className=\"text-lg font-semibold\">Confirmar check-in</h2>\n            <p className=\"text-[12px] text-white/65\">\n              Confirma apenas quando estiveres com a pessoa presente.\n            </p>\n\n            {preview || confirmedCode ? (\n              <div className={`rounded-2xl border p-4 text-sm ${meta.tone}`}>\n                <p className=\"text-[11px] uppercase tracking-[0.2em] opacity-80\">Estado</p>\n                <p className=\"mt-1 text-lg font-semibold\">{meta.label}</p>\n                <p className=\"text-[12px] opacity-80\">{meta.hint}</p>\n                {preview?.entitlement && (\n                  <div className=\"mt-3 space-y-1 text-[12px] text-white/85\">\n                    <p className=\"font-semibold\">{preview.entitlement.snapshotTitle}</p>\n                    <p>{preview.entitlement.holderKey}</p>\n                    <p>{preview.entitlement.snapshotVenue ?? \"Local a anunciar\"}</p>\n                    <p>{formatDateTime(preview.entitlement.snapshotStartAt)}</p>\n                  </div>\n                )}\n                {preview?.checkedInAt && (\n                  <p className=\"mt-2 text-[12px] opacity-80\">\n                    Check-in feito em {formatDateTime(preview.checkedInAt)}\n                  </p>\n                )}\n              </div>\n            ) : (\n              <div className=\"rounded-2xl border border-white/10 bg-black/30 p-4 text-[12px] text-white/70\">\n                Primeiro valida um QR para veres os detalhes.\n              </div>\n            )}\n\n            <button\n              type=\"button\"\n              onClick={handleConfirm}\n              disabled={!preview || preview.code !== \"OK\" || confirming || Boolean(confirmedCode)}\n              className=\"w-full rounded-full bg-emerald-400 px-4 py-2 text-sm font-semibold text-black transition hover:scale-[1.01] disabled:opacity-50\"\n            >\n              {confirming ? \"A confirmar...\" : confirmedCode ? \"Check-in confirmado\" : \"Confirmar check-in\"}\n            </button>\n\n            <button\n              type=\"button\"\n              onClick={handleReset}\n              className=\"w-full rounded-full border border-white/30 bg-white/5 px-4 py-2 text-xs font-semibold text-white/80 hover:bg-white/10\"\n            >\n              Novo check-in\n            </button>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 687, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/organizador/objectiveNav.ts"],"sourcesContent":["export type ObjectiveTab = \"manage\" | \"promote\" | \"analyze\" | \"profile\";\nexport type OrgCategory = \"EVENTOS\" | \"PADEL\" | \"VOLUNTARIADO\";\n\nexport type ObjectiveNavContext = {\n  category: OrgCategory;\n  modules: string[];\n  username?: string | null;\n};\n\nexport type ObjectiveNavSection = {\n  id: string;\n  label: string;\n  href: string;\n  description?: string;\n};\n\nexport function normalizeOrgCategory(value?: string | null): OrgCategory {\n  const normalized = value?.toUpperCase() ?? \"\";\n  if (normalized === \"PADEL\") return \"PADEL\";\n  if (normalized === \"VOLUNTARIADO\") return \"VOLUNTARIADO\";\n  return \"EVENTOS\";\n}\n\nexport function getObjectiveSections(\n  objective: ObjectiveTab,\n  context: ObjectiveNavContext,\n  _options?: { mode?: \"dashboard\" | \"page\" },\n): ObjectiveNavSection[] {\n  const sections: ObjectiveNavSection[] = [];\n\n  if (objective === \"manage\") {\n    sections.push({\n      id: \"eventos\",\n      label: \"Eventos\",\n      href: \"/organizador?tab=manage&section=eventos\",\n    });\n    if (context.category === \"PADEL\") {\n      sections.push({\n        id: \"padel-hub\",\n        label: \"Hub Padel\",\n        href: \"/organizador?tab=manage&section=padel-hub\",\n      });\n      return sections;\n    }\n    sections.push({\n      id: \"inscricoes\",\n      label: \"Inscrições\",\n      href: \"/organizador?tab=manage&section=inscricoes\",\n    });\n    return sections;\n  }\n\n  if (objective === \"promote\") {\n    const baseHref = \"/organizador?tab=promote&section=marketing&marketing=\";\n    sections.push({\n      id: \"overview\",\n      label: \"Visão geral\",\n      href: `${baseHref}overview`,\n    });\n    sections.push({\n      id: \"promos\",\n      label: \"Códigos promocionais\",\n      href: `${baseHref}promos`,\n    });\n    sections.push({\n      id: \"updates\",\n      label: \"Canal oficial\",\n      href: `${baseHref}updates`,\n    });\n    sections.push({\n      id: \"promoters\",\n      label: \"Promotores e parcerias\",\n      href: `${baseHref}promoters`,\n    });\n    sections.push({\n      id: \"content\",\n      label: \"Conteúdos e kits\",\n      href: `${baseHref}content`,\n    });\n    return sections;\n  }\n\n  if (objective === \"profile\") {\n    return [\n      {\n        id: \"perfil\",\n        label: \"Perfil público\",\n        href: \"/organizador?tab=profile\",\n      },\n    ];\n  }\n\n  return [\n    {\n      id: \"financas\",\n      label: \"Finanças\",\n      href: \"/organizador?tab=analyze&section=financas\",\n    },\n    {\n      id: \"invoices\",\n      label: \"Faturação\",\n      href: \"/organizador?tab=analyze&section=invoices\",\n    },\n  ];\n}\n"],"names":[],"mappings":";;;;;;AAgBO,SAAS,qBAAqB,KAAqB;IACxD,MAAM,aAAa,OAAO,iBAAiB;IAC3C,IAAI,eAAe,SAAS,OAAO;IACnC,IAAI,eAAe,gBAAgB,OAAO;IAC1C,OAAO;AACT;AAEO,SAAS,qBACd,SAAuB,EACvB,OAA4B,EAC5B,QAA0C;IAE1C,MAAM,WAAkC,EAAE;IAE1C,IAAI,cAAc,UAAU;QAC1B,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM;QACR;QACA,IAAI,QAAQ,QAAQ,KAAK,SAAS;YAChC,SAAS,IAAI,CAAC;gBACZ,IAAI;gBACJ,OAAO;gBACP,MAAM;YACR;YACA,OAAO;QACT;QACA,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM;QACR;QACA,OAAO;IACT;IAEA,IAAI,cAAc,WAAW;QAC3B,MAAM,WAAW;QACjB,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM,GAAG,SAAS,QAAQ,CAAC;QAC7B;QACA,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM,GAAG,SAAS,MAAM,CAAC;QAC3B;QACA,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM,GAAG,SAAS,OAAO,CAAC;QAC5B;QACA,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM,GAAG,SAAS,SAAS,CAAC;QAC9B;QACA,SAAS,IAAI,CAAC;YACZ,IAAI;YACJ,OAAO;YACP,MAAM,GAAG,SAAS,OAAO,CAAC;QAC5B;QACA,OAAO;IACT;IAEA,IAAI,cAAc,WAAW;QAC3B,OAAO;YACL;gBACE,IAAI;gBACJ,OAAO;gBACP,MAAM;YACR;SACD;IACH;IAEA,OAAO;QACL;YACE,IAAI;YACJ,OAAO;YACP,MAAM;QACR;QACA;YACE,IAAI;YACJ,OAAO;YACP,MAAM;QACR;KACD;AACH"}},
    {"offset": {"line": 780, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/organizador/ObjectiveSubnav.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport useSWR from \"swr\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  getObjectiveSections,\n  normalizeOrgCategory,\n  type ObjectiveNavContext,\n  type ObjectiveTab,\n} from \"./objectiveNav\";\n\nconst fetcher = (url: string) => fetch(url).then((res) => res.json());\n\nconst OBJECTIVE_LABELS: Record<ObjectiveTab, string> = {\n  manage: \"Gerir\",\n  promote: \"Promover\",\n  analyze: \"Analisar\",\n  profile: \"Perfil\",\n};\n\ntype ObjectiveSubnavProps = {\n  objective: ObjectiveTab;\n  activeId?: string;\n  category?: string | null;\n  modules?: string[] | null;\n  mode?: \"dashboard\" | \"page\";\n  variant?: \"full\" | \"tabs\";\n  hideWhenSingle?: boolean;\n  className?: string;\n};\n\nexport default function ObjectiveSubnav({\n  objective,\n  activeId,\n  category,\n  modules,\n  mode,\n  variant = \"full\",\n  hideWhenSingle = true,\n  className,\n}: ObjectiveSubnavProps) {\n  const { data } = useSWR(category || modules ? null : \"/api/organizador/me\", fetcher);\n  const organizer = data?.organizer ?? null;\n\n  const context: ObjectiveNavContext = {\n    category: normalizeOrgCategory(category ?? organizer?.organizationCategory),\n    modules: Array.isArray(modules) ? modules : Array.isArray(organizer?.modules) ? organizer.modules : [],\n    username: organizer?.username ?? null,\n  };\n\n  const sections = getObjectiveSections(objective, context, { mode });\n  const active =\n    activeId && sections.some((section) => section.id === activeId)\n      ? activeId\n      : sections[0]?.id;\n\n  if (hideWhenSingle && sections.length <= 1) return null;\n\n  const tabs = (\n    <div className=\"flex flex-wrap gap-2 rounded-2xl border border-white/10 bg-white/5 px-2 py-2 text-sm shadow-[0_16px_50px_rgba(0,0,0,0.4)]\">\n      {sections.map((section) => {\n        const isActive = section.id === active;\n        return (\n          <Link\n            key={section.id}\n            href={section.href}\n            className={cn(\n              \"rounded-xl px-3 py-2 font-semibold transition\",\n              isActive\n                ? \"bg-gradient-to-r from-[#FF7AD1]/60 via-[#7FE0FF]/35 to-[#6A7BFF]/55 text-white shadow-[0_14px_36px_rgba(107,255,255,0.45)]\"\n                : \"text-white/80 hover:bg-white/10\",\n            )}\n            aria-current={isActive ? \"page\" : undefined}\n          >\n            {section.label}\n          </Link>\n        );\n      })}\n    </div>\n  );\n\n  if (variant === \"tabs\") {\n    return <div className={className}>{tabs}</div>;\n  }\n\n  return (\n    <div\n      className={cn(\n        \"rounded-3xl border border-white/12 bg-gradient-to-r from-[#0b1226]/80 via-[#101b39]/75 to-[#050811]/90 p-4 shadow-[0_26px_90px_rgba(0,0,0,0.55)] backdrop-blur-2xl\",\n        className,\n      )}\n    >\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-3 py-1 text-[11px] uppercase tracking-[0.26em] text-white/70 shadow-[0_12px_32px_rgba(0,0,0,0.4)]\">\n          Objetivo · {OBJECTIVE_LABELS[objective]}\n        </div>\n        <div className=\"text-[11px] text-white/60\">{sections.length} secções</div>\n      </div>\n      <div className=\"mt-3\">{tabs}</div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAYA,MAAM,UAAU,CAAC,MAAgB,MAAM,KAAK,IAAI,CAAC,CAAC,MAAQ,IAAI,IAAI;AAElE,MAAM,mBAAiD;IACrD,QAAQ;IACR,SAAS;IACT,SAAS;IACT,SAAS;AACX;AAae,SAAS,gBAAgB,EACtC,SAAS,EACT,QAAQ,EACR,QAAQ,EACR,OAAO,EACP,IAAI,EACJ,UAAU,MAAM,EAChB,iBAAiB,IAAI,EACrB,SAAS,EACY;;IACrB,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,4KAAM,EAAC,YAAY,UAAU,OAAO,uBAAuB;IAC5E,MAAM,YAAY,MAAM,aAAa;IAErC,MAAM,UAA+B;QACnC,UAAU,IAAA,6JAAoB,EAAC,YAAY,WAAW;QACtD,SAAS,MAAM,OAAO,CAAC,WAAW,UAAU,MAAM,OAAO,CAAC,WAAW,WAAW,UAAU,OAAO,GAAG,EAAE;QACtG,UAAU,WAAW,YAAY;IACnC;IAEA,MAAM,WAAW,IAAA,6JAAoB,EAAC,WAAW,SAAS;QAAE;IAAK;IACjE,MAAM,SACJ,YAAY,SAAS,IAAI,CAAC,CAAC,UAAY,QAAQ,EAAE,KAAK,YAClD,WACA,QAAQ,CAAC,EAAE,EAAE;IAEnB,IAAI,kBAAkB,SAAS,MAAM,IAAI,GAAG,OAAO;IAEnD,MAAM,qBACJ,6LAAC;QAAI,WAAU;kBACZ,SAAS,GAAG,CAAC,CAAC;YACb,MAAM,WAAW,QAAQ,EAAE,KAAK;YAChC,qBACE,6LAAC,0KAAI;gBAEH,MAAM,QAAQ,IAAI;gBAClB,WAAW,IAAA,qHAAE,EACX,iDACA,WACI,+HACA;gBAEN,gBAAc,WAAW,SAAS;0BAEjC,QAAQ,KAAK;eAVT,QAAQ,EAAE;;;;;QAarB;;;;;;IAIJ,IAAI,YAAY,QAAQ;QACtB,qBAAO,6LAAC;YAAI,WAAW;sBAAY;;;;;;IACrC;IAEA,qBACE,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,sKACA;;0BAGF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BAAsL;4BACvL,gBAAgB,CAAC,UAAU;;;;;;;kCAEzC,6LAAC;wBAAI,WAAU;;4BAA6B,SAAS,MAAM;4BAAC;;;;;;;;;;;;;0BAE9D,6LAAC;gBAAI,WAAU;0BAAQ;;;;;;;;;;;;AAG7B;GAtEwB;;QAUL,4KAAM;;;KAVD"}},
    {"offset": {"line": 911, "column": 0}, "map": {"version":3,"sources":["file:///Users/nuno/orya/ORYA-WebApp/app/organizador/%28dashboard%29/scan/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { CheckinScanner } from \"@/app/components/checkin/CheckinScanner\";\nimport ObjectiveSubnav from \"@/app/organizador/ObjectiveSubnav\";\n\ntype OrganizerScanPageProps = {\n  embedded?: boolean;\n};\n\nexport default function OrganizerScanPage({ embedded }: OrganizerScanPageProps) {\n  const wrapperClass = embedded ? \"space-y-6 text-white\" : \"w-full px-4 py-8 space-y-6 text-white md:px-6 lg:px-8\";\n\n  return (\n    <div className={wrapperClass}>\n      {!embedded && <ObjectiveSubnav objective=\"manage\" activeId=\"checkin\" />}\n      <CheckinScanner\n        backHref=\"/organizador?tab=manage\"\n        backLabel=\"Ver gestão\"\n        title=\"Modo Receção · Organizador\"\n        subtitle=\"Check-in em 2 passos com confirmação explícita.\"\n        allowOrganizerEvents\n        embedded\n        showBackLink={false}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AASe,SAAS,kBAAkB,EAAE,QAAQ,EAA0B;IAC5E,MAAM,eAAe,WAAW,yBAAyB;IAEzD,qBACE,6LAAC;QAAI,WAAW;;YACb,CAAC,0BAAY,6LAAC,oJAAe;gBAAC,WAAU;gBAAS,UAAS;;;;;;0BAC3D,6LAAC,oKAAc;gBACb,UAAS;gBACT,WAAU;gBACV,OAAM;gBACN,UAAS;gBACT,oBAAoB;gBACpB,QAAQ;gBACR,cAAc;;;;;;;;;;;;AAItB;KAjBwB"}}]
}